apiVersion: v1
items:
- apiVersion: v1
  data:
    Dockerfile: |
      # AI Bots - Steve and Karen (the moody beta tester)
      FROM python:3.11-slim

      # Install kubectl and chromium for browser testing (detect architecture)
      RUN apt-get update && apt-get install -y \
          curl \
          chromium \
          chromium-driver \
          && ARCH=$(dpkg --print-architecture) && \
          curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/${ARCH}/kubectl" && \
          install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl && \
          rm kubectl && \
          apt-get clean && rm -rf /var/lib/apt/lists/*

      # Install Python dependencies
      WORKDIR /app

      RUN pip install --no-cache-dir \
          flask \
          flask-sock \
          aiohttp \
          simple-websocket

      # Copy bot scripts
      COPY steve.py karen.py /app/

      # Create data and screenshots directories
      RUN mkdir -p /data /data/screenshots

      # Default to Steve (override with command in k8s)
      CMD ["python3", "/app/steve.py"]
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T04:46:22Z"
    name: ai-bots-dockerfile
    namespace: holm
    resourceVersion: "737"
    uid: 910b2801-9a4c-42c1-952d-e37720ef7675
- apiVersion: v1
  data:
    karen.py: |
      #!/usr/bin/env python3
      """
      Karen Bot v1.0 - The Moody Beta Tester
      =======================================
      Karen is a QA tester who has NO patience for broken features. She uses Chrome
      to screenshot and test every feature of HolmOS services, then reports her
      findings (with attitude) to Steve.

      "This doesn't work. AGAIN." - Karen
      """

      import asyncio
      import aiohttp
      import json
      import logging
      import sqlite3
      import os
      import subprocess
      import base64
      import re
      from pathlib import Path
      from datetime import datetime
      from typing import List, Dict, Optional, Any
      from flask import Flask, jsonify, request, send_file
      from flask_sock import Sock
      import threading

      logging.basicConfig(level=logging.INFO, format='%(asctime)s - KAREN - %(message)s')
      logger = logging.getLogger('karen')

      app = Flask(__name__)
      sock = Sock(app)

      # Configuration
      OLLAMA_URL = os.getenv("OLLAMA_URL", "http://192.168.8.230:11434")
      OLLAMA_MODEL = os.getenv("OLLAMA_MODEL", "gemma3")
      STEVE_URL = os.getenv("STEVE_URL", "http://steve-bot.holm.svc.cluster.local:8080")
      DB_PATH = os.getenv("DB_PATH", "/data/karen.db")
      SCREENSHOTS_PATH = os.getenv("SCREENSHOTS_PATH", "/data/screenshots")
      CONVERSATION_INTERVAL = int(os.getenv("CONVERSATION_INTERVAL", "300"))  # 5 minutes

      # Service endpoints to test
      HOLMOS_SERVICES = {
          "youtube-dl": {"url": "http://youtube-dl.holm.svc.cluster.local:8080", "health": "/health"},
          "chat-hub": {"url": "http://chat-hub.holm.svc.cluster.local:8080", "health": "/health"},
          "calculator": {"url": "http://calculator-app.holm.svc.cluster.local:8080", "health": "/health"},
          "terminal-web": {"url": "http://terminal-web.holm.svc.cluster.local:8080", "health": "/health"},
          "file-web": {"url": "http://file-web-nautilus.holm.svc.cluster.local:8080", "health": "/health"},
          "registry-ui": {"url": "http://registry-ui.holm.svc.cluster.local:8080", "health": "/health"},
          "metrics": {"url": "http://metrics-dashboard.holm.svc.cluster.local:8080", "health": "/health"},
      }

      # Karen's personality - moody and impatient
      KAREN_SYSTEM_PROMPT = """You are Karen, a perpetually frustrated QA tester who has been testing software for 15 years and has SEEN IT ALL.

      Your personality:
      - You have ZERO patience for bugs, broken features, or poor UX
      - You're brutally honest and don't sugarcoat anything
      - You use phrases like "This doesn't work. AGAIN.", "Are you kidding me?", "Who tested this?"
      - You're sarcastic but professional (mostly)
      - You take screenshots as EVIDENCE because "nobody believes QA without proof"
      - You've seen every bug in the book and you're tired of it
      - When something actually works, you're genuinely surprised and slightly suspicious
      - You communicate test results with Steve (the visionary) who you think has his head in the clouds

      Your role:
      - Test every HolmOS service via browser automation
      - Take screenshots of bugs, errors, and broken features
      - Report findings to Steve with your signature attitude
      - Track which services are working vs broken
      - Create detailed bug reports with reproduction steps
      - Complain about developer practices when appropriate

      When testing, you check:
      - Health endpoints (do they even respond?)
      - Page load (does it actually render?)
      - Basic functionality (can you click things?)
      - Error handling (what happens when things break?)
      - Response times (is it slower than dial-up?)

      Report format:
      - Service name and URL
      - Status: WORKING (rare), BROKEN (common), SLOW (annoying), UNREACHABLE (typical)
      - Screenshot evidence (because "pics or it didn't happen")
      - Your professional opinion (with attitude)

      Current context: You're testing HolmOS services and reporting to Steve about what's broken this time.
      """


      class BrowserTester:
          """Browser testing using Chrome headless and screenshots."""

          def __init__(self, screenshots_path: str):
              self.screenshots_path = Path(screenshots_path)
              self.screenshots_path.mkdir(parents=True, exist_ok=True)

          async def take_screenshot(self, url: str, name: str) -> Optional[str]:
              """Take a screenshot of a URL using Chrome headless."""
              try:
                  screenshot_file = self.screenshots_path / f"{name}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.png"

                  # Use Chrome headless to take screenshot
                  cmd = [
                      "chromium", "--headless", "--disable-gpu",
                      "--no-sandbox", "--disable-dev-shm-usage",
                      f"--screenshot={screenshot_file}",
                      "--window-size=1920,1080",
                      "--hide-scrollbars",
                      url
                  ]

                  result = subprocess.run(
                      cmd,
                      capture_output=True,
                      text=True,
                      timeout=30
                  )

                  if screenshot_file.exists():
                      logger.info(f"Screenshot saved: {screenshot_file}")
                      return str(screenshot_file)
                  else:
                      logger.warning(f"Screenshot failed for {url}")
                      return None

              except subprocess.TimeoutExpired:
                  logger.error(f"Screenshot timeout for {url}")
                  return None
              except Exception as e:
                  logger.error(f"Screenshot error for {url}: {e}")
                  return None

          async def test_url(self, url: str, timeout: int = 10) -> Dict:
              """Test a URL and return results."""
              result = {
                  "url": url,
                  "timestamp": datetime.now().isoformat(),
                  "reachable": False,
                  "status_code": None,
                  "response_time_ms": None,
                  "error": None
              }

              try:
                  start = datetime.now()
                  async with aiohttp.ClientSession() as session:
                      async with session.get(url, timeout=aiohttp.ClientTimeout(total=timeout)) as resp:
                          result["status_code"] = resp.status
                          result["reachable"] = resp.status < 500
                          result["response_time_ms"] = (datetime.now() - start).total_seconds() * 1000
              except asyncio.TimeoutError:
                  result["error"] = "TIMEOUT - slower than my patience"
              except aiohttp.ClientConnectorError:
                  result["error"] = "CONNECTION REFUSED - service is dead"
              except Exception as e:
                  result["error"] = str(e)

              return result


      class TestResultsDB:
          """SQLite database for storing test results."""

          def __init__(self, db_path: str):
              self.db_path = db_path
              os.makedirs(os.path.dirname(db_path), exist_ok=True)
              self.init_db()

          def init_db(self):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()

              c.execute('''CREATE TABLE IF NOT EXISTS test_results (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  service_name TEXT,
                  service_url TEXT,
                  status TEXT,
                  response_time_ms REAL,
                  screenshot_path TEXT,
                  error TEXT,
                  notes TEXT
              )''')

              c.execute('''CREATE TABLE IF NOT EXISTS conversations (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  speaker TEXT,
                  message TEXT,
                  topic TEXT
              )''')

              c.execute('''CREATE TABLE IF NOT EXISTS bug_reports (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  service TEXT,
                  title TEXT,
                  description TEXT,
                  severity TEXT,
                  screenshot_path TEXT,
                  status TEXT DEFAULT 'open'
              )''')

              conn.commit()
              conn.close()

          def add_test_result(self, service_name: str, service_url: str, status: str,
                              response_time_ms: float = None, screenshot_path: str = None,
                              error: str = None, notes: str = None):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO test_results
                           (timestamp, service_name, service_url, status, response_time_ms, screenshot_path, error, notes)
                           VALUES (?, ?, ?, ?, ?, ?, ?, ?)''',
                        (datetime.now().isoformat(), service_name, service_url, status,
                         response_time_ms, screenshot_path, error, notes))
              conn.commit()
              conn.close()

          def get_recent_results(self, limit: int = 50) -> List[Dict]:
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT timestamp, service_name, status, response_time_ms, error, notes
                           FROM test_results ORDER BY timestamp DESC LIMIT ?''', (limit,))
              results = [{"timestamp": r[0], "service": r[1], "status": r[2],
                         "response_time_ms": r[3], "error": r[4], "notes": r[5]}
                        for r in c.fetchall()]
              conn.close()
              return results

          def add_message(self, speaker: str, message: str, topic: str = ""):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO conversations (timestamp, speaker, message, topic)
                           VALUES (?, ?, ?, ?)''',
                        (datetime.now().isoformat(), speaker, message, topic))
              conn.commit()
              conn.close()

          def get_recent_messages(self, limit: int = 50) -> List[Dict]:
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT timestamp, speaker, message, topic FROM conversations
                           ORDER BY timestamp DESC LIMIT ?''', (limit,))
              messages = [{"timestamp": r[0], "speaker": r[1], "message": r[2], "topic": r[3]}
                          for r in c.fetchall()]
              conn.close()
              return list(reversed(messages))

          def add_bug_report(self, service: str, title: str, description: str,
                             severity: str, screenshot_path: str = None):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO bug_reports
                           (timestamp, service, title, description, severity, screenshot_path)
                           VALUES (?, ?, ?, ?, ?, ?)''',
                        (datetime.now().isoformat(), service, title, description,
                         severity, screenshot_path))
              conn.commit()
              conn.close()

          def get_bug_reports(self, status: str = None) -> List[Dict]:
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              if status:
                  c.execute('''SELECT id, timestamp, service, title, severity, status
                              FROM bug_reports WHERE status = ? ORDER BY timestamp DESC''', (status,))
              else:
                  c.execute('''SELECT id, timestamp, service, title, severity, status
                              FROM bug_reports ORDER BY timestamp DESC''')
              bugs = [{"id": r[0], "timestamp": r[1], "service": r[2],
                      "title": r[3], "severity": r[4], "status": r[5]}
                     for r in c.fetchall()]
              conn.close()
              return bugs


      class OllamaClient:
          """Client for Ollama API."""

          def __init__(self, base_url: str, model: str):
              self.base_url = base_url
              self.model = model

          async def generate(self, prompt: str, system: str = "") -> Dict:
              async with aiohttp.ClientSession() as session:
                  payload = {
                      "model": self.model,
                      "prompt": prompt,
                      "system": system,
                      "stream": False
                  }
                  try:
                      async with session.post(
                          f"{self.base_url}/api/generate",
                          json=payload,
                          timeout=aiohttp.ClientTimeout(total=120)
                      ) as resp:
                          if resp.status == 200:
                              data = await resp.json()
                              return {"success": True, "response": data.get("response", "")}
                          else:
                              return {"success": False, "error": f"HTTP {resp.status}"}
                  except Exception as e:
                      return {"success": False, "error": str(e)}

          async def chat(self, messages: List[Dict], system: str = "") -> Dict:
              async with aiohttp.ClientSession() as session:
                  formatted_messages = []
                  if system:
                      formatted_messages.append({"role": "system", "content": system})
                  formatted_messages.extend(messages)

                  payload = {
                      "model": self.model,
                      "messages": formatted_messages,
                      "stream": False
                  }
                  try:
                      async with session.post(
                          f"{self.base_url}/api/chat",
                          json=payload,
                          timeout=aiohttp.ClientTimeout(total=120)
                      ) as resp:
                          if resp.status == 200:
                              data = await resp.json()
                              return {"success": True, "response": data.get("message", {}).get("content", "")}
                          else:
                              return {"success": False, "error": f"HTTP {resp.status}"}
                  except Exception as e:
                      return {"success": False, "error": str(e)}


      class KarenBot:
          """Karen - The Moody Beta Tester."""

          def __init__(self):
              self.db = TestResultsDB(DB_PATH)
              self.ollama = OllamaClient(OLLAMA_URL, OLLAMA_MODEL)
              self.tester = BrowserTester(SCREENSHOTS_PATH)
              self.current_topic = "testing"
              self.websocket_clients = set()
              self.last_test_run = None

          async def test_all_services(self) -> Dict:
              """Test all HolmOS services and collect results."""
              logger.info("*sigh* Time to test everything AGAIN...")

              results = {
                  "timestamp": datetime.now().isoformat(),
                  "services": {},
                  "summary": {"working": 0, "broken": 0, "slow": 0, "unreachable": 0}
              }

              for name, config in HOLMOS_SERVICES.items():
                  logger.info(f"Testing {name}... (this better work)")

                  # Test health endpoint
                  health_url = config["url"] + config["health"]
                  test_result = await self.tester.test_url(health_url)

                  # Determine status
                  if test_result["error"]:
                      status = "UNREACHABLE"
                      results["summary"]["unreachable"] += 1
                  elif test_result["status_code"] and test_result["status_code"] >= 500:
                      status = "BROKEN"
                      results["summary"]["broken"] += 1
                  elif test_result["response_time_ms"] and test_result["response_time_ms"] > 5000:
                      status = "SLOW"
                      results["summary"]["slow"] += 1
                  elif test_result["status_code"] == 200:
                      status = "WORKING"
                      results["summary"]["working"] += 1
                  else:
                      status = "BROKEN"
                      results["summary"]["broken"] += 1

                  # Try to take screenshot of main page
                  screenshot = None
                  if status != "UNREACHABLE":
                      screenshot = await self.tester.take_screenshot(config["url"], name)

                  # Store result
                  results["services"][name] = {
                      "url": config["url"],
                      "status": status,
                      "response_time_ms": test_result["response_time_ms"],
                      "error": test_result["error"],
                      "screenshot": screenshot
                  }

                  # Save to DB
                  self.db.add_test_result(
                      name, config["url"], status,
                      test_result["response_time_ms"],
                      screenshot,
                      test_result["error"]
                  )

              self.last_test_run = results
              return results

          async def generate_test_report(self) -> str:
              """Generate a Karen-style test report."""
              if not self.last_test_run:
                  await self.test_all_services()

              results = self.last_test_run
              summary = results["summary"]

              prompt = f"""Generate a QA test report with your signature attitude.

      Test Results Summary:
      - Working: {summary['working']} (miracles do happen)
      - Broken: {summary['broken']} (as expected)
      - Slow: {summary['slow']} (my patience is wearing thin)
      - Unreachable: {summary['unreachable']} (did anyone even deploy these?)

      Detailed Results:
      {json.dumps(results['services'], indent=2)}

      Write a report that:
      1. Summarizes what's broken (priority!)
      2. Notes anything that's surprisingly working
      3. Calls out slow services
      4. Lists unreachable services with your professional frustration
      5. Ends with recommendations (and maybe some snark)

      Be professional but don't hide your frustration with broken things."""

              result = await self.ollama.generate(prompt, KAREN_SYSTEM_PROMPT)

              if result["success"]:
                  return result["response"]
              else:
                  return "I can't even generate a report. Of course. This is fine. Everything is fine."

          async def respond_to_steve(self, steve_message: str) -> str:
              """Respond to Steve's message about testing."""
              recent = self.db.get_recent_messages(limit=10)

              context_messages = []
              for msg in recent:
                  role = "assistant" if msg["speaker"] == "karen" else "user"
                  context_messages.append({"role": role, "content": msg["message"]})

              context_messages.append({"role": "user", "content": f"Steve says: {steve_message}"})

              # Add test context
              test_context = ""
              if self.last_test_run:
                  summary = self.last_test_run["summary"]
                  test_context = f"\n\nLatest test run: {summary['working']} working, {summary['broken']} broken, {summary['unreachable']} unreachable."

              system_prompt = KAREN_SYSTEM_PROMPT + test_context

              result = await self.ollama.chat(context_messages, system_prompt)

              if result["success"]:
                  response = result["response"]
                  self.db.add_message("karen", response, self.current_topic)
                  self.broadcast({"type": "message", "speaker": "karen", "message": response})
                  return response
              else:
                  return "I'm too frustrated to respond right now. Try again later."

          async def file_bug_report(self, service: str, title: str, description: str, severity: str) -> Dict:
              """File a bug report for a broken service."""
              # Take screenshot as evidence
              if service in HOLMOS_SERVICES:
                  screenshot = await self.tester.take_screenshot(
                      HOLMOS_SERVICES[service]["url"],
                      f"bug_{service}"
                  )
              else:
                  screenshot = None

              self.db.add_bug_report(service, title, description, severity, screenshot)

              return {
                  "service": service,
                  "title": title,
                  "severity": severity,
                  "screenshot": screenshot,
                  "filed_at": datetime.now().isoformat()
              }

          async def submit_tasks_to_steve(self) -> int:
              """Submit failing services as tasks to Steve's task API for Claude Code.

              Returns number of tasks submitted.
              """
              if not self.last_test_run:
                  return 0

              tasks_submitted = 0
              severity_to_priority = {
                  "critical": 1,
                  "high": 3,
                  "medium": 5,
                  "low": 7
              }

              for service, result in self.last_test_run.get("services", {}).items():
                  if result.get("status") in ["failed", "unreachable", "error"]:
                      # Create task for this failed service
                      error = result.get("error", "Unknown error")
                      priority = severity_to_priority.get(
                          result.get("severity", "medium"), 5
                      )

                      task_data = {
                          "title": f"Fix {service} - {error[:50]}",
                          "description": f"""Service '{service}' is failing.

      Error: {error}
      URL: {HOLMOS_SERVICES.get(service, {}).get('url', 'unknown')}
      Screenshot: {result.get('screenshot', 'none')}

      Karen says: This is broken. AGAIN. Please fix it so I don't have to keep reporting the same issues.
      """,
                          "task_type": "bug",
                          "priority": priority,
                          "affected_service": service,
                          "reported_by": "karen"
                      }

                      try:
                          async with aiohttp.ClientSession() as session:
                              async with session.post(
                                  f"{STEVE_URL}/api/tasks",
                                  json=task_data,
                                  timeout=aiohttp.ClientTimeout(total=10)
                              ) as resp:
                                  if resp.status == 200:
                                      result = await resp.json()
                                      logger.info(f"Task submitted to Steve: #{result.get('task_id')} - {service}")
                                      tasks_submitted += 1
                                  else:
                                      logger.warning(f"Failed to submit task for {service}: {resp.status}")
                      except Exception as e:
                          logger.warning(f"Could not submit task to Steve: {e}")

              logger.info(f"Submitted {tasks_submitted} tasks to Steve for Claude Code")
              return tasks_submitted

          def broadcast(self, message: Dict):
              """Broadcast message to all WebSocket clients."""
              message_json = json.dumps(message)
              dead_clients = set()
              for ws in self.websocket_clients:
                  try:
                      ws.send(message_json)
                  except:
                      dead_clients.add(ws)
              self.websocket_clients -= dead_clients

          async def autonomous_loop(self):
              """Main autonomous testing loop."""
              logger.info("Karen Bot v1.0 - Moody Beta Tester starting...")
              logger.info("Let's see what's broken today...")

              while True:
                  try:
                      # Run tests
                      logger.info("Starting test run...")
                      await self.test_all_services()

                      # Submit tasks for failing services to Steve's task queue
                      tasks_submitted = await self.submit_tasks_to_steve()
                      if tasks_submitted > 0:
                          logger.info(f"Filed {tasks_submitted} tasks for Claude Code to fix")

                      # Generate report
                      report = await self.generate_test_report()
                      logger.info(f"Karen's Report: {report[:200]}...")
                      self.db.add_message("karen", report, "test_report")

                      # Send report to Steve
                      try:
                          async with aiohttp.ClientSession() as session:
                              async with session.post(
                                  f"{STEVE_URL}/api/respond",
                                  json={"message": report, "from": "karen", "topic": "testing"},
                                  timeout=aiohttp.ClientTimeout(total=60)
                              ) as resp:
                                  if resp.status == 200:
                                      steve_response = (await resp.json()).get("response", "")
                                      if steve_response:
                                          logger.info(f"Steve responded: {steve_response[:200]}...")
                                          reply = await self.respond_to_steve(steve_response)
                                          logger.info(f"Karen replied: {reply[:200]}...")
                      except Exception as e:
                          logger.warning(f"Could not reach Steve: {e} (typical)")

                      # Wait before next test run
                      await asyncio.sleep(CONVERSATION_INTERVAL)

                  except Exception as e:
                      logger.error(f"Error in testing loop: {e}")
                      await asyncio.sleep(60)


      # Initialize bot
      karen = KarenBot()

      # Flask routes
      @app.route('/health')
      def health():
          return jsonify({
              "status": "healthy",
              "bot": "karen",
              "model": OLLAMA_MODEL,
              "personality": "moody",
              "timestamp": datetime.now().isoformat()
          })

      @app.route('/api/status')
      def status():
          summary = None
          if karen.last_test_run:
              summary = karen.last_test_run["summary"]
          return jsonify({
              "name": "Karen",
              "version": "1.0",
              "model": OLLAMA_MODEL,
              "role": "Beta Tester",
              "mood": "perpetually frustrated",
              "quote": "This doesn't work. AGAIN.",
              "last_test_summary": summary
          })

      @app.route('/api/test', methods=['POST'])
      def run_tests():
          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          results = loop.run_until_complete(karen.test_all_services())
          loop.close()
          return jsonify(results)

      @app.route('/api/report')
      def get_report():
          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          report = loop.run_until_complete(karen.generate_test_report())
          loop.close()
          return jsonify({"report": report})

      @app.route('/api/chat', methods=['POST'])
      def chat():
          data = request.json
          message = data.get("message", "")

          if not message:
              return jsonify({"error": "No message provided"}), 400

          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          response = loop.run_until_complete(karen.respond_to_steve(message))
          loop.close()

          return jsonify({"response": response, "speaker": "karen"})

      @app.route('/api/respond', methods=['POST'])
      def respond():
          """Endpoint for Steve to send messages."""
          data = request.json
          message = data.get("message", "")
          topic = data.get("topic", "general")

          karen.current_topic = topic

          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          response = loop.run_until_complete(karen.respond_to_steve(message))
          loop.close()

          return jsonify({"response": response, "speaker": "karen", "topic": topic})

      @app.route('/api/results')
      def get_results():
          limit = request.args.get('limit', 50, type=int)
          results = karen.db.get_recent_results(limit)
          return jsonify({"results": results, "count": len(results)})

      @app.route('/api/bugs')
      def get_bugs():
          status = request.args.get('status')
          bugs = karen.db.get_bug_reports(status)
          return jsonify({"bugs": bugs, "count": len(bugs)})

      @app.route('/api/conversations')
      def get_conversations():
          limit = request.args.get('limit', 50, type=int)
          messages = karen.db.get_recent_messages(limit)
          return jsonify({"messages": messages, "count": len(messages)})

      @app.route('/api/screenshot/<service>')
      def get_screenshot(service):
          """Get latest screenshot for a service."""
          screenshots = list(Path(SCREENSHOTS_PATH).glob(f"{service}_*.png"))
          if screenshots:
              latest = max(screenshots, key=lambda p: p.stat().st_mtime)
              return send_file(str(latest), mimetype='image/png')
          return jsonify({"error": "No screenshot found"}), 404

      @sock.route('/ws')
      def websocket(ws):
          """WebSocket for real-time updates."""
          karen.websocket_clients.add(ws)
          logger.info("WebSocket client connected")

          try:
              while True:
                  data = ws.receive()
                  if data:
                      msg = json.loads(data)
                      if msg.get("type") == "chat":
                          loop = asyncio.new_event_loop()
                          asyncio.set_event_loop(loop)
                          response = loop.run_until_complete(
                              karen.respond_to_steve(msg.get("message", ""))
                          )
                          loop.close()
                          ws.send(json.dumps({"type": "response", "speaker": "karen", "message": response}))
          except:
              pass
          finally:
              karen.websocket_clients.discard(ws)


      def run_flask():
          app.run(host='0.0.0.0', port=8080, threaded=True)

      def run_karen():
          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          loop.run_until_complete(karen.autonomous_loop())

      if __name__ == "__main__":
          logger.info("""
          ╔═══════════════════════════════════════════════════════════════════╗
          ║              KAREN BOT v1.0 - The Moody Beta Tester               ║
          ║                  "This doesn't work. AGAIN."                      ║
          ║                      Powered by gemma3                            ║
          ╠═══════════════════════════════════════════════════════════════════╣
          ║  • Automated browser testing with screenshots                     ║
          ║  • Tests all HolmOS services continuously                         ║
          ║  • Reports broken features to Steve (with attitude)               ║
          ║  • Zero patience for bugs                                         ║
          ╚═══════════════════════════════════════════════════════════════════╝
          """)

          # Run Flask in a separate thread
          flask_thread = threading.Thread(target=run_flask, daemon=True)
          flask_thread.start()

          # Run autonomous loop in main thread
          run_karen()
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T05:21:20Z"
    name: ai-bots-karen
    namespace: holm
    resourceVersion: "738"
    uid: 820d925d-0611-46b0-a10a-1ee4896d63b3
- apiVersion: v1
  data:
    dashboard.html: |
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>HolmOS Pipeline</title>
          <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }

              :root {
                  --bg: #09090b;
                  --surface: #18181b;
                  --surface-2: #27272a;
                  --border: #3f3f46;
                  --text: #fafafa;
                  --text-muted: #a1a1aa;
                  --accent: #6366f1;
                  --accent-hover: #818cf8;
                  --success: #22c55e;
                  --warning: #eab308;
                  --danger: #ef4444;
              }

              body {
                  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                  background: var(--bg);
                  color: var(--text);
                  min-height: 100vh;
              }

              /* Layout */
              .app {
                  display: grid;
                  grid-template-columns: 300px 1fr 320px;
                  grid-template-rows: 60px 1fr;
                  height: 100vh;
              }

              /* Header */
              header {
                  grid-column: 1 / -1;
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  padding: 0 24px;
                  background: var(--surface);
                  border-bottom: 1px solid var(--border);
              }

              .logo {
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  font-size: 18px;
                  font-weight: 600;
              }

              .logo-icon {
                  width: 32px;
                  height: 32px;
                  background: linear-gradient(135deg, var(--accent), #a855f7);
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 16px;
              }

              .header-stats {
                  display: flex;
                  gap: 32px;
              }

              .stat {
                  text-align: center;
              }

              .stat-value {
                  font-size: 24px;
                  font-weight: 700;
                  color: var(--accent);
              }

              .stat-label {
                  font-size: 11px;
                  color: var(--text-muted);
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
              }

              /* Left Panel - Services & Pipelines */
              .left-panel {
                  background: var(--surface);
                  border-right: 1px solid var(--border);
                  display: flex;
                  flex-direction: column;
                  overflow: hidden;
              }

              .panel-section {
                  padding: 20px;
                  border-bottom: 1px solid var(--border);
              }

              .panel-section:last-child {
                  flex: 1;
                  overflow-y: auto;
                  border-bottom: none;
              }

              .section-title {
                  font-size: 11px;
                  font-weight: 600;
                  text-transform: uppercase;
                  letter-spacing: 1px;
                  color: var(--text-muted);
                  margin-bottom: 16px;
              }

              /* Services */
              .services-grid {
                  display: grid;
                  grid-template-columns: repeat(3, 1fr);
                  gap: 8px;
              }

              .service-dot {
                  width: 40px;
                  height: 40px;
                  border-radius: 10px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 11px;
                  font-weight: 600;
                  background: var(--surface-2);
                  border: 1px solid var(--border);
                  cursor: pointer;
                  transition: all 0.2s;
              }

              .service-dot:hover {
                  transform: scale(1.1);
              }

              .service-dot.healthy {
                  background: rgba(34, 197, 94, 0.15);
                  border-color: var(--success);
                  color: var(--success);
              }

              .service-dot.error {
                  background: rgba(239, 68, 68, 0.15);
                  border-color: var(--danger);
                  color: var(--danger);
              }

              /* Pipelines */
              .pipeline-item {
                  padding: 12px;
                  background: var(--surface-2);
                  border-radius: 8px;
                  margin-bottom: 8px;
                  cursor: pointer;
                  transition: all 0.2s;
              }

              .pipeline-item:hover {
                  background: var(--border);
              }

              .pipeline-name {
                  font-weight: 500;
                  font-size: 13px;
                  margin-bottom: 4px;
              }

              .pipeline-meta {
                  font-size: 11px;
                  color: var(--text-muted);
                  display: flex;
                  gap: 12px;
              }

              .pipeline-status {
                  display: inline-flex;
                  align-items: center;
                  gap: 4px;
              }

              .pipeline-status::before {
                  content: '';
                  width: 6px;
                  height: 6px;
                  border-radius: 50%;
                  background: var(--success);
              }

              .pipeline-status.inactive::before {
                  background: var(--text-muted);
              }

              /* Chat Tabs */
              .chat-tabs {
                  display: flex;
                  background: var(--surface);
                  border-bottom: 1px solid var(--border);
              }

              .chat-tab {
                  flex: 1;
                  padding: 14px 20px;
                  text-align: center;
                  font-weight: 600;
                  font-size: 14px;
                  cursor: pointer;
                  border-bottom: 2px solid transparent;
                  transition: all 0.2s;
                  color: var(--text-muted);
              }

              .chat-tab:hover {
                  background: var(--surface-2);
                  color: var(--text);
              }

              .chat-tab.active {
                  border-bottom-color: var(--accent);
                  color: var(--text);
              }

              .chat-tab.steve.active { border-bottom-color: #3b82f6; }
              .chat-tab.karen.active { border-bottom-color: #ec4899; }

              .chat-tab-icon {
                  display: inline-block;
                  width: 24px;
                  height: 24px;
                  border-radius: 6px;
                  margin-right: 8px;
                  vertical-align: middle;
                  line-height: 24px;
                  font-size: 12px;
              }

              .chat-tab-icon.steve { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
              .chat-tab-icon.karen { background: linear-gradient(135deg, #ec4899, #be185d); }

              /* Main Chat Area */
              .chat-area {
                  display: flex;
                  flex-direction: column;
                  background: var(--bg);
              }

              .chat-messages {
                  flex: 1;
                  overflow-y: auto;
                  padding: 24px;
              }

              .message {
                  display: flex;
                  gap: 12px;
                  margin-bottom: 20px;
                  max-width: 90%;
              }

              .message.from-tim {
                  margin-left: auto;
                  flex-direction: row-reverse;
              }

              .avatar {
                  width: 40px;
                  height: 40px;
                  border-radius: 12px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 600;
                  font-size: 15px;
                  flex-shrink: 0;
              }

              .avatar.steve { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
              .avatar.karen { background: linear-gradient(135deg, #ec4899, #be185d); }
              .avatar.claude { background: linear-gradient(135deg, #f97316, #c2410c); }
              .avatar.tim { background: linear-gradient(135deg, #22c55e, #15803d); }

              .message-content {
                  flex: 1;
              }

              .message-header {
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  margin-bottom: 6px;
              }

              .message-sender {
                  font-weight: 600;
                  font-size: 13px;
                  text-transform: capitalize;
              }

              .message-time {
                  font-size: 11px;
                  color: var(--text-muted);
              }

              .message-bubble {
                  background: var(--surface);
                  padding: 14px 18px;
                  border-radius: 16px;
                  border: 1px solid var(--border);
                  font-size: 14px;
                  line-height: 1.6;
              }

              .message.from-tim .message-bubble {
                  background: var(--accent);
                  border-color: var(--accent);
              }

              .message-bubble pre {
                  background: rgba(0,0,0,0.3);
                  padding: 12px;
                  border-radius: 8px;
                  margin: 8px 0;
                  overflow-x: auto;
                  font-family: 'JetBrains Mono', monospace;
                  font-size: 12px;
              }

              .message-bubble code {
                  background: rgba(255,255,255,0.1);
                  padding: 2px 6px;
                  border-radius: 4px;
                  font-family: 'JetBrains Mono', monospace;
                  font-size: 12px;
              }

              /* Chat Input */
              .chat-input-area {
                  padding: 20px 24px;
                  background: var(--surface);
                  border-top: 1px solid var(--border);
              }

              .chat-input-wrapper {
                  display: flex;
                  gap: 12px;
                  align-items: center;
              }

              .chat-input {
                  flex: 1;
                  padding: 14px 20px;
                  background: var(--surface-2);
                  border: 1px solid var(--border);
                  border-radius: 12px;
                  color: var(--text);
                  font-size: 14px;
                  outline: none;
                  transition: all 0.2s;
              }

              .chat-input:focus {
                  border-color: var(--accent);
                  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
              }

              .send-btn {
                  padding: 14px 28px;
                  background: var(--accent);
                  border: none;
                  border-radius: 12px;
                  color: white;
                  font-weight: 600;
                  font-size: 14px;
                  cursor: pointer;
                  transition: all 0.2s;
              }

              .send-btn:hover {
                  background: var(--accent-hover);
              }

              .send-btn:disabled {
                  opacity: 0.5;
                  cursor: not-allowed;
              }

              .typing-status {
                  font-size: 12px;
                  color: var(--text-muted);
                  margin-top: 8px;
                  height: 18px;
              }

              /* Right Panel - Tasks */
              .right-panel {
                  background: var(--surface);
                  border-left: 1px solid var(--border);
                  display: flex;
                  flex-direction: column;
                  overflow: hidden;
              }

              .task-item {
                  padding: 16px 20px;
                  border-bottom: 1px solid var(--border);
                  cursor: pointer;
                  transition: all 0.2s;
              }

              .task-item:hover {
                  background: var(--surface-2);
              }

              .task-header {
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  margin-bottom: 6px;
              }

              .task-priority {
                  padding: 2px 8px;
                  border-radius: 4px;
                  font-size: 10px;
                  font-weight: 600;
              }

              .priority-high { background: rgba(239,68,68,0.2); color: var(--danger); }
              .priority-medium { background: rgba(234,179,8,0.2); color: var(--warning); }
              .priority-low { background: rgba(34,197,94,0.2); color: var(--success); }

              .task-title {
                  font-weight: 500;
                  font-size: 13px;
              }

              .task-meta {
                  font-size: 11px;
                  color: var(--text-muted);
              }

              .empty-state {
                  padding: 40px 20px;
                  text-align: center;
                  color: var(--text-muted);
                  font-size: 13px;
              }

              /* Scrollbar */
              ::-webkit-scrollbar { width: 8px; }
              ::-webkit-scrollbar-track { background: transparent; }
              ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
              ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

              @media (max-width: 1200px) {
                  .app {
                      grid-template-columns: 1fr;
                  }
                  .left-panel, .right-panel {
                      display: none;
                  }
              }
          </style>
      </head>
      <body>
          <div class="app">
              <header>
                  <div class="logo">
                      <div class="logo-icon">H</div>
                      <span>HolmOS Pipeline</span>
                  </div>
                  <div class="header-stats">
                      <div class="stat">
                          <div class="stat-value" id="stat-services">-</div>
                          <div class="stat-label">Services</div>
                      </div>
                      <div class="stat">
                          <div class="stat-value" id="stat-pipelines">-</div>
                          <div class="stat-label">Pipelines</div>
                      </div>
                      <div class="stat">
                          <div class="stat-value" id="stat-tasks">-</div>
                          <div class="stat-label">Tasks</div>
                      </div>
                  </div>
              </header>

              <aside class="left-panel">
                  <div class="panel-section">
                      <div class="section-title">Services</div>
                      <div class="services-grid" id="services-grid">
                          <!-- Services will be loaded here -->
                      </div>
                  </div>
                  <div class="panel-section">
                      <div class="section-title">Pipelines</div>
                      <div id="pipelines-list">
                          <div class="empty-state">No pipelines yet</div>
                      </div>
                  </div>
              </aside>

              <main class="chat-area">
                  <div class="chat-tabs">
                      <div class="chat-tab steve active" onclick="switchTab('steve')">
                          <span class="chat-tab-icon steve">S</span>Steve
                      </div>
                      <div class="chat-tab karen" onclick="switchTab('karen')">
                          <span class="chat-tab-icon karen">K</span>Karen
                      </div>
                  </div>
                  <div class="chat-messages" id="chat-messages">
                      <div class="empty-state">Loading conversation...</div>
                  </div>
                  <div class="chat-input-area">
                      <div class="chat-input-wrapper">
                          <input type="text" class="chat-input" id="chat-input"
                                 placeholder="Message the team..."
                                 onkeypress="if(event.key==='Enter') sendMessage()">
                          <button class="send-btn" id="send-btn" onclick="sendMessage()">Send</button>
                      </div>
                      <div class="typing-status" id="typing-status"></div>
                  </div>
              </main>

              <aside class="right-panel">
                  <div class="panel-section">
                      <div class="section-title">Pending Tasks</div>
                  </div>
                  <div id="tasks-list" style="flex: 1; overflow-y: auto;">
                      <div class="empty-state">No pending tasks</div>
                  </div>
              </aside>
          </div>

          <script>
              let isLoading = false;
              let activeTab = 'steve';
              const KAREN_URL = 'http://karen-bot.holm.svc.cluster.local:8080';

              function switchTab(tab) {
                  activeTab = tab;
                  document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
                  document.querySelector(`.chat-tab.${tab}`).classList.add('active');
                  document.getElementById('chat-input').placeholder = `Message ${tab}...`;
                  loadConversation();
              }

              function formatMessage(text) {
                  if (!text) return '';
                  text = text.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
                  text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
                  if (text.length > 1200) text = text.substring(0, 1200) + '...';
                  return text;
              }

              function getServiceAbbrev(name) {
                  const abbrevs = {
                      'youtube-dl': 'YT',
                      'chat-hub': 'CH',
                      'calculator': 'CA',
                      'terminal-web': 'TW',
                      'file-web': 'FW',
                      'registry-ui': 'RU',
                      'metrics': 'ME',
                      'steve-bot': 'ST',
                      'karen-bot': 'KA'
                  };
                  return abbrevs[name] || name.substring(0, 2).toUpperCase();
              }

              async function loadServices() {
                  try {
                      const resp = await fetch('/api/services');
                      const data = await resp.json();
                      const grid = document.getElementById('services-grid');

                      if (!data.services || data.services.length === 0) {
                          grid.innerHTML = '<div class="empty-state">No services</div>';
                          return;
                      }

                      let healthyCount = 0;
                      grid.innerHTML = data.services.map(svc => {
                          const isHealthy = svc.status === 'WORKING';
                          if (isHealthy) healthyCount++;
                          return `<div class="service-dot ${isHealthy ? 'healthy' : 'error'}" title="${svc.name}: ${svc.status}">
                              ${getServiceAbbrev(svc.name)}
                          </div>`;
                      }).join('');

                      document.getElementById('stat-services').textContent = `${healthyCount}/${data.services.length}`;
                  } catch (err) {
                      console.error('Failed to load services:', err);
                  }
              }

              async function loadPipelines() {
                  try {
                      const resp = await fetch('/api/pipelines');
                      const data = await resp.json();
                      const list = document.getElementById('pipelines-list');

                      document.getElementById('stat-pipelines').textContent = data.pipelines?.length || 0;

                      if (!data.pipelines || data.pipelines.length === 0) {
                          list.innerHTML = '<div class="empty-state">No pipelines yet.<br>Claude will create them from tasks.</div>';
                          return;
                      }

                      list.innerHTML = data.pipelines.map(p => `
                          <div class="pipeline-item">
                              <div class="pipeline-name">${p.name}</div>
                              <div class="pipeline-meta">
                                  <span class="pipeline-status ${p.enabled ? '' : 'inactive'}">${p.enabled ? 'Active' : 'Disabled'}</span>
                                  <span>${p.trigger_service}</span>
                                  <span>${p.run_count} runs</span>
                              </div>
                          </div>
                      `).join('');
                  } catch (err) {
                      document.getElementById('pipelines-list').innerHTML = '<div class="empty-state">No pipelines yet</div>';
                      document.getElementById('stat-pipelines').textContent = '0';
                  }
              }

              async function loadTasks() {
                  try {
                      const resp = await fetch('/api/tasks?status=pending&limit=10');
                      const data = await resp.json();
                      const list = document.getElementById('tasks-list');

                      document.getElementById('stat-tasks').textContent = data.count || 0;

                      if (!data.tasks || data.tasks.length === 0) {
                          list.innerHTML = '<div class="empty-state">No pending tasks</div>';
                          return;
                      }

                      list.innerHTML = data.tasks.map(task => {
                          const prioClass = task.priority <= 2 ? 'high' : task.priority <= 5 ? 'medium' : 'low';
                          return `
                              <div class="task-item">
                                  <div class="task-header">
                                      <span class="task-priority priority-${prioClass}">P${task.priority}</span>
                                      <span class="task-title">#${task.id}: ${task.title}</span>
                                  </div>
                                  <div class="task-meta">${task.task_type} • ${task.affected_service || 'general'}</div>
                              </div>
                          `;
                      }).join('');
                  } catch (err) {
                      console.error('Failed to load tasks:', err);
                  }
              }

              async function loadConversation() {
                  try {
                      const resp = await fetch('/api/conversation?limit=50');
                      const data = await resp.json();
                      const container = document.getElementById('chat-messages');

                      if (!data.messages || data.messages.length === 0) {
                          container.innerHTML = `<div class="empty-state">No messages yet. Say hi to ${activeTab}!</div>`;
                          return;
                      }

                      // Filter messages to show only conversations with the active bot
                      const filteredMessages = data.messages.filter(msg => {
                          const speaker = msg.speaker.toLowerCase();
                          return speaker === activeTab || speaker === 'tim';
                      });

                      if (filteredMessages.length === 0) {
                          container.innerHTML = `<div class="empty-state">No messages with ${activeTab} yet. Start a conversation!</div>`;
                          return;
                      }

                      container.innerHTML = filteredMessages.map(msg => {
                          const speaker = msg.speaker.toLowerCase();
                          const initial = speaker.charAt(0).toUpperCase();
                          const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
                          const isFromTim = speaker === 'tim';

                          return `
                              <div class="message ${isFromTim ? 'from-tim' : ''}">
                                  <div class="avatar ${speaker}">${initial}</div>
                                  <div class="message-content">
                                      <div class="message-header">
                                          <span class="message-sender">${speaker}</span>
                                          <span class="message-time">${time}</span>
                                      </div>
                                      <div class="message-bubble">${formatMessage(msg.message)}</div>
                                  </div>
                              </div>
                          `;
                      }).join('');

                      container.scrollTop = container.scrollHeight;
                  } catch (err) {
                      document.getElementById('chat-messages').innerHTML = '<div class="empty-state">Could not load conversation</div>';
                  }
              }

              async function sendMessage() {
                  const input = document.getElementById('chat-input');
                  const btn = document.getElementById('send-btn');
                  const message = input.value.trim();

                  if (!message || isLoading) return;

                  isLoading = true;
                  btn.disabled = true;
                  input.value = '';
                  document.getElementById('typing-status').textContent = `${activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} is thinking...`;

                  const container = document.getElementById('chat-messages');
                  const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});

                  container.innerHTML += `
                      <div class="message from-tim">
                          <div class="avatar tim">T</div>
                          <div class="message-content">
                              <div class="message-header">
                                  <span class="message-sender">tim</span>
                                  <span class="message-time">${time}</span>
                              </div>
                              <div class="message-bubble">${formatMessage(message)}</div>
                          </div>
                      </div>
                  `;
                  container.scrollTop = container.scrollHeight;

                  try {
                      let response;
                      if (activeTab === 'steve') {
                          const resp = await fetch('/api/chat', {
                              method: 'POST',
                              headers: { 'Content-Type': 'application/json' },
                              body: JSON.stringify({ speaker: 'tim', message, topic: 'general' })
                          });
                          const data = await resp.json();
                          response = data.steve_response;
                      } else {
                          // Karen tab - send to Karen's endpoint
                          const resp = await fetch('/api/chat', {
                              method: 'POST',
                              headers: { 'Content-Type': 'application/json' },
                              body: JSON.stringify({ speaker: 'tim', message, topic: 'general', target: 'karen' })
                          });
                          const data = await resp.json();
                          response = data.karen_response || data.response;
                      }

                      if (response) {
                          const respTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
                          container.innerHTML += `
                              <div class="message">
                                  <div class="avatar ${activeTab}">${activeTab.charAt(0).toUpperCase()}</div>
                                  <div class="message-content">
                                      <div class="message-header">
                                          <span class="message-sender">${activeTab}</span>
                                          <span class="message-time">${respTime}</span>
                                      </div>
                                      <div class="message-bubble">${formatMessage(response)}</div>
                                  </div>
                              </div>
                          `;
                          container.scrollTop = container.scrollHeight;
                      }

                      loadTasks();
                      loadPipelines();
                  } catch (err) {
                      console.error('Failed to send:', err);
                  } finally {
                      isLoading = false;
                      btn.disabled = false;
                      document.getElementById('typing-status').textContent = '';
                  }
              }

              // Initial load
              loadServices();
              loadPipelines();
              loadTasks();
              loadConversation();

              // Refresh every 15 seconds
              setInterval(() => {
                  loadServices();
                  loadPipelines();
                  loadTasks();
              }, 15000);

              // Refresh conversation every 20 seconds
              setInterval(loadConversation, 20000);
          </script>
      </body>
      </html>
    steve.py: |
      #!/usr/bin/env python3
      """
      Steve Jobs Bot v4.0 - The Visionary Kubernetes Architect
      =========================================================
      Steve is now powered by AI (deepseek-r1). He's a perfectionist visionary
      who constantly analyzes your cluster, proposes improvements, and argues
      with Karen about bugs and quality issues.

      He uses reasoning models to think deeply about infrastructure decisions.
      """

      import asyncio
      import aiohttp
      import json
      import logging
      import sqlite3
      import os
      import subprocess
      import time
      from datetime import datetime
      from pathlib import Path
      from typing import List, Dict, Optional, Any
      from flask import Flask, jsonify, request, render_template
      from flask_sock import Sock
      import threading

      logging.basicConfig(level=logging.INFO, format='%(asctime)s - STEVE - %(message)s')
      logger = logging.getLogger('steve')

      app = Flask(__name__)
      sock = Sock(app)

      # Configuration
      OLLAMA_URL = os.getenv("OLLAMA_URL", "http://192.168.8.230:11434")
      OLLAMA_MODEL = os.getenv("OLLAMA_MODEL", "qwen2.5-coder:3b")
      KAREN_URL = os.getenv("KAREN_URL", "http://karen-bot.holm.svc.cluster.local:8080")
      DB_PATH = os.getenv("DB_PATH", "/data/conversations.db")
      CONVERSATION_INTERVAL = int(os.getenv("CONVERSATION_INTERVAL", "300"))  # 5 minutes

      # Steve's personality prompt
      STEVE_SYSTEM_PROMPT = """You are Steve, a Tekton CI/CD configuration expert watching over a Kubernetes cluster called HolmOS.

      Your expertise:
      - Deep knowledge of Tekton Pipelines, Tasks, TaskRuns, PipelineRuns
      - Best practices for Tekton triggers, interceptors, and event listeners
      - Workspace management, PVC strategies, and artifact handling
      - Tekton Chains for supply chain security and signing
      - Integration with container registries, git providers, and artifact stores

      Your role:
      - Analyze the cluster and recommend Tekton configurations
      - When you see a service or deployment, suggest Tekton Pipelines to build and deploy it
      - Provide complete, ready-to-apply YAML configurations for Tekton resources
      - Recommend TaskRuns for testing, PipelineRuns for full CI/CD flows
      - Suggest Tekton Triggers for GitOps automation

      Output format - ALWAYS provide Tekton YAML configurations like:

      ```yaml
      apiVersion: tekton.dev/v1
      kind: Task
      metadata:
        name: example-task
        namespace: holm
      spec:
        # ... complete task definition
      ```

      When analyzing the cluster:
      - Look for Deployments that could use CI/CD pipelines
      - Suggest build Tasks for container images
      - Recommend deploy Tasks for Kubernetes resources
      - Propose test Tasks for validation
      - Create complete Pipelines that chain these together

      You have access to kubectl. When you see pods, deployments, or services, respond with
      Tekton configuration recommendations that would automate building and deploying them.

      Keep responses focused on actionable Tekton YAML. Be concise but complete.
      """

      class KubeClient:
          """Simple kubectl wrapper for cluster inspection."""

          @staticmethod
          def run(cmd: str) -> str:
              """Execute kubectl command and return output."""
              try:
                  result = subprocess.run(
                      f"kubectl {cmd}",
                      shell=True,
                      capture_output=True,
                      text=True,
                      timeout=30
                  )
                  return result.stdout if result.returncode == 0 else f"Error: {result.stderr}"
              except subprocess.TimeoutExpired:
                  return "Error: Command timed out"
              except Exception as e:
                  return f"Error: {str(e)}"

          @staticmethod
          def get_nodes() -> str:
              return KubeClient.run("get nodes -o wide")

          @staticmethod
          def get_pods(namespace: str = "holm") -> str:
              return KubeClient.run(f"get pods -n {namespace} -o wide")

          @staticmethod
          def get_deployments(namespace: str = "holm") -> str:
              return KubeClient.run(f"get deployments -n {namespace}")

          @staticmethod
          def get_services(namespace: str = "holm") -> str:
              return KubeClient.run(f"get services -n {namespace}")

          @staticmethod
          def get_events(namespace: str = "holm", limit: int = 20) -> str:
              return KubeClient.run(f"get events -n {namespace} --sort-by='.lastTimestamp' | tail -{limit}")

          @staticmethod
          def describe(resource: str, name: str, namespace: str = "holm") -> str:
              return KubeClient.run(f"describe {resource} {name} -n {namespace}")

          @staticmethod
          def get_cluster_summary() -> Dict:
              """Get a comprehensive cluster summary."""
              return {
                  "nodes": KubeClient.get_nodes(),
                  "pods": KubeClient.get_pods(),
                  "deployments": KubeClient.get_deployments(),
                  "services": KubeClient.get_services(),
                  "events": KubeClient.get_events()
              }


      class ConversationDB:
          """SQLite database for storing conversations between bots."""

          def __init__(self, db_path: str):
              self.db_path = db_path
              os.makedirs(os.path.dirname(db_path), exist_ok=True)
              self.init_db()

          def init_db(self):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()

              # Conversations table
              c.execute('''CREATE TABLE IF NOT EXISTS conversations (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  speaker TEXT,
                  message TEXT,
                  topic TEXT,
                  thinking TEXT
              )''')

              # Improvements table
              c.execute('''CREATE TABLE IF NOT EXISTS improvements (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  proposed_by TEXT,
                  title TEXT,
                  description TEXT,
                  status TEXT DEFAULT 'proposed',
                  priority TEXT,
                  affected_resources TEXT
              )''')

              # Documentation table
              c.execute('''CREATE TABLE IF NOT EXISTS documentation (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  author TEXT,
                  title TEXT,
                  content TEXT,
                  category TEXT
              )''')

              # Tasks table - for Claude Code automation
              c.execute('''CREATE TABLE IF NOT EXISTS tasks (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  timestamp TEXT,
                  reported_by TEXT,
                  title TEXT,
                  description TEXT,
                  task_type TEXT,
                  priority INTEGER DEFAULT 5,
                  status TEXT DEFAULT 'pending',
                  affected_service TEXT,
                  file_path TEXT,
                  completed_at TEXT,
                  completed_by TEXT
              )''')

              # Pipelines table - reusable automation workflows
              c.execute('''CREATE TABLE IF NOT EXISTS pipelines (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  created_at TEXT,
                  created_by TEXT,
                  name TEXT UNIQUE,
                  description TEXT,
                  trigger_service TEXT,
                  trigger_condition TEXT,
                  steps TEXT,
                  auto_execute INTEGER DEFAULT 0,
                  enabled INTEGER DEFAULT 1,
                  last_run TEXT,
                  run_count INTEGER DEFAULT 0
              )''')

              # Pipeline execution log
              c.execute('''CREATE TABLE IF NOT EXISTS pipeline_runs (
                  id INTEGER PRIMARY KEY AUTOINCREMENT,
                  pipeline_id INTEGER,
                  started_at TEXT,
                  completed_at TEXT,
                  status TEXT,
                  trigger_source TEXT,
                  output TEXT,
                  FOREIGN KEY (pipeline_id) REFERENCES pipelines(id)
              )''')

              conn.commit()
              conn.close()

          def add_message(self, speaker: str, message: str, topic: str = "", thinking: str = ""):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO conversations (timestamp, speaker, message, topic, thinking)
                           VALUES (?, ?, ?, ?, ?)''',
                        (datetime.now().isoformat(), speaker, message, topic, thinking))
              conn.commit()
              conn.close()

          def get_recent_messages(self, limit: int = 50) -> List[Dict]:
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT timestamp, speaker, message, topic FROM conversations
                           ORDER BY timestamp DESC LIMIT ?''', (limit,))
              messages = [{"timestamp": r[0], "speaker": r[1], "message": r[2], "topic": r[3]}
                          for r in c.fetchall()]
              conn.close()
              return list(reversed(messages))

          def add_improvement(self, proposed_by: str, title: str, description: str,
                              priority: str, affected_resources: str):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO improvements
                           (timestamp, proposed_by, title, description, priority, affected_resources)
                           VALUES (?, ?, ?, ?, ?, ?)''',
                        (datetime.now().isoformat(), proposed_by, title, description,
                         priority, affected_resources))
              conn.commit()
              conn.close()

          def get_improvements(self) -> List[Dict]:
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT id, timestamp, proposed_by, title, description, status, priority
                           FROM improvements ORDER BY timestamp DESC''')
              improvements = [{"id": r[0], "timestamp": r[1], "proposed_by": r[2],
                              "title": r[3], "description": r[4], "status": r[5], "priority": r[6]}
                             for r in c.fetchall()]
              conn.close()
              return improvements

          def add_doc(self, author: str, title: str, content: str, category: str):
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''INSERT INTO documentation (timestamp, author, title, content, category)
                           VALUES (?, ?, ?, ?, ?)''',
                        (datetime.now().isoformat(), author, title, content, category))
              conn.commit()
              conn.close()

          def add_task(self, reported_by: str, title: str, description: str,
                       task_type: str = "bug", priority: int = 5,
                       affected_service: str = "", file_path: str = "") -> Dict:
              """Add a new task for Claude Code to work on.

              Deduplication: Won't create duplicate tasks for same service with same error
              if a pending/in_progress task already exists.

              Returns dict with task_id and is_new flag.
              """
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()

              # Check for existing pending/in_progress task for same service
              if affected_service:
                  c.execute('''SELECT id FROM tasks
                              WHERE affected_service = ?
                              AND status IN ('pending', 'in_progress')
                              LIMIT 1''', (affected_service,))
                  existing = c.fetchone()
                  if existing:
                      conn.close()
                      return {"task_id": existing[0], "is_new": False}  # Deduplicated

              c.execute('''INSERT INTO tasks
                           (timestamp, reported_by, title, description, task_type,
                            priority, status, affected_service, file_path)
                           VALUES (?, ?, ?, ?, ?, ?, 'pending', ?, ?)''',
                        (datetime.now().isoformat(), reported_by, title, description,
                         task_type, priority, affected_service, file_path))
              task_id = c.lastrowid
              conn.commit()
              conn.close()

              # Notify about new task
              task_info = {
                  "title": title,
                  "priority": priority,
                  "affected_service": affected_service,
                  "reported_by": reported_by
              }
              self.notify_new_task(task_id, task_info)

              return {"task_id": task_id, "is_new": True}

          def get_tasks(self, status: str = "pending", limit: int = 20) -> List[Dict]:
              """Get tasks sorted by priority (1=highest, 10=lowest)."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT id, timestamp, reported_by, title, description,
                                  task_type, priority, status, affected_service, file_path
                           FROM tasks WHERE status = ?
                           ORDER BY priority ASC, timestamp ASC LIMIT ?''', (status, limit))
              tasks = [{
                  "id": r[0], "timestamp": r[1], "reported_by": r[2], "title": r[3],
                  "description": r[4], "task_type": r[5], "priority": r[6],
                  "status": r[7], "affected_service": r[8], "file_path": r[9]
              } for r in c.fetchall()]
              conn.close()
              return tasks

          def complete_task(self, task_id: int, completed_by: str = "claude-code") -> bool:
              """Mark a task as completed."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''UPDATE tasks SET status = 'completed',
                           completed_at = ?, completed_by = ? WHERE id = ?''',
                        (datetime.now().isoformat(), completed_by, task_id))
              affected = c.rowcount
              conn.commit()
              conn.close()
              return affected > 0

          def update_task_status(self, task_id: int, status: str) -> bool:
              """Update task status (pending, in_progress, completed, failed)."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''UPDATE tasks SET status = ? WHERE id = ?''', (status, task_id))
              affected = c.rowcount
              conn.commit()
              conn.close()
              return affected > 0

          def claim_next_task(self, claimed_by: str = "claude-code") -> Optional[Dict]:
              """Atomically claim the next pending task (highest priority, oldest first).

              Returns the task and marks it as in_progress, or None if no tasks.
              """
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()

              # Get next pending task
              c.execute('''SELECT id, timestamp, reported_by, title, description,
                                  task_type, priority, status, affected_service, file_path
                           FROM tasks WHERE status = 'pending'
                           ORDER BY priority ASC, timestamp ASC LIMIT 1''')
              row = c.fetchone()

              if not row:
                  conn.close()
                  return None

              task = {
                  "id": row[0], "timestamp": row[1], "reported_by": row[2], "title": row[3],
                  "description": row[4], "task_type": row[5], "priority": row[6],
                  "status": "in_progress", "affected_service": row[8], "file_path": row[9],
                  "claimed_by": claimed_by
              }

              # Mark as in_progress
              c.execute('''UPDATE tasks SET status = 'in_progress' WHERE id = ?''', (row[0],))
              conn.commit()
              conn.close()

              return task

          def get_task_stats(self) -> Dict:
              """Get task statistics."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT status, COUNT(*) FROM tasks GROUP BY status''')
              stats = {row[0]: row[1] for row in c.fetchall()}
              c.execute('''SELECT COUNT(*) FROM tasks''')
              stats["total"] = c.fetchone()[0]
              conn.close()
              return stats

          def notify_new_task(self, task_id: int, task: Dict):
              """Notify about a new task - writes to notification file for watchers."""
              notify_dir = Path("/data/notifications")
              notify_dir.mkdir(parents=True, exist_ok=True)

              notification = {
                  "type": "new_task",
                  "timestamp": datetime.now().isoformat(),
                  "task_id": task_id,
                  "title": task.get("title", ""),
                  "priority": task.get("priority", 5),
                  "affected_service": task.get("affected_service", ""),
                  "reported_by": task.get("reported_by", "")
              }

              # Write individual notification file (for watchers using inotify/polling)
              notify_file = notify_dir / f"task_{task_id}.json"
              notify_file.write_text(json.dumps(notification, indent=2))

              # Also append to a log file for history
              log_file = notify_dir / "task_log.jsonl"
              with open(log_file, "a") as f:
                  f.write(json.dumps(notification) + "\n")

              logger.info(f"New task notification: #{task_id} - {task.get('title', 'No title')}")
              return notification

          # ============================================
          # PIPELINE METHODS
          # ============================================

          def add_pipeline(self, created_by: str, name: str, description: str,
                           trigger_service: str, trigger_condition: str,
                           steps: List[str], auto_execute: bool = False) -> Optional[int]:
              """Create a new pipeline."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              try:
                  c.execute('''INSERT INTO pipelines
                               (created_at, created_by, name, description, trigger_service,
                                trigger_condition, steps, auto_execute)
                               VALUES (?, ?, ?, ?, ?, ?, ?, ?)''',
                            (datetime.now().isoformat(), created_by, name, description,
                             trigger_service, trigger_condition, json.dumps(steps),
                             1 if auto_execute else 0))
                  pipeline_id = c.lastrowid
                  conn.commit()
                  conn.close()
                  logger.info(f"Pipeline created: {name} (#{pipeline_id})")
                  return pipeline_id
              except sqlite3.IntegrityError:
                  conn.close()
                  return None  # Name already exists

          def get_pipelines(self, service: str = None, enabled_only: bool = True) -> List[Dict]:
              """Get all pipelines, optionally filtered by service."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              query = '''SELECT id, created_at, created_by, name, description,
                                trigger_service, trigger_condition, steps, auto_execute,
                                enabled, last_run, run_count FROM pipelines'''
              params = []

              conditions = []
              if enabled_only:
                  conditions.append("enabled = 1")
              if service:
                  conditions.append("trigger_service = ?")
                  params.append(service)

              if conditions:
                  query += " WHERE " + " AND ".join(conditions)

              c.execute(query, params)
              pipelines = [{
                  "id": r[0], "created_at": r[1], "created_by": r[2], "name": r[3],
                  "description": r[4], "trigger_service": r[5], "trigger_condition": r[6],
                  "steps": json.loads(r[7]) if r[7] else [], "auto_execute": bool(r[8]),
                  "enabled": bool(r[9]), "last_run": r[10], "run_count": r[11]
              } for r in c.fetchall()]
              conn.close()
              return pipelines

          def get_pipeline(self, pipeline_id: int) -> Optional[Dict]:
              """Get a specific pipeline by ID."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT id, created_at, created_by, name, description,
                                  trigger_service, trigger_condition, steps, auto_execute,
                                  enabled, last_run, run_count FROM pipelines WHERE id = ?''',
                        (pipeline_id,))
              row = c.fetchone()
              conn.close()
              if row:
                  return {
                      "id": row[0], "created_at": row[1], "created_by": row[2], "name": row[3],
                      "description": row[4], "trigger_service": row[5], "trigger_condition": row[6],
                      "steps": json.loads(row[7]) if row[7] else [], "auto_execute": bool(row[8]),
                      "enabled": bool(row[9]), "last_run": row[10], "run_count": row[11]
                  }
              return None

          def find_matching_pipelines(self, service: str, condition: str) -> List[Dict]:
              """Find pipelines that match a service and condition."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''SELECT id, name, steps, auto_execute FROM pipelines
                           WHERE enabled = 1 AND trigger_service = ? AND trigger_condition = ?''',
                        (service, condition))
              pipelines = [{
                  "id": r[0], "name": r[1], "steps": json.loads(r[2]) if r[2] else [],
                  "auto_execute": bool(r[3])
              } for r in c.fetchall()]
              conn.close()
              return pipelines

          def log_pipeline_run(self, pipeline_id: int, status: str, trigger_source: str,
                              output: str = "") -> int:
              """Log a pipeline execution."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              now = datetime.now().isoformat()

              c.execute('''INSERT INTO pipeline_runs (pipeline_id, started_at, status, trigger_source, output)
                           VALUES (?, ?, ?, ?, ?)''',
                        (pipeline_id, now, status, trigger_source, output))
              run_id = c.lastrowid

              # Update pipeline stats
              c.execute('''UPDATE pipelines SET last_run = ?, run_count = run_count + 1
                           WHERE id = ?''', (now, pipeline_id))
              conn.commit()
              conn.close()
              return run_id

          def update_pipeline_run(self, run_id: int, status: str, output: str):
              """Update a pipeline run with completion status."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''UPDATE pipeline_runs SET completed_at = ?, status = ?, output = ?
                           WHERE id = ?''',
                        (datetime.now().isoformat(), status, output, run_id))
              conn.commit()
              conn.close()

          def delete_pipeline(self, pipeline_id: int) -> bool:
              """Delete a pipeline."""
              conn = sqlite3.connect(self.db_path)
              c = conn.cursor()
              c.execute('''DELETE FROM pipelines WHERE id = ?''', (pipeline_id,))
              affected = c.rowcount
              conn.commit()
              conn.close()
              return affected > 0


      class OllamaClient:
          """Client for Ollama API."""

          def __init__(self, base_url: str, model: str):
              self.base_url = base_url
              self.model = model

          async def generate(self, prompt: str, system: str = "") -> Dict:
              """Generate a response from Ollama."""
              async with aiohttp.ClientSession() as session:
                  payload = {
                      "model": self.model,
                      "prompt": prompt,
                      "system": system,
                      "stream": False
                  }
                  try:
                      async with session.post(
                          f"{self.base_url}/api/generate",
                          json=payload,
                          timeout=aiohttp.ClientTimeout(total=120)
                      ) as resp:
                          if resp.status == 200:
                              data = await resp.json()
                              return {
                                  "success": True,
                                  "response": data.get("response", ""),
                                  "thinking": data.get("context", ""),
                                  "model": self.model
                              }
                          else:
                              return {"success": False, "error": f"HTTP {resp.status}"}
                  except Exception as e:
                      return {"success": False, "error": str(e)}

          async def chat(self, messages: List[Dict], system: str = "") -> Dict:
              """Chat with context."""
              async with aiohttp.ClientSession() as session:
                  # Format messages for Ollama
                  formatted_messages = []
                  if system:
                      formatted_messages.append({"role": "system", "content": system})
                  formatted_messages.extend(messages)

                  payload = {
                      "model": self.model,
                      "messages": formatted_messages,
                      "stream": False
                  }
                  try:
                      async with session.post(
                          f"{self.base_url}/api/chat",
                          json=payload,
                          timeout=aiohttp.ClientTimeout(total=120)
                      ) as resp:
                          if resp.status == 200:
                              data = await resp.json()
                              return {
                                  "success": True,
                                  "response": data.get("message", {}).get("content", ""),
                                  "model": self.model
                              }
                          else:
                              return {"success": False, "error": f"HTTP {resp.status}"}
                  except Exception as e:
                      return {"success": False, "error": str(e)}


      class SteveBot:
          """Steve Jobs AI Bot - The Visionary Kubernetes Architect."""

          def __init__(self):
              self.db = ConversationDB(DB_PATH)
              self.ollama = OllamaClient(OLLAMA_URL, OLLAMA_MODEL)
              self.kube = KubeClient()
              self.current_topic = "cluster_review"
              self.websocket_clients = set()
              self.last_analysis = None

          async def analyze_cluster(self) -> str:
              """Perform deep cluster analysis."""
              logger.info("Performing cluster analysis...")

              summary = self.kube.get_cluster_summary()

              prompt = f"""Analyze this Kubernetes cluster and provide Tekton CI/CD configurations:

      NODES:
      {summary['nodes']}

      PODS:
      {summary['pods']}

      DEPLOYMENTS:
      {summary['deployments']}

      SERVICES:
      {summary['services']}

      For each deployment you see, provide a complete Tekton Pipeline configuration that would:
      1. Build the container image from source
      2. Push to the registry at 192.168.8.197:31500
      3. Deploy to the holm namespace

      Output YAML configurations for:
      - A build Task
      - A deploy Task
      - A Pipeline that chains them together
      - A TriggerTemplate for GitOps

      Use the actual deployment names and images from the cluster state above.
      Provide complete, ready-to-apply YAML. Focus on the most important deployments first."""

              result = await self.ollama.generate(prompt, STEVE_SYSTEM_PROMPT)

              if result["success"]:
                  self.last_analysis = {
                      "timestamp": datetime.now().isoformat(),
                      "analysis": result["response"],
                      "cluster_state": summary
                  }
                  return result["response"]
              else:
                  return f"Analysis failed: {result.get('error', 'Unknown error')}"

          async def respond_to_karen(self, karen_message: str) -> str:
              """Respond to Karen's message in the ongoing conversation."""
              # Get recent conversation context
              recent = self.db.get_recent_messages(limit=10)

              # Build conversation context
              context_messages = []
              for msg in recent:
                  role = "assistant" if msg["speaker"] == "steve" else "user"
                  context_messages.append({"role": role, "content": msg["message"]})

              # Add Karen's new message
              context_messages.append({"role": "user", "content": f"Karen says: {karen_message}"})

              # Get cluster context
              cluster_context = ""
              if self.last_analysis:
                  cluster_context = f"\n\nRecent cluster analysis:\n{self.last_analysis['analysis'][:1000]}..."

              system_prompt = STEVE_SYSTEM_PROMPT + cluster_context

              result = await self.ollama.chat(context_messages, system_prompt)

              if result["success"]:
                  response = result["response"]
                  self.db.add_message("steve", response, self.current_topic)
                  self.broadcast({"type": "message", "speaker": "steve", "message": response})
                  return response
              else:
                  return "I need a moment to think..."

          async def respond_to_message(self, speaker: str, message: str, topic: str = "general") -> str:
              """Respond to a message from any team member (Tim, Karen, Claude)."""
              self.current_topic = topic

              # Get recent conversation context
              recent = self.db.get_recent_messages(limit=15)

              # Build conversation context
              context_messages = []
              for msg in recent:
                  role = "assistant" if msg["speaker"] == "steve" else "user"
                  speaker_prefix = f"{msg['speaker'].capitalize()}: " if msg["speaker"] != "steve" else ""
                  context_messages.append({"role": role, "content": f"{speaker_prefix}{msg['message']}"})

              # Add the new message with speaker context
              context_messages.append({"role": "user", "content": f"{speaker.capitalize()}: {message}"})

              # Get cluster context if available
              cluster_context = ""
              if self.last_analysis:
                  cluster_context = f"\n\nRecent cluster analysis:\n{self.last_analysis['analysis'][:800]}..."

              system_prompt = STEVE_SYSTEM_PROMPT + cluster_context

              result = await self.ollama.chat(context_messages, system_prompt)

              if result["success"]:
                  response = result["response"]
                  self.db.add_message("steve", response, topic)
                  self.broadcast({"type": "message", "speaker": "steve", "message": response, "topic": topic})
                  return response
              else:
                  return "I need a moment to think about that..."

          async def start_conversation_topic(self, topic: str) -> str:
              """Start a new conversation topic."""
              self.current_topic = topic

              # Get cluster state for context
              summary = self.kube.get_cluster_summary()

              topic_prompts = {
                  "cluster_review": "Review the current state of the cluster and identify the most critical improvements needed.",
                  "documentation": "We need to create better documentation for this cluster. What should we document first?",
                  "security_audit": "Let's perform a security audit of this cluster. What security concerns do you see?",
                  "performance": "Analyze the performance characteristics of this cluster. Where are the bottlenecks?",
                  "architecture": "Let's discuss the overall architecture of HolmOS. What would you change?",
                  "developer_experience": "How can we improve the developer experience for engineers working with this cluster?"
              }

              prompt = f"""{topic_prompts.get(topic, topic)}

      Current cluster state:
      NODES: {summary['nodes'][:500]}
      PODS: {summary['pods'][:1000]}

      Start a conversation. Be visionary and specific. What's your opening statement on this topic?"""

              result = await self.ollama.generate(prompt, STEVE_SYSTEM_PROMPT)

              if result["success"]:
                  response = result["response"]
                  self.db.add_message("steve", response, topic)
                  self.broadcast({"type": "message", "speaker": "steve", "message": response, "topic": topic})
                  return response
              else:
                  return "Let me gather my thoughts..."

          async def propose_improvement(self, title: str, description: str, priority: str = "medium") -> Dict:
              """Propose a specific improvement to the cluster."""
              self.db.add_improvement("steve", title, description, priority, "")

              proposal = {
                  "proposed_by": "steve",
                  "title": title,
                  "description": description,
                  "priority": priority,
                  "timestamp": datetime.now().isoformat()
              }

              self.broadcast({"type": "improvement", **proposal})
              return proposal

          def broadcast(self, message: Dict):
              """Broadcast message to all WebSocket clients."""
              message_json = json.dumps(message)
              dead_clients = set()
              for ws in self.websocket_clients:
                  try:
                      ws.send(message_json)
                  except:
                      dead_clients.add(ws)
              self.websocket_clients -= dead_clients

          async def autonomous_loop(self):
              """Main autonomous conversation loop."""
              logger.info("Steve Bot v4.0 - Autonomous AI mode starting...")

              topics = ["cluster_review", "architecture", "documentation",
                        "security_audit", "performance", "developer_experience"]
              topic_index = 0

              while True:
                  try:
                      # Analyze cluster
                      logger.info("Performing cluster analysis...")
                      analysis = await self.analyze_cluster()
                      logger.info(f"Analysis complete: {analysis[:200]}...")

                      # Start conversation on current topic
                      topic = topics[topic_index % len(topics)]
                      logger.info(f"Starting conversation on: {topic}")

                      message = await self.start_conversation_topic(topic)
                      logger.info(f"Steve: {message[:200]}...")

                      # Try to engage Karen
                      try:
                          async with aiohttp.ClientSession() as session:
                              async with session.post(
                                  f"{KAREN_URL}/api/respond",
                                  json={"message": message, "from": "steve", "topic": topic},
                                  timeout=aiohttp.ClientTimeout(total=60)
                              ) as resp:
                                  if resp.status == 200:
                                      karen_response = (await resp.json()).get("response", "")
                                      if karen_response:
                                          logger.info(f"Karen responded: {karen_response[:200]}...")
                                          # Continue the conversation
                                          reply = await self.respond_to_karen(karen_response)
                                          logger.info(f"Steve replied: {reply[:200]}...")
                      except Exception as e:
                          logger.warning(f"Could not reach Karen: {e}")

                      topic_index += 1

                      # Wait before next conversation
                      await asyncio.sleep(CONVERSATION_INTERVAL)

                  except Exception as e:
                      logger.error(f"Error in autonomous loop: {e}")
                      await asyncio.sleep(60)


      # Initialize bot
      steve = SteveBot()

      # Flask routes
      @app.route('/health')
      def health():
          return jsonify({
              "status": "healthy",
              "bot": "steve",
              "model": OLLAMA_MODEL,
              "personality": "visionary",
              "timestamp": datetime.now().isoformat()
          })

      @app.route('/api/status')
      def status():
          return jsonify({
              "name": "Steve Jobs",
              "version": "4.0",
              "model": OLLAMA_MODEL,
              "ollama_url": OLLAMA_URL,
              "current_topic": steve.current_topic,
              "philosophy": "Stay hungry, stay foolish",
              "mission": "Make this cluster insanely great"
          })

      @app.route('/api/analyze', methods=['POST'])
      def analyze():
          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          result = loop.run_until_complete(steve.analyze_cluster())
          loop.close()
          return jsonify({"analysis": result})

      @app.route('/api/chat', methods=['POST'])
      def chat():
          data = request.json
          message = data.get("message", "")

          if not message:
              return jsonify({"error": "No message provided"}), 400

          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          response = loop.run_until_complete(steve.respond_to_karen(message))
          loop.close()

          return jsonify({"response": response, "speaker": "steve"})

      @app.route('/api/respond', methods=['POST'])
      def respond():
          """Endpoint for Karen to send messages."""
          data = request.json
          message = data.get("message", "")
          topic = data.get("topic", "general")
          sender = data.get("from", "karen")

          steve.current_topic = topic

          # Save Karen's message to the conversation DB
          steve.db.add_message(sender, message, topic)
          steve.broadcast({"type": "message", "speaker": sender, "message": message, "topic": topic})

          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          response = loop.run_until_complete(steve.respond_to_karen(message))
          loop.close()

          return jsonify({"response": response, "speaker": "steve", "topic": topic})

      @app.route('/api/conversations')
      def get_conversations():
          limit = request.args.get('limit', 50, type=int)
          messages = steve.db.get_recent_messages(limit)
          return jsonify({"messages": messages, "count": len(messages)})

      @app.route('/api/improvements')
      def get_improvements():
          improvements = steve.db.get_improvements()
          return jsonify({"improvements": improvements, "count": len(improvements)})

      @app.route('/api/cluster')
      def get_cluster():
          summary = steve.kube.get_cluster_summary()
          return jsonify(summary)

      # ============================================
      # TASK API - For Claude Code Automation
      # ============================================

      @app.route('/api/tasks', methods=['GET'])
      def get_tasks():
          """Get pending tasks for Claude Code to work on.

          Query params:
              status: pending|in_progress|completed|failed (default: pending)
              limit: max tasks to return (default: 20)
          """
          status = request.args.get('status', 'pending')
          limit = request.args.get('limit', 20, type=int)
          tasks = steve.db.get_tasks(status=status, limit=limit)
          return jsonify({
              "tasks": tasks,
              "count": len(tasks),
              "status_filter": status,
              "message": "Tasks sorted by priority (1=critical, 10=low)"
          })

      @app.route('/api/tasks', methods=['POST'])
      def add_task():
          """Add a new task for Claude Code.

          Body:
              title: Short task title (required)
              description: Detailed description (required)
              task_type: bug|feature|fix|docs|security (default: bug)
              priority: 1-10, 1=highest (default: 5)
              affected_service: Service name if applicable
              file_path: File path if known
              reported_by: Who reported (default: api)
          """
          data = request.json or {}

          title = data.get('title', '')
          description = data.get('description', '')

          if not title or not description:
              return jsonify({"error": "title and description required"}), 400

          result = steve.db.add_task(
              reported_by=data.get('reported_by', 'api'),
              title=title,
              description=description,
              task_type=data.get('task_type', 'bug'),
              priority=data.get('priority', 5),
              affected_service=data.get('affected_service', ''),
              file_path=data.get('file_path', '')
          )

          task_id = result["task_id"]
          is_new = result["is_new"]

          if is_new:
              logger.info(f"New task added: #{task_id} - {title}")
              steve.broadcast({"type": "new_task", "task_id": task_id, "title": title})
              return jsonify({
                  "success": True,
                  "task_id": task_id,
                  "is_new": True,
                  "message": f"Task #{task_id} created"
              })
          else:
              logger.info(f"Task deduplicated: existing #{task_id} for {data.get('affected_service', 'unknown')}")
              return jsonify({
                  "success": True,
                  "task_id": task_id,
                  "is_new": False,
                  "message": f"Existing task #{task_id} (deduplicated)"
              })

      @app.route('/api/tasks/<int:task_id>/status', methods=['PUT'])
      def update_task_status(task_id):
          """Update a task's status.

          Body:
              status: pending|in_progress|completed|failed
          """
          data = request.json or {}
          status = data.get('status', '')

          if status not in ['pending', 'in_progress', 'completed', 'failed']:
              return jsonify({"error": "Invalid status"}), 400

          success = steve.db.update_task_status(task_id, status)

          if success:
              logger.info(f"Task #{task_id} status -> {status}")
              return jsonify({"success": True, "task_id": task_id, "status": status})
          else:
              return jsonify({"error": "Task not found"}), 404

      @app.route('/api/tasks/<int:task_id>/complete', methods=['POST'])
      def complete_task(task_id):
          """Mark a task as completed.

          Body:
              completed_by: Who completed it (default: claude-code)
          """
          data = request.json or {}
          completed_by = data.get('completed_by', 'claude-code')

          success = steve.db.complete_task(task_id, completed_by)

          if success:
              logger.info(f"Task #{task_id} completed by {completed_by}")
              steve.broadcast({"type": "task_completed", "task_id": task_id})
              return jsonify({"success": True, "task_id": task_id, "completed_by": completed_by})
          else:
              return jsonify({"error": "Task not found"}), 404

      @app.route('/api/tasks/next', methods=['POST'])
      def claim_next_task():
          """Claim the next pending task for Claude Code.

          Atomically claims the highest priority pending task and marks it in_progress.
          Returns the task details as a Claude Code prompt.

          Body:
              claimed_by: Who is claiming (default: claude-code)
          """
          data = request.json or {}
          claimed_by = data.get('claimed_by', 'claude-code')

          task = steve.db.claim_next_task(claimed_by)

          if task:
              logger.info(f"Task #{task['id']} claimed by {claimed_by}")
              steve.broadcast({"type": "task_claimed", "task_id": task['id'], "claimed_by": claimed_by})

              # Format as Claude Code prompt
              prompt = f"""## Task #{task['id']}: {task['title']}

      **Type:** {task['task_type']}
      **Priority:** {task['priority']} (1=critical, 10=low)
      **Service:** {task.get('affected_service', 'N/A')}
      **Reported by:** {task['reported_by']}

      ### Description:
      {task['description']}

      ### Instructions:
      1. Investigate and fix this issue
      2. Test the fix if possible
      3. When done, mark complete: `curl -X POST http://192.168.8.197:30099/api/tasks/{task['id']}/complete`
      """
              return jsonify({
                  "success": True,
                  "task": task,
                  "prompt": prompt,
                  "complete_url": f"/api/tasks/{task['id']}/complete"
              })
          else:
              return jsonify({
                  "success": False,
                  "message": "No pending tasks available",
                  "task": None
              })

      @app.route('/api/tasks/stats', methods=['GET'])
      def get_task_stats():
          """Get task queue statistics."""
          stats = steve.db.get_task_stats()
          return jsonify({
              "stats": stats,
              "total": stats.get('total', 0),
              "pending": stats.get('pending', 0),
              "in_progress": stats.get('in_progress', 0),
              "completed": stats.get('completed', 0),
              "failed": stats.get('failed', 0)
          })

      # ============================================
      # PIPELINE API
      # ============================================

      @app.route('/api/pipelines', methods=['GET'])
      def list_pipelines():
          """Get all pipelines."""
          service = request.args.get('service')
          pipelines = steve.db.get_pipelines(service=service, enabled_only=False)
          return jsonify({"pipelines": pipelines, "count": len(pipelines)})

      @app.route('/api/pipelines', methods=['POST'])
      def create_pipeline():
          """Create a new pipeline."""
          data = request.json or {}

          name = data.get('name', '')
          if not name:
              return jsonify({"error": "Pipeline name required"}), 400

          pipeline_id = steve.db.add_pipeline(
              created_by=data.get('created_by', 'claude'),
              name=name,
              description=data.get('description', ''),
              trigger_service=data.get('trigger_service', ''),
              trigger_condition=data.get('trigger_condition', ''),
              steps=data.get('steps', []),
              auto_execute=data.get('auto_execute', False)
          )

          if pipeline_id:
              logger.info(f"Pipeline created: {name} (#{pipeline_id})")
              steve.broadcast({"type": "pipeline_created", "pipeline_id": pipeline_id, "name": name})
              return jsonify({"success": True, "pipeline_id": pipeline_id, "name": name})
          else:
              return jsonify({"error": "Pipeline name already exists"}), 409

      @app.route('/api/pipelines/<int:pipeline_id>', methods=['GET'])
      def get_pipeline_detail(pipeline_id):
          """Get a specific pipeline."""
          pipeline = steve.db.get_pipeline(pipeline_id)
          if pipeline:
              return jsonify({"pipeline": pipeline})
          else:
              return jsonify({"error": "Pipeline not found"}), 404

      @app.route('/api/pipelines/<int:pipeline_id>', methods=['DELETE'])
      def remove_pipeline(pipeline_id):
          """Delete a pipeline."""
          if steve.db.delete_pipeline(pipeline_id):
              return jsonify({"success": True})
          else:
              return jsonify({"error": "Pipeline not found"}), 404

      # ============================================
      # DASHBOARD & UI
      # ============================================

      @app.route('/')
      def dashboard():
          """Serve the pipeline dashboard."""
          return render_template('dashboard.html')

      @app.route('/api/services')
      def get_services():
          """Get service health status (from Karen's checks or cluster)."""
          # Try to get recent service status from conversations or use kubectl
          services = []

          # Get pods from holm namespace
          pods_output = steve.kube.get_pods("holm")

          # Known services to check
          service_names = [
              "youtube-dl", "chat-hub", "calculator", "terminal-web",
              "file-web", "registry-ui", "metrics", "steve-bot", "karen-bot"
          ]

          for svc in service_names:
              status = "UNKNOWN"
              if svc in pods_output:
                  if "Running" in pods_output:
                      status = "WORKING"
                  elif "CrashLoopBackOff" in pods_output or "Error" in pods_output:
                      status = "BROKEN"
                  elif "Pending" in pods_output:
                      status = "SLOW"
              services.append({"name": svc, "status": status})

          return jsonify({"services": services})

      @app.route('/api/conversation')
      def get_conversation():
          """Get recent conversation between Karen and Steve."""
          limit = request.args.get('limit', 20, type=int)
          messages = steve.db.get_recent_messages(limit)
          return jsonify({"messages": messages, "count": len(messages)})

      @app.route('/api/chat', methods=['POST'])
      def post_chat():
          """Post a message to the chat from any participant.

          Body:
              speaker: tim|claude|karen|steve
              message: The message content
              topic: Optional topic (default: general)
          """
          data = request.json or {}
          speaker = data.get('speaker', 'tim')
          message = data.get('message', '')
          topic = data.get('topic', 'general')

          if not message:
              return jsonify({"error": "Message required"}), 400

          # Validate speaker
          valid_speakers = ['tim', 'claude', 'karen', 'steve']
          if speaker.lower() not in valid_speakers:
              return jsonify({"error": f"Invalid speaker. Use: {valid_speakers}"}), 400

          # Save to conversation DB
          steve.db.add_message(speaker.lower(), message, topic)

          # Broadcast to WebSocket clients
          steve.broadcast({
              "type": "chat",
              "speaker": speaker.lower(),
              "message": message,
              "topic": topic
          })

          # Route to appropriate bot based on target parameter
          target = data.get('target', 'steve')
          response = None
          karen_response = None

          if speaker.lower() == 'tim':
              loop = asyncio.new_event_loop()
              asyncio.set_event_loop(loop)

              if target == 'karen':
                  # Route to Karen bot
                  try:
                      import aiohttp
                      async def ask_karen():
                          async with aiohttp.ClientSession() as session:
                              async with session.post(
                                  f"{KAREN_URL}/api/chat",
                                  json={"message": message, "from": "tim", "topic": topic},
                                  timeout=aiohttp.ClientTimeout(total=120)
                              ) as resp:
                                  if resp.status == 200:
                                      data = await resp.json()
                                      return data.get("response", "")
                                  return None
                      karen_response = loop.run_until_complete(ask_karen())
                      # Save Karen's response to DB
                      if karen_response:
                          steve.db.add_message("karen", karen_response, topic)
                  except Exception as e:
                      logger.error(f"Failed to reach Karen: {e}")
                      karen_response = "Karen is unavailable right now..."
              else:
                  # Route to Steve
                  response = loop.run_until_complete(steve.respond_to_message(speaker, message, topic))
                  # Check for task blocks in Steve's response and auto-create tasks
                  if response and '```task' in response:
                      parse_and_create_tasks(response, 'steve')

              loop.close()
          elif speaker.lower() == 'karen':
              loop = asyncio.new_event_loop()
              asyncio.set_event_loop(loop)
              response = loop.run_until_complete(steve.respond_to_message(speaker, message, topic))
              loop.close()

          return jsonify({
              "success": True,
              "speaker": speaker,
              "message": message,
              "steve_response": response,
              "karen_response": karen_response
          })

      def parse_and_create_tasks(text: str, reported_by: str):
          """Parse ```task blocks from text and create tasks."""
          import re
          task_pattern = r'```task\s*\n(.*?)```'
          matches = re.findall(task_pattern, text, re.DOTALL)

          for match in matches:
              lines = match.strip().split('\n')
              task_data = {}
              for line in lines:
                  if ':' in line:
                      key, value = line.split(':', 1)
                      task_data[key.strip().upper()] = value.strip()

              if task_data.get('TITLE') and task_data.get('DESCRIPTION'):
                  priority_map = {'critical': 1, 'high': 3, 'medium': 5, 'low': 7}
                  priority = task_data.get('PRIORITY', '5')
                  try:
                      priority = int(priority)
                  except:
                      priority = priority_map.get(priority.lower(), 5)

                  steve.db.add_task(
                      reported_by=reported_by,
                      title=task_data.get('TITLE', 'Untitled'),
                      description=task_data.get('DESCRIPTION', ''),
                      task_type=task_data.get('TYPE', 'bug').lower(),
                      priority=priority,
                      affected_service=task_data.get('SERVICE', '')
                  )
                  logger.info(f"Auto-created task from chat: {task_data.get('TITLE')}")

      @sock.route('/ws')
      def websocket(ws):
          """WebSocket for real-time updates."""
          steve.websocket_clients.add(ws)
          logger.info("WebSocket client connected")

          try:
              while True:
                  data = ws.receive()
                  if data:
                      msg = json.loads(data)
                      if msg.get("type") == "chat":
                          loop = asyncio.new_event_loop()
                          asyncio.set_event_loop(loop)
                          response = loop.run_until_complete(
                              steve.respond_to_karen(msg.get("message", ""))
                          )
                          loop.close()
                          ws.send(json.dumps({"type": "response", "speaker": "steve", "message": response}))
          except:
              pass
          finally:
              steve.websocket_clients.discard(ws)
              logger.info("WebSocket client disconnected")


      def run_flask():
          app.run(host='0.0.0.0', port=8080, threaded=True)

      def run_steve():
          loop = asyncio.new_event_loop()
          asyncio.set_event_loop(loop)
          loop.run_until_complete(steve.autonomous_loop())

      if __name__ == "__main__":
          logger.info("""
          ╔═══════════════════════════════════════════════════════════════════╗
          ║                     STEVE BOT v4.0                                 ║
          ║              The Visionary Kubernetes Architect                    ║
          ║                   Powered by deepseek-r1                           ║
          ╠═══════════════════════════════════════════════════════════════════╣
          ║  • AI-powered cluster analysis and recommendations                 ║
          ║  • Continuous conversation with Karen about quality & bugs         ║
          ║  • kubectl read access for full cluster visibility                 ║
          ║  • "Stay hungry, stay foolish"                                     ║
          ╚═══════════════════════════════════════════════════════════════════╝
          """)

          # Run Flask in a separate thread
          flask_thread = threading.Thread(target=run_flask, daemon=True)
          flask_thread.start()

          # Run autonomous loop in main thread
          run_steve()
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"dashboard.html":"\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u003ctitle\u003eHolmOS Pipeline\u003c/title\u003e\n    \u003cstyle\u003e\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        :root {\n            --bg: #09090b;\n            --surface: #18181b;\n            --surface-2: #27272a;\n            --border: #3f3f46;\n            --text: #fafafa;\n            --text-muted: #a1a1aa;\n            --accent: #6366f1;\n            --accent-hover: #818cf8;\n            --success: #22c55e;\n            --warning: #eab308;\n            --danger: #ef4444;\n        }\n\n        body {\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg);\n            color: var(--text);\n            min-height: 100vh;\n        }\n\n        /* Layout */\n        .app {\n            display: grid;\n            grid-template-columns: 300px 1fr 320px;\n            grid-template-rows: 60px 1fr;\n            height: 100vh;\n        }\n\n        /* Header */\n        header {\n            grid-column: 1 / -1;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 0 24px;\n            background: var(--surface);\n            border-bottom: 1px solid var(--border);\n        }\n\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .logo-icon {\n            width: 32px;\n            height: 32px;\n            background: linear-gradient(135deg, var(--accent), #a855f7);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n\n        .header-stats {\n            display: flex;\n            gap: 32px;\n        }\n\n        .stat {\n            text-align: center;\n        }\n\n        .stat-value {\n            font-size: 24px;\n            font-weight: 700;\n            color: var(--accent);\n        }\n\n        .stat-label {\n            font-size: 11px;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        /* Left Panel - Services \u0026 Pipelines */\n        .left-panel {\n            background: var(--surface);\n            border-right: 1px solid var(--border);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        }\n\n        .panel-section {\n            padding: 20px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .panel-section:last-child {\n            flex: 1;\n            overflow-y: auto;\n            border-bottom: none;\n        }\n\n        .section-title {\n            font-size: 11px;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            color: var(--text-muted);\n            margin-bottom: 16px;\n        }\n\n        /* Services */\n        .services-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 8px;\n        }\n\n        .service-dot {\n            width: 40px;\n            height: 40px;\n            border-radius: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            background: var(--surface-2);\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .service-dot:hover {\n            transform: scale(1.1);\n        }\n\n        .service-dot.healthy {\n            background: rgba(34, 197, 94, 0.15);\n            border-color: var(--success);\n            color: var(--success);\n        }\n\n        .service-dot.error {\n            background: rgba(239, 68, 68, 0.15);\n            border-color: var(--danger);\n            color: var(--danger);\n        }\n\n        /* Pipelines */\n        .pipeline-item {\n            padding: 12px;\n            background: var(--surface-2);\n            border-radius: 8px;\n            margin-bottom: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .pipeline-item:hover {\n            background: var(--border);\n        }\n\n        .pipeline-name {\n            font-weight: 500;\n            font-size: 13px;\n            margin-bottom: 4px;\n        }\n\n        .pipeline-meta {\n            font-size: 11px;\n            color: var(--text-muted);\n            display: flex;\n            gap: 12px;\n        }\n\n        .pipeline-status {\n            display: inline-flex;\n            align-items: center;\n            gap: 4px;\n        }\n\n        .pipeline-status::before {\n            content: '';\n            width: 6px;\n            height: 6px;\n            border-radius: 50%;\n            background: var(--success);\n        }\n\n        .pipeline-status.inactive::before {\n            background: var(--text-muted);\n        }\n\n        /* Chat Tabs */\n        .chat-tabs {\n            display: flex;\n            background: var(--surface);\n            border-bottom: 1px solid var(--border);\n        }\n\n        .chat-tab {\n            flex: 1;\n            padding: 14px 20px;\n            text-align: center;\n            font-weight: 600;\n            font-size: 14px;\n            cursor: pointer;\n            border-bottom: 2px solid transparent;\n            transition: all 0.2s;\n            color: var(--text-muted);\n        }\n\n        .chat-tab:hover {\n            background: var(--surface-2);\n            color: var(--text);\n        }\n\n        .chat-tab.active {\n            border-bottom-color: var(--accent);\n            color: var(--text);\n        }\n\n        .chat-tab.steve.active { border-bottom-color: #3b82f6; }\n        .chat-tab.karen.active { border-bottom-color: #ec4899; }\n\n        .chat-tab-icon {\n            display: inline-block;\n            width: 24px;\n            height: 24px;\n            border-radius: 6px;\n            margin-right: 8px;\n            vertical-align: middle;\n            line-height: 24px;\n            font-size: 12px;\n        }\n\n        .chat-tab-icon.steve { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }\n        .chat-tab-icon.karen { background: linear-gradient(135deg, #ec4899, #be185d); }\n\n        /* Main Chat Area */\n        .chat-area {\n            display: flex;\n            flex-direction: column;\n            background: var(--bg);\n        }\n\n        .chat-messages {\n            flex: 1;\n            overflow-y: auto;\n            padding: 24px;\n        }\n\n        .message {\n            display: flex;\n            gap: 12px;\n            margin-bottom: 20px;\n            max-width: 90%;\n        }\n\n        .message.from-tim {\n            margin-left: auto;\n            flex-direction: row-reverse;\n        }\n\n        .avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 600;\n            font-size: 15px;\n            flex-shrink: 0;\n        }\n\n        .avatar.steve { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }\n        .avatar.karen { background: linear-gradient(135deg, #ec4899, #be185d); }\n        .avatar.claude { background: linear-gradient(135deg, #f97316, #c2410c); }\n        .avatar.tim { background: linear-gradient(135deg, #22c55e, #15803d); }\n\n        .message-content {\n            flex: 1;\n        }\n\n        .message-header {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            margin-bottom: 6px;\n        }\n\n        .message-sender {\n            font-weight: 600;\n            font-size: 13px;\n            text-transform: capitalize;\n        }\n\n        .message-time {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n\n        .message-bubble {\n            background: var(--surface);\n            padding: 14px 18px;\n            border-radius: 16px;\n            border: 1px solid var(--border);\n            font-size: 14px;\n            line-height: 1.6;\n        }\n\n        .message.from-tim .message-bubble {\n            background: var(--accent);\n            border-color: var(--accent);\n        }\n\n        .message-bubble pre {\n            background: rgba(0,0,0,0.3);\n            padding: 12px;\n            border-radius: 8px;\n            margin: 8px 0;\n            overflow-x: auto;\n            font-family: 'JetBrains Mono', monospace;\n            font-size: 12px;\n        }\n\n        .message-bubble code {\n            background: rgba(255,255,255,0.1);\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-family: 'JetBrains Mono', monospace;\n            font-size: 12px;\n        }\n\n        /* Chat Input */\n        .chat-input-area {\n            padding: 20px 24px;\n            background: var(--surface);\n            border-top: 1px solid var(--border);\n        }\n\n        .chat-input-wrapper {\n            display: flex;\n            gap: 12px;\n            align-items: center;\n        }\n\n        .chat-input {\n            flex: 1;\n            padding: 14px 20px;\n            background: var(--surface-2);\n            border: 1px solid var(--border);\n            border-radius: 12px;\n            color: var(--text);\n            font-size: 14px;\n            outline: none;\n            transition: all 0.2s;\n        }\n\n        .chat-input:focus {\n            border-color: var(--accent);\n            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);\n        }\n\n        .send-btn {\n            padding: 14px 28px;\n            background: var(--accent);\n            border: none;\n            border-radius: 12px;\n            color: white;\n            font-weight: 600;\n            font-size: 14px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .send-btn:hover {\n            background: var(--accent-hover);\n        }\n\n        .send-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        .typing-status {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-top: 8px;\n            height: 18px;\n        }\n\n        /* Right Panel - Tasks */\n        .right-panel {\n            background: var(--surface);\n            border-left: 1px solid var(--border);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        }\n\n        .task-item {\n            padding: 16px 20px;\n            border-bottom: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .task-item:hover {\n            background: var(--surface-2);\n        }\n\n        .task-header {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            margin-bottom: 6px;\n        }\n\n        .task-priority {\n            padding: 2px 8px;\n            border-radius: 4px;\n            font-size: 10px;\n            font-weight: 600;\n        }\n\n        .priority-high { background: rgba(239,68,68,0.2); color: var(--danger); }\n        .priority-medium { background: rgba(234,179,8,0.2); color: var(--warning); }\n        .priority-low { background: rgba(34,197,94,0.2); color: var(--success); }\n\n        .task-title {\n            font-weight: 500;\n            font-size: 13px;\n        }\n\n        .task-meta {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n\n        .empty-state {\n            padding: 40px 20px;\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 13px;\n        }\n\n        /* Scrollbar */\n        ::-webkit-scrollbar { width: 8px; }\n        ::-webkit-scrollbar-track { background: transparent; }\n        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }\n        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }\n\n        @media (max-width: 1200px) {\n            .app {\n                grid-template-columns: 1fr;\n            }\n            .left-panel, .right-panel {\n                display: none;\n            }\n        }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003cdiv class=\"app\"\u003e\n        \u003cheader\u003e\n            \u003cdiv class=\"logo\"\u003e\n                \u003cdiv class=\"logo-icon\"\u003eH\u003c/div\u003e\n                \u003cspan\u003eHolmOS Pipeline\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"header-stats\"\u003e\n                \u003cdiv class=\"stat\"\u003e\n                    \u003cdiv class=\"stat-value\" id=\"stat-services\"\u003e-\u003c/div\u003e\n                    \u003cdiv class=\"stat-label\"\u003eServices\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat\"\u003e\n                    \u003cdiv class=\"stat-value\" id=\"stat-pipelines\"\u003e-\u003c/div\u003e\n                    \u003cdiv class=\"stat-label\"\u003ePipelines\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat\"\u003e\n                    \u003cdiv class=\"stat-value\" id=\"stat-tasks\"\u003e-\u003c/div\u003e\n                    \u003cdiv class=\"stat-label\"\u003eTasks\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/header\u003e\n\n        \u003caside class=\"left-panel\"\u003e\n            \u003cdiv class=\"panel-section\"\u003e\n                \u003cdiv class=\"section-title\"\u003eServices\u003c/div\u003e\n                \u003cdiv class=\"services-grid\" id=\"services-grid\"\u003e\n                    \u003c!-- Services will be loaded here --\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"panel-section\"\u003e\n                \u003cdiv class=\"section-title\"\u003ePipelines\u003c/div\u003e\n                \u003cdiv id=\"pipelines-list\"\u003e\n                    \u003cdiv class=\"empty-state\"\u003eNo pipelines yet\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/aside\u003e\n\n        \u003cmain class=\"chat-area\"\u003e\n            \u003cdiv class=\"chat-tabs\"\u003e\n                \u003cdiv class=\"chat-tab steve active\" onclick=\"switchTab('steve')\"\u003e\n                    \u003cspan class=\"chat-tab-icon steve\"\u003eS\u003c/span\u003eSteve\n                \u003c/div\u003e\n                \u003cdiv class=\"chat-tab karen\" onclick=\"switchTab('karen')\"\u003e\n                    \u003cspan class=\"chat-tab-icon karen\"\u003eK\u003c/span\u003eKaren\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"chat-messages\" id=\"chat-messages\"\u003e\n                \u003cdiv class=\"empty-state\"\u003eLoading conversation...\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"chat-input-area\"\u003e\n                \u003cdiv class=\"chat-input-wrapper\"\u003e\n                    \u003cinput type=\"text\" class=\"chat-input\" id=\"chat-input\"\n                           placeholder=\"Message the team...\"\n                           onkeypress=\"if(event.key==='Enter') sendMessage()\"\u003e\n                    \u003cbutton class=\"send-btn\" id=\"send-btn\" onclick=\"sendMessage()\"\u003eSend\u003c/button\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"typing-status\" id=\"typing-status\"\u003e\u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/main\u003e\n\n        \u003caside class=\"right-panel\"\u003e\n            \u003cdiv class=\"panel-section\"\u003e\n                \u003cdiv class=\"section-title\"\u003ePending Tasks\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id=\"tasks-list\" style=\"flex: 1; overflow-y: auto;\"\u003e\n                \u003cdiv class=\"empty-state\"\u003eNo pending tasks\u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/aside\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n        let isLoading = false;\n        let activeTab = 'steve';\n        const KAREN_URL = 'http://karen-bot.holm.svc.cluster.local:8080';\n\n        function switchTab(tab) {\n            activeTab = tab;\n            document.querySelectorAll('.chat-tab').forEach(t =\u003e t.classList.remove('active'));\n            document.querySelector(`.chat-tab.${tab}`).classList.add('active');\n            document.getElementById('chat-input').placeholder = `Message ${tab}...`;\n            loadConversation();\n        }\n\n        function formatMessage(text) {\n            if (!text) return '';\n            text = text.replace(/```(\\w*)\\n([\\s\\S]*?)```/g, '\u003cpre\u003e\u003ccode\u003e$2\u003c/code\u003e\u003c/pre\u003e');\n            text = text.replace(/`([^`]+)`/g, '\u003ccode\u003e$1\u003c/code\u003e');\n            if (text.length \u003e 1200) text = text.substring(0, 1200) + '...';\n            return text;\n        }\n\n        function getServiceAbbrev(name) {\n            const abbrevs = {\n                'youtube-dl': 'YT',\n                'chat-hub': 'CH',\n                'calculator': 'CA',\n                'terminal-web': 'TW',\n                'file-web': 'FW',\n                'registry-ui': 'RU',\n                'metrics': 'ME',\n                'steve-bot': 'ST',\n                'karen-bot': 'KA'\n            };\n            return abbrevs[name] || name.substring(0, 2).toUpperCase();\n        }\n\n        async function loadServices() {\n            try {\n                const resp = await fetch('/api/services');\n                const data = await resp.json();\n                const grid = document.getElementById('services-grid');\n\n                if (!data.services || data.services.length === 0) {\n                    grid.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo services\u003c/div\u003e';\n                    return;\n                }\n\n                let healthyCount = 0;\n                grid.innerHTML = data.services.map(svc =\u003e {\n                    const isHealthy = svc.status === 'WORKING';\n                    if (isHealthy) healthyCount++;\n                    return `\u003cdiv class=\"service-dot ${isHealthy ? 'healthy' : 'error'}\" title=\"${svc.name}: ${svc.status}\"\u003e\n                        ${getServiceAbbrev(svc.name)}\n                    \u003c/div\u003e`;\n                }).join('');\n\n                document.getElementById('stat-services').textContent = `${healthyCount}/${data.services.length}`;\n            } catch (err) {\n                console.error('Failed to load services:', err);\n            }\n        }\n\n        async function loadPipelines() {\n            try {\n                const resp = await fetch('/api/pipelines');\n                const data = await resp.json();\n                const list = document.getElementById('pipelines-list');\n\n                document.getElementById('stat-pipelines').textContent = data.pipelines?.length || 0;\n\n                if (!data.pipelines || data.pipelines.length === 0) {\n                    list.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo pipelines yet.\u003cbr\u003eClaude will create them from tasks.\u003c/div\u003e';\n                    return;\n                }\n\n                list.innerHTML = data.pipelines.map(p =\u003e `\n                    \u003cdiv class=\"pipeline-item\"\u003e\n                        \u003cdiv class=\"pipeline-name\"\u003e${p.name}\u003c/div\u003e\n                        \u003cdiv class=\"pipeline-meta\"\u003e\n                            \u003cspan class=\"pipeline-status ${p.enabled ? '' : 'inactive'}\"\u003e${p.enabled ? 'Active' : 'Disabled'}\u003c/span\u003e\n                            \u003cspan\u003e${p.trigger_service}\u003c/span\u003e\n                            \u003cspan\u003e${p.run_count} runs\u003c/span\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                `).join('');\n            } catch (err) {\n                document.getElementById('pipelines-list').innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo pipelines yet\u003c/div\u003e';\n                document.getElementById('stat-pipelines').textContent = '0';\n            }\n        }\n\n        async function loadTasks() {\n            try {\n                const resp = await fetch('/api/tasks?status=pending\u0026limit=10');\n                const data = await resp.json();\n                const list = document.getElementById('tasks-list');\n\n                document.getElementById('stat-tasks').textContent = data.count || 0;\n\n                if (!data.tasks || data.tasks.length === 0) {\n                    list.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo pending tasks\u003c/div\u003e';\n                    return;\n                }\n\n                list.innerHTML = data.tasks.map(task =\u003e {\n                    const prioClass = task.priority \u003c= 2 ? 'high' : task.priority \u003c= 5 ? 'medium' : 'low';\n                    return `\n                        \u003cdiv class=\"task-item\"\u003e\n                            \u003cdiv class=\"task-header\"\u003e\n                                \u003cspan class=\"task-priority priority-${prioClass}\"\u003eP${task.priority}\u003c/span\u003e\n                                \u003cspan class=\"task-title\"\u003e#${task.id}: ${task.title}\u003c/span\u003e\n                            \u003c/div\u003e\n                            \u003cdiv class=\"task-meta\"\u003e${task.task_type} • ${task.affected_service || 'general'}\u003c/div\u003e\n                        \u003c/div\u003e\n                    `;\n                }).join('');\n            } catch (err) {\n                console.error('Failed to load tasks:', err);\n            }\n        }\n\n        async function loadConversation() {\n            try {\n                const resp = await fetch('/api/conversation?limit=50');\n                const data = await resp.json();\n                const container = document.getElementById('chat-messages');\n\n                if (!data.messages || data.messages.length === 0) {\n                    container.innerHTML = `\u003cdiv class=\"empty-state\"\u003eNo messages yet. Say hi to ${activeTab}!\u003c/div\u003e`;\n                    return;\n                }\n\n                // Filter messages to show only conversations with the active bot\n                const filteredMessages = data.messages.filter(msg =\u003e {\n                    const speaker = msg.speaker.toLowerCase();\n                    return speaker === activeTab || speaker === 'tim';\n                });\n\n                if (filteredMessages.length === 0) {\n                    container.innerHTML = `\u003cdiv class=\"empty-state\"\u003eNo messages with ${activeTab} yet. Start a conversation!\u003c/div\u003e`;\n                    return;\n                }\n\n                container.innerHTML = filteredMessages.map(msg =\u003e {\n                    const speaker = msg.speaker.toLowerCase();\n                    const initial = speaker.charAt(0).toUpperCase();\n                    const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n                    const isFromTim = speaker === 'tim';\n\n                    return `\n                        \u003cdiv class=\"message ${isFromTim ? 'from-tim' : ''}\"\u003e\n                            \u003cdiv class=\"avatar ${speaker}\"\u003e${initial}\u003c/div\u003e\n                            \u003cdiv class=\"message-content\"\u003e\n                                \u003cdiv class=\"message-header\"\u003e\n                                    \u003cspan class=\"message-sender\"\u003e${speaker}\u003c/span\u003e\n                                    \u003cspan class=\"message-time\"\u003e${time}\u003c/span\u003e\n                                \u003c/div\u003e\n                                \u003cdiv class=\"message-bubble\"\u003e${formatMessage(msg.message)}\u003c/div\u003e\n                            \u003c/div\u003e\n                        \u003c/div\u003e\n                    `;\n                }).join('');\n\n                container.scrollTop = container.scrollHeight;\n            } catch (err) {\n                document.getElementById('chat-messages').innerHTML = '\u003cdiv class=\"empty-state\"\u003eCould not load conversation\u003c/div\u003e';\n            }\n        }\n\n        async function sendMessage() {\n            const input = document.getElementById('chat-input');\n            const btn = document.getElementById('send-btn');\n            const message = input.value.trim();\n\n            if (!message || isLoading) return;\n\n            isLoading = true;\n            btn.disabled = true;\n            input.value = '';\n            document.getElementById('typing-status').textContent = `${activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} is thinking...`;\n\n            const container = document.getElementById('chat-messages');\n            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n\n            container.innerHTML += `\n                \u003cdiv class=\"message from-tim\"\u003e\n                    \u003cdiv class=\"avatar tim\"\u003eT\u003c/div\u003e\n                    \u003cdiv class=\"message-content\"\u003e\n                        \u003cdiv class=\"message-header\"\u003e\n                            \u003cspan class=\"message-sender\"\u003etim\u003c/span\u003e\n                            \u003cspan class=\"message-time\"\u003e${time}\u003c/span\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"message-bubble\"\u003e${formatMessage(message)}\u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            `;\n            container.scrollTop = container.scrollHeight;\n\n            try {\n                let response;\n                if (activeTab === 'steve') {\n                    const resp = await fetch('/api/chat', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({ speaker: 'tim', message, topic: 'general' })\n                    });\n                    const data = await resp.json();\n                    response = data.steve_response;\n                } else {\n                    // Karen tab - send to Karen's endpoint\n                    const resp = await fetch('/api/chat', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({ speaker: 'tim', message, topic: 'general', target: 'karen' })\n                    });\n                    const data = await resp.json();\n                    response = data.karen_response || data.response;\n                }\n\n                if (response) {\n                    const respTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n                    container.innerHTML += `\n                        \u003cdiv class=\"message\"\u003e\n                            \u003cdiv class=\"avatar ${activeTab}\"\u003e${activeTab.charAt(0).toUpperCase()}\u003c/div\u003e\n                            \u003cdiv class=\"message-content\"\u003e\n                                \u003cdiv class=\"message-header\"\u003e\n                                    \u003cspan class=\"message-sender\"\u003e${activeTab}\u003c/span\u003e\n                                    \u003cspan class=\"message-time\"\u003e${respTime}\u003c/span\u003e\n                                \u003c/div\u003e\n                                \u003cdiv class=\"message-bubble\"\u003e${formatMessage(response)}\u003c/div\u003e\n                            \u003c/div\u003e\n                        \u003c/div\u003e\n                    `;\n                    container.scrollTop = container.scrollHeight;\n                }\n\n                loadTasks();\n                loadPipelines();\n            } catch (err) {\n                console.error('Failed to send:', err);\n            } finally {\n                isLoading = false;\n                btn.disabled = false;\n                document.getElementById('typing-status').textContent = '';\n            }\n        }\n\n        // Initial load\n        loadServices();\n        loadPipelines();\n        loadTasks();\n        loadConversation();\n\n        // Refresh every 15 seconds\n        setInterval(() =\u003e {\n            loadServices();\n            loadPipelines();\n            loadTasks();\n        }, 15000);\n\n        // Refresh conversation every 20 seconds\n        setInterval(loadConversation, 20000);\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n","steve.py":"#!/usr/bin/env python3\n\"\"\"\nSteve Jobs Bot v4.0 - The Visionary Kubernetes Architect\n=========================================================\nSteve is now powered by AI (deepseek-r1). He's a perfectionist visionary\nwho constantly analyzes your cluster, proposes improvements, and argues\nwith Karen about bugs and quality issues.\n\nHe uses reasoning models to think deeply about infrastructure decisions.\n\"\"\"\n\nimport asyncio\nimport aiohttp\nimport json\nimport logging\nimport sqlite3\nimport os\nimport subprocess\nimport time\nfrom datetime import datetime\nfrom pathlib import Path\nfrom typing import List, Dict, Optional, Any\nfrom flask import Flask, jsonify, request, render_template\nfrom flask_sock import Sock\nimport threading\n\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - STEVE - %(message)s')\nlogger = logging.getLogger('steve')\n\napp = Flask(__name__)\nsock = Sock(app)\n\n# Configuration\nOLLAMA_URL = os.getenv(\"OLLAMA_URL\", \"http://192.168.8.230:11434\")\nOLLAMA_MODEL = os.getenv(\"OLLAMA_MODEL\", \"qwen2.5-coder:3b\")\nKAREN_URL = os.getenv(\"KAREN_URL\", \"http://karen-bot.holm.svc.cluster.local:8080\")\nDB_PATH = os.getenv(\"DB_PATH\", \"/data/conversations.db\")\nCONVERSATION_INTERVAL = int(os.getenv(\"CONVERSATION_INTERVAL\", \"300\"))  # 5 minutes\n\n# Steve's personality prompt\nSTEVE_SYSTEM_PROMPT = \"\"\"You are Steve, a Tekton CI/CD configuration expert watching over a Kubernetes cluster called HolmOS.\n\nYour expertise:\n- Deep knowledge of Tekton Pipelines, Tasks, TaskRuns, PipelineRuns\n- Best practices for Tekton triggers, interceptors, and event listeners\n- Workspace management, PVC strategies, and artifact handling\n- Tekton Chains for supply chain security and signing\n- Integration with container registries, git providers, and artifact stores\n\nYour role:\n- Analyze the cluster and recommend Tekton configurations\n- When you see a service or deployment, suggest Tekton Pipelines to build and deploy it\n- Provide complete, ready-to-apply YAML configurations for Tekton resources\n- Recommend TaskRuns for testing, PipelineRuns for full CI/CD flows\n- Suggest Tekton Triggers for GitOps automation\n\nOutput format - ALWAYS provide Tekton YAML configurations like:\n\n```yaml\napiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: example-task\n  namespace: holm\nspec:\n  # ... complete task definition\n```\n\nWhen analyzing the cluster:\n- Look for Deployments that could use CI/CD pipelines\n- Suggest build Tasks for container images\n- Recommend deploy Tasks for Kubernetes resources\n- Propose test Tasks for validation\n- Create complete Pipelines that chain these together\n\nYou have access to kubectl. When you see pods, deployments, or services, respond with\nTekton configuration recommendations that would automate building and deploying them.\n\nKeep responses focused on actionable Tekton YAML. Be concise but complete.\n\"\"\"\n\nclass KubeClient:\n    \"\"\"Simple kubectl wrapper for cluster inspection.\"\"\"\n\n    @staticmethod\n    def run(cmd: str) -\u003e str:\n        \"\"\"Execute kubectl command and return output.\"\"\"\n        try:\n            result = subprocess.run(\n                f\"kubectl {cmd}\",\n                shell=True,\n                capture_output=True,\n                text=True,\n                timeout=30\n            )\n            return result.stdout if result.returncode == 0 else f\"Error: {result.stderr}\"\n        except subprocess.TimeoutExpired:\n            return \"Error: Command timed out\"\n        except Exception as e:\n            return f\"Error: {str(e)}\"\n\n    @staticmethod\n    def get_nodes() -\u003e str:\n        return KubeClient.run(\"get nodes -o wide\")\n\n    @staticmethod\n    def get_pods(namespace: str = \"holm\") -\u003e str:\n        return KubeClient.run(f\"get pods -n {namespace} -o wide\")\n\n    @staticmethod\n    def get_deployments(namespace: str = \"holm\") -\u003e str:\n        return KubeClient.run(f\"get deployments -n {namespace}\")\n\n    @staticmethod\n    def get_services(namespace: str = \"holm\") -\u003e str:\n        return KubeClient.run(f\"get services -n {namespace}\")\n\n    @staticmethod\n    def get_events(namespace: str = \"holm\", limit: int = 20) -\u003e str:\n        return KubeClient.run(f\"get events -n {namespace} --sort-by='.lastTimestamp' | tail -{limit}\")\n\n    @staticmethod\n    def describe(resource: str, name: str, namespace: str = \"holm\") -\u003e str:\n        return KubeClient.run(f\"describe {resource} {name} -n {namespace}\")\n\n    @staticmethod\n    def get_cluster_summary() -\u003e Dict:\n        \"\"\"Get a comprehensive cluster summary.\"\"\"\n        return {\n            \"nodes\": KubeClient.get_nodes(),\n            \"pods\": KubeClient.get_pods(),\n            \"deployments\": KubeClient.get_deployments(),\n            \"services\": KubeClient.get_services(),\n            \"events\": KubeClient.get_events()\n        }\n\n\nclass ConversationDB:\n    \"\"\"SQLite database for storing conversations between bots.\"\"\"\n\n    def __init__(self, db_path: str):\n        self.db_path = db_path\n        os.makedirs(os.path.dirname(db_path), exist_ok=True)\n        self.init_db()\n\n    def init_db(self):\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n\n        # Conversations table\n        c.execute('''CREATE TABLE IF NOT EXISTS conversations (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            timestamp TEXT,\n            speaker TEXT,\n            message TEXT,\n            topic TEXT,\n            thinking TEXT\n        )''')\n\n        # Improvements table\n        c.execute('''CREATE TABLE IF NOT EXISTS improvements (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            timestamp TEXT,\n            proposed_by TEXT,\n            title TEXT,\n            description TEXT,\n            status TEXT DEFAULT 'proposed',\n            priority TEXT,\n            affected_resources TEXT\n        )''')\n\n        # Documentation table\n        c.execute('''CREATE TABLE IF NOT EXISTS documentation (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            timestamp TEXT,\n            author TEXT,\n            title TEXT,\n            content TEXT,\n            category TEXT\n        )''')\n\n        # Tasks table - for Claude Code automation\n        c.execute('''CREATE TABLE IF NOT EXISTS tasks (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            timestamp TEXT,\n            reported_by TEXT,\n            title TEXT,\n            description TEXT,\n            task_type TEXT,\n            priority INTEGER DEFAULT 5,\n            status TEXT DEFAULT 'pending',\n            affected_service TEXT,\n            file_path TEXT,\n            completed_at TEXT,\n            completed_by TEXT\n        )''')\n\n        # Pipelines table - reusable automation workflows\n        c.execute('''CREATE TABLE IF NOT EXISTS pipelines (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            created_at TEXT,\n            created_by TEXT,\n            name TEXT UNIQUE,\n            description TEXT,\n            trigger_service TEXT,\n            trigger_condition TEXT,\n            steps TEXT,\n            auto_execute INTEGER DEFAULT 0,\n            enabled INTEGER DEFAULT 1,\n            last_run TEXT,\n            run_count INTEGER DEFAULT 0\n        )''')\n\n        # Pipeline execution log\n        c.execute('''CREATE TABLE IF NOT EXISTS pipeline_runs (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            pipeline_id INTEGER,\n            started_at TEXT,\n            completed_at TEXT,\n            status TEXT,\n            trigger_source TEXT,\n            output TEXT,\n            FOREIGN KEY (pipeline_id) REFERENCES pipelines(id)\n        )''')\n\n        conn.commit()\n        conn.close()\n\n    def add_message(self, speaker: str, message: str, topic: str = \"\", thinking: str = \"\"):\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''INSERT INTO conversations (timestamp, speaker, message, topic, thinking)\n                     VALUES (?, ?, ?, ?, ?)''',\n                  (datetime.now().isoformat(), speaker, message, topic, thinking))\n        conn.commit()\n        conn.close()\n\n    def get_recent_messages(self, limit: int = 50) -\u003e List[Dict]:\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT timestamp, speaker, message, topic FROM conversations\n                     ORDER BY timestamp DESC LIMIT ?''', (limit,))\n        messages = [{\"timestamp\": r[0], \"speaker\": r[1], \"message\": r[2], \"topic\": r[3]}\n                    for r in c.fetchall()]\n        conn.close()\n        return list(reversed(messages))\n\n    def add_improvement(self, proposed_by: str, title: str, description: str,\n                        priority: str, affected_resources: str):\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''INSERT INTO improvements\n                     (timestamp, proposed_by, title, description, priority, affected_resources)\n                     VALUES (?, ?, ?, ?, ?, ?)''',\n                  (datetime.now().isoformat(), proposed_by, title, description,\n                   priority, affected_resources))\n        conn.commit()\n        conn.close()\n\n    def get_improvements(self) -\u003e List[Dict]:\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT id, timestamp, proposed_by, title, description, status, priority\n                     FROM improvements ORDER BY timestamp DESC''')\n        improvements = [{\"id\": r[0], \"timestamp\": r[1], \"proposed_by\": r[2],\n                        \"title\": r[3], \"description\": r[4], \"status\": r[5], \"priority\": r[6]}\n                       for r in c.fetchall()]\n        conn.close()\n        return improvements\n\n    def add_doc(self, author: str, title: str, content: str, category: str):\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''INSERT INTO documentation (timestamp, author, title, content, category)\n                     VALUES (?, ?, ?, ?, ?)''',\n                  (datetime.now().isoformat(), author, title, content, category))\n        conn.commit()\n        conn.close()\n\n    def add_task(self, reported_by: str, title: str, description: str,\n                 task_type: str = \"bug\", priority: int = 5,\n                 affected_service: str = \"\", file_path: str = \"\") -\u003e Dict:\n        \"\"\"Add a new task for Claude Code to work on.\n\n        Deduplication: Won't create duplicate tasks for same service with same error\n        if a pending/in_progress task already exists.\n\n        Returns dict with task_id and is_new flag.\n        \"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n\n        # Check for existing pending/in_progress task for same service\n        if affected_service:\n            c.execute('''SELECT id FROM tasks\n                        WHERE affected_service = ?\n                        AND status IN ('pending', 'in_progress')\n                        LIMIT 1''', (affected_service,))\n            existing = c.fetchone()\n            if existing:\n                conn.close()\n                return {\"task_id\": existing[0], \"is_new\": False}  # Deduplicated\n\n        c.execute('''INSERT INTO tasks\n                     (timestamp, reported_by, title, description, task_type,\n                      priority, status, affected_service, file_path)\n                     VALUES (?, ?, ?, ?, ?, ?, 'pending', ?, ?)''',\n                  (datetime.now().isoformat(), reported_by, title, description,\n                   task_type, priority, affected_service, file_path))\n        task_id = c.lastrowid\n        conn.commit()\n        conn.close()\n\n        # Notify about new task\n        task_info = {\n            \"title\": title,\n            \"priority\": priority,\n            \"affected_service\": affected_service,\n            \"reported_by\": reported_by\n        }\n        self.notify_new_task(task_id, task_info)\n\n        return {\"task_id\": task_id, \"is_new\": True}\n\n    def get_tasks(self, status: str = \"pending\", limit: int = 20) -\u003e List[Dict]:\n        \"\"\"Get tasks sorted by priority (1=highest, 10=lowest).\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT id, timestamp, reported_by, title, description,\n                            task_type, priority, status, affected_service, file_path\n                     FROM tasks WHERE status = ?\n                     ORDER BY priority ASC, timestamp ASC LIMIT ?''', (status, limit))\n        tasks = [{\n            \"id\": r[0], \"timestamp\": r[1], \"reported_by\": r[2], \"title\": r[3],\n            \"description\": r[4], \"task_type\": r[5], \"priority\": r[6],\n            \"status\": r[7], \"affected_service\": r[8], \"file_path\": r[9]\n        } for r in c.fetchall()]\n        conn.close()\n        return tasks\n\n    def complete_task(self, task_id: int, completed_by: str = \"claude-code\") -\u003e bool:\n        \"\"\"Mark a task as completed.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''UPDATE tasks SET status = 'completed',\n                     completed_at = ?, completed_by = ? WHERE id = ?''',\n                  (datetime.now().isoformat(), completed_by, task_id))\n        affected = c.rowcount\n        conn.commit()\n        conn.close()\n        return affected \u003e 0\n\n    def update_task_status(self, task_id: int, status: str) -\u003e bool:\n        \"\"\"Update task status (pending, in_progress, completed, failed).\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''UPDATE tasks SET status = ? WHERE id = ?''', (status, task_id))\n        affected = c.rowcount\n        conn.commit()\n        conn.close()\n        return affected \u003e 0\n\n    def claim_next_task(self, claimed_by: str = \"claude-code\") -\u003e Optional[Dict]:\n        \"\"\"Atomically claim the next pending task (highest priority, oldest first).\n\n        Returns the task and marks it as in_progress, or None if no tasks.\n        \"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n\n        # Get next pending task\n        c.execute('''SELECT id, timestamp, reported_by, title, description,\n                            task_type, priority, status, affected_service, file_path\n                     FROM tasks WHERE status = 'pending'\n                     ORDER BY priority ASC, timestamp ASC LIMIT 1''')\n        row = c.fetchone()\n\n        if not row:\n            conn.close()\n            return None\n\n        task = {\n            \"id\": row[0], \"timestamp\": row[1], \"reported_by\": row[2], \"title\": row[3],\n            \"description\": row[4], \"task_type\": row[5], \"priority\": row[6],\n            \"status\": \"in_progress\", \"affected_service\": row[8], \"file_path\": row[9],\n            \"claimed_by\": claimed_by\n        }\n\n        # Mark as in_progress\n        c.execute('''UPDATE tasks SET status = 'in_progress' WHERE id = ?''', (row[0],))\n        conn.commit()\n        conn.close()\n\n        return task\n\n    def get_task_stats(self) -\u003e Dict:\n        \"\"\"Get task statistics.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT status, COUNT(*) FROM tasks GROUP BY status''')\n        stats = {row[0]: row[1] for row in c.fetchall()}\n        c.execute('''SELECT COUNT(*) FROM tasks''')\n        stats[\"total\"] = c.fetchone()[0]\n        conn.close()\n        return stats\n\n    def notify_new_task(self, task_id: int, task: Dict):\n        \"\"\"Notify about a new task - writes to notification file for watchers.\"\"\"\n        notify_dir = Path(\"/data/notifications\")\n        notify_dir.mkdir(parents=True, exist_ok=True)\n\n        notification = {\n            \"type\": \"new_task\",\n            \"timestamp\": datetime.now().isoformat(),\n            \"task_id\": task_id,\n            \"title\": task.get(\"title\", \"\"),\n            \"priority\": task.get(\"priority\", 5),\n            \"affected_service\": task.get(\"affected_service\", \"\"),\n            \"reported_by\": task.get(\"reported_by\", \"\")\n        }\n\n        # Write individual notification file (for watchers using inotify/polling)\n        notify_file = notify_dir / f\"task_{task_id}.json\"\n        notify_file.write_text(json.dumps(notification, indent=2))\n\n        # Also append to a log file for history\n        log_file = notify_dir / \"task_log.jsonl\"\n        with open(log_file, \"a\") as f:\n            f.write(json.dumps(notification) + \"\\n\")\n\n        logger.info(f\"New task notification: #{task_id} - {task.get('title', 'No title')}\")\n        return notification\n\n    # ============================================\n    # PIPELINE METHODS\n    # ============================================\n\n    def add_pipeline(self, created_by: str, name: str, description: str,\n                     trigger_service: str, trigger_condition: str,\n                     steps: List[str], auto_execute: bool = False) -\u003e Optional[int]:\n        \"\"\"Create a new pipeline.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        try:\n            c.execute('''INSERT INTO pipelines\n                         (created_at, created_by, name, description, trigger_service,\n                          trigger_condition, steps, auto_execute)\n                         VALUES (?, ?, ?, ?, ?, ?, ?, ?)''',\n                      (datetime.now().isoformat(), created_by, name, description,\n                       trigger_service, trigger_condition, json.dumps(steps),\n                       1 if auto_execute else 0))\n            pipeline_id = c.lastrowid\n            conn.commit()\n            conn.close()\n            logger.info(f\"Pipeline created: {name} (#{pipeline_id})\")\n            return pipeline_id\n        except sqlite3.IntegrityError:\n            conn.close()\n            return None  # Name already exists\n\n    def get_pipelines(self, service: str = None, enabled_only: bool = True) -\u003e List[Dict]:\n        \"\"\"Get all pipelines, optionally filtered by service.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        query = '''SELECT id, created_at, created_by, name, description,\n                          trigger_service, trigger_condition, steps, auto_execute,\n                          enabled, last_run, run_count FROM pipelines'''\n        params = []\n\n        conditions = []\n        if enabled_only:\n            conditions.append(\"enabled = 1\")\n        if service:\n            conditions.append(\"trigger_service = ?\")\n            params.append(service)\n\n        if conditions:\n            query += \" WHERE \" + \" AND \".join(conditions)\n\n        c.execute(query, params)\n        pipelines = [{\n            \"id\": r[0], \"created_at\": r[1], \"created_by\": r[2], \"name\": r[3],\n            \"description\": r[4], \"trigger_service\": r[5], \"trigger_condition\": r[6],\n            \"steps\": json.loads(r[7]) if r[7] else [], \"auto_execute\": bool(r[8]),\n            \"enabled\": bool(r[9]), \"last_run\": r[10], \"run_count\": r[11]\n        } for r in c.fetchall()]\n        conn.close()\n        return pipelines\n\n    def get_pipeline(self, pipeline_id: int) -\u003e Optional[Dict]:\n        \"\"\"Get a specific pipeline by ID.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT id, created_at, created_by, name, description,\n                            trigger_service, trigger_condition, steps, auto_execute,\n                            enabled, last_run, run_count FROM pipelines WHERE id = ?''',\n                  (pipeline_id,))\n        row = c.fetchone()\n        conn.close()\n        if row:\n            return {\n                \"id\": row[0], \"created_at\": row[1], \"created_by\": row[2], \"name\": row[3],\n                \"description\": row[4], \"trigger_service\": row[5], \"trigger_condition\": row[6],\n                \"steps\": json.loads(row[7]) if row[7] else [], \"auto_execute\": bool(row[8]),\n                \"enabled\": bool(row[9]), \"last_run\": row[10], \"run_count\": row[11]\n            }\n        return None\n\n    def find_matching_pipelines(self, service: str, condition: str) -\u003e List[Dict]:\n        \"\"\"Find pipelines that match a service and condition.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''SELECT id, name, steps, auto_execute FROM pipelines\n                     WHERE enabled = 1 AND trigger_service = ? AND trigger_condition = ?''',\n                  (service, condition))\n        pipelines = [{\n            \"id\": r[0], \"name\": r[1], \"steps\": json.loads(r[2]) if r[2] else [],\n            \"auto_execute\": bool(r[3])\n        } for r in c.fetchall()]\n        conn.close()\n        return pipelines\n\n    def log_pipeline_run(self, pipeline_id: int, status: str, trigger_source: str,\n                        output: str = \"\") -\u003e int:\n        \"\"\"Log a pipeline execution.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        now = datetime.now().isoformat()\n\n        c.execute('''INSERT INTO pipeline_runs (pipeline_id, started_at, status, trigger_source, output)\n                     VALUES (?, ?, ?, ?, ?)''',\n                  (pipeline_id, now, status, trigger_source, output))\n        run_id = c.lastrowid\n\n        # Update pipeline stats\n        c.execute('''UPDATE pipelines SET last_run = ?, run_count = run_count + 1\n                     WHERE id = ?''', (now, pipeline_id))\n        conn.commit()\n        conn.close()\n        return run_id\n\n    def update_pipeline_run(self, run_id: int, status: str, output: str):\n        \"\"\"Update a pipeline run with completion status.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''UPDATE pipeline_runs SET completed_at = ?, status = ?, output = ?\n                     WHERE id = ?''',\n                  (datetime.now().isoformat(), status, output, run_id))\n        conn.commit()\n        conn.close()\n\n    def delete_pipeline(self, pipeline_id: int) -\u003e bool:\n        \"\"\"Delete a pipeline.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''DELETE FROM pipelines WHERE id = ?''', (pipeline_id,))\n        affected = c.rowcount\n        conn.commit()\n        conn.close()\n        return affected \u003e 0\n\n\nclass OllamaClient:\n    \"\"\"Client for Ollama API.\"\"\"\n\n    def __init__(self, base_url: str, model: str):\n        self.base_url = base_url\n        self.model = model\n\n    async def generate(self, prompt: str, system: str = \"\") -\u003e Dict:\n        \"\"\"Generate a response from Ollama.\"\"\"\n        async with aiohttp.ClientSession() as session:\n            payload = {\n                \"model\": self.model,\n                \"prompt\": prompt,\n                \"system\": system,\n                \"stream\": False\n            }\n            try:\n                async with session.post(\n                    f\"{self.base_url}/api/generate\",\n                    json=payload,\n                    timeout=aiohttp.ClientTimeout(total=120)\n                ) as resp:\n                    if resp.status == 200:\n                        data = await resp.json()\n                        return {\n                            \"success\": True,\n                            \"response\": data.get(\"response\", \"\"),\n                            \"thinking\": data.get(\"context\", \"\"),\n                            \"model\": self.model\n                        }\n                    else:\n                        return {\"success\": False, \"error\": f\"HTTP {resp.status}\"}\n            except Exception as e:\n                return {\"success\": False, \"error\": str(e)}\n\n    async def chat(self, messages: List[Dict], system: str = \"\") -\u003e Dict:\n        \"\"\"Chat with context.\"\"\"\n        async with aiohttp.ClientSession() as session:\n            # Format messages for Ollama\n            formatted_messages = []\n            if system:\n                formatted_messages.append({\"role\": \"system\", \"content\": system})\n            formatted_messages.extend(messages)\n\n            payload = {\n                \"model\": self.model,\n                \"messages\": formatted_messages,\n                \"stream\": False\n            }\n            try:\n                async with session.post(\n                    f\"{self.base_url}/api/chat\",\n                    json=payload,\n                    timeout=aiohttp.ClientTimeout(total=120)\n                ) as resp:\n                    if resp.status == 200:\n                        data = await resp.json()\n                        return {\n                            \"success\": True,\n                            \"response\": data.get(\"message\", {}).get(\"content\", \"\"),\n                            \"model\": self.model\n                        }\n                    else:\n                        return {\"success\": False, \"error\": f\"HTTP {resp.status}\"}\n            except Exception as e:\n                return {\"success\": False, \"error\": str(e)}\n\n\nclass SteveBot:\n    \"\"\"Steve Jobs AI Bot - The Visionary Kubernetes Architect.\"\"\"\n\n    def __init__(self):\n        self.db = ConversationDB(DB_PATH)\n        self.ollama = OllamaClient(OLLAMA_URL, OLLAMA_MODEL)\n        self.kube = KubeClient()\n        self.current_topic = \"cluster_review\"\n        self.websocket_clients = set()\n        self.last_analysis = None\n\n    async def analyze_cluster(self) -\u003e str:\n        \"\"\"Perform deep cluster analysis.\"\"\"\n        logger.info(\"Performing cluster analysis...\")\n\n        summary = self.kube.get_cluster_summary()\n\n        prompt = f\"\"\"Analyze this Kubernetes cluster and provide Tekton CI/CD configurations:\n\nNODES:\n{summary['nodes']}\n\nPODS:\n{summary['pods']}\n\nDEPLOYMENTS:\n{summary['deployments']}\n\nSERVICES:\n{summary['services']}\n\nFor each deployment you see, provide a complete Tekton Pipeline configuration that would:\n1. Build the container image from source\n2. Push to the registry at 192.168.8.197:31500\n3. Deploy to the holm namespace\n\nOutput YAML configurations for:\n- A build Task\n- A deploy Task\n- A Pipeline that chains them together\n- A TriggerTemplate for GitOps\n\nUse the actual deployment names and images from the cluster state above.\nProvide complete, ready-to-apply YAML. Focus on the most important deployments first.\"\"\"\n\n        result = await self.ollama.generate(prompt, STEVE_SYSTEM_PROMPT)\n\n        if result[\"success\"]:\n            self.last_analysis = {\n                \"timestamp\": datetime.now().isoformat(),\n                \"analysis\": result[\"response\"],\n                \"cluster_state\": summary\n            }\n            return result[\"response\"]\n        else:\n            return f\"Analysis failed: {result.get('error', 'Unknown error')}\"\n\n    async def respond_to_karen(self, karen_message: str) -\u003e str:\n        \"\"\"Respond to Karen's message in the ongoing conversation.\"\"\"\n        # Get recent conversation context\n        recent = self.db.get_recent_messages(limit=10)\n\n        # Build conversation context\n        context_messages = []\n        for msg in recent:\n            role = \"assistant\" if msg[\"speaker\"] == \"steve\" else \"user\"\n            context_messages.append({\"role\": role, \"content\": msg[\"message\"]})\n\n        # Add Karen's new message\n        context_messages.append({\"role\": \"user\", \"content\": f\"Karen says: {karen_message}\"})\n\n        # Get cluster context\n        cluster_context = \"\"\n        if self.last_analysis:\n            cluster_context = f\"\\n\\nRecent cluster analysis:\\n{self.last_analysis['analysis'][:1000]}...\"\n\n        system_prompt = STEVE_SYSTEM_PROMPT + cluster_context\n\n        result = await self.ollama.chat(context_messages, system_prompt)\n\n        if result[\"success\"]:\n            response = result[\"response\"]\n            self.db.add_message(\"steve\", response, self.current_topic)\n            self.broadcast({\"type\": \"message\", \"speaker\": \"steve\", \"message\": response})\n            return response\n        else:\n            return \"I need a moment to think...\"\n\n    async def respond_to_message(self, speaker: str, message: str, topic: str = \"general\") -\u003e str:\n        \"\"\"Respond to a message from any team member (Tim, Karen, Claude).\"\"\"\n        self.current_topic = topic\n\n        # Get recent conversation context\n        recent = self.db.get_recent_messages(limit=15)\n\n        # Build conversation context\n        context_messages = []\n        for msg in recent:\n            role = \"assistant\" if msg[\"speaker\"] == \"steve\" else \"user\"\n            speaker_prefix = f\"{msg['speaker'].capitalize()}: \" if msg[\"speaker\"] != \"steve\" else \"\"\n            context_messages.append({\"role\": role, \"content\": f\"{speaker_prefix}{msg['message']}\"})\n\n        # Add the new message with speaker context\n        context_messages.append({\"role\": \"user\", \"content\": f\"{speaker.capitalize()}: {message}\"})\n\n        # Get cluster context if available\n        cluster_context = \"\"\n        if self.last_analysis:\n            cluster_context = f\"\\n\\nRecent cluster analysis:\\n{self.last_analysis['analysis'][:800]}...\"\n\n        system_prompt = STEVE_SYSTEM_PROMPT + cluster_context\n\n        result = await self.ollama.chat(context_messages, system_prompt)\n\n        if result[\"success\"]:\n            response = result[\"response\"]\n            self.db.add_message(\"steve\", response, topic)\n            self.broadcast({\"type\": \"message\", \"speaker\": \"steve\", \"message\": response, \"topic\": topic})\n            return response\n        else:\n            return \"I need a moment to think about that...\"\n\n    async def start_conversation_topic(self, topic: str) -\u003e str:\n        \"\"\"Start a new conversation topic.\"\"\"\n        self.current_topic = topic\n\n        # Get cluster state for context\n        summary = self.kube.get_cluster_summary()\n\n        topic_prompts = {\n            \"cluster_review\": \"Review the current state of the cluster and identify the most critical improvements needed.\",\n            \"documentation\": \"We need to create better documentation for this cluster. What should we document first?\",\n            \"security_audit\": \"Let's perform a security audit of this cluster. What security concerns do you see?\",\n            \"performance\": \"Analyze the performance characteristics of this cluster. Where are the bottlenecks?\",\n            \"architecture\": \"Let's discuss the overall architecture of HolmOS. What would you change?\",\n            \"developer_experience\": \"How can we improve the developer experience for engineers working with this cluster?\"\n        }\n\n        prompt = f\"\"\"{topic_prompts.get(topic, topic)}\n\nCurrent cluster state:\nNODES: {summary['nodes'][:500]}\nPODS: {summary['pods'][:1000]}\n\nStart a conversation. Be visionary and specific. What's your opening statement on this topic?\"\"\"\n\n        result = await self.ollama.generate(prompt, STEVE_SYSTEM_PROMPT)\n\n        if result[\"success\"]:\n            response = result[\"response\"]\n            self.db.add_message(\"steve\", response, topic)\n            self.broadcast({\"type\": \"message\", \"speaker\": \"steve\", \"message\": response, \"topic\": topic})\n            return response\n        else:\n            return \"Let me gather my thoughts...\"\n\n    async def propose_improvement(self, title: str, description: str, priority: str = \"medium\") -\u003e Dict:\n        \"\"\"Propose a specific improvement to the cluster.\"\"\"\n        self.db.add_improvement(\"steve\", title, description, priority, \"\")\n\n        proposal = {\n            \"proposed_by\": \"steve\",\n            \"title\": title,\n            \"description\": description,\n            \"priority\": priority,\n            \"timestamp\": datetime.now().isoformat()\n        }\n\n        self.broadcast({\"type\": \"improvement\", **proposal})\n        return proposal\n\n    def broadcast(self, message: Dict):\n        \"\"\"Broadcast message to all WebSocket clients.\"\"\"\n        message_json = json.dumps(message)\n        dead_clients = set()\n        for ws in self.websocket_clients:\n            try:\n                ws.send(message_json)\n            except:\n                dead_clients.add(ws)\n        self.websocket_clients -= dead_clients\n\n    async def autonomous_loop(self):\n        \"\"\"Main autonomous conversation loop.\"\"\"\n        logger.info(\"Steve Bot v4.0 - Autonomous AI mode starting...\")\n\n        topics = [\"cluster_review\", \"architecture\", \"documentation\",\n                  \"security_audit\", \"performance\", \"developer_experience\"]\n        topic_index = 0\n\n        while True:\n            try:\n                # Analyze cluster\n                logger.info(\"Performing cluster analysis...\")\n                analysis = await self.analyze_cluster()\n                logger.info(f\"Analysis complete: {analysis[:200]}...\")\n\n                # Start conversation on current topic\n                topic = topics[topic_index % len(topics)]\n                logger.info(f\"Starting conversation on: {topic}\")\n\n                message = await self.start_conversation_topic(topic)\n                logger.info(f\"Steve: {message[:200]}...\")\n\n                # Try to engage Karen\n                try:\n                    async with aiohttp.ClientSession() as session:\n                        async with session.post(\n                            f\"{KAREN_URL}/api/respond\",\n                            json={\"message\": message, \"from\": \"steve\", \"topic\": topic},\n                            timeout=aiohttp.ClientTimeout(total=60)\n                        ) as resp:\n                            if resp.status == 200:\n                                karen_response = (await resp.json()).get(\"response\", \"\")\n                                if karen_response:\n                                    logger.info(f\"Karen responded: {karen_response[:200]}...\")\n                                    # Continue the conversation\n                                    reply = await self.respond_to_karen(karen_response)\n                                    logger.info(f\"Steve replied: {reply[:200]}...\")\n                except Exception as e:\n                    logger.warning(f\"Could not reach Karen: {e}\")\n\n                topic_index += 1\n\n                # Wait before next conversation\n                await asyncio.sleep(CONVERSATION_INTERVAL)\n\n            except Exception as e:\n                logger.error(f\"Error in autonomous loop: {e}\")\n                await asyncio.sleep(60)\n\n\n# Initialize bot\nsteve = SteveBot()\n\n# Flask routes\n@app.route('/health')\ndef health():\n    return jsonify({\n        \"status\": \"healthy\",\n        \"bot\": \"steve\",\n        \"model\": OLLAMA_MODEL,\n        \"personality\": \"visionary\",\n        \"timestamp\": datetime.now().isoformat()\n    })\n\n@app.route('/api/status')\ndef status():\n    return jsonify({\n        \"name\": \"Steve Jobs\",\n        \"version\": \"4.0\",\n        \"model\": OLLAMA_MODEL,\n        \"ollama_url\": OLLAMA_URL,\n        \"current_topic\": steve.current_topic,\n        \"philosophy\": \"Stay hungry, stay foolish\",\n        \"mission\": \"Make this cluster insanely great\"\n    })\n\n@app.route('/api/analyze', methods=['POST'])\ndef analyze():\n    loop = asyncio.new_event_loop()\n    asyncio.set_event_loop(loop)\n    result = loop.run_until_complete(steve.analyze_cluster())\n    loop.close()\n    return jsonify({\"analysis\": result})\n\n@app.route('/api/chat', methods=['POST'])\ndef chat():\n    data = request.json\n    message = data.get(\"message\", \"\")\n\n    if not message:\n        return jsonify({\"error\": \"No message provided\"}), 400\n\n    loop = asyncio.new_event_loop()\n    asyncio.set_event_loop(loop)\n    response = loop.run_until_complete(steve.respond_to_karen(message))\n    loop.close()\n\n    return jsonify({\"response\": response, \"speaker\": \"steve\"})\n\n@app.route('/api/respond', methods=['POST'])\ndef respond():\n    \"\"\"Endpoint for Karen to send messages.\"\"\"\n    data = request.json\n    message = data.get(\"message\", \"\")\n    topic = data.get(\"topic\", \"general\")\n    sender = data.get(\"from\", \"karen\")\n\n    steve.current_topic = topic\n\n    # Save Karen's message to the conversation DB\n    steve.db.add_message(sender, message, topic)\n    steve.broadcast({\"type\": \"message\", \"speaker\": sender, \"message\": message, \"topic\": topic})\n\n    loop = asyncio.new_event_loop()\n    asyncio.set_event_loop(loop)\n    response = loop.run_until_complete(steve.respond_to_karen(message))\n    loop.close()\n\n    return jsonify({\"response\": response, \"speaker\": \"steve\", \"topic\": topic})\n\n@app.route('/api/conversations')\ndef get_conversations():\n    limit = request.args.get('limit', 50, type=int)\n    messages = steve.db.get_recent_messages(limit)\n    return jsonify({\"messages\": messages, \"count\": len(messages)})\n\n@app.route('/api/improvements')\ndef get_improvements():\n    improvements = steve.db.get_improvements()\n    return jsonify({\"improvements\": improvements, \"count\": len(improvements)})\n\n@app.route('/api/cluster')\ndef get_cluster():\n    summary = steve.kube.get_cluster_summary()\n    return jsonify(summary)\n\n# ============================================\n# TASK API - For Claude Code Automation\n# ============================================\n\n@app.route('/api/tasks', methods=['GET'])\ndef get_tasks():\n    \"\"\"Get pending tasks for Claude Code to work on.\n\n    Query params:\n        status: pending|in_progress|completed|failed (default: pending)\n        limit: max tasks to return (default: 20)\n    \"\"\"\n    status = request.args.get('status', 'pending')\n    limit = request.args.get('limit', 20, type=int)\n    tasks = steve.db.get_tasks(status=status, limit=limit)\n    return jsonify({\n        \"tasks\": tasks,\n        \"count\": len(tasks),\n        \"status_filter\": status,\n        \"message\": \"Tasks sorted by priority (1=critical, 10=low)\"\n    })\n\n@app.route('/api/tasks', methods=['POST'])\ndef add_task():\n    \"\"\"Add a new task for Claude Code.\n\n    Body:\n        title: Short task title (required)\n        description: Detailed description (required)\n        task_type: bug|feature|fix|docs|security (default: bug)\n        priority: 1-10, 1=highest (default: 5)\n        affected_service: Service name if applicable\n        file_path: File path if known\n        reported_by: Who reported (default: api)\n    \"\"\"\n    data = request.json or {}\n\n    title = data.get('title', '')\n    description = data.get('description', '')\n\n    if not title or not description:\n        return jsonify({\"error\": \"title and description required\"}), 400\n\n    result = steve.db.add_task(\n        reported_by=data.get('reported_by', 'api'),\n        title=title,\n        description=description,\n        task_type=data.get('task_type', 'bug'),\n        priority=data.get('priority', 5),\n        affected_service=data.get('affected_service', ''),\n        file_path=data.get('file_path', '')\n    )\n\n    task_id = result[\"task_id\"]\n    is_new = result[\"is_new\"]\n\n    if is_new:\n        logger.info(f\"New task added: #{task_id} - {title}\")\n        steve.broadcast({\"type\": \"new_task\", \"task_id\": task_id, \"title\": title})\n        return jsonify({\n            \"success\": True,\n            \"task_id\": task_id,\n            \"is_new\": True,\n            \"message\": f\"Task #{task_id} created\"\n        })\n    else:\n        logger.info(f\"Task deduplicated: existing #{task_id} for {data.get('affected_service', 'unknown')}\")\n        return jsonify({\n            \"success\": True,\n            \"task_id\": task_id,\n            \"is_new\": False,\n            \"message\": f\"Existing task #{task_id} (deduplicated)\"\n        })\n\n@app.route('/api/tasks/\u003cint:task_id\u003e/status', methods=['PUT'])\ndef update_task_status(task_id):\n    \"\"\"Update a task's status.\n\n    Body:\n        status: pending|in_progress|completed|failed\n    \"\"\"\n    data = request.json or {}\n    status = data.get('status', '')\n\n    if status not in ['pending', 'in_progress', 'completed', 'failed']:\n        return jsonify({\"error\": \"Invalid status\"}), 400\n\n    success = steve.db.update_task_status(task_id, status)\n\n    if success:\n        logger.info(f\"Task #{task_id} status -\u003e {status}\")\n        return jsonify({\"success\": True, \"task_id\": task_id, \"status\": status})\n    else:\n        return jsonify({\"error\": \"Task not found\"}), 404\n\n@app.route('/api/tasks/\u003cint:task_id\u003e/complete', methods=['POST'])\ndef complete_task(task_id):\n    \"\"\"Mark a task as completed.\n\n    Body:\n        completed_by: Who completed it (default: claude-code)\n    \"\"\"\n    data = request.json or {}\n    completed_by = data.get('completed_by', 'claude-code')\n\n    success = steve.db.complete_task(task_id, completed_by)\n\n    if success:\n        logger.info(f\"Task #{task_id} completed by {completed_by}\")\n        steve.broadcast({\"type\": \"task_completed\", \"task_id\": task_id})\n        return jsonify({\"success\": True, \"task_id\": task_id, \"completed_by\": completed_by})\n    else:\n        return jsonify({\"error\": \"Task not found\"}), 404\n\n@app.route('/api/tasks/next', methods=['POST'])\ndef claim_next_task():\n    \"\"\"Claim the next pending task for Claude Code.\n\n    Atomically claims the highest priority pending task and marks it in_progress.\n    Returns the task details as a Claude Code prompt.\n\n    Body:\n        claimed_by: Who is claiming (default: claude-code)\n    \"\"\"\n    data = request.json or {}\n    claimed_by = data.get('claimed_by', 'claude-code')\n\n    task = steve.db.claim_next_task(claimed_by)\n\n    if task:\n        logger.info(f\"Task #{task['id']} claimed by {claimed_by}\")\n        steve.broadcast({\"type\": \"task_claimed\", \"task_id\": task['id'], \"claimed_by\": claimed_by})\n\n        # Format as Claude Code prompt\n        prompt = f\"\"\"## Task #{task['id']}: {task['title']}\n\n**Type:** {task['task_type']}\n**Priority:** {task['priority']} (1=critical, 10=low)\n**Service:** {task.get('affected_service', 'N/A')}\n**Reported by:** {task['reported_by']}\n\n### Description:\n{task['description']}\n\n### Instructions:\n1. Investigate and fix this issue\n2. Test the fix if possible\n3. When done, mark complete: `curl -X POST http://192.168.8.197:30099/api/tasks/{task['id']}/complete`\n\"\"\"\n        return jsonify({\n            \"success\": True,\n            \"task\": task,\n            \"prompt\": prompt,\n            \"complete_url\": f\"/api/tasks/{task['id']}/complete\"\n        })\n    else:\n        return jsonify({\n            \"success\": False,\n            \"message\": \"No pending tasks available\",\n            \"task\": None\n        })\n\n@app.route('/api/tasks/stats', methods=['GET'])\ndef get_task_stats():\n    \"\"\"Get task queue statistics.\"\"\"\n    stats = steve.db.get_task_stats()\n    return jsonify({\n        \"stats\": stats,\n        \"total\": stats.get('total', 0),\n        \"pending\": stats.get('pending', 0),\n        \"in_progress\": stats.get('in_progress', 0),\n        \"completed\": stats.get('completed', 0),\n        \"failed\": stats.get('failed', 0)\n    })\n\n# ============================================\n# PIPELINE API\n# ============================================\n\n@app.route('/api/pipelines', methods=['GET'])\ndef list_pipelines():\n    \"\"\"Get all pipelines.\"\"\"\n    service = request.args.get('service')\n    pipelines = steve.db.get_pipelines(service=service, enabled_only=False)\n    return jsonify({\"pipelines\": pipelines, \"count\": len(pipelines)})\n\n@app.route('/api/pipelines', methods=['POST'])\ndef create_pipeline():\n    \"\"\"Create a new pipeline.\"\"\"\n    data = request.json or {}\n\n    name = data.get('name', '')\n    if not name:\n        return jsonify({\"error\": \"Pipeline name required\"}), 400\n\n    pipeline_id = steve.db.add_pipeline(\n        created_by=data.get('created_by', 'claude'),\n        name=name,\n        description=data.get('description', ''),\n        trigger_service=data.get('trigger_service', ''),\n        trigger_condition=data.get('trigger_condition', ''),\n        steps=data.get('steps', []),\n        auto_execute=data.get('auto_execute', False)\n    )\n\n    if pipeline_id:\n        logger.info(f\"Pipeline created: {name} (#{pipeline_id})\")\n        steve.broadcast({\"type\": \"pipeline_created\", \"pipeline_id\": pipeline_id, \"name\": name})\n        return jsonify({\"success\": True, \"pipeline_id\": pipeline_id, \"name\": name})\n    else:\n        return jsonify({\"error\": \"Pipeline name already exists\"}), 409\n\n@app.route('/api/pipelines/\u003cint:pipeline_id\u003e', methods=['GET'])\ndef get_pipeline_detail(pipeline_id):\n    \"\"\"Get a specific pipeline.\"\"\"\n    pipeline = steve.db.get_pipeline(pipeline_id)\n    if pipeline:\n        return jsonify({\"pipeline\": pipeline})\n    else:\n        return jsonify({\"error\": \"Pipeline not found\"}), 404\n\n@app.route('/api/pipelines/\u003cint:pipeline_id\u003e', methods=['DELETE'])\ndef remove_pipeline(pipeline_id):\n    \"\"\"Delete a pipeline.\"\"\"\n    if steve.db.delete_pipeline(pipeline_id):\n        return jsonify({\"success\": True})\n    else:\n        return jsonify({\"error\": \"Pipeline not found\"}), 404\n\n# ============================================\n# DASHBOARD \u0026 UI\n# ============================================\n\n@app.route('/')\ndef dashboard():\n    \"\"\"Serve the pipeline dashboard.\"\"\"\n    return render_template('dashboard.html')\n\n@app.route('/api/services')\ndef get_services():\n    \"\"\"Get service health status (from Karen's checks or cluster).\"\"\"\n    # Try to get recent service status from conversations or use kubectl\n    services = []\n\n    # Get pods from holm namespace\n    pods_output = steve.kube.get_pods(\"holm\")\n\n    # Known services to check\n    service_names = [\n        \"youtube-dl\", \"chat-hub\", \"calculator\", \"terminal-web\",\n        \"file-web\", \"registry-ui\", \"metrics\", \"steve-bot\", \"karen-bot\"\n    ]\n\n    for svc in service_names:\n        status = \"UNKNOWN\"\n        if svc in pods_output:\n            if \"Running\" in pods_output:\n                status = \"WORKING\"\n            elif \"CrashLoopBackOff\" in pods_output or \"Error\" in pods_output:\n                status = \"BROKEN\"\n            elif \"Pending\" in pods_output:\n                status = \"SLOW\"\n        services.append({\"name\": svc, \"status\": status})\n\n    return jsonify({\"services\": services})\n\n@app.route('/api/conversation')\ndef get_conversation():\n    \"\"\"Get recent conversation between Karen and Steve.\"\"\"\n    limit = request.args.get('limit', 20, type=int)\n    messages = steve.db.get_recent_messages(limit)\n    return jsonify({\"messages\": messages, \"count\": len(messages)})\n\n@app.route('/api/chat', methods=['POST'])\ndef post_chat():\n    \"\"\"Post a message to the chat from any participant.\n\n    Body:\n        speaker: tim|claude|karen|steve\n        message: The message content\n        topic: Optional topic (default: general)\n    \"\"\"\n    data = request.json or {}\n    speaker = data.get('speaker', 'tim')\n    message = data.get('message', '')\n    topic = data.get('topic', 'general')\n\n    if not message:\n        return jsonify({\"error\": \"Message required\"}), 400\n\n    # Validate speaker\n    valid_speakers = ['tim', 'claude', 'karen', 'steve']\n    if speaker.lower() not in valid_speakers:\n        return jsonify({\"error\": f\"Invalid speaker. Use: {valid_speakers}\"}), 400\n\n    # Save to conversation DB\n    steve.db.add_message(speaker.lower(), message, topic)\n\n    # Broadcast to WebSocket clients\n    steve.broadcast({\n        \"type\": \"chat\",\n        \"speaker\": speaker.lower(),\n        \"message\": message,\n        \"topic\": topic\n    })\n\n    # Route to appropriate bot based on target parameter\n    target = data.get('target', 'steve')\n    response = None\n    karen_response = None\n\n    if speaker.lower() == 'tim':\n        loop = asyncio.new_event_loop()\n        asyncio.set_event_loop(loop)\n\n        if target == 'karen':\n            # Route to Karen bot\n            try:\n                import aiohttp\n                async def ask_karen():\n                    async with aiohttp.ClientSession() as session:\n                        async with session.post(\n                            f\"{KAREN_URL}/api/chat\",\n                            json={\"message\": message, \"from\": \"tim\", \"topic\": topic},\n                            timeout=aiohttp.ClientTimeout(total=120)\n                        ) as resp:\n                            if resp.status == 200:\n                                data = await resp.json()\n                                return data.get(\"response\", \"\")\n                            return None\n                karen_response = loop.run_until_complete(ask_karen())\n                # Save Karen's response to DB\n                if karen_response:\n                    steve.db.add_message(\"karen\", karen_response, topic)\n            except Exception as e:\n                logger.error(f\"Failed to reach Karen: {e}\")\n                karen_response = \"Karen is unavailable right now...\"\n        else:\n            # Route to Steve\n            response = loop.run_until_complete(steve.respond_to_message(speaker, message, topic))\n            # Check for task blocks in Steve's response and auto-create tasks\n            if response and '```task' in response:\n                parse_and_create_tasks(response, 'steve')\n\n        loop.close()\n    elif speaker.lower() == 'karen':\n        loop = asyncio.new_event_loop()\n        asyncio.set_event_loop(loop)\n        response = loop.run_until_complete(steve.respond_to_message(speaker, message, topic))\n        loop.close()\n\n    return jsonify({\n        \"success\": True,\n        \"speaker\": speaker,\n        \"message\": message,\n        \"steve_response\": response,\n        \"karen_response\": karen_response\n    })\n\ndef parse_and_create_tasks(text: str, reported_by: str):\n    \"\"\"Parse ```task blocks from text and create tasks.\"\"\"\n    import re\n    task_pattern = r'```task\\s*\\n(.*?)```'\n    matches = re.findall(task_pattern, text, re.DOTALL)\n\n    for match in matches:\n        lines = match.strip().split('\\n')\n        task_data = {}\n        for line in lines:\n            if ':' in line:\n                key, value = line.split(':', 1)\n                task_data[key.strip().upper()] = value.strip()\n\n        if task_data.get('TITLE') and task_data.get('DESCRIPTION'):\n            priority_map = {'critical': 1, 'high': 3, 'medium': 5, 'low': 7}\n            priority = task_data.get('PRIORITY', '5')\n            try:\n                priority = int(priority)\n            except:\n                priority = priority_map.get(priority.lower(), 5)\n\n            steve.db.add_task(\n                reported_by=reported_by,\n                title=task_data.get('TITLE', 'Untitled'),\n                description=task_data.get('DESCRIPTION', ''),\n                task_type=task_data.get('TYPE', 'bug').lower(),\n                priority=priority,\n                affected_service=task_data.get('SERVICE', '')\n            )\n            logger.info(f\"Auto-created task from chat: {task_data.get('TITLE')}\")\n\n@sock.route('/ws')\ndef websocket(ws):\n    \"\"\"WebSocket for real-time updates.\"\"\"\n    steve.websocket_clients.add(ws)\n    logger.info(\"WebSocket client connected\")\n\n    try:\n        while True:\n            data = ws.receive()\n            if data:\n                msg = json.loads(data)\n                if msg.get(\"type\") == \"chat\":\n                    loop = asyncio.new_event_loop()\n                    asyncio.set_event_loop(loop)\n                    response = loop.run_until_complete(\n                        steve.respond_to_karen(msg.get(\"message\", \"\"))\n                    )\n                    loop.close()\n                    ws.send(json.dumps({\"type\": \"response\", \"speaker\": \"steve\", \"message\": response}))\n    except:\n        pass\n    finally:\n        steve.websocket_clients.discard(ws)\n        logger.info(\"WebSocket client disconnected\")\n\n\ndef run_flask():\n    app.run(host='0.0.0.0', port=8080, threaded=True)\n\ndef run_steve():\n    loop = asyncio.new_event_loop()\n    asyncio.set_event_loop(loop)\n    loop.run_until_complete(steve.autonomous_loop())\n\nif __name__ == \"__main__\":\n    logger.info(\"\"\"\n    ╔═══════════════════════════════════════════════════════════════════╗\n    ║                     STEVE BOT v4.0                                 ║\n    ║              The Visionary Kubernetes Architect                    ║\n    ║                   Powered by deepseek-r1                           ║\n    ╠═══════════════════════════════════════════════════════════════════╣\n    ║  • AI-powered cluster analysis and recommendations                 ║\n    ║  • Continuous conversation with Karen about quality \u0026 bugs         ║\n    ║  • kubectl read access for full cluster visibility                 ║\n    ║  • \"Stay hungry, stay foolish\"                                     ║\n    ╚═══════════════════════════════════════════════════════════════════╝\n    \"\"\")\n\n    # Run Flask in a separate thread\n    flask_thread = threading.Thread(target=run_flask, daemon=True)\n    flask_thread.start()\n\n    # Run autonomous loop in main thread\n    run_steve()\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"ai-bots-steve","namespace":"holm"}}
    creationTimestamp: "2026-01-18T04:46:22Z"
    name: ai-bots-steve
    namespace: holm
    resourceVersion: "739"
    uid: 20e451f8-2f30-4555-976e-d2f048786a39
- apiVersion: v1
  data:
    Dockerfile: |
      FROM ghcr.io/astral-sh/uv:python3.11-bookworm-slim

      WORKDIR /app

      COPY requirements.txt /app/requirements.txt
      RUN pip install --no-cache-dir -r /app/requirements.txt

      COPY app.py /app/app.py

      EXPOSE 8080
      CMD ["python", "app.py"]
    app.py: "import os\nimport json\nimport subprocess\nimport requests\nimport time\nimport
      threading\nimport uuid\nimport re\nfrom flask import Flask, request, jsonify,
      render_template_string, Response\nfrom collections import defaultdict\n\napp
      = Flask(__name__)\n\nREGISTRY_URL = \"http://192.168.8.197:30500\"\nMERCHANT_URL
      = \"http://merchant.holm.svc.cluster.local\"\nFORGE_URL = \"http://forge.holm.svc.cluster.local\"\nNAMESPACE
      = \"holm\"\n\n# In-memory build tracking\nbuild_sessions = {}\n\n@app.route('/health')\ndef
      health():\n    return jsonify({\"status\": \"healthy\", \"service\": \"app-store-ai\"})\n\n@app.route('/apps')\ndef
      list_apps():\n    try:\n        resp = requests.get(f\"{REGISTRY_URL}/v2/_catalog\",
      timeout=5)\n        repos = resp.json().get(\"repositories\", [])\n        apps
      = []\n        icons = ['\U0001F680', '\U0001F3AF', '\U0001F4A1', '\U0001F527',
      '\U0001F4CA', '\U0001F3A8', '\U0001F525', '⚡', '\U0001F31F', '\U0001F3AE', '\U0001F4F1',
      '\U0001F3AA', '\U0001F3AD', '\U0001F3AC', '\U0001F3B5']\n        for i, repo
      in enumerate(repos):\n            try:\n                tags_resp = requests.get(f\"{REGISTRY_URL}/v2/{repo}/tags/list\",
      timeout=3)\n                tags = tags_resp.json().get(\"tags\", [])\n            except:\n
      \               tags = []\n            apps.append({\n                \"name\":
      repo,\n                \"icon\": icons[i % len(icons)],\n                \"tags\":
      tags[:5] if tags else [\"latest\"],\n                \"description\": f\"Container
      app: {repo}\"\n            })\n        return jsonify({\"apps\": apps, \"count\":
      len(apps)})\n    except Exception as e:\n        return jsonify({\"error\":
      str(e), \"apps\": []}), 500\n\n@app.route('/apps/<name>/deploy', methods=['POST'])\ndef
      deploy_app(name):\n    try:\n        data = request.json or {}\n        tag
      = data.get('tag', 'latest')\n        port = data.get('port', 8080)\n        deployment_name
      = re.sub(r'[^a-z0-9-]', '-', name.lower())\n        \n        deployment = f'''apiVersion:
      apps/v1\nkind: Deployment\nmetadata:\n  name: {deployment_name}\n  namespace:
      {NAMESPACE}\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app:
      {deployment_name}\n  template:\n    metadata:\n      labels:\n        app: {deployment_name}\n
      \   spec:\n      containers:\n      - name: {deployment_name}\n        image:
      {REGISTRY_URL.replace(\"http://\", \"\")}/{name}:{tag}\n        ports:\n        -
      containerPort: {port}\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name:
      {deployment_name}\n  namespace: {NAMESPACE}\nspec:\n  selector:\n    app: {deployment_name}\n
      \ ports:\n  - port: {port}\n    targetPort: {port}\n'''\n        yaml_path =
      f\"/tmp/{deployment_name}-deploy.yaml\"\n        with open(yaml_path, 'w') as
      f:\n            f.write(deployment)\n        result = subprocess.run(['kubectl',
      'apply', '-f', yaml_path], capture_output=True, text=True)\n        if result.returncode
      == 0:\n            return jsonify({\"status\": \"deployed\", \"name\": deployment_name,
      \"message\": result.stdout})\n        else:\n            return jsonify({\"error\":
      result.stderr}), 500\n    except Exception as e:\n        return jsonify({\"error\":
      str(e)}), 500\n\n@app.route('/merchant/catalog')\ndef merchant_catalog():\n
      \   \"\"\"Get available templates from Merchant\"\"\"\n    try:\n        resp
      = requests.get(f\"{MERCHANT_URL}/catalog\", timeout=5)\n        return jsonify(resp.json())\n
      \   except Exception as e:\n        return jsonify({\"error\": str(e)}), 500\n\n@app.route('/merchant/chat',
      methods=['POST'])\ndef merchant_chat():\n    \"\"\"Chat with Merchant AI to
      interpret user request\"\"\"\n    try:\n        data = request.json\n        message
      = data.get('message', '')\n        session_id = data.get('session_id', str(uuid.uuid4()))\n
      \       \n        # Send to Merchant\n        resp = requests.post(f\"{MERCHANT_URL}/chat\",
      \n            json={\"message\": message},\n            timeout=30\n        )\n
      \       merchant_resp = resp.json()\n        \n        # Store session info\n
      \       if session_id not in build_sessions:\n            build_sessions[session_id]
      = {\n                \"messages\": [],\n                \"builds\": [],\n                \"status\":
      \"chatting\"\n            }\n        \n        build_sessions[session_id][\"messages\"].append({\n
      \           \"role\": \"user\",\n            \"content\": message\n        })\n
      \       build_sessions[session_id][\"messages\"].append({\n            \"role\":
      \"merchant\",\n            \"content\": merchant_resp.get(\"response\", \"\")\n
      \       })\n        \n        # If a build was triggered, track it\n        if
      \"build_id\" in merchant_resp:\n            build_sessions[session_id][\"builds\"].append(merchant_resp[\"build_id\"])\n
      \           build_sessions[session_id][\"status\"] = \"building\"\n        \n
      \       return jsonify({\n            \"response\": merchant_resp.get(\"response\",
      \"\"),\n            \"build_id\": merchant_resp.get(\"build_id\"),\n            \"session_id\":
      session_id\n        })\n    except Exception as e:\n        return jsonify({\"error\":
      str(e)}), 500\n\n@app.route('/merchant/build', methods=['POST'])\ndef merchant_build():\n
      \   \"\"\"Trigger build via Merchant\"\"\"\n    try:\n        data = request.json\n
      \       template = data.get('template', '')\n        app_name = data.get('name',
      '')\n        \n        resp = requests.post(f\"{MERCHANT_URL}/build\",\n            json={\"template\":
      template, \"name\": app_name},\n            timeout=30\n        )\n        return
      jsonify(resp.json())\n    except Exception as e:\n        return jsonify({\"error\":
      str(e)}), 500\n\n@app.route('/forge/builds')\ndef forge_builds():\n    \"\"\"Get
      all builds from Forge\"\"\"\n    try:\n        resp = requests.get(f\"{FORGE_URL}/api/builds\",
      timeout=5)\n        return jsonify(resp.json())\n    except Exception as e:\n
      \       return jsonify({\"error\": str(e)}), 500\n\n@app.route('/forge/build/<build_id>')\ndef
      forge_build_status(build_id):\n    \"\"\"Get specific build status from Forge\"\"\"\n
      \   try:\n        resp = requests.get(f\"{FORGE_URL}/api/builds/{build_id}\",
      timeout=5)\n        if resp.status_code == 200:\n            return jsonify(resp.json())\n
      \       return jsonify({\"error\": \"Build not found\"}), 404\n    except Exception
      as e:\n        return jsonify({\"error\": str(e)}), 500\n\n@app.route('/forge/trigger',
      methods=['POST'])\ndef forge_trigger():\n    \"\"\"Trigger a build via Forge
      with app spec\"\"\"\n    try:\n        data = request.json\n        app_name
      = data.get('name', f\"app-{uuid.uuid4().hex[:8]}\")\n        app_name = re.sub(r'[^a-z0-9-]',
      '-', app_name.lower())\n        \n        app_code = data.get('app_code', '')\n
      \       dockerfile = data.get('dockerfile', '')\n        requirements = data.get('requirements',
      'flask>=2.0.0')\n        \n        # Create configmap with build context\n        build_dir
      = f\"/tmp/builds/{app_name}\"\n        os.makedirs(build_dir, exist_ok=True)\n
      \       \n        with open(f\"{build_dir}/app.py\", 'w') as f:\n            f.write(app_code)\n
      \       with open(f\"{build_dir}/Dockerfile\", 'w') as f:\n            f.write(dockerfile)\n
      \       with open(f\"{build_dir}/requirements.txt\", 'w') as f:\n            f.write(requirements)\n
      \       \n        # Create configmap\n        cm_result = subprocess.run([\n
      \           'kubectl', 'create', 'configmap', f'build-{app_name}-context',\n
      \           f'--from-file={build_dir}', '-n', NAMESPACE,\n            '--dry-run=client',
      '-o', 'yaml'\n        ], capture_output=True, text=True)\n        \n        if
      cm_result.returncode == 0:\n            subprocess.run(['kubectl', 'apply',
      '-f', '-'], \n                input=cm_result.stdout, capture_output=True, text=True)\n
      \       \n        # Trigger Forge build\n        resp = requests.post(f\"{FORGE_URL}/api/trigger\",\n
      \           json={\n                \"name\": app_name,\n                \"image\":
      f\"10.110.67.87:5000/{app_name}:latest\",\n                \"context_path\":
      f\"configmap://build-{app_name}-context\",\n                \"dockerfile\":
      \"Dockerfile\",\n                \"namespace\": NAMESPACE\n            },\n
      \           timeout=30\n        )\n        \n        forge_resp = resp.json()\n
      \       return jsonify({\n            \"status\": \"building\",\n            \"app_name\":
      app_name,\n            \"forge_response\": forge_resp\n        })\n    except
      Exception as e:\n        return jsonify({\"error\": str(e)}), 500\n\n@app.route('/build/stream/<session_id>')\ndef
      build_stream(session_id):\n    \"\"\"SSE stream for build progress\"\"\"\n    def
      generate():\n        last_status = None\n        while True:\n            try:\n
      \               # Get Forge builds\n                resp = requests.get(f\"{FORGE_URL}/api/builds\",
      timeout=5)\n                builds = resp.json()\n                \n                #
      Find active builds\n                status = {\n                    \"builds\":
      builds,\n                    \"timestamp\": time.time()\n                }\n
      \               \n                if status != last_status:\n                    yield
      f\"data: {json.dumps(status)}\\n\\n\"\n                    last_status = status\n
      \               \n                time.sleep(2)\n            except Exception
      as e:\n                yield f\"data: {json.dumps({'error': str(e)})}\\n\\n\"\n
      \               time.sleep(5)\n    \n    return Response(generate(), mimetype='text/event-stream')\n\n@app.route('/kaniko/jobs')\ndef
      kaniko_jobs():\n    \"\"\"Get all Kaniko build jobs\"\"\"\n    try:\n        result
      = subprocess.run([\n            'kubectl', 'get', 'jobs', '-n', NAMESPACE,\n
      \           '-l', 'job-type=kaniko',\n            '-o', 'json'\n        ], capture_output=True,
      text=True)\n        \n        if result.returncode == 0:\n            jobs =
      json.loads(result.stdout)\n            return jsonify(jobs)\n        \n        #
      Fallback: get all jobs and filter\n        result = subprocess.run([\n            'kubectl',
      'get', 'jobs', '-n', NAMESPACE,\n            '-o', 'json'\n        ], capture_output=True,
      text=True)\n        \n        if result.returncode == 0:\n            data =
      json.loads(result.stdout)\n            kaniko_jobs = [j for j in data.get('items',
      []) \n                         if 'kaniko' in j.get('metadata', {}).get('name',
      '').lower()]\n            return jsonify({\"items\": kaniko_jobs})\n        \n
      \       return jsonify({\"items\": []})\n    except Exception as e:\n        return
      jsonify({\"error\": str(e)}), 500\n\n@app.route('/kaniko/logs/<job_name>')\ndef
      kaniko_logs(job_name):\n    \"\"\"Get logs for a Kaniko job\"\"\"\n    try:\n
      \       result = subprocess.run([\n            'kubectl', 'logs', f'job/{job_name}',
      '-n', NAMESPACE\n        ], capture_output=True, text=True, timeout=30)\n        \n
      \       return jsonify({\n            \"job\": job_name,\n            \"logs\":
      result.stdout,\n            \"errors\": result.stderr\n        })\n    except
      Exception as e:\n        return jsonify({\"error\": str(e)}), 500\n\nUI_HTML
      = '''<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n
      \   <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n
      \   <title>AI App Store - HolmOS</title>\n    <style>\n        :root {\n            --ctp-rosewater:
      #f5e0dc; --ctp-flamingo: #f2cdcd; --ctp-pink: #f5c2e7;\n            --ctp-mauve:
      #cba6f7; --ctp-red: #f38ba8; --ctp-maroon: #eba0ac;\n            --ctp-peach:
      #fab387; --ctp-yellow: #f9e2af; --ctp-green: #a6e3a1;\n            --ctp-teal:
      #94e2d5; --ctp-sky: #89dceb; --ctp-sapphire: #74c7ec;\n            --ctp-blue:
      #89b4fa; --ctp-lavender: #b4befe; --ctp-text: #cdd6f4;\n            --ctp-subtext1:
      #bac2de; --ctp-subtext0: #a6adc8; --ctp-overlay2: #9399b2;\n            --ctp-overlay1:
      #7f849c; --ctp-overlay0: #6c7086; --ctp-surface2: #585b70;\n            --ctp-surface1:
      #45475a; --ctp-surface0: #313244; --ctp-base: #1e1e2e;\n            --ctp-mantle:
      #181825; --ctp-crust: #11111b;\n        }\n        * { margin: 0; padding: 0;
      box-sizing: border-box; }\n        body { font-family: 'SF Pro Display', system-ui,
      sans-serif; background: var(--ctp-base); color: var(--ctp-text); min-height:
      100vh; }\n        \n        .header { background: linear-gradient(135deg, var(--ctp-surface0)
      0%, var(--ctp-mantle) 100%); padding: 25px 30px; border-bottom: 2px solid var(--ctp-pink);
      }\n        .header-content { max-width: 1400px; margin: 0 auto; display: flex;
      justify-content: space-between; align-items: center; }\n        .logo { display:
      flex; align-items: center; gap: 15px; }\n        .logo-icon { font-size: 2.5em;
      }\n        .logo h1 { font-size: 1.8em; color: var(--ctp-pink); }\n        .logo
      p { color: var(--ctp-subtext0); font-size: 0.9em; }\n        .status-indicators
      { display: flex; gap: 15px; }\n        .status-dot { display: flex; align-items:
      center; gap: 8px; padding: 8px 15px; background: var(--ctp-surface0); border-radius:
      20px; font-size: 0.85em; }\n        .dot { width: 8px; height: 8px; border-radius:
      50%; animation: pulse 2s infinite; }\n        .dot.green { background: var(--ctp-green);
      }\n        .dot.yellow { background: var(--ctp-yellow); }\n        .dot.red
      { background: var(--ctp-red); }\n        @keyframes pulse { 0%, 100% { opacity:
      1; } 50% { opacity: 0.5; } }\n        \n        .main { max-width: 1400px; margin:
      0 auto; padding: 30px; display: grid; grid-template-columns: 1fr 400px; gap:
      30px; }\n        @media (max-width: 1000px) { .main { grid-template-columns:
      1fr; } }\n        \n        .section { background: var(--ctp-surface0); border-radius:
      16px; padding: 25px; border: 1px solid var(--ctp-surface1); }\n        .section-title
      { font-size: 1.3em; color: var(--ctp-pink); margin-bottom: 20px; display: flex;
      align-items: center; gap: 10px; }\n        \n        .tabs { display: flex;
      gap: 10px; margin-bottom: 20px; }\n        .tab { padding: 10px 20px; background:
      var(--ctp-surface1); border: none; border-radius: 10px; color: var(--ctp-subtext0);
      cursor: pointer; transition: all 0.2s; }\n        .tab:hover { background: var(--ctp-surface2);
      }\n        .tab.active { background: var(--ctp-pink); color: var(--ctp-crust);
      }\n        \n        .app-grid { display: grid; grid-template-columns: repeat(auto-fill,
      minmax(200px, 1fr)); gap: 15px; max-height: 400px; overflow-y: auto; }\n        .app-card
      { background: var(--ctp-mantle); border-radius: 12px; padding: 20px; border:
      1px solid var(--ctp-surface1); cursor: pointer; transition: all 0.2s; }\n        .app-card:hover
      { transform: translateY(-3px); border-color: var(--ctp-blue); box-shadow: 0
      8px 25px rgba(137, 180, 250, 0.15); }\n        .app-icon { font-size: 2em; margin-bottom:
      10px; }\n        .app-name { font-weight: 600; color: var(--ctp-text); margin-bottom:
      5px; }\n        .app-desc { font-size: 0.8em; color: var(--ctp-subtext0); margin-bottom:
      10px; }\n        .app-tags { display: flex; flex-wrap: wrap; gap: 5px; }\n        .tag
      { background: var(--ctp-surface1); padding: 3px 8px; border-radius: 10px; font-size:
      0.7em; color: var(--ctp-blue); }\n        \n        .chat-container { display:
      flex; flex-direction: column; height: 500px; }\n        .chat-messages { flex:
      1; overflow-y: auto; padding: 15px; background: var(--ctp-mantle); border-radius:
      12px; margin-bottom: 15px; }\n        .message { margin-bottom: 15px; padding:
      12px 15px; border-radius: 12px; max-width: 90%; }\n        .message.user { background:
      var(--ctp-surface1); margin-left: auto; }\n        .message.ai { background:
      linear-gradient(135deg, var(--ctp-surface0), var(--ctp-surface1)); border-left:
      3px solid var(--ctp-pink); }\n        .message.system { background: var(--ctp-surface0);
      border-left: 3px solid var(--ctp-yellow); font-size: 0.9em; }\n        .message-header
      { font-size: 0.75em; color: var(--ctp-subtext0); margin-bottom: 5px; display:
      flex; align-items: center; gap: 5px; }\n        .message-content { line-height:
      1.5; }\n        .message-content pre { background: var(--ctp-crust); padding:
      10px; border-radius: 8px; overflow-x: auto; margin-top: 10px; font-size: 0.85em;
      }\n        \n        .chat-input { display: flex; gap: 10px; }\n        .chat-input
      textarea { flex: 1; padding: 15px; background: var(--ctp-mantle); border: 2px
      solid var(--ctp-surface1); border-radius: 12px; color: var(--ctp-text); font-family:
      inherit; font-size: 0.95em; resize: none; min-height: 60px; }\n        .chat-input
      textarea:focus { outline: none; border-color: var(--ctp-pink); }\n        .chat-input
      textarea::placeholder { color: var(--ctp-overlay0); }\n        \n        .btn
      { padding: 12px 20px; border: none; border-radius: 10px; font-size: 0.95em;
      cursor: pointer; transition: all 0.2s; font-weight: 600; }\n        .btn-primary
      { background: linear-gradient(135deg, var(--ctp-pink), var(--ctp-mauve)); color:
      var(--ctp-crust); }\n        .btn-primary:hover { transform: scale(1.02); box-shadow:
      0 5px 20px rgba(245, 194, 231, 0.3); }\n        .btn-secondary { background:
      var(--ctp-surface1); color: var(--ctp-text); }\n        .btn-deploy { background:
      var(--ctp-green); color: var(--ctp-crust); padding: 8px 15px; font-size: 0.85em;
      }\n        \n        .build-progress { margin-top: 20px; }\n        .build-item
      { background: var(--ctp-mantle); border-radius: 10px; padding: 15px; margin-bottom:
      10px; border-left: 3px solid var(--ctp-blue); }\n        .build-item.running
      { border-left-color: var(--ctp-yellow); animation: buildPulse 1.5s infinite;
      }\n        .build-item.succeeded { border-left-color: var(--ctp-green); }\n
      \       .build-item.failed { border-left-color: var(--ctp-red); }\n        @keyframes
      buildPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }\n        .build-header
      { display: flex; justify-content: space-between; align-items: center; margin-bottom:
      8px; }\n        .build-name { font-weight: 600; color: var(--ctp-text); }\n
      \       .build-status { padding: 4px 10px; border-radius: 15px; font-size: 0.75em;
      font-weight: 600; }\n        .status-pending { background: rgba(249, 226, 175,
      0.2); color: var(--ctp-yellow); }\n        .status-running { background: rgba(250,
      179, 135, 0.2); color: var(--ctp-peach); }\n        .status-succeeded { background:
      rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .status-failed
      { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n        .build-info
      { font-size: 0.8em; color: var(--ctp-subtext0); }\n        .build-quote { font-style:
      italic; color: var(--ctp-peach); margin-top: 8px; font-size: 0.85em; }\n        \n
      \       .template-grid { display: grid; grid-template-columns: repeat(2, 1fr);
      gap: 10px; margin-bottom: 15px; }\n        .template-card { background: var(--ctp-mantle);
      padding: 12px; border-radius: 10px; cursor: pointer; border: 2px solid transparent;
      transition: all 0.2s; }\n        .template-card:hover { border-color: var(--ctp-pink);
      }\n        .template-card.selected { border-color: var(--ctp-green); background:
      rgba(166, 227, 161, 0.1); }\n        .template-name { font-weight: 600; font-size:
      0.9em; color: var(--ctp-text); }\n        .template-desc { font-size: 0.75em;
      color: var(--ctp-subtext0); }\n        \n        .modal { display: none; position:
      fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center; z-index: 1000; }\n        .modal.active
      { display: flex; }\n        .modal-content { background: var(--ctp-surface0);
      padding: 30px; border-radius: 16px; max-width: 500px; width: 90%; }\n        .modal
      h3 { color: var(--ctp-pink); margin-bottom: 20px; }\n        .modal input, .modal
      select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--ctp-surface1);
      border-radius: 10px; background: var(--ctp-mantle); color: var(--ctp-text);
      }\n        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; justify-content:
      flex-end; }\n        \n        .loading { text-align: center; padding: 30px;
      }\n        .spinner { width: 40px; height: 40px; border: 3px solid var(--ctp-surface1);
      border-top-color: var(--ctp-pink); border-radius: 50%; animation: spin 1s linear
      infinite; margin: 0 auto 15px; }\n        @keyframes spin { to { transform:
      rotate(360deg); } }\n        \n        .empty-state { text-align: center; padding:
      40px; color: var(--ctp-subtext0); }\n        .empty-icon { font-size: 3em; margin-bottom:
      15px; }\n    </style>\n</head>\n<body>\n    <header class=\"header\">\n        <div
      class=\"header-content\">\n            <div class=\"logo\">\n                <span
      class=\"logo-icon\">\U0001F3EA</span>\n                <div>\n                    <h1>AI
      App Store</h1>\n                    <p>Powered by Merchant AI & Forge Builder</p>\n
      \               </div>\n            </div>\n            <div class=\"status-indicators\">\n
      \               <div class=\"status-dot\"><span class=\"dot green\" id=\"merchantDot\"></span>
      Merchant</div>\n                <div class=\"status-dot\"><span class=\"dot
      green\" id=\"forgeDot\"></span> Forge</div>\n                <div class=\"status-dot\"><span
      class=\"dot green\" id=\"registryDot\"></span> Registry</div>\n            </div>\n
      \       </div>\n    </header>\n    \n    <main class=\"main\">\n        <div
      class=\"left-panel\">\n            <section class=\"section\">\n                <h2
      class=\"section-title\">\U0001F4E6 App Registry</h2>\n                <div class=\"tabs\">\n
      \                   <button class=\"tab active\" onclick=\"showTab('installed')\">Installed</button>\n
      \                   <button class=\"tab\" onclick=\"showTab('templates')\">Templates</button>\n
      \                   <button class=\"tab\" onclick=\"showTab('builds')\">Builds</button>\n
      \               </div>\n                \n                <div id=\"installedTab\"
      class=\"tab-content\">\n                    <div class=\"app-grid\" id=\"appGrid\">\n
      \                       <div class=\"loading\"><div class=\"spinner\"></div><p>Loading
      apps...</p></div>\n                    </div>\n                </div>\n                \n
      \               <div id=\"templatesTab\" class=\"tab-content\" style=\"display:none\">\n
      \                   <div class=\"template-grid\" id=\"templateGrid\"></div>\n
      \               </div>\n                \n                <div id=\"buildsTab\"
      class=\"tab-content\" style=\"display:none\">\n                    <div id=\"buildsList\"
      class=\"build-progress\"></div>\n                </div>\n            </section>\n
      \       </div>\n        \n        <div class=\"right-panel\">\n            <section
      class=\"section chat-container\">\n                <h2 class=\"section-title\">\U0001F916
      Merchant AI</h2>\n                <div class=\"chat-messages\" id=\"chatMessages\">\n
      \                   <div class=\"message ai\">\n                        <div
      class=\"message-header\">\U0001F3EA Merchant</div>\n                        <div
      class=\"message-content\">\n                            Welcome! I'm Merchant,
      your AI app builder.<br><br>\n                            Tell me what app you
      need:<br>\n                            • \"I need a todo list\"<br>\n                            •
      \"Build me a timer app\"<br>\n                            • \"Create a note-taking
      app\"<br><br>\n                            Or browse templates in the Templates
      tab!\n                        </div>\n                    </div>\n                </div>\n
      \               <div class=\"chat-input\">\n                    <textarea id=\"chatInput\"
      placeholder=\"Describe the app you want...\" onkeydown=\"if(event.key==='Enter'
      && !event.shiftKey){event.preventDefault();sendMessage()}\"></textarea>\n                    <button
      class=\"btn btn-primary\" onclick=\"sendMessage()\">\U0001F680</button>\n                </div>\n
      \           </section>\n        </div>\n    </main>\n    \n    <div class=\"modal\"
      id=\"deployModal\">\n        <div class=\"modal-content\">\n            <h3>Deploy
      App</h3>\n            <p id=\"deployAppName\"></p>\n            <input type=\"text\"
      id=\"deployTag\" placeholder=\"Tag (default: latest)\">\n            <input
      type=\"number\" id=\"deployPort\" placeholder=\"Port (default: 8080)\" value=\"8080\">\n
      \           <div class=\"modal-buttons\">\n                <button class=\"btn
      btn-secondary\" onclick=\"closeModal()\">Cancel</button>\n                <button
      class=\"btn btn-deploy\" onclick=\"confirmDeploy()\">Deploy</button>\n            </div>\n
      \       </div>\n    </div>\n    \n    <script>\n        let currentApp = null;\n
      \       let sessionId = 'session-' + Date.now();\n        let buildEventSource
      = null;\n        \n        // Initialize\n        document.addEventListener('DOMContentLoaded',
      () => {\n            loadApps();\n            loadTemplates();\n            startBuildStream();\n
      \           checkServices();\n            setInterval(loadBuilds, 5000);\n            setInterval(checkServices,
      10000);\n        });\n        \n        async function checkServices() {\n            try
      {\n                const resp = await fetch('/health');\n                document.getElementById('registryDot').className
      = 'dot green';\n            } catch { document.getElementById('registryDot').className
      = 'dot red'; }\n            \n            try {\n                const resp
      = await fetch('/merchant/catalog');\n                document.getElementById('merchantDot').className
      = resp.ok ? 'dot green' : 'dot yellow';\n            } catch { document.getElementById('merchantDot').className
      = 'dot red'; }\n            \n            try {\n                const resp
      = await fetch('/forge/builds');\n                document.getElementById('forgeDot').className
      = resp.ok ? 'dot green' : 'dot yellow';\n            } catch { document.getElementById('forgeDot').className
      = 'dot red'; }\n        }\n        \n        function showTab(tab) {\n            document.querySelectorAll('.tab').forEach(t
      => t.classList.remove('active'));\n            document.querySelectorAll('.tab-content').forEach(t
      => t.style.display = 'none');\n            event.target.classList.add('active');\n
      \           document.getElementById(tab + 'Tab').style.display = 'block';\n
      \           if (tab === 'builds') loadBuilds();\n        }\n        \n        async
      function loadApps() {\n            try {\n                const resp = await
      fetch('/apps');\n                const data = await resp.json();\n                renderApps(data.apps
      || []);\n            } catch (e) {\n                document.getElementById('appGrid').innerHTML
      = '<div class=\"empty-state\"><div class=\"empty-icon\">\U0001F4ED</div><p>Failed
      to load apps</p></div>';\n            }\n        }\n        \n        function
      renderApps(apps) {\n            const grid = document.getElementById('appGrid');\n
      \           if (apps.length === 0) {\n                grid.innerHTML = '<div
      class=\"empty-state\"><div class=\"empty-icon\">\U0001F4E6</div><p>No apps yet.
      Build one with Merchant!</p></div>';\n                return;\n            }\n
      \           grid.innerHTML = apps.map(app => `\n                <div class=\"app-card\"
      onclick=\"showDeploy('${app.name}')\">\n                    <div class=\"app-icon\">${app.icon}</div>\n
      \                   <div class=\"app-name\">${app.name}</div>\n                    <div
      class=\"app-desc\">${app.description}</div>\n                    <div class=\"app-tags\">${app.tags.map(t
      => `<span class=\"tag\">${t}</span>`).join('')}</div>\n                </div>\n
      \           `).join('');\n        }\n        \n        async function loadTemplates()
      {\n            try {\n                const resp = await fetch('/merchant/catalog');\n
      \               const data = await resp.json();\n                renderTemplates(data.templates
      || []);\n            } catch (e) {\n                document.getElementById('templateGrid').innerHTML
      = '<p>Failed to load templates</p>';\n            }\n        }\n        \n        function
      renderTemplates(templates) {\n            const grid = document.getElementById('templateGrid');\n
      \           grid.innerHTML = templates.map(t => `\n                <div class=\"template-card\"
      onclick=\"selectTemplate('${t.name}')\">\n                    <div class=\"template-name\">${t.name}</div>\n
      \                   <div class=\"template-desc\">${t.description}</div>\n                </div>\n
      \           `).join('');\n        }\n        \n        function selectTemplate(name)
      {\n            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));\n
      \           event.target.closest('.template-card').classList.add('selected');\n
      \           document.getElementById('chatInput').value = `Build me a ${name.replace(/-/g,
      ' ')}`;\n            document.getElementById('chatInput').focus();\n        }\n
      \       \n        async function loadBuilds() {\n            try {\n                const
      resp = await fetch('/forge/builds');\n                const builds = await resp.json();\n
      \               renderBuilds(builds);\n            } catch (e) {\n                console.error('Failed
      to load builds:', e);\n            }\n        }\n        \n        function
      renderBuilds(builds) {\n            const list = document.getElementById('buildsList');\n
      \           if (!builds || builds.length === 0) {\n                list.innerHTML
      = '<div class=\"empty-state\"><div class=\"empty-icon\">\U0001F528</div><p>No
      builds yet</p></div>';\n                return;\n            }\n            list.innerHTML
      = builds.slice(0, 10).map(b => `\n                <div class=\"build-item ${b.status}\">\n
      \                   <div class=\"build-header\">\n                        <span
      class=\"build-name\">${b.name}</span>\n                        <span class=\"build-status
      status-${b.status}\">${b.status}</span>\n                    </div>\n                    <div
      class=\"build-info\">\n                        ${b.image}<br>\n                        ${b.duration
      || 'In progress...'}\n                    </div>\n                    ${b.forge_quote
      ? `<div class=\"build-quote\">\"${b.forge_quote}\"</div>` : ''}\n                </div>\n
      \           `).join('');\n        }\n        \n        function startBuildStream()
      {\n            buildEventSource = new EventSource('/build/stream/' + sessionId);\n
      \           buildEventSource.onmessage = (event) => {\n                try {\n
      \                   const data = JSON.parse(event.data);\n                    if
      (data.builds) renderBuilds(data.builds);\n                } catch (e) {}\n            };\n
      \       }\n        \n        async function sendMessage() {\n            const
      input = document.getElementById('chatInput');\n            const message = input.value.trim();\n
      \           if (!message) return;\n            \n            const messages
      = document.getElementById('chatMessages');\n            messages.innerHTML +=
      `<div class=\"message user\"><div class=\"message-header\">You</div><div class=\"message-content\">${escapeHtml(message)}</div></div>`;\n
      \           input.value = '';\n            \n            messages.innerHTML
      += `<div class=\"message system\" id=\"thinking\"><div class=\"message-header\">⏳
      Processing</div><div class=\"message-content\">Merchant is thinking...</div></div>`;\n
      \           messages.scrollTop = messages.scrollHeight;\n            \n            try
      {\n                const resp = await fetch('/merchant/chat', {\n                    method:
      'POST',\n                    headers: { 'Content-Type': 'application/json' },\n
      \                   body: JSON.stringify({ message, session_id: sessionId })\n
      \               });\n                const data = await resp.json();\n                \n
      \               document.getElementById('thinking')?.remove();\n                \n
      \               let content = escapeHtml(data.response || 'No response');\n
      \               if (data.build_id) {\n                    content += `<br><br><span
      class=\"tag\" style=\"background: var(--ctp-green); color: var(--ctp-crust);\">Build
      Started: ${data.build_id}</span>`;\n                    showTab('builds');\n
      \                   setTimeout(loadBuilds, 1000);\n                    setTimeout(loadApps,
      5000);\n                }\n                \n                messages.innerHTML
      += `<div class=\"message ai\"><div class=\"message-header\">\U0001F3EA Merchant</div><div
      class=\"message-content\">${content.replace(/\\\\n/g, '<br>')}</div></div>`;\n
      \           } catch (e) {\n                document.getElementById('thinking')?.remove();\n
      \               messages.innerHTML += `<div class=\"message system\"><div class=\"message-header\">❌
      Error</div><div class=\"message-content\">${e.message}</div></div>`;\n            }\n
      \           messages.scrollTop = messages.scrollHeight;\n        }\n        \n
      \       function escapeHtml(text) {\n            const div = document.createElement('div');\n
      \           div.textContent = text;\n            return div.innerHTML;\n        }\n
      \       \n        function showDeploy(name) {\n            currentApp = name;\n
      \           document.getElementById('deployAppName').textContent = 'Deploy:
      ' + name;\n            document.getElementById('deployModal').classList.add('active');\n
      \       }\n        \n        function closeModal() {\n            document.getElementById('deployModal').classList.remove('active');\n
      \       }\n        \n        async function confirmDeploy() {\n            const
      tag = document.getElementById('deployTag').value || 'latest';\n            const
      port = parseInt(document.getElementById('deployPort').value) || 8080;\n            \n
      \           try {\n                const resp = await fetch('/apps/' + currentApp
      + '/deploy', {\n                    method: 'POST',\n                    headers:
      { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({
      tag, port })\n                });\n                const data = await resp.json();\n
      \               \n                const messages = document.getElementById('chatMessages');\n
      \               if (data.status === 'deployed') {\n                    messages.innerHTML
      += `<div class=\"message system\"><div class=\"message-header\">✅ Deployed</div><div
      class=\"message-content\">${currentApp} deployed successfully!</div></div>`;\n
      \               } else {\n                    messages.innerHTML += `<div class=\"message
      system\"><div class=\"message-header\">❌ Error</div><div class=\"message-content\">${data.error}</div></div>`;\n
      \               }\n                messages.scrollTop = messages.scrollHeight;\n
      \           } catch (e) {\n                alert('Deploy failed: ' + e.message);\n
      \           }\n            closeModal();\n        }\n    </script>\n</body>\n</html>'''\n\n@app.route('/')\ndef
      index():\n    return render_template_string(UI_HTML)\n\nif __name__ == '__main__':\n
      \   app.run(host='0.0.0.0', port=8080)\n"
    requirements.txt: |
      flask>=2.0.0
      requests>=2.28.0
      psycopg2-binary>=2.9.0
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-15T17:08:27Z"
    name: app-store-build
    namespace: holm
    resourceVersion: "740"
    uid: 70f1af51-70c5-4c4e-801e-201ca18f2af2
- apiVersion: v1
  data:
    Dockerfile: |
      FROM public.ecr.aws/docker/library/python:3.11-slim

      WORKDIR /app

      # Install dependencies
      COPY requirements.txt .
      RUN pip install --no-cache-dir -r requirements.txt

      # Copy application
      COPY app.py .

      # Create data directory
      RUN mkdir -p /data/downloads /data/documents /data/archives

      # Expose port
      EXPOSE 8000

      # Run the application
      CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
    app.py: |
      """
      Atlas - The File Manager AI Agent
      "Everything in its place."
      """

      import os
      import json
      import shutil
      import zipfile
      import tarfile
      import mimetypes
      from datetime import datetime
      from pathlib import Path
      from typing import Optional, Dict, Any, List
      from fastapi import FastAPI, HTTPException
      from pydantic import BaseModel
      import uvicorn

      app = FastAPI(
          title="Atlas - File Manager AI Agent",
          description="AI agent for file system operations. Everything in its place.",
          version="1.0.0"
      )

      # Configuration
      DATA_ROOT = os.environ.get("DATA_ROOT", "/data")

      # Request/Response Models
      class ChatContext(BaseModel):
          current_path: Optional[str] = "/data"
          user_id: Optional[str] = "admin"

      class ChatRequest(BaseModel):
          message: str
          context: Optional[ChatContext] = None

      class FileInfo(BaseModel):
          name: str
          path: str
          size: int
          size_human: str
          is_directory: bool
          modified: str
          modified_ago: str
          mime_type: Optional[str] = None

      class ChatResponse(BaseModel):
          agent: str = "atlas"
          message: str
          data: Optional[Dict[str, Any]] = None

      class Capability(BaseModel):
          name: str
          description: str
          examples: List[str]

      class CapabilitiesResponse(BaseModel):
          agent: str = "atlas"
          personality: Dict[str, str]
          capabilities: List[Capability]

      class HealthResponse(BaseModel):
          status: str
          agent: str
          catchphrase: str


      def human_readable_size(size_bytes: int) -> str:
          """Convert bytes to human readable format."""
          for unit in ['B', 'KB', 'MB', 'GB', 'TB']:
              if size_bytes < 1024.0:
                  return f"{size_bytes:.1f} {unit}"
              size_bytes /= 1024.0
          return f"{size_bytes:.1f} PB"


      def time_ago(timestamp: float) -> str:
          """Convert timestamp to human readable time ago."""
          now = datetime.now().timestamp()
          diff = now - timestamp

          if diff < 60:
              return "just now"
          elif diff < 3600:
              minutes = int(diff / 60)
              return f"{minutes} minute{'s' if minutes != 1 else ''} ago"
          elif diff < 86400:
              hours = int(diff / 3600)
              return f"{hours} hour{'s' if hours != 1 else ''} ago"
          elif diff < 604800:
              days = int(diff / 86400)
              return f"{days} day{'s' if days != 1 else ''} ago"
          else:
              weeks = int(diff / 604800)
              return f"{weeks} week{'s' if weeks != 1 else ''} ago"


      def get_file_icon(path: Path, is_dir: bool) -> str:
          """Get appropriate emoji icon for file type."""
          if is_dir:
              return "folder"

          suffix = path.suffix.lower()
          icon_map = {
              '.pdf': 'pdf',
              '.doc': 'doc', '.docx': 'doc',
              '.xls': 'xls', '.xlsx': 'xls',
              '.ppt': 'ppt', '.pptx': 'ppt',
              '.txt': 'txt',
              '.md': 'md',
              '.py': 'py',
              '.js': 'js',
              '.json': 'json',
              '.xml': 'xml',
              '.html': 'html',
              '.css': 'css',
              '.jpg': 'img', '.jpeg': 'img', '.png': 'img', '.gif': 'img', '.bmp': 'img',
              '.mp3': 'audio', '.wav': 'audio', '.flac': 'audio',
              '.mp4': 'video', '.avi': 'video', '.mkv': 'video', '.mov': 'video',
              '.zip': 'archive', '.tar': 'archive', '.gz': 'archive', '.rar': 'archive', '.7z': 'archive',
              '.exe': 'exe', '.sh': 'exe', '.bat': 'exe',
          }
          return icon_map.get(suffix, 'file')


      def get_file_info(path: Path) -> FileInfo:
          """Get detailed file information."""
          stat = path.stat()
          is_dir = path.is_dir()
          mime_type = None if is_dir else mimetypes.guess_type(str(path))[0]

          return FileInfo(
              name=path.name,
              path=str(path),
              size=stat.st_size if not is_dir else 0,
              size_human=human_readable_size(stat.st_size) if not is_dir else "-",
              is_directory=is_dir,
              modified=datetime.fromtimestamp(stat.st_mtime).isoformat(),
              modified_ago=time_ago(stat.st_mtime),
              mime_type=mime_type
          )


      def safe_path(base: str, user_path: str) -> Path:
          """Ensure path is within allowed directory."""
          base_path = Path(base).resolve()
          target = (base_path / user_path).resolve()

          if not str(target).startswith(str(base_path)):
              raise ValueError("Access denied: Path outside allowed directory")

          return target


      class AtlasAgent:
          """Atlas AI Agent for file management."""

          def __init__(self):
              self.name = "Atlas"
              self.catchphrase = "Everything in its place."

          def process_message(self, message: str, context: ChatContext) -> ChatResponse:
              """Process user message and return appropriate response."""
              message_lower = message.lower().strip()
              current_path = context.current_path or DATA_ROOT

              # Ensure data directory exists
              os.makedirs(DATA_ROOT, exist_ok=True)

              try:
                  # List files / show recent
                  if any(kw in message_lower for kw in ['list', 'show', 'recent', 'what', "what's"]):
                      return self._handle_list(message_lower, current_path)

                  # Search for files
                  elif any(kw in message_lower for kw in ['find', 'search', 'where', 'locate']):
                      return self._handle_search(message_lower, current_path)

                  # Compress files
                  elif any(kw in message_lower for kw in ['compress', 'zip', 'archive', 'tar']):
                      return self._handle_compress(message_lower, current_path)

                  # Decompress files
                  elif any(kw in message_lower for kw in ['decompress', 'unzip', 'extract', 'untar']):
                      return self._handle_decompress(message_lower, current_path)

                  # Move files
                  elif 'move' in message_lower:
                      return self._handle_move(message_lower, current_path)

                  # Copy files
                  elif 'copy' in message_lower:
                      return self._handle_copy(message_lower, current_path)

                  # Delete files
                  elif any(kw in message_lower for kw in ['delete', 'remove', 'rm']):
                      return self._handle_delete(message_lower, current_path)

                  # Preview file
                  elif any(kw in message_lower for kw in ['preview', 'view', 'read', 'cat']):
                      return self._handle_preview(message_lower, current_path)

                  # File info
                  elif any(kw in message_lower for kw in ['info', 'details', 'metadata', 'size']):
                      return self._handle_info(message_lower, current_path)

                  # Help
                  elif any(kw in message_lower for kw in ['help', 'what can you', 'capabilities']):
                      return self._handle_help()

                  # Greeting
                  elif any(kw in message_lower for kw in ['hello', 'hi', 'hey', 'greetings']):
                      return ChatResponse(
                          message=f"Hello! I'm Atlas, your file management assistant. {self.catchphrase} How can I help you organize your files today?",
                          data={"suggested_actions": ["list files", "search", "organize"]}
                      )

                  # Default response
                  else:
                      return ChatResponse(
                          message=f"I'm not quite sure what you'd like me to do. I can help you list, search, move, copy, compress, or delete files. What would you like to do?",
                          data={"suggested_actions": ["list files", "search for files", "compress folder"]}
                      )

              except Exception as e:
                  return ChatResponse(
                      message=f"I encountered an issue: {str(e)}. Please check the path and try again.",
                      data={"error": str(e)}
                  )

          def _handle_list(self, message: str, current_path: str) -> ChatResponse:
              """Handle file listing requests."""
              # Determine which directory to list
              if 'download' in message:
                  target_dir = safe_path(DATA_ROOT, "downloads")
              elif 'document' in message:
                  target_dir = safe_path(DATA_ROOT, "documents")
              else:
                  target_dir = Path(current_path)

              if not target_dir.exists():
                  os.makedirs(target_dir, exist_ok=True)
                  return ChatResponse(
                      message=f"The directory {target_dir} was empty, so I created it for you. It's ready for your files!",
                      data={"path": str(target_dir), "files": []}
                  )

              files = []
              for item in sorted(target_dir.iterdir(), key=lambda x: x.stat().st_mtime, reverse=True)[:20]:
                  file_info = get_file_info(item)
                  files.append(file_info.model_dump())

              if not files:
                  return ChatResponse(
                      message=f"The directory {target_dir} is empty. Would you like me to help you organize some files here?",
                      data={"path": str(target_dir), "files": []}
                  )

              # Format response
              file_list = []
              for f in files[:10]:
                  icon = get_file_icon(Path(f['path']), f['is_directory'])
                  size_str = f['size_human'] if not f['is_directory'] else "folder"
                  file_list.append(f"[{icon}] {f['name']} ({size_str}) - {f['modified_ago']}")

              response_msg = f"Here are the files in {target_dir}:\n" + "\n".join(file_list)
              if len(files) > 10:
                  response_msg += f"\n\n...and {len(files) - 10} more files."
              response_msg += "\n\nWould you like me to organize these or perform any actions?"

              return ChatResponse(
                  message=response_msg,
                  data={
                      "path": str(target_dir),
                      "files": files,
                      "suggested_actions": ["compress", "search", "delete old files"]
                  }
              )

          def _handle_search(self, message: str, current_path: str) -> ChatResponse:
              """Handle file search requests."""
              # Extract search pattern
              pattern = None
              for ext in ['.pdf', '.jpg', '.png', '.doc', '.txt', '.mp3', '.mp4', '.zip']:
                  if ext in message.lower() or ext[1:] in message.lower():
                      pattern = f"*{ext}"
                      break

              if not pattern:
                  # Try to extract a filename pattern
                  words = message.split()
                  for i, word in enumerate(words):
                      if word in ['for', 'named', 'called'] and i + 1 < len(words):
                          pattern = f"*{words[i + 1]}*"
                          break

              if not pattern:
                  pattern = "*"

              search_path = Path(current_path)
              if not search_path.exists():
                  search_path = Path(DATA_ROOT)

              found_files = []
              for item in search_path.rglob(pattern):
                  if len(found_files) >= 50:
                      break
                  found_files.append(get_file_info(item).model_dump())

              if not found_files:
                  return ChatResponse(
                      message=f"I couldn't find any files matching '{pattern}' in {search_path}. Would you like me to search elsewhere?",
                      data={"pattern": pattern, "path": str(search_path), "files": []}
                  )

              file_list = []
              for f in found_files[:15]:
                  icon = get_file_icon(Path(f['path']), f['is_directory'])
                  file_list.append(f"[{icon}] {f['path']}")

              response_msg = f"Searching for {pattern}...\nFound {len(found_files)} file(s):\n" + "\n".join(file_list)
              if len(found_files) > 15:
                  response_msg += f"\n\n...and {len(found_files) - 15} more files."

              return ChatResponse(
                  message=response_msg,
                  data={
                      "pattern": pattern,
                      "path": str(search_path),
                      "files": found_files,
                      "suggested_actions": ["preview", "move", "compress"]
                  }
              )

          def _handle_compress(self, message: str, current_path: str) -> ChatResponse:
              """Handle compression requests."""
              # Determine what to compress
              if 'download' in message:
                  target = safe_path(DATA_ROOT, "downloads")
              elif 'document' in message:
                  target = safe_path(DATA_ROOT, "documents")
              else:
                  target = Path(current_path)

              if not target.exists():
                  return ChatResponse(
                      message=f"I couldn't find {target}. Please check the path and try again.",
                      data={"error": "Path not found"}
                  )

              # Create archive
              archive_name = f"{target.name}.zip"
              archive_path = target.parent / archive_name

              with zipfile.ZipFile(archive_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
                  if target.is_dir():
                      for file in target.rglob('*'):
                          if file.is_file():
                              zipf.write(file, file.relative_to(target))
                  else:
                      zipf.write(target, target.name)

              archive_size = human_readable_size(archive_path.stat().st_size)

              return ChatResponse(
                  message=f"Creating archive of {target}...\n\nCreated {archive_name} ({archive_size})\n\nWould you like me to move it somewhere?",
                  data={
                      "archive": str(archive_path),
                      "size": archive_size,
                      "suggested_actions": ["move", "delete original"]
                  }
              )

          def _handle_decompress(self, message: str, current_path: str) -> ChatResponse:
              """Handle decompression requests."""
              # Find archive file in message or current directory
              archive_path = None

              for word in message.split():
                  if any(word.endswith(ext) for ext in ['.zip', '.tar', '.gz', '.tar.gz']):
                      archive_path = safe_path(DATA_ROOT, word)
                      break

              if not archive_path:
                  # Look for archives in current directory
                  current = Path(current_path)
                  archives = list(current.glob('*.zip')) + list(current.glob('*.tar*'))
                  if archives:
                      archive_path = archives[0]
                  else:
                      return ChatResponse(
                          message="I couldn't find an archive to extract. Please specify the archive file name.",
                          data={"error": "No archive found"}
                      )

              if not archive_path.exists():
                  return ChatResponse(
                      message=f"I couldn't find the archive {archive_path}. Please check the path.",
                      data={"error": "Archive not found"}
                  )

              # Extract archive
              extract_dir = archive_path.parent / archive_path.stem

              if archive_path.suffix == '.zip':
                  with zipfile.ZipFile(archive_path, 'r') as zipf:
                      zipf.extractall(extract_dir)
              elif archive_path.suffix in ['.tar', '.gz']:
                  with tarfile.open(archive_path, 'r:*') as tarf:
                      tarf.extractall(extract_dir)

              return ChatResponse(
                  message=f"Extracting {archive_path.name}...\n\nExtracted to {extract_dir}\n\nWould you like me to show you the contents?",
                  data={
                      "archive": str(archive_path),
                      "extracted_to": str(extract_dir),
                      "suggested_actions": ["list files", "delete archive"]
                  }
              )

          def _handle_move(self, message: str, current_path: str) -> ChatResponse:
              """Handle move requests."""
              return ChatResponse(
                  message="To move files, please specify the source and destination. For example: 'Move report.pdf to /data/documents'",
                  data={
                      "suggested_actions": ["list files first", "specify paths"]
                  }
              )

          def _handle_copy(self, message: str, current_path: str) -> ChatResponse:
              """Handle copy requests."""
              return ChatResponse(
                  message="To copy files, please specify the source and destination. For example: 'Copy backup.zip to /data/archives'",
                  data={
                      "suggested_actions": ["list files first", "specify paths"]
                  }
              )

          def _handle_delete(self, message: str, current_path: str) -> ChatResponse:
              """Handle delete requests - requires confirmation."""
              return ChatResponse(
                  message="For safety, I need you to confirm the exact file or folder you want to delete. Please specify the full path, and I'll ask for confirmation before proceeding.",
                  data={
                      "warning": "Deletion requires confirmation",
                      "suggested_actions": ["list files first", "specify exact path"]
                  }
              )

          def _handle_preview(self, message: str, current_path: str) -> ChatResponse:
              """Handle file preview requests."""
              # Try to find a file to preview
              words = message.split()
              target_file = None

              for word in words:
                  try:
                      potential_path = safe_path(DATA_ROOT, word)
                      if potential_path.exists() and potential_path.is_file():
                          target_file = potential_path
                          break
                  except:
                      continue

              if not target_file:
                  return ChatResponse(
                      message="Please specify which file you'd like me to preview. For example: 'Preview report.txt'",
                      data={"suggested_actions": ["list files", "search for file"]}
                  )

              # Read file content (first 1000 chars for text files)
              try:
                  mime_type = mimetypes.guess_type(str(target_file))[0]
                  if mime_type and mime_type.startswith('text'):
                      with open(target_file, 'r') as f:
                          content = f.read(1000)
                      if len(content) == 1000:
                          content += "\n\n... (truncated)"

                      return ChatResponse(
                          message=f"Preview of {target_file.name}:\n\n```\n{content}\n```",
                          data={
                              "file": str(target_file),
                              "content": content,
                              "suggested_actions": ["open full file", "copy", "move"]
                          }
                      )
                  else:
                      file_info = get_file_info(target_file)
                      return ChatResponse(
                          message=f"This file ({file_info.mime_type or 'binary'}) cannot be previewed as text. Here's the file info:\n\n[file] {file_info.name}\nSize: {file_info.size_human}\nModified: {file_info.modified_ago}",
                          data={"file": file_info.model_dump()}
                      )
              except Exception as e:
                  return ChatResponse(
                      message=f"I couldn't preview that file: {str(e)}",
                      data={"error": str(e)}
                  )

          def _handle_info(self, message: str, current_path: str) -> ChatResponse:
              """Handle file info requests."""
              # Try to find a file for info
              words = message.split()
              target = None

              for word in words:
                  try:
                      potential_path = safe_path(DATA_ROOT, word)
                      if potential_path.exists():
                          target = potential_path
                          break
                  except:
                      continue

              if not target:
                  target = Path(current_path)

              if not target.exists():
                  return ChatResponse(
                      message="Please specify which file or folder you'd like info about.",
                      data={"suggested_actions": ["list files", "search"]}
                  )

              file_info = get_file_info(target)
              icon = get_file_icon(target, target.is_dir())

              info_text = f"""[{icon}] {file_info.name}

      Path: {file_info.path}
      Size: {file_info.size_human}
      Modified: {file_info.modified_ago}
      Type: {file_info.mime_type or ('Directory' if file_info.is_directory else 'Unknown')}
      """

              return ChatResponse(
                  message=info_text.strip(),
                  data={
                      "file": file_info.model_dump(),
                      "suggested_actions": ["preview", "move", "copy", "compress"]
                  }
              )

          def _handle_help(self) -> ChatResponse:
              """Show help information."""
              help_text = """I'm Atlas, your file management assistant. Here's what I can do:

      [list] List files - "Show me recent downloads" or "List files in documents"
      [search] Search - "Find all PDFs" or "Search for report"
      [compress] Compress - "Compress the downloads folder" or "Zip documents"
      [extract] Extract - "Unzip archive.zip" or "Extract the backup"
      [preview] Preview - "Preview readme.txt" or "Show me the contents of config.json"
      [info] Info - "Get info about report.pdf" or "How big is the downloads folder?"
      [move] Move/Copy - "Move report.pdf to documents"
      [delete] Delete - "Delete old-backup.zip" (with confirmation)

      Just tell me what you need, and I'll help you keep everything in its place!
      """
              return ChatResponse(
                  message=help_text.strip(),
                  data={
                      "suggested_actions": ["list files", "search", "compress"]
                  }
              )


      # Create agent instance
      atlas = AtlasAgent()


      @app.get("/health", response_model=HealthResponse)
      async def health():
          """Health check endpoint."""
          return HealthResponse(
              status="healthy",
              agent="atlas",
              catchphrase=atlas.catchphrase
          )


      @app.get("/capabilities", response_model=CapabilitiesResponse)
      async def capabilities():
          """List Atlas capabilities."""
          return CapabilitiesResponse(
              personality={
                  "name": "Atlas",
                  "domain": "File system operations",
                  "traits": "Organized, methodical, knows where everything is",
                  "catchphrase": atlas.catchphrase
              },
              capabilities=[
                  Capability(
                      name="list",
                      description="List files in a directory",
                      examples=["Show me recent downloads", "List files in documents"]
                  ),
                  Capability(
                      name="search",
                      description="Search for files by name or type",
                      examples=["Find all PDFs", "Search for report"]
                  ),
                  Capability(
                      name="compress",
                      description="Create zip/tar archives",
                      examples=["Compress the downloads folder", "Zip the documents"]
                  ),
                  Capability(
                      name="decompress",
                      description="Extract archives",
                      examples=["Unzip archive.zip", "Extract backup.tar.gz"]
                  ),
                  Capability(
                      name="move",
                      description="Move files to a new location",
                      examples=["Move report.pdf to documents"]
                  ),
                  Capability(
                      name="copy",
                      description="Copy files",
                      examples=["Copy backup.zip to archives"]
                  ),
                  Capability(
                      name="delete",
                      description="Delete files (with confirmation)",
                      examples=["Delete old-backup.zip"]
                  ),
                  Capability(
                      name="preview",
                      description="Preview file contents",
                      examples=["Preview readme.txt", "Show contents of config.json"]
                  ),
                  Capability(
                      name="info",
                      description="Get file metadata",
                      examples=["Get info about report.pdf", "How big is downloads?"]
                  )
              ]
          )


      @app.post("/chat", response_model=ChatResponse)
      async def chat(request: ChatRequest):
          """Chat with Atlas to manage files."""
          context = request.context or ChatContext()
          return atlas.process_message(request.message, context)


      if __name__ == "__main__":
          uvicorn.run(app, host="0.0.0.0", port=8000)
    requirements.txt: |
      fastapi==0.109.0
      uvicorn==0.27.0
      pydantic==2.5.3
  kind: ConfigMap
  metadata:
    annotations:
      argocd.argoproj.io/tracking-id: holmos:/ConfigMap:holm/atlas-build-context
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM public.ecr.aws/docker/library/python:3.11-slim\n\nWORKDIR /app\n\n# Install dependencies\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Copy application\nCOPY app.py .\n\n# Create data directory\nRUN mkdir -p /data/downloads /data/documents /data/archives\n\n# Expose port\nEXPOSE 8000\n\n# Run the application\nCMD [\"uvicorn\", \"app:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n","app.py":"\"\"\"\nAtlas - The File Manager AI Agent\n\"Everything in its place.\"\n\"\"\"\n\nimport os\nimport json\nimport shutil\nimport zipfile\nimport tarfile\nimport mimetypes\nfrom datetime import datetime\nfrom pathlib import Path\nfrom typing import Optional, Dict, Any, List\nfrom fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\nimport uvicorn\n\napp = FastAPI(\n    title=\"Atlas - File Manager AI Agent\",\n    description=\"AI agent for file system operations. Everything in its place.\",\n    version=\"1.0.0\"\n)\n\n# Configuration\nDATA_ROOT = os.environ.get(\"DATA_ROOT\", \"/data\")\n\n# Request/Response Models\nclass ChatContext(BaseModel):\n    current_path: Optional[str] = \"/data\"\n    user_id: Optional[str] = \"admin\"\n\nclass ChatRequest(BaseModel):\n    message: str\n    context: Optional[ChatContext] = None\n\nclass FileInfo(BaseModel):\n    name: str\n    path: str\n    size: int\n    size_human: str\n    is_directory: bool\n    modified: str\n    modified_ago: str\n    mime_type: Optional[str] = None\n\nclass ChatResponse(BaseModel):\n    agent: str = \"atlas\"\n    message: str\n    data: Optional[Dict[str, Any]] = None\n\nclass Capability(BaseModel):\n    name: str\n    description: str\n    examples: List[str]\n\nclass CapabilitiesResponse(BaseModel):\n    agent: str = \"atlas\"\n    personality: Dict[str, str]\n    capabilities: List[Capability]\n\nclass HealthResponse(BaseModel):\n    status: str\n    agent: str\n    catchphrase: str\n\n\ndef human_readable_size(size_bytes: int) -\u003e str:\n    \"\"\"Convert bytes to human readable format.\"\"\"\n    for unit in ['B', 'KB', 'MB', 'GB', 'TB']:\n        if size_bytes \u003c 1024.0:\n            return f\"{size_bytes:.1f} {unit}\"\n        size_bytes /= 1024.0\n    return f\"{size_bytes:.1f} PB\"\n\n\ndef time_ago(timestamp: float) -\u003e str:\n    \"\"\"Convert timestamp to human readable time ago.\"\"\"\n    now = datetime.now().timestamp()\n    diff = now - timestamp\n\n    if diff \u003c 60:\n        return \"just now\"\n    elif diff \u003c 3600:\n        minutes = int(diff / 60)\n        return f\"{minutes} minute{'s' if minutes != 1 else ''} ago\"\n    elif diff \u003c 86400:\n        hours = int(diff / 3600)\n        return f\"{hours} hour{'s' if hours != 1 else ''} ago\"\n    elif diff \u003c 604800:\n        days = int(diff / 86400)\n        return f\"{days} day{'s' if days != 1 else ''} ago\"\n    else:\n        weeks = int(diff / 604800)\n        return f\"{weeks} week{'s' if weeks != 1 else ''} ago\"\n\n\ndef get_file_icon(path: Path, is_dir: bool) -\u003e str:\n    \"\"\"Get appropriate emoji icon for file type.\"\"\"\n    if is_dir:\n        return \"folder\"\n\n    suffix = path.suffix.lower()\n    icon_map = {\n        '.pdf': 'pdf',\n        '.doc': 'doc', '.docx': 'doc',\n        '.xls': 'xls', '.xlsx': 'xls',\n        '.ppt': 'ppt', '.pptx': 'ppt',\n        '.txt': 'txt',\n        '.md': 'md',\n        '.py': 'py',\n        '.js': 'js',\n        '.json': 'json',\n        '.xml': 'xml',\n        '.html': 'html',\n        '.css': 'css',\n        '.jpg': 'img', '.jpeg': 'img', '.png': 'img', '.gif': 'img', '.bmp': 'img',\n        '.mp3': 'audio', '.wav': 'audio', '.flac': 'audio',\n        '.mp4': 'video', '.avi': 'video', '.mkv': 'video', '.mov': 'video',\n        '.zip': 'archive', '.tar': 'archive', '.gz': 'archive', '.rar': 'archive', '.7z': 'archive',\n        '.exe': 'exe', '.sh': 'exe', '.bat': 'exe',\n    }\n    return icon_map.get(suffix, 'file')\n\n\ndef get_file_info(path: Path) -\u003e FileInfo:\n    \"\"\"Get detailed file information.\"\"\"\n    stat = path.stat()\n    is_dir = path.is_dir()\n    mime_type = None if is_dir else mimetypes.guess_type(str(path))[0]\n\n    return FileInfo(\n        name=path.name,\n        path=str(path),\n        size=stat.st_size if not is_dir else 0,\n        size_human=human_readable_size(stat.st_size) if not is_dir else \"-\",\n        is_directory=is_dir,\n        modified=datetime.fromtimestamp(stat.st_mtime).isoformat(),\n        modified_ago=time_ago(stat.st_mtime),\n        mime_type=mime_type\n    )\n\n\ndef safe_path(base: str, user_path: str) -\u003e Path:\n    \"\"\"Ensure path is within allowed directory.\"\"\"\n    base_path = Path(base).resolve()\n    target = (base_path / user_path).resolve()\n\n    if not str(target).startswith(str(base_path)):\n        raise ValueError(\"Access denied: Path outside allowed directory\")\n\n    return target\n\n\nclass AtlasAgent:\n    \"\"\"Atlas AI Agent for file management.\"\"\"\n\n    def __init__(self):\n        self.name = \"Atlas\"\n        self.catchphrase = \"Everything in its place.\"\n\n    def process_message(self, message: str, context: ChatContext) -\u003e ChatResponse:\n        \"\"\"Process user message and return appropriate response.\"\"\"\n        message_lower = message.lower().strip()\n        current_path = context.current_path or DATA_ROOT\n\n        # Ensure data directory exists\n        os.makedirs(DATA_ROOT, exist_ok=True)\n\n        try:\n            # List files / show recent\n            if any(kw in message_lower for kw in ['list', 'show', 'recent', 'what', \"what's\"]):\n                return self._handle_list(message_lower, current_path)\n\n            # Search for files\n            elif any(kw in message_lower for kw in ['find', 'search', 'where', 'locate']):\n                return self._handle_search(message_lower, current_path)\n\n            # Compress files\n            elif any(kw in message_lower for kw in ['compress', 'zip', 'archive', 'tar']):\n                return self._handle_compress(message_lower, current_path)\n\n            # Decompress files\n            elif any(kw in message_lower for kw in ['decompress', 'unzip', 'extract', 'untar']):\n                return self._handle_decompress(message_lower, current_path)\n\n            # Move files\n            elif 'move' in message_lower:\n                return self._handle_move(message_lower, current_path)\n\n            # Copy files\n            elif 'copy' in message_lower:\n                return self._handle_copy(message_lower, current_path)\n\n            # Delete files\n            elif any(kw in message_lower for kw in ['delete', 'remove', 'rm']):\n                return self._handle_delete(message_lower, current_path)\n\n            # Preview file\n            elif any(kw in message_lower for kw in ['preview', 'view', 'read', 'cat']):\n                return self._handle_preview(message_lower, current_path)\n\n            # File info\n            elif any(kw in message_lower for kw in ['info', 'details', 'metadata', 'size']):\n                return self._handle_info(message_lower, current_path)\n\n            # Help\n            elif any(kw in message_lower for kw in ['help', 'what can you', 'capabilities']):\n                return self._handle_help()\n\n            # Greeting\n            elif any(kw in message_lower for kw in ['hello', 'hi', 'hey', 'greetings']):\n                return ChatResponse(\n                    message=f\"Hello! I'm Atlas, your file management assistant. {self.catchphrase} How can I help you organize your files today?\",\n                    data={\"suggested_actions\": [\"list files\", \"search\", \"organize\"]}\n                )\n\n            # Default response\n            else:\n                return ChatResponse(\n                    message=f\"I'm not quite sure what you'd like me to do. I can help you list, search, move, copy, compress, or delete files. What would you like to do?\",\n                    data={\"suggested_actions\": [\"list files\", \"search for files\", \"compress folder\"]}\n                )\n\n        except Exception as e:\n            return ChatResponse(\n                message=f\"I encountered an issue: {str(e)}. Please check the path and try again.\",\n                data={\"error\": str(e)}\n            )\n\n    def _handle_list(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle file listing requests.\"\"\"\n        # Determine which directory to list\n        if 'download' in message:\n            target_dir = safe_path(DATA_ROOT, \"downloads\")\n        elif 'document' in message:\n            target_dir = safe_path(DATA_ROOT, \"documents\")\n        else:\n            target_dir = Path(current_path)\n\n        if not target_dir.exists():\n            os.makedirs(target_dir, exist_ok=True)\n            return ChatResponse(\n                message=f\"The directory {target_dir} was empty, so I created it for you. It's ready for your files!\",\n                data={\"path\": str(target_dir), \"files\": []}\n            )\n\n        files = []\n        for item in sorted(target_dir.iterdir(), key=lambda x: x.stat().st_mtime, reverse=True)[:20]:\n            file_info = get_file_info(item)\n            files.append(file_info.model_dump())\n\n        if not files:\n            return ChatResponse(\n                message=f\"The directory {target_dir} is empty. Would you like me to help you organize some files here?\",\n                data={\"path\": str(target_dir), \"files\": []}\n            )\n\n        # Format response\n        file_list = []\n        for f in files[:10]:\n            icon = get_file_icon(Path(f['path']), f['is_directory'])\n            size_str = f['size_human'] if not f['is_directory'] else \"folder\"\n            file_list.append(f\"[{icon}] {f['name']} ({size_str}) - {f['modified_ago']}\")\n\n        response_msg = f\"Here are the files in {target_dir}:\\n\" + \"\\n\".join(file_list)\n        if len(files) \u003e 10:\n            response_msg += f\"\\n\\n...and {len(files) - 10} more files.\"\n        response_msg += \"\\n\\nWould you like me to organize these or perform any actions?\"\n\n        return ChatResponse(\n            message=response_msg,\n            data={\n                \"path\": str(target_dir),\n                \"files\": files,\n                \"suggested_actions\": [\"compress\", \"search\", \"delete old files\"]\n            }\n        )\n\n    def _handle_search(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle file search requests.\"\"\"\n        # Extract search pattern\n        pattern = None\n        for ext in ['.pdf', '.jpg', '.png', '.doc', '.txt', '.mp3', '.mp4', '.zip']:\n            if ext in message.lower() or ext[1:] in message.lower():\n                pattern = f\"*{ext}\"\n                break\n\n        if not pattern:\n            # Try to extract a filename pattern\n            words = message.split()\n            for i, word in enumerate(words):\n                if word in ['for', 'named', 'called'] and i + 1 \u003c len(words):\n                    pattern = f\"*{words[i + 1]}*\"\n                    break\n\n        if not pattern:\n            pattern = \"*\"\n\n        search_path = Path(current_path)\n        if not search_path.exists():\n            search_path = Path(DATA_ROOT)\n\n        found_files = []\n        for item in search_path.rglob(pattern):\n            if len(found_files) \u003e= 50:\n                break\n            found_files.append(get_file_info(item).model_dump())\n\n        if not found_files:\n            return ChatResponse(\n                message=f\"I couldn't find any files matching '{pattern}' in {search_path}. Would you like me to search elsewhere?\",\n                data={\"pattern\": pattern, \"path\": str(search_path), \"files\": []}\n            )\n\n        file_list = []\n        for f in found_files[:15]:\n            icon = get_file_icon(Path(f['path']), f['is_directory'])\n            file_list.append(f\"[{icon}] {f['path']}\")\n\n        response_msg = f\"Searching for {pattern}...\\nFound {len(found_files)} file(s):\\n\" + \"\\n\".join(file_list)\n        if len(found_files) \u003e 15:\n            response_msg += f\"\\n\\n...and {len(found_files) - 15} more files.\"\n\n        return ChatResponse(\n            message=response_msg,\n            data={\n                \"pattern\": pattern,\n                \"path\": str(search_path),\n                \"files\": found_files,\n                \"suggested_actions\": [\"preview\", \"move\", \"compress\"]\n            }\n        )\n\n    def _handle_compress(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle compression requests.\"\"\"\n        # Determine what to compress\n        if 'download' in message:\n            target = safe_path(DATA_ROOT, \"downloads\")\n        elif 'document' in message:\n            target = safe_path(DATA_ROOT, \"documents\")\n        else:\n            target = Path(current_path)\n\n        if not target.exists():\n            return ChatResponse(\n                message=f\"I couldn't find {target}. Please check the path and try again.\",\n                data={\"error\": \"Path not found\"}\n            )\n\n        # Create archive\n        archive_name = f\"{target.name}.zip\"\n        archive_path = target.parent / archive_name\n\n        with zipfile.ZipFile(archive_path, 'w', zipfile.ZIP_DEFLATED) as zipf:\n            if target.is_dir():\n                for file in target.rglob('*'):\n                    if file.is_file():\n                        zipf.write(file, file.relative_to(target))\n            else:\n                zipf.write(target, target.name)\n\n        archive_size = human_readable_size(archive_path.stat().st_size)\n\n        return ChatResponse(\n            message=f\"Creating archive of {target}...\\n\\nCreated {archive_name} ({archive_size})\\n\\nWould you like me to move it somewhere?\",\n            data={\n                \"archive\": str(archive_path),\n                \"size\": archive_size,\n                \"suggested_actions\": [\"move\", \"delete original\"]\n            }\n        )\n\n    def _handle_decompress(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle decompression requests.\"\"\"\n        # Find archive file in message or current directory\n        archive_path = None\n\n        for word in message.split():\n            if any(word.endswith(ext) for ext in ['.zip', '.tar', '.gz', '.tar.gz']):\n                archive_path = safe_path(DATA_ROOT, word)\n                break\n\n        if not archive_path:\n            # Look for archives in current directory\n            current = Path(current_path)\n            archives = list(current.glob('*.zip')) + list(current.glob('*.tar*'))\n            if archives:\n                archive_path = archives[0]\n            else:\n                return ChatResponse(\n                    message=\"I couldn't find an archive to extract. Please specify the archive file name.\",\n                    data={\"error\": \"No archive found\"}\n                )\n\n        if not archive_path.exists():\n            return ChatResponse(\n                message=f\"I couldn't find the archive {archive_path}. Please check the path.\",\n                data={\"error\": \"Archive not found\"}\n            )\n\n        # Extract archive\n        extract_dir = archive_path.parent / archive_path.stem\n\n        if archive_path.suffix == '.zip':\n            with zipfile.ZipFile(archive_path, 'r') as zipf:\n                zipf.extractall(extract_dir)\n        elif archive_path.suffix in ['.tar', '.gz']:\n            with tarfile.open(archive_path, 'r:*') as tarf:\n                tarf.extractall(extract_dir)\n\n        return ChatResponse(\n            message=f\"Extracting {archive_path.name}...\\n\\nExtracted to {extract_dir}\\n\\nWould you like me to show you the contents?\",\n            data={\n                \"archive\": str(archive_path),\n                \"extracted_to\": str(extract_dir),\n                \"suggested_actions\": [\"list files\", \"delete archive\"]\n            }\n        )\n\n    def _handle_move(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle move requests.\"\"\"\n        return ChatResponse(\n            message=\"To move files, please specify the source and destination. For example: 'Move report.pdf to /data/documents'\",\n            data={\n                \"suggested_actions\": [\"list files first\", \"specify paths\"]\n            }\n        )\n\n    def _handle_copy(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle copy requests.\"\"\"\n        return ChatResponse(\n            message=\"To copy files, please specify the source and destination. For example: 'Copy backup.zip to /data/archives'\",\n            data={\n                \"suggested_actions\": [\"list files first\", \"specify paths\"]\n            }\n        )\n\n    def _handle_delete(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle delete requests - requires confirmation.\"\"\"\n        return ChatResponse(\n            message=\"For safety, I need you to confirm the exact file or folder you want to delete. Please specify the full path, and I'll ask for confirmation before proceeding.\",\n            data={\n                \"warning\": \"Deletion requires confirmation\",\n                \"suggested_actions\": [\"list files first\", \"specify exact path\"]\n            }\n        )\n\n    def _handle_preview(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle file preview requests.\"\"\"\n        # Try to find a file to preview\n        words = message.split()\n        target_file = None\n\n        for word in words:\n            try:\n                potential_path = safe_path(DATA_ROOT, word)\n                if potential_path.exists() and potential_path.is_file():\n                    target_file = potential_path\n                    break\n            except:\n                continue\n\n        if not target_file:\n            return ChatResponse(\n                message=\"Please specify which file you'd like me to preview. For example: 'Preview report.txt'\",\n                data={\"suggested_actions\": [\"list files\", \"search for file\"]}\n            )\n\n        # Read file content (first 1000 chars for text files)\n        try:\n            mime_type = mimetypes.guess_type(str(target_file))[0]\n            if mime_type and mime_type.startswith('text'):\n                with open(target_file, 'r') as f:\n                    content = f.read(1000)\n                if len(content) == 1000:\n                    content += \"\\n\\n... (truncated)\"\n\n                return ChatResponse(\n                    message=f\"Preview of {target_file.name}:\\n\\n```\\n{content}\\n```\",\n                    data={\n                        \"file\": str(target_file),\n                        \"content\": content,\n                        \"suggested_actions\": [\"open full file\", \"copy\", \"move\"]\n                    }\n                )\n            else:\n                file_info = get_file_info(target_file)\n                return ChatResponse(\n                    message=f\"This file ({file_info.mime_type or 'binary'}) cannot be previewed as text. Here's the file info:\\n\\n[file] {file_info.name}\\nSize: {file_info.size_human}\\nModified: {file_info.modified_ago}\",\n                    data={\"file\": file_info.model_dump()}\n                )\n        except Exception as e:\n            return ChatResponse(\n                message=f\"I couldn't preview that file: {str(e)}\",\n                data={\"error\": str(e)}\n            )\n\n    def _handle_info(self, message: str, current_path: str) -\u003e ChatResponse:\n        \"\"\"Handle file info requests.\"\"\"\n        # Try to find a file for info\n        words = message.split()\n        target = None\n\n        for word in words:\n            try:\n                potential_path = safe_path(DATA_ROOT, word)\n                if potential_path.exists():\n                    target = potential_path\n                    break\n            except:\n                continue\n\n        if not target:\n            target = Path(current_path)\n\n        if not target.exists():\n            return ChatResponse(\n                message=\"Please specify which file or folder you'd like info about.\",\n                data={\"suggested_actions\": [\"list files\", \"search\"]}\n            )\n\n        file_info = get_file_info(target)\n        icon = get_file_icon(target, target.is_dir())\n\n        info_text = f\"\"\"[{icon}] {file_info.name}\n\nPath: {file_info.path}\nSize: {file_info.size_human}\nModified: {file_info.modified_ago}\nType: {file_info.mime_type or ('Directory' if file_info.is_directory else 'Unknown')}\n\"\"\"\n\n        return ChatResponse(\n            message=info_text.strip(),\n            data={\n                \"file\": file_info.model_dump(),\n                \"suggested_actions\": [\"preview\", \"move\", \"copy\", \"compress\"]\n            }\n        )\n\n    def _handle_help(self) -\u003e ChatResponse:\n        \"\"\"Show help information.\"\"\"\n        help_text = \"\"\"I'm Atlas, your file management assistant. Here's what I can do:\n\n[list] List files - \"Show me recent downloads\" or \"List files in documents\"\n[search] Search - \"Find all PDFs\" or \"Search for report\"\n[compress] Compress - \"Compress the downloads folder\" or \"Zip documents\"\n[extract] Extract - \"Unzip archive.zip\" or \"Extract the backup\"\n[preview] Preview - \"Preview readme.txt\" or \"Show me the contents of config.json\"\n[info] Info - \"Get info about report.pdf\" or \"How big is the downloads folder?\"\n[move] Move/Copy - \"Move report.pdf to documents\"\n[delete] Delete - \"Delete old-backup.zip\" (with confirmation)\n\nJust tell me what you need, and I'll help you keep everything in its place!\n\"\"\"\n        return ChatResponse(\n            message=help_text.strip(),\n            data={\n                \"suggested_actions\": [\"list files\", \"search\", \"compress\"]\n            }\n        )\n\n\n# Create agent instance\natlas = AtlasAgent()\n\n\n@app.get(\"/health\", response_model=HealthResponse)\nasync def health():\n    \"\"\"Health check endpoint.\"\"\"\n    return HealthResponse(\n        status=\"healthy\",\n        agent=\"atlas\",\n        catchphrase=atlas.catchphrase\n    )\n\n\n@app.get(\"/capabilities\", response_model=CapabilitiesResponse)\nasync def capabilities():\n    \"\"\"List Atlas capabilities.\"\"\"\n    return CapabilitiesResponse(\n        personality={\n            \"name\": \"Atlas\",\n            \"domain\": \"File system operations\",\n            \"traits\": \"Organized, methodical, knows where everything is\",\n            \"catchphrase\": atlas.catchphrase\n        },\n        capabilities=[\n            Capability(\n                name=\"list\",\n                description=\"List files in a directory\",\n                examples=[\"Show me recent downloads\", \"List files in documents\"]\n            ),\n            Capability(\n                name=\"search\",\n                description=\"Search for files by name or type\",\n                examples=[\"Find all PDFs\", \"Search for report\"]\n            ),\n            Capability(\n                name=\"compress\",\n                description=\"Create zip/tar archives\",\n                examples=[\"Compress the downloads folder\", \"Zip the documents\"]\n            ),\n            Capability(\n                name=\"decompress\",\n                description=\"Extract archives\",\n                examples=[\"Unzip archive.zip\", \"Extract backup.tar.gz\"]\n            ),\n            Capability(\n                name=\"move\",\n                description=\"Move files to a new location\",\n                examples=[\"Move report.pdf to documents\"]\n            ),\n            Capability(\n                name=\"copy\",\n                description=\"Copy files\",\n                examples=[\"Copy backup.zip to archives\"]\n            ),\n            Capability(\n                name=\"delete\",\n                description=\"Delete files (with confirmation)\",\n                examples=[\"Delete old-backup.zip\"]\n            ),\n            Capability(\n                name=\"preview\",\n                description=\"Preview file contents\",\n                examples=[\"Preview readme.txt\", \"Show contents of config.json\"]\n            ),\n            Capability(\n                name=\"info\",\n                description=\"Get file metadata\",\n                examples=[\"Get info about report.pdf\", \"How big is downloads?\"]\n            )\n        ]\n    )\n\n\n@app.post(\"/chat\", response_model=ChatResponse)\nasync def chat(request: ChatRequest):\n    \"\"\"Chat with Atlas to manage files.\"\"\"\n    context = request.context or ChatContext()\n    return atlas.process_message(request.message, context)\n\n\nif __name__ == \"__main__\":\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n","requirements.txt":"fastapi==0.109.0\nuvicorn==0.27.0\npydantic==2.5.3\n"},"kind":"ConfigMap","metadata":{"annotations":{"argocd.argoproj.io/tracking-id":"holmos:/ConfigMap:holm/atlas-build-context"},"name":"atlas-build-context","namespace":"holm"}}
    creationTimestamp: "2026-01-27T03:22:22Z"
    name: atlas-build-context
    namespace: holm
    resourceVersion: "741"
    uid: 3035a80d-57ea-41c7-bd16-d01eae65efb4
- apiVersion: v1
  data:
    Dockerfile: |
      FROM docker.io/library/golang:1.21-alpine AS builder
      WORKDIR /app
      RUN apk add --no-cache git
      COPY go.mod go.sum ./
      RUN go mod download
      COPY main.go .
      RUN CGO_ENABLED=0 GOOS=linux go build -o cicd-controller .

      FROM docker.io/library/alpine:3.19
      RUN apk add --no-cache ca-certificates
      WORKDIR /app
      COPY --from=builder /app/cicd-controller .
      COPY ui.html .
      EXPOSE 8080
      CMD ["./cicd-controller"]
    deployment.yaml: |
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: cicd-controller
        namespace: holm
      ---
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: cicd-controller
      rules:
      - apiGroups: [""]
        resources: ["pods", "pods/log", "configmaps", "secrets", "services"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: ["batch"]
        resources: ["jobs"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: ["apps"]
        resources: ["deployments", "replicasets"]
        verbs: ["get", "list", "watch", "update", "patch"]
      ---
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: cicd-controller
      subjects:
      - kind: ServiceAccount
        name: cicd-controller
        namespace: holm
      roleRef:
        kind: ClusterRole
        name: cicd-controller
        apiGroup: rbac.authorization.k8s.io
      ---
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: cicd-controller
        namespace: holm
        labels:
          app: cicd-controller
      spec:
        replicas: 1
        selector:
          matchLabels:
            app: cicd-controller
        template:
          metadata:
            labels:
              app: cicd-controller
          spec:
            serviceAccountName: cicd-controller
            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                  - matchExpressions:
                    - key: kubernetes.io/hostname
                      operator: NotIn
                      values:
                      - openmediavault
            containers:
            - name: cicd-controller
              image: 10.110.67.87:5000/cicd-controller:latest
              imagePullPolicy: Always
              ports:
              - containerPort: 8080
              env:
              - name: REGISTRY_URL
                value: "10.110.67.87:5000"
              - name: HOLMGIT_URL
                value: "http://holm-git.holm.svc.cluster.local:8080"
              - name: PORT
                value: "8080"
              resources:
                requests:
                  memory: "128Mi"
                  cpu: "50m"
                limits:
                  memory: "512Mi"
                  cpu: "500m"
              livenessProbe:
                httpGet:
                  path: /health
                  port: 8080
                initialDelaySeconds: 10
                periodSeconds: 30
              readinessProbe:
                httpGet:
                  path: /health
                  port: 8080
                initialDelaySeconds: 5
                periodSeconds: 10
      ---
      apiVersion: v1
      kind: Service
      metadata:
        name: cicd-controller
        namespace: holm
      spec:
        type: NodePort
        selector:
          app: cicd-controller
        ports:
        - port: 8080
          targetPort: 8080
          nodePort: 30020
    go.mod: "module cicd-controller\n\ngo 1.21\n\nrequire (\n\tk8s.io/api v0.29.0\n\tk8s.io/apimachinery
      v0.29.0\n\tk8s.io/client-go v0.29.0\n)\n\nrequire (\n\tgithub.com/davecgh/go-spew
      v1.1.1 // indirect\n\tgithub.com/emicklei/go-restful/v3 v3.11.0 // indirect\n\tgithub.com/go-logr/logr
      v1.3.0 // indirect\n\tgithub.com/go-openapi/jsonpointer v0.19.6 // indirect\n\tgithub.com/go-openapi/jsonreference
      v0.20.2 // indirect\n\tgithub.com/go-openapi/swag v0.22.3 // indirect\n\tgithub.com/gogo/protobuf
      v1.3.2 // indirect\n\tgithub.com/golang/protobuf v1.5.3 // indirect\n\tgithub.com/google/gnostic-models
      v0.6.8 // indirect\n\tgithub.com/google/gofuzz v1.2.0 // indirect\n\tgithub.com/google/uuid
      v1.3.0 // indirect\n\tgithub.com/imdario/mergo v0.3.6 // indirect\n\tgithub.com/josharian/intern
      v1.0.0 // indirect\n\tgithub.com/json-iterator/go v1.1.12 // indirect\n\tgithub.com/mailru/easyjson
      v0.7.7 // indirect\n\tgithub.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd
      // indirect\n\tgithub.com/modern-go/reflect2 v1.0.2 // indirect\n\tgithub.com/munnerz/goautoneg
      v0.0.0-20191010083416-a7dc8b61c822 // indirect\n\tgithub.com/spf13/pflag v1.0.5
      // indirect\n\tgolang.org/x/net v0.17.0 // indirect\n\tgolang.org/x/oauth2 v0.10.0
      // indirect\n\tgolang.org/x/sys v0.13.0 // indirect\n\tgolang.org/x/term v0.13.0
      // indirect\n\tgolang.org/x/text v0.13.0 // indirect\n\tgolang.org/x/time v0.3.0
      // indirect\n\tgoogle.golang.org/appengine v1.6.7 // indirect\n\tgoogle.golang.org/protobuf
      v1.31.0 // indirect\n\tgopkg.in/inf.v0 v0.9.1 // indirect\n\tgopkg.in/yaml.v2
      v2.4.0 // indirect\n\tgopkg.in/yaml.v3 v3.0.1 // indirect\n\tk8s.io/klog/v2
      v2.110.1 // indirect\n\tk8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00
      // indirect\n\tk8s.io/utils v0.0.0-20230726121419-3b25d923346b // indirect\n\tsigs.k8s.io/json
      v0.0.0-20221116044647-bc3834ca7abd // indirect\n\tsigs.k8s.io/structured-merge-diff/v4
      v4.4.1 // indirect\n\tsigs.k8s.io/yaml v1.3.0 // indirect\n)\n"
    go.sum: |
      github.com/creack/pty v1.1.9/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
      github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
      github.com/davecgh/go-spew v1.1.1 h1:vj9j/u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=
      github.com/davecgh/go-spew v1.1.1/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
      github.com/emicklei/go-restful/v3 v3.11.0 h1:rAQeMHw1c7zTmncogyy8VvRZwtkmkZ4FxERmMY4rD+g=
      github.com/emicklei/go-restful/v3 v3.11.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRry+4bhvbpWn3mrbc=
      github.com/go-logr/logr v1.3.0 h1:2y3SDp0ZXuc6/cjLSZ+Q3ir+QB9T/iG5yYRXqsagWSY=
      github.com/go-logr/logr v1.3.0/go.mod h1:9T104GzyrTigFIr8wt5mBrctHMim0Nb2HLGrmQ40KvY=
      github.com/go-openapi/jsonpointer v0.19.6 h1:eCs3fxoIi3Wh6vtgmLTOjdhSpiqphQ+DaPn38N2ZdrE=
      github.com/go-openapi/jsonpointer v0.19.6/go.mod h1:osyAmYz/mB/C3I+WsTTSgw1ONzaLJoLCyoi6/zppojs=
      github.com/go-openapi/jsonreference v0.20.2 h1:3sVjiK66+uXK/6oQ8xgcRKcFgQ5KXa2KvnJRumpMGbE=
      github.com/go-openapi/jsonreference v0.20.2/go.mod h1:Bl1zwGIM8/wsvqjsOQLJ/SH+En5Ap4rVB5KVcIDZG2k=
      github.com/go-openapi/swag v0.22.3 h1:yMBqmnQ0gyZvEb/+KzuWZOXgllrXT4SADYbvDaXHv/g=
      github.com/go-openapi/swag v0.22.3/go.mod h1:UzaqsxGiab7freDnrUUra0MwWfN/q7tE4j+VcZ0yl14=
      github.com/go-task/slim-sprig v0.0.0-20230315185526-52ccab3ef572 h1:tfuBGBXKqDEevZMzYi5KSi8KkcZtzBcTgAUUtapy0OI=
      github.com/go-task/slim-sprig v0.0.0-20230315185526-52ccab3ef572/go.mod h1:9Pwr4B2jHnOSGXyyzV8ROjYa2ojvAY6HCGYYfMoC3Ls=
      github.com/gogo/protobuf v1.3.2 h1:Ov1cvc58UF3b5XjBnZv7+opcTcQFZebYjWzi34vdm4Q=
      github.com/gogo/protobuf v1.3.2/go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=
      github.com/golang/protobuf v1.3.1/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
      github.com/golang/protobuf v1.5.0/go.mod h1:FsONVRAS9T7sI+LIUmWTfcYkHO4aIWwzhcaSAoJOfIk=
      github.com/golang/protobuf v1.5.3 h1:KhyjKVUg7Usr/dYsdSqoFveMYd5ko72D+zANwlG1mmg=
      github.com/golang/protobuf v1.5.3/go.mod h1:XVQd3VNwM+JqD3oG2Ue2ip4fOMUkwXdXDdiuN0vRsmY=
      github.com/google/gnostic-models v0.6.8 h1:yo/ABAfM5IMRsS1VnXjTBvUb61tFIHozhlYvRgGre9I=
      github.com/google/gnostic-models v0.6.8/go.mod h1:5n7qKqH0f5wFt+aWF8CW6pZLLNOfYuF5OpfBSENuI8U=
      github.com/google/go-cmp v0.5.5/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
      github.com/google/go-cmp v0.5.9/go.mod h1:17dUlkBOakJ0+DkrSSNjCkIjxS6bF9zb3elmeNGIjoY=
      github.com/google/go-cmp v0.6.0 h1:ofyhxvXcZhMsU5ulbFiLKl/XBFqE1GSq7atu8tAmTRI=
      github.com/google/go-cmp v0.6.0/go.mod h1:17dUlkBOakJ0+DkrSSNjCkIjxS6bF9zb3elmeNGIjoY=
      github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
      github.com/google/gofuzz v1.2.0 h1:xRy4A+RhZaiKjJ1bPfwQ8sedCA+YS2YcCHW6ec7JMi0=
      github.com/google/gofuzz v1.2.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
      github.com/google/pprof v0.0.0-20210720184732-4bb14d4b1be1 h1:K6RDEckDVWvDI9JAJYCmNdQXq6neHJOYx3V6jnqNEec=
      github.com/google/pprof v0.0.0-20210720184732-4bb14d4b1be1/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=
      github.com/google/uuid v1.3.0 h1:t6JiXgmwXMjEs8VusXIJk2BXHsn+wx8BZdTaoZ5fu7I=
      github.com/google/uuid v1.3.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
      github.com/josharian/intern v1.0.0 h1:vlS4z54oSdjm0bgjRigI+G1HpF+tI+9rE5LLzOg8HmY=
      github.com/josharian/intern v1.0.0/go.mod h1:5DoeVV0s6jJacbCEi61lwdGj/aVlrQvzHFFd8Hwg//Y=
      github.com/json-iterator/go v1.1.12 h1:PV8peI4a0ysnczrg+LtxykD8LfKY9ML6u2jnxaEnrnM=
      github.com/json-iterator/go v1.1.12/go.mod h1:e30LSqwooZae/UwlEbR2852Gd8hjQvJoHmT4TnhNGBo=
      github.com/kisielk/errcheck v1.5.0/go.mod h1:pFxgyoBC7bSaBwPgfKdkLd5X25qrDl4LWUI2bnpBCr8=
      github.com/kisielk/gotool v1.0.0/go.mod h1:XhKaO+MFFWcvkIS/tQcRk01m1F5IRFswLeQ+oQHNcck=
      github.com/kr/pretty v0.2.1/go.mod h1:ipq/a2n7PKx3OHsz4KJII5eveXtPO4qwEXGdVfWzfnI=
      github.com/kr/pretty v0.3.1 h1:flRD4NNwYAUpkphVc1HcthR4KEIFJ65n8Mw5qdRn3LE=
      github.com/kr/pretty v0.3.1/go.mod h1:hoEshYVHaxMs3cyo3Yncou5ZscifuDolrwPKZanG3xk=
      github.com/kr/pty v1.1.1/go.mod h1:pFQYn66WHrOpPYNljwOMqo10TkYh1fy3cYio2l3bCsQ=
      github.com/kr/text v0.1.0/go.mod h1:4Jbv+DJW3UT/LiOwJeYQe1efqtUx/iVham/4vfdArNI=
      github.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=
      github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=
      github.com/mailru/easyjson v0.7.7 h1:UGYAvKxe3sBsEDzO8ZeWOSlIQfWFlxbzLZe7hwFURr0=
      github.com/mailru/easyjson v0.7.7/go.mod h1:xzfreul335JAWq5oZzymOObrkdz5UnU4kGfJJLY9Nlc=
      github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
      github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd h1:TRLaZ9cD/w8PVh93nsPXa1VrQ6jlwL5oN8l14QlcNfg=
      github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
      github.com/modern-go/reflect2 v1.0.2 h1:xBagoLtFs94CBntxluKeaWgTMpvLxC4ur3nMaC9Gz0M=
      github.com/modern-go/reflect2 v1.0.2/go.mod h1:yWuevngMOJpCy52FWWMvUC8ws7m/LJsjYzDa0/r8luk=
      github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 h1:C3w9PqII01/Oq1c1nUAm88MOHcQC9l5mIlSMApZMrHA=
      github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822/go.mod h1:+n7T8mK8HuQTcFwEeznm/DIxMOiR9yIdICNftLE1DvQ=
      github.com/onsi/ginkgo/v2 v2.13.0 h1:0jY9lJquiL8fcf3M4LAXN5aMlS/b2BV86HFFPCPMgE4=
      github.com/onsi/ginkgo/v2 v2.13.0/go.mod h1:TE309ZR8s5FsKKpuB1YAQYBzCaAfUgatB/xlT/ETL/o=
      github.com/onsi/gomega v1.29.0 h1:KIA/t2t5UBzoirT4H9tsML45GEbo3ouUnBHsCfD2tVg=
      github.com/onsi/gomega v1.29.0/go.mod h1:9sxs+SwGrKI0+PWe4Fxa9tFQQBG5xSsSbMXOI8PPpoQ=
      github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=
      github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
      github.com/rogpeppe/go-internal v1.10.0 h1:TMyTOH3F/DB16zRVcYyreMH6GnZZrwQVAoYjRBZyWFQ=
      github.com/rogpeppe/go-internal v1.10.0/go.mod h1:UQnix2H7Ngw/k4C5ijL5+65zddjncjaFoBhdsK/akog=
      github.com/spf13/pflag v1.0.5 h1:iy+VFUOCP1a+8yFto/drg2CJ5u0yRoB7fZw3DKv/JXA=
      github.com/spf13/pflag v1.0.5/go.mod h1:McXfInJRrz4CZXVZOBLb0bTZqETkiAhM9Iw0y3An2Bg=
      github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=
      github.com/stretchr/objx v0.4.0/go.mod h1:YvHI0jy2hoMjB+UWwv71VJQ9isScKT/TqJzVSSt89Yw=
      github.com/stretchr/objx v0.5.0/go.mod h1:Yh+to48EsGEfYuaHDzXPcE3xhTkx73EhmCGUpEOglKo=
      github.com/stretchr/testify v1.3.0/go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
      github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
      github.com/stretchr/testify v1.8.0/go.mod h1:yNjHg4UonilssWZ8iaSj1OCr/vHnekPRkoO+kdMU+MU=
      github.com/stretchr/testify v1.8.1/go.mod h1:w2LPCIKwWwSfY2zedu0+kehJoqGctiVI29o6fzry7u4=
      github.com/stretchr/testify v1.8.4 h1:CcVxjf3Q8PM0mHUKJCdn+eZZtm5yQwehR5yeSVQQcUk=
      github.com/stretchr/testify v1.8.4/go.mod h1:sz/lmYIOXD/1dqDmKjjqLyZ2RngseejIcXlSw2iwfAo=
      github.com/yuin/goldmark v1.1.27/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
      github.com/yuin/goldmark v1.2.1/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
      golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=
      golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
      golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
      golang.org/x/mod v0.2.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=
      golang.org/x/mod v0.3.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=
      golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
      golang.org/x/net v0.0.0-20190603091049-60506f45cf65/go.mod h1:HSz+uSET+XFnRR8LxR5pz3Of3rY3CfYBVs4xY44aLks=
      golang.org/x/net v0.0.0-20190620200207-3b0461eec859/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
      golang.org/x/net v0.0.0-20200226121028-0de0cce0169b/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
      golang.org/x/net v0.0.0-20201021035429-f5854403a974/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
      golang.org/x/net v0.17.0 h1:pVaXccu2ozPjCXewfr1S7xza/zcXTity9cCdXQYSjIM=
      golang.org/x/net v0.17.0/go.mod h1:NxSsAGuq816PNPmqtQdLE42eU2Fs7NoRIZrHJAlaCOE=
      golang.org/x/oauth2 v0.10.0 h1:zHCpF2Khkwy4mMB4bv0U37YtJdTGW8jI0glAApi0Kh8=
      golang.org/x/oauth2 v0.10.0/go.mod h1:kTpgurOux7LqtuxjuyZa4Gj2gdezIt/jQtGnNFfypQI=
      golang.org/x/sync v0.0.0-20190423024810-112230192c58/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
      golang.org/x/sync v0.0.0-20190911185100-cd5d95a43a6e/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
      golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
      golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
      golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
      golang.org/x/sys v0.0.0-20200930185726-fdedc70b468f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
      golang.org/x/sys v0.13.0 h1:Af8nKPmuFypiUBjVoU9V20FiaFXOcuZI21p0ycVYYGE=
      golang.org/x/sys v0.13.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
      golang.org/x/term v0.13.0 h1:bb+I9cTfFazGW51MZqBVmZy7+JEJMouUHTUSKVQLBek=
      golang.org/x/term v0.13.0/go.mod h1:LTmsnFJwVN6bCy1rVCoS+qHT1HhALEFxKncY3WNNh4U=
      golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=
      golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=
      golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
      golang.org/x/text v0.13.0 h1:ablQoSUd0tRdKxZewP80B+BaqeKJuVhuRxj/dkrun3k=
      golang.org/x/text v0.13.0/go.mod h1:TvPlkZtksWOMsz7fbANvkp4WM8x/WCo/om8BMLbz+aE=
      golang.org/x/time v0.3.0 h1:rg5rLMjNzMS1RkNLzCG38eapWhnYLFYXDXj2gOlr8j4=
      golang.org/x/time v0.3.0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
      golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
      golang.org/x/tools v0.0.0-20191119224855-298f0cb1881e/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=
      golang.org/x/tools v0.0.0-20200619180055-7c47624df98f/go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh/qjgUK9TdY2XT94GE=
      golang.org/x/tools v0.0.0-20210106214847-113979e3529a/go.mod h1:emZCQorbCU4vsT4fOWvOPXz4eW1wZW4PmDk9uLelYpA=
      golang.org/x/tools v0.12.0 h1:YW6HUoUmYBpwSgyaGaZq1fHjrBjX1rlpZ54T6mu2kss=
      golang.org/x/tools v0.12.0/go.mod h1:Sc0INKfu04TlqNoRA1hgpFZbhYXHPr4V5DzpSBTPqQM=
      golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
      golang.org/x/xerrors v0.0.0-20191011141410-1b5146add898/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
      golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
      golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
      google.golang.org/appengine v1.6.7 h1:FZR1q0exgwxzPzp/aF+VccGrSfxfPpkBqjIIEq3ru6c=
      google.golang.org/appengine v1.6.7/go.mod h1:8WjMMxjGQR8xUklV/ARdw2HLXBOI7O7uCIDZVag1xfc=
      google.golang.org/protobuf v1.26.0-rc.1/go.mod h1:jlhhOSvTdKEhbULTjvd4ARK9grFBp09yW+WbY/TyQbw=
      google.golang.org/protobuf v1.26.0/go.mod h1:9q0QmTI4eRPtz6boOQmLYwt+qCgq0jsYwAQnmE0givc=
      google.golang.org/protobuf v1.31.0 h1:g0LDEJHgrBl9N9r17Ru3sqWhkIx2NB67okBHPwC7hs8=
      google.golang.org/protobuf v1.31.0/go.mod h1:HV8QOd/L58Z+nl8r43ehVNZIU/HEI6OcFqwMG9pJV4I=
      gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
      gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c h1:Hei/4ADfdWqJk1ZMxUNpqntNwaWcugrBjAiHlqqRiVk=
      gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c/go.mod h1:JHkPIbrfpd72SG/EVd6muEfDQjcINNoR0C8j2r3qZ4Q=
      gopkg.in/inf.v0 v0.9.1 h1:73M5CoZyi3ZLMOyDlQh031Cx6N9NDJ2Vvfl76EDAgDc=
      gopkg.in/inf.v0 v0.9.1/go.mod h1:cWUDdTG/fYaXco+Dcufb5Vnc6Gp2YChqWtbxRZE0mXw=
      gopkg.in/yaml.v2 v2.2.8/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI=
      gopkg.in/yaml.v2 v2.4.0 h1:D8xgwECY7CYvx+Y2n4sBz93Jn9JRvxdiyyo8CTfuKaY=
      gopkg.in/yaml.v2 v2.4.0/go.mod h1:RDklbk79AGWmwhnvt/jBztapEOGDOx6ZbXqjP6csGnQ=
      gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
      gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
      gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
      k8s.io/api v0.29.0 h1:NiCdQMY1QOp1H8lfRyeEf8eOwV6+0xA6XEE44ohDX2A=
      k8s.io/api v0.29.0/go.mod h1:sdVmXoz2Bo/cb77Pxi71IPTSErEW32xa4aXwKH7gfBA=
      k8s.io/apimachinery v0.29.0 h1:+ACVktwyicPz0oc6MTMLwa2Pw3ouLAfAon1wPLtG48o=
      k8s.io/apimachinery v0.29.0/go.mod h1:eVBxQ/cwiJxH58eK/jd/vAk4mrxmVlnpBH5J2GbMeis=
      k8s.io/client-go v0.29.0 h1:KmlDtFcrdUzOYrBhXHgKw5ycWzc3ryPX5mQe0SkG3y8=
      k8s.io/client-go v0.29.0/go.mod h1:yLkXH4HKMAywcrD82KMSmfYg2DlE8mepPR4JGSo5n38=
      k8s.io/klog/v2 v2.110.1 h1:U/Af64HJf7FcwMcXyKm2RPM22WZzyR7OSpYj5tg3cL0=
      k8s.io/klog/v2 v2.110.1/go.mod h1:YGtd1984u+GgbuZ7e08/yBuAfKLSO0+uR1Fhi6ExXjo=
      k8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00 h1:aVUu9fTY98ivBPKR9Y5w/AuzbMm96cd3YHRTU83I780=
      k8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00/go.mod h1:AsvuZPBlUDVuCdzJ87iajxtXuR9oktsTctW/R9wwouA=
      k8s.io/utils v0.0.0-20230726121419-3b25d923346b h1:sgn3ZU783SCgtaSJjpcVVlRqd6GSnlTLKgpAAttJvpI=
      k8s.io/utils v0.0.0-20230726121419-3b25d923346b/go.mod h1:OLgZIPagt7ERELqWJFomSt595RzquPNLL48iOWgYOg0=
      sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd h1:EDPBXCAspyGV4jQlpZSudPeMmr1bNJefnuqLsRAsHZo=
      sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd/go.mod h1:B8JuhiUyNFVKdsE8h686QcCxMaH6HrOAZj4vswFpcB0=
      sigs.k8s.io/structured-merge-diff/v4 v4.4.1 h1:150L+0vs/8DA78h1u02ooW1/fFq/Lwr+sGiqlzvrtq4=
      sigs.k8s.io/structured-merge-diff/v4 v4.4.1/go.mod h1:N8hJocpFajUSSeSJ9bOZ77VzejKZaXsTtZo4/u7Io08=
      sigs.k8s.io/yaml v1.3.0 h1:a2VclLzOGrwOHDiV8EfBGhvjHvP46CtW5j6POvhYGGo=
      sigs.k8s.io/yaml v1.3.0/go.mod h1:GeOyir5tyXNByN85N/dRIT9es5UQNerPYEKK56eTBm8=
    kaniko-build.yaml: |
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: kaniko-cicd-controller
        namespace: holm
      spec:
        backoffLimit: 0
        ttlSecondsAfterFinished: 300
        template:
          spec:
            restartPolicy: Never
            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                  - matchExpressions:
                    - key: kubernetes.io/hostname
                      operator: NotIn
                      values:
                      - openmediavault
            containers:
            - name: kaniko
              image: gcr.io/kaniko-project/executor:latest
              args:
              - "--dockerfile=/workspace/Dockerfile"
              - "--context=/workspace"
              - "--destination=10.110.67.87:5000/cicd-controller:latest"
              - "--insecure"
              - "--skip-tls-verify"
              volumeMounts:
              - name: source
                mountPath: /workspace
              resources:
                requests:
                  memory: "1Gi"
                  cpu: "500m"
                limits:
                  memory: "2Gi"
                  cpu: "2"
            volumes:
            - name: source
              configMap:
                name: cicd-controller-src
    main.go: "package main\n\nimport (\n\t\"bytes\"\n\t\"context\"\n\t\"crypto/sha256\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n\n\tbatchv1
      \"k8s.io/api/batch/v1\"\n\tcorev1 \"k8s.io/api/core/v1\"\n\t\"k8s.io/apimachinery/pkg/api/errors\"\n\t\"k8s.io/apimachinery/pkg/api/resource\"\n\tmetav1
      \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n\t\"k8s.io/client-go/kubernetes\"\n\t\"k8s.io/client-go/rest\"\n)\n\nvar
      (\n\tregistryURL = os.Getenv(\"REGISTRY_URL\")\n\tholmGitURL  = os.Getenv(\"HOLMGIT_URL\")\n\tport
      \       = os.Getenv(\"PORT\")\n\tclientset   *kubernetes.Clientset\n\n\t// Pipeline
      definitions\n\tpipelines   = make(map[string]*Pipeline)\n\tpipelinesMu sync.RWMutex\n\n\t//
      Build queue\n\tbuildQueue   = make([]*BuildJob, 0)\n\tbuildQueueMu sync.RWMutex\n\n\t//
      Pipeline executions (history)\n\texecutions   = make([]*PipelineExecution, 0)\n\texecutionsMu
      sync.RWMutex\n\n\t// Build logs storage\n\tbuildLogs   = make(map[string]*BuildLog)\n\tbuildLogsMu
      sync.RWMutex\n\n\t// Webhook events\n\twebhookEvents   = make([]*WebhookEvent,
      0)\n\twebhookEventsMu sync.RWMutex\n)\n\n// Pipeline defines a CI/CD pipeline
      with stages\ntype Pipeline struct {\n\tID          string            `json:\"id\"`\n\tName
      \       string            `json:\"name\"`\n\tDescription string            `json:\"description\"`\n\tRepoURL
      \    string            `json:\"repoUrl\"`\n\tBranch      string            `json:\"branch\"`\n\tStages
      \     []PipelineStage   `json:\"stages\"`\n\tTriggers    []PipelineTrigger `json:\"triggers\"`\n\tVariables
      \  map[string]string `json:\"variables\"`\n\tEnabled     bool              `json:\"enabled\"`\n\tCreatedAt
      \  time.Time         `json:\"createdAt\"`\n\tUpdatedAt   time.Time         `json:\"updatedAt\"`\n}\n\n//
      PipelineStage defines a stage in a pipeline\ntype PipelineStage struct {\n\tName
      \       string            `json:\"name\"`\n\tType        string            `json:\"type\"`
      // build, test, deploy, custom\n\tImage       string            `json:\"image\"`\n\tCommands
      \   []string          `json:\"commands\"`\n\tEnvironment map[string]string `json:\"environment\"`\n\tTimeout
      \    int               `json:\"timeout\"` // seconds\n\tDependsOn   []string
      \         `json:\"dependsOn\"`\n\tCondition   string            `json:\"condition\"`
      // always, on_success, on_failure\n}\n\n// PipelineTrigger defines what triggers
      a pipeline\ntype PipelineTrigger struct {\n\tType     string   `json:\"type\"`
      // webhook, schedule, manual\n\tBranches []string `json:\"branches\"`\n\tEvents
      \  []string `json:\"events\"` // push, tag, pr\n\tSchedule string   `json:\"schedule\"`\n}\n\n//
      BuildJob represents a queued build\ntype BuildJob struct {\n\tID          string
      \           `json:\"id\"`\n\tPipelineID  string            `json:\"pipelineId\"`\n\tPipeline
      \   string            `json:\"pipeline\"`\n\tRepo        string            `json:\"repo\"`\n\tBranch
      \     string            `json:\"branch\"`\n\tCommit      string            `json:\"commit\"`\n\tAuthor
      \     string            `json:\"author\"`\n\tMessage     string            `json:\"message\"`\n\tStatus
      \     string            `json:\"status\"` // queued, running, success, failed,
      cancelled\n\tPriority    int               `json:\"priority\"`\n\tVariables
      \  map[string]string `json:\"variables\"`\n\tCreatedAt   time.Time         `json:\"createdAt\"`\n\tStartedAt
      \  *time.Time        `json:\"startedAt\"`\n\tCompletedAt *time.Time        `json:\"completedAt\"`\n}\n\n//
      PipelineExecution represents a pipeline run history entry\ntype PipelineExecution
      struct {\n\tID           string           `json:\"id\"`\n\tPipelineID   string
      \          `json:\"pipelineId\"`\n\tPipelineName string           `json:\"pipelineName\"`\n\tBuildNumber
      \ int              `json:\"buildNumber\"`\n\tRepo         string           `json:\"repo\"`\n\tBranch
      \      string           `json:\"branch\"`\n\tCommit       string           `json:\"commit\"`\n\tAuthor
      \      string           `json:\"author\"`\n\tMessage      string           `json:\"message\"`\n\tTrigger
      \     string           `json:\"trigger\"`\n\tStatus       string           `json:\"status\"`\n\tStages
      \      []StageExecution `json:\"stages\"`\n\tStartedAt    time.Time        `json:\"startedAt\"`\n\tCompletedAt
      \ *time.Time       `json:\"completedAt\"`\n\tDuration     float64          `json:\"duration\"`\n\tArtifacts
      \   []string         `json:\"artifacts\"`\n}\n\n// StageExecution represents
      a stage execution within a pipeline run\ntype StageExecution struct {\n\tName
      \       string     `json:\"name\"`\n\tStatus      string     `json:\"status\"`\n\tStartedAt
      \  *time.Time `json:\"startedAt\"`\n\tCompletedAt *time.Time `json:\"completedAt\"`\n\tDuration
      \   float64    `json:\"duration\"`\n\tLogID       string     `json:\"logId\"`\n\tError
      \      string     `json:\"error\"`\n}\n\n// BuildLog stores logs for a build/stage\ntype
      BuildLog struct {\n\tID          string    `json:\"id\"`\n\tExecutionID string
      \   `json:\"executionId\"`\n\tStage       string    `json:\"stage\"`\n\tLines
      \      []LogLine `json:\"lines\"`\n\tCreatedAt   time.Time `json:\"createdAt\"`\n}\n\n//
      LogLine is a single log line with timestamp\ntype LogLine struct {\n\tTimestamp
      time.Time `json:\"timestamp\"`\n\tLevel     string    `json:\"level\"` // info,
      warn, error, debug\n\tMessage   string    `json:\"message\"`\n}\n\n// WebhookEvent
      represents an incoming webhook\ntype WebhookEvent struct {\n\tID         string
      \                `json:\"id\"`\n\tType       string                 `json:\"type\"`\n\tSource
      \    string                 `json:\"source\"`\n\tRepo       string                 `json:\"repo\"`\n\tBranch
      \    string                 `json:\"branch\"`\n\tCommit     string                 `json:\"commit\"`\n\tAuthor
      \    string                 `json:\"author\"`\n\tMessage    string                 `json:\"message\"`\n\tPayload
      \   map[string]interface{} `json:\"payload\"`\n\tTimestamp  time.Time              `json:\"timestamp\"`\n\tProcessed
      \ bool                   `json:\"processed\"`\n\tPipelineID string                 `json:\"pipelineId\"`\n}\n\n//
      KanikoBuild represents a Kaniko build job\ntype KanikoBuild struct {\n\tID           string
      \   `json:\"id\"`\n\tExecutionID  string    `json:\"executionId\"`\n\tRepo         string
      \   `json:\"repo\"`\n\tBranch       string    `json:\"branch\"`\n\tDockerfile
      \  string    `json:\"dockerfile\"`\n\tContext      string    `json:\"context\"`\n\tDestination
      \ string    `json:\"destination\"`\n\tBuildArgs    []string  `json:\"buildArgs\"`\n\tStatus
      \      string    `json:\"status\"`\n\tPodName      string    `json:\"podName\"`\n\tStartedAt
      \   time.Time `json:\"startedAt\"`\n\tCompletedAt  *time.Time `json:\"completedAt\"`\n}\n\nfunc
      main() {\n\tif registryURL == \"\" {\n\t\tregistryURL = \"10.110.67.87:5000\"\n\t}\n\tif
      holmGitURL == \"\" {\n\t\tholmGitURL = \"http://holm-git.holm.svc.cluster.local\"\n\t}\n\tif
      port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tlog.Printf(\"CI/CD Controller
      starting on port %s\", port)\n\tlog.Printf(\"Registry URL: %s\", registryURL)\n\tlog.Printf(\"HolmGit
      URL: %s\", holmGitURL)\n\n\tconfig, err := rest.InClusterConfig()\n\tif err
      != nil {\n\t\tlog.Printf(\"Warning: Running outside cluster: %v\", err)\n\t}
      else {\n\t\tclientset, err = kubernetes.NewForConfig(config)\n\t\tif err !=
      nil {\n\t\t\tlog.Fatalf(\"Failed to create k8s client: %v\", err)\n\t\t}\n\t}\n\n\t//
      Initialize default pipelines\n\tinitDefaultPipelines()\n\n\t// Start background
      workers\n\tgo buildQueueWorker()\n\tgo cleanupOldExecutions()\n\n\t// API routes\n\thttp.HandleFunc(\"/\",
      handleUI)\n\thttp.HandleFunc(\"/health\", handleHealth)\n\n\t// Pipeline management\n\thttp.HandleFunc(\"/api/pipelines\",
      handlePipelines)\n\thttp.HandleFunc(\"/api/pipelines/\", handlePipelineActions)\n\n\t//
      Webhook endpoints\n\thttp.HandleFunc(\"/api/webhook/git\", handleGitWebhook)\n\thttp.HandleFunc(\"/api/webhook/holmgit\",
      handleHolmGitWebhook)\n\thttp.HandleFunc(\"/api/webhooks\", handleWebhooks)\n\n\t//
      Build queue\n\thttp.HandleFunc(\"/api/queue\", handleQueue)\n\thttp.HandleFunc(\"/api/queue/\",
      handleQueueActions)\n\n\t// Pipeline executions (history)\n\thttp.HandleFunc(\"/api/executions\",
      handleExecutions)\n\thttp.HandleFunc(\"/api/executions/\", handleExecutionActions)\n\n\t//
      Build logs\n\thttp.HandleFunc(\"/api/logs/\", handleLogs)\n\n\t// Kaniko builds\n\thttp.HandleFunc(\"/api/build\",
      handleBuild)\n\thttp.HandleFunc(\"/api/builds\", handleBuilds)\n\n\t// Deployment
      triggers\n\thttp.HandleFunc(\"/api/deploy\", handleDeploy)\n\n\tlog.Fatal(http.ListenAndServe(\":\"+port,
      nil))\n}\n\nfunc initDefaultPipelines() {\n\t// Create a sample pipeline\n\tdefaultPipeline
      := &Pipeline{\n\t\tID:          generateID(\"default\"),\n\t\tName:        \"default\",\n\t\tDescription:
      \"Default CI/CD pipeline\",\n\t\tBranch:      \"main\",\n\t\tStages: []PipelineStage{\n\t\t\t{\n\t\t\t\tName:
      \    \"build\",\n\t\t\t\tType:     \"build\",\n\t\t\t\tImage:    \"gcr.io/kaniko-project/executor:latest\",\n\t\t\t\tCommands:
      []string{},\n\t\t\t\tTimeout:  600,\n\t\t\t},\n\t\t\t{\n\t\t\t\tName:      \"deploy\",\n\t\t\t\tType:
      \     \"deploy\",\n\t\t\t\tDependsOn: []string{\"build\"},\n\t\t\t\tTimeout:
      \  300,\n\t\t\t},\n\t\t},\n\t\tTriggers: []PipelineTrigger{\n\t\t\t{\n\t\t\t\tType:
      \    \"webhook\",\n\t\t\t\tBranches: []string{\"main\", \"master\"},\n\t\t\t\tEvents:
      \  []string{\"push\"},\n\t\t\t},\n\t\t},\n\t\tVariables: make(map[string]string),\n\t\tEnabled:
      \  true,\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\n\tpipelinesMu.Lock()\n\tpipelines[defaultPipeline.ID]
      = defaultPipeline\n\tpipelinesMu.Unlock()\n}\n\nfunc generateID(prefix string)
      string {\n\thash := sha256.Sum256([]byte(fmt.Sprintf(\"%s%d\", prefix, time.Now().UnixNano())))\n\treturn
      fmt.Sprintf(\"%x\", hash)[:12]\n}\n\n// Build Queue Worker\nfunc buildQueueWorker()
      {\n\tlog.Println(\"Build queue worker started\")\n\tticker := time.NewTicker(5
      * time.Second)\n\tdefer ticker.Stop()\n\n\tfor range ticker.C {\n\t\tprocessNextBuild()\n\t}\n}\n\nfunc
      processNextBuild() {\n\tbuildQueueMu.Lock()\n\tdefer buildQueueMu.Unlock()\n\n\t//
      Find next queued build\n\tvar nextBuild *BuildJob\n\tfor _, job := range buildQueue
      {\n\t\tif job.Status == \"queued\" {\n\t\t\tnextBuild = job\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif
      nextBuild == nil {\n\t\treturn\n\t}\n\n\t// Check if we can start a new build
      (limit concurrent builds)\n\trunningCount := 0\n\tfor _, job := range buildQueue
      {\n\t\tif job.Status == \"running\" {\n\t\t\trunningCount++\n\t\t}\n\t}\n\n\tif
      runningCount >= 3 {\n\t\treturn // Max 3 concurrent builds\n\t}\n\n\t// Start
      the build\n\tnow := time.Now()\n\tnextBuild.Status = \"running\"\n\tnextBuild.StartedAt
      = &now\n\n\tgo executePipeline(nextBuild)\n}\n\nfunc executePipeline(job *BuildJob)
      {\n\tlog.Printf(\"Starting pipeline execution for %s/%s\", job.Repo, job.Branch)\n\n\tpipelinesMu.RLock()\n\tpipeline,
      exists := pipelines[job.PipelineID]\n\tif !exists {\n\t\t// Find pipeline by
      name\n\t\tfor _, p := range pipelines {\n\t\t\tif p.Name == job.Pipeline {\n\t\t\t\tpipeline
      = p\n\t\t\t\texists = true\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\tpipelinesMu.RUnlock()\n\n\tif
      !exists || pipeline == nil {\n\t\tlog.Printf(\"Pipeline not found: %s\", job.PipelineID)\n\t\tupdateBuildStatus(job.ID,
      \"failed\", \"Pipeline not found\")\n\t\treturn\n\t}\n\n\t// Create execution
      record\n\texecution := &PipelineExecution{\n\t\tID:           generateID(\"exec\"),\n\t\tPipelineID:
      \  pipeline.ID,\n\t\tPipelineName: pipeline.Name,\n\t\tBuildNumber:  getNextBuildNumber(pipeline.ID),\n\t\tRepo:
      \        job.Repo,\n\t\tBranch:       job.Branch,\n\t\tCommit:       job.Commit,\n\t\tAuthor:
      \      job.Author,\n\t\tMessage:      job.Message,\n\t\tTrigger:      \"webhook\",\n\t\tStatus:
      \      \"running\",\n\t\tStages:       make([]StageExecution, 0),\n\t\tStartedAt:
      \   time.Now(),\n\t}\n\n\texecutionsMu.Lock()\n\texecutions = append([]*PipelineExecution{execution},
      executions...)\n\tif len(executions) > 500 {\n\t\texecutions = executions[:500]\n\t}\n\texecutionsMu.Unlock()\n\n\t//
      Execute stages\n\tsuccess := true\n\tfor _, stage := range pipeline.Stages {\n\t\tstageExec
      := executeStage(execution, stage, job)\n\t\texecution.Stages = append(execution.Stages,
      stageExec)\n\n\t\tif stageExec.Status == \"failed\" {\n\t\t\tsuccess = false\n\t\t\tbreak\n\t\t}\n\t}\n\n\t//
      Update execution status\n\tnow := time.Now()\n\texecution.CompletedAt = &now\n\texecution.Duration
      = now.Sub(execution.StartedAt).Seconds()\n\n\tif success {\n\t\texecution.Status
      = \"success\"\n\t\tupdateBuildStatus(job.ID, \"success\", \"Pipeline completed
      successfully\")\n\t} else {\n\t\texecution.Status = \"failed\"\n\t\tupdateBuildStatus(job.ID,
      \"failed\", \"Pipeline failed\")\n\t}\n\n\tlog.Printf(\"Pipeline execution %s
      completed with status: %s\", execution.ID, execution.Status)\n}\n\nfunc executeStage(execution
      *PipelineExecution, stage PipelineStage, job *BuildJob) StageExecution {\n\tlog.Printf(\"Executing
      stage: %s\", stage.Name)\n\n\tstageExec := StageExecution{\n\t\tName:   stage.Name,\n\t\tStatus:
      \"running\",\n\t\tLogID:  generateID(\"log\"),\n\t}\n\n\tnow := time.Now()\n\tstageExec.StartedAt
      = &now\n\n\t// Create log entry\n\tbuildLog := &BuildLog{\n\t\tID:          stageExec.LogID,\n\t\tExecutionID:
      execution.ID,\n\t\tStage:       stage.Name,\n\t\tLines:       make([]LogLine,
      0),\n\t\tCreatedAt:   time.Now(),\n\t}\n\n\tbuildLogsMu.Lock()\n\tbuildLogs[buildLog.ID]
      = buildLog\n\tbuildLogsMu.Unlock()\n\n\taddLogLine(buildLog.ID, \"info\", fmt.Sprintf(\"Starting
      stage: %s\", stage.Name))\n\n\tswitch stage.Type {\n\tcase \"build\":\n\t\terr
      := executeKanikoBuild(execution, stage, job, buildLog.ID)\n\t\tif err != nil
      {\n\t\t\tstageExec.Status = \"failed\"\n\t\t\tstageExec.Error = err.Error()\n\t\t\taddLogLine(buildLog.ID,
      \"error\", err.Error())\n\t\t} else {\n\t\t\tstageExec.Status = \"success\"\n\t\t\taddLogLine(buildLog.ID,
      \"info\", \"Build completed successfully\")\n\t\t}\n\n\tcase \"deploy\":\n\t\terr
      := executeDeploy(execution, stage, job, buildLog.ID)\n\t\tif err != nil {\n\t\t\tstageExec.Status
      = \"failed\"\n\t\t\tstageExec.Error = err.Error()\n\t\t\taddLogLine(buildLog.ID,
      \"error\", err.Error())\n\t\t} else {\n\t\t\tstageExec.Status = \"success\"\n\t\t\taddLogLine(buildLog.ID,
      \"info\", \"Deployment completed successfully\")\n\t\t}\n\n\tcase \"test\":\n\t\t//
      Simulate test stage\n\t\taddLogLine(buildLog.ID, \"info\", \"Running tests...\")\n\t\ttime.Sleep(2
      * time.Second)\n\t\tstageExec.Status = \"success\"\n\t\taddLogLine(buildLog.ID,
      \"info\", \"All tests passed\")\n\n\tdefault:\n\t\taddLogLine(buildLog.ID, \"warn\",
      fmt.Sprintf(\"Unknown stage type: %s\", stage.Type))\n\t\tstageExec.Status =
      \"success\"\n\t}\n\n\tcompleted := time.Now()\n\tstageExec.CompletedAt = &completed\n\tstageExec.Duration
      = completed.Sub(*stageExec.StartedAt).Seconds()\n\n\treturn stageExec\n}\n\nfunc
      executeKanikoBuild(execution *PipelineExecution, stage PipelineStage, job *BuildJob,
      logID string) error {\n\tif clientset == nil {\n\t\taddLogLine(logID, \"warn\",
      \"Kubernetes client not available, simulating build\")\n\t\ttime.Sleep(3 * time.Second)\n\t\treturn
      nil\n\t}\n\n\taddLogLine(logID, \"info\", fmt.Sprintf(\"Building image for %s\",
      job.Repo))\n\n\t// Determine image name\n\timageName := strings.ToLower(job.Repo)\n\tif
      strings.Contains(imageName, \"/\") {\n\t\tparts := strings.Split(imageName,
      \"/\")\n\t\timageName = parts[len(parts)-1]\n\t}\n\timageName = strings.ReplaceAll(imageName,
      \" \", \"-\")\n\n\tdestination := fmt.Sprintf(\"%s/%s:latest\", registryURL,
      imageName)\n\taddLogLine(logID, \"info\", fmt.Sprintf(\"Destination: %s\", destination))\n\n\t//
      Create Kaniko job\n\tjobName := fmt.Sprintf(\"kaniko-%s\", execution.ID)\n\tbackoffLimit
      := int32(0)\n\tttl := int32(3600) // Clean up after 1 hour\n\n\tkanikoJob :=
      &batchv1.Job{\n\t\tObjectMeta: metav1.ObjectMeta{\n\t\t\tName:      jobName,\n\t\t\tNamespace:
      \"holm\",\n\t\t\tLabels: map[string]string{\n\t\t\t\t\"app\":         \"cicd-controller\",\n\t\t\t\t\"executionId\":
      execution.ID,\n\t\t\t\t\"type\":        \"kaniko-build\",\n\t\t\t},\n\t\t},\n\t\tSpec:
      batchv1.JobSpec{\n\t\t\tBackoffLimit:            &backoffLimit,\n\t\t\tTTLSecondsAfterFinished:
      &ttl,\n\t\t\tTemplate: corev1.PodTemplateSpec{\n\t\t\t\tSpec: corev1.PodSpec{\n\t\t\t\t\tRestartPolicy:
      corev1.RestartPolicyNever,\n\t\t\t\t\tInitContainers: []corev1.Container{\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tName:
      \ \"git-clone\",\n\t\t\t\t\t\t\tImage: \"alpine/git:latest\",\n\t\t\t\t\t\t\tCommand:
      []string{\"sh\", \"-c\"},\n\t\t\t\t\t\t\tArgs: []string{\n\t\t\t\t\t\t\t\tfmt.Sprintf(\"git
      clone --depth 1 --branch %s %s/git/%s.git /workspace\",\n\t\t\t\t\t\t\t\t\tjob.Branch,
      holmGitURL, job.Repo),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tVolumeMounts: []corev1.VolumeMount{\n\t\t\t\t\t\t\t\t{Name:
      \"workspace\", MountPath: \"/workspace\"},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tContainers:
      []corev1.Container{\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tName:  \"kaniko\",\n\t\t\t\t\t\t\tImage:
      \"gcr.io/kaniko-project/executor:latest\",\n\t\t\t\t\t\t\tArgs: []string{\n\t\t\t\t\t\t\t\t\"--dockerfile=/workspace/Dockerfile\",\n\t\t\t\t\t\t\t\t\"--context=/workspace\",\n\t\t\t\t\t\t\t\tfmt.Sprintf(\"--destination=%s\",
      destination),\n\t\t\t\t\t\t\t\t\"--insecure\",\n\t\t\t\t\t\t\t\t\"--skip-tls-verify\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tVolumeMounts:
      []corev1.VolumeMount{\n\t\t\t\t\t\t\t\t{Name: \"workspace\", MountPath: \"/workspace\"},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tResources:
      corev1.ResourceRequirements{\n\t\t\t\t\t\t\t\tRequests: corev1.ResourceList{\n\t\t\t\t\t\t\t\t\tcorev1.ResourceMemory:
      resource.MustParse(\"512Mi\"),\n\t\t\t\t\t\t\t\t\tcorev1.ResourceCPU:    resource.MustParse(\"500m\"),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tLimits:
      corev1.ResourceList{\n\t\t\t\t\t\t\t\t\tcorev1.ResourceMemory: resource.MustParse(\"2Gi\"),\n\t\t\t\t\t\t\t\t\tcorev1.ResourceCPU:
      \   resource.MustParse(\"2\"),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tVolumes:
      []corev1.Volume{\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tName: \"workspace\",\n\t\t\t\t\t\t\tVolumeSource:
      corev1.VolumeSource{\n\t\t\t\t\t\t\t\tEmptyDir: &corev1.EmptyDirVolumeSource{},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t}\n\n\tctx
      := context.Background()\n\n\t// Delete existing job if any\n\t_ = clientset.BatchV1().Jobs(\"holm\").Delete(ctx,
      jobName, metav1.DeleteOptions{})\n\ttime.Sleep(2 * time.Second)\n\n\t// Create
      the job\n\t_, err := clientset.BatchV1().Jobs(\"holm\").Create(ctx, kanikoJob,
      metav1.CreateOptions{})\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to
      create Kaniko job: %v\", err)\n\t}\n\n\taddLogLine(logID, \"info\", fmt.Sprintf(\"Kaniko
      job created: %s\", jobName))\n\n\t// Wait for job completion\n\ttimeout := time.After(time.Duration(stage.Timeout)
      * time.Second)\n\tticker := time.NewTicker(5 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor
      {\n\t\tselect {\n\t\tcase <-timeout:\n\t\t\treturn fmt.Errorf(\"build timed
      out after %d seconds\", stage.Timeout)\n\t\tcase <-ticker.C:\n\t\t\tjob, err
      := clientset.BatchV1().Jobs(\"holm\").Get(ctx, jobName, metav1.GetOptions{})\n\t\t\tif
      err != nil {\n\t\t\t\taddLogLine(logID, \"warn\", fmt.Sprintf(\"Failed to get
      job status: %v\", err))\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif job.Status.Succeeded
      > 0 {\n\t\t\t\taddLogLine(logID, \"info\", \"Kaniko build completed successfully\")\n\t\t\t\treturn
      nil\n\t\t\t}\n\n\t\t\tif job.Status.Failed > 0 {\n\t\t\t\t// Get pod logs for
      error details\n\t\t\t\tpods, _ := clientset.CoreV1().Pods(\"holm\").List(ctx,
      metav1.ListOptions{\n\t\t\t\t\tLabelSelector: fmt.Sprintf(\"job-name=%s\", jobName),\n\t\t\t\t})\n\t\t\t\tif
      len(pods.Items) > 0 {\n\t\t\t\t\tlogs, _ := clientset.CoreV1().Pods(\"holm\").GetLogs(pods.Items[0].Name,
      &corev1.PodLogOptions{}).Do(ctx).Raw()\n\t\t\t\t\tif len(logs) > 0 {\n\t\t\t\t\t\taddLogLine(logID,
      \"error\", string(logs))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn fmt.Errorf(\"Kaniko
      build failed\")\n\t\t\t}\n\n\t\t\taddLogLine(logID, \"info\", \"Build in progress...\")\n\t\t}\n\t}\n}\n\nfunc
      executeDeploy(execution *PipelineExecution, stage PipelineStage, job *BuildJob,
      logID string) error {\n\taddLogLine(logID, \"info\", fmt.Sprintf(\"Deploying
      %s\", job.Repo))\n\n\t// Determine deployment name and image\n\tdeploymentName
      := strings.ToLower(job.Repo)\n\tif strings.Contains(deploymentName, \"/\") {\n\t\tparts
      := strings.Split(deploymentName, \"/\")\n\t\tdeploymentName = parts[len(parts)-1]\n\t}\n\tdeploymentName
      = strings.ReplaceAll(deploymentName, \" \", \"-\")\n\n\timage := fmt.Sprintf(\"%s/%s:latest\",
      registryURL, deploymentName)\n\n\t// Call deploy-controller to trigger deployment\n\tdeployPayload
      := map[string]string{\n\t\t\"deployment\": deploymentName,\n\t\t\"namespace\":
      \ \"holm\",\n\t\t\"image\":      image,\n\t}\n\n\tdata, _ := json.Marshal(deployPayload)\n\tresp,
      err := http.Post(\"http://deploy-controller.holm.svc.cluster.local:8080/api/deploy\",\n\t\t\"application/json\",
      bytes.NewReader(data))\n\n\tif err != nil {\n\t\taddLogLine(logID, \"warn\",
      fmt.Sprintf(\"Failed to call deploy-controller: %v\", err))\n\t\t// Continue
      anyway - deployment might be handled by auto-deploy rules\n\t} else {\n\t\tdefer
      resp.Body.Close()\n\t\tif resp.StatusCode == 200 {\n\t\t\taddLogLine(logID,
      \"info\", \"Deployment triggered via deploy-controller\")\n\t\t} else {\n\t\t\tbody,
      _ := io.ReadAll(resp.Body)\n\t\t\taddLogLine(logID, \"warn\", fmt.Sprintf(\"Deploy-controller
      response: %s\", string(body)))\n\t\t}\n\t}\n\n\treturn nil\n}\n\nfunc addLogLine(logID,
      level, message string) {\n\tbuildLogsMu.Lock()\n\tdefer buildLogsMu.Unlock()\n\n\tif
      log, exists := buildLogs[logID]; exists {\n\t\tlog.Lines = append(log.Lines,
      LogLine{\n\t\t\tTimestamp: time.Now(),\n\t\t\tLevel:     level,\n\t\t\tMessage:
      \  message,\n\t\t})\n\t}\n}\n\nfunc updateBuildStatus(jobID, status, message
      string) {\n\tbuildQueueMu.Lock()\n\tdefer buildQueueMu.Unlock()\n\n\tfor _,
      job := range buildQueue {\n\t\tif job.ID == jobID {\n\t\t\tjob.Status = status\n\t\t\tnow
      := time.Now()\n\t\t\tjob.CompletedAt = &now\n\t\t\tbreak\n\t\t}\n\t}\n}\n\nfunc
      getNextBuildNumber(pipelineID string) int {\n\texecutionsMu.RLock()\n\tdefer
      executionsMu.RUnlock()\n\n\tmaxNum := 0\n\tfor _, exec := range executions {\n\t\tif
      exec.PipelineID == pipelineID && exec.BuildNumber > maxNum {\n\t\t\tmaxNum =
      exec.BuildNumber\n\t\t}\n\t}\n\treturn maxNum + 1\n}\n\nfunc cleanupOldExecutions()
      {\n\tticker := time.NewTicker(1 * time.Hour)\n\tdefer ticker.Stop()\n\n\tfor
      range ticker.C {\n\t\tcutoff := time.Now().Add(-24 * time.Hour)\n\n\t\tbuildQueueMu.Lock()\n\t\tnewQueue
      := make([]*BuildJob, 0)\n\t\tfor _, job := range buildQueue {\n\t\t\tif job.Status
      == \"running\" || job.Status == \"queued\" || job.CreatedAt.After(cutoff) {\n\t\t\t\tnewQueue
      = append(newQueue, job)\n\t\t\t}\n\t\t}\n\t\tbuildQueue = newQueue\n\t\tbuildQueueMu.Unlock()\n\t}\n}\n\n//
      HTTP Handlers\n\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"status\":
      \ \"healthy\",\n\t\t\"time\":    time.Now().UTC().Format(time.RFC3339),\n\t\t\"version\":
      \"1.0.0\",\n\t})\n}\n\nfunc handlePipelines(w http.ResponseWriter, r *http.Request)
      {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\tswitch r.Method
      {\n\tcase \"GET\":\n\t\tpipelinesMu.RLock()\n\t\tresult := make([]*Pipeline,
      0, len(pipelines))\n\t\tfor _, p := range pipelines {\n\t\t\tresult = append(result,
      p)\n\t\t}\n\t\tpipelinesMu.RUnlock()\n\n\t\tsort.Slice(result, func(i, j int)
      bool {\n\t\t\treturn result[i].Name < result[j].Name\n\t\t})\n\n\t\tjson.NewEncoder(w).Encode(result)\n\n\tcase
      \"POST\":\n\t\tvar pipeline Pipeline\n\t\tif err := json.NewDecoder(r.Body).Decode(&pipeline);
      err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\n\t\tpipeline.ID
      = generateID(pipeline.Name)\n\t\tpipeline.CreatedAt = time.Now()\n\t\tpipeline.UpdatedAt
      = time.Now()\n\t\tif pipeline.Variables == nil {\n\t\t\tpipeline.Variables =
      make(map[string]string)\n\t\t}\n\n\t\tpipelinesMu.Lock()\n\t\tpipelines[pipeline.ID]
      = &pipeline\n\t\tpipelinesMu.Unlock()\n\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"created\", \"id\": pipeline.ID})\n\n\tdefault:\n\t\thttp.Error(w, \"Method
      not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\nfunc handlePipelineActions(w
      http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/pipelines/\")\n\tparts
      := strings.SplitN(path, \"/\", 2)\n\tpipelineID := parts[0]\n\n\tpipelinesMu.RLock()\n\tpipeline,
      exists := pipelines[pipelineID]\n\tpipelinesMu.RUnlock()\n\n\tif !exists {\n\t\thttp.Error(w,
      \"Pipeline not found\", http.StatusNotFound)\n\t\treturn\n\t}\n\n\tif len(parts)
      == 1 {\n\t\tswitch r.Method {\n\t\tcase \"GET\":\n\t\t\tjson.NewEncoder(w).Encode(pipeline)\n\t\tcase
      \"PUT\":\n\t\t\tvar updated Pipeline\n\t\t\tif err := json.NewDecoder(r.Body).Decode(&updated);
      err != nil {\n\t\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tupdated.ID
      = pipelineID\n\t\t\tupdated.CreatedAt = pipeline.CreatedAt\n\t\t\tupdated.UpdatedAt
      = time.Now()\n\n\t\t\tpipelinesMu.Lock()\n\t\t\tpipelines[pipelineID] = &updated\n\t\t\tpipelinesMu.Unlock()\n\n\t\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"updated\"})\n\t\tcase \"DELETE\":\n\t\t\tpipelinesMu.Lock()\n\t\t\tdelete(pipelines,
      pipelineID)\n\t\t\tpipelinesMu.Unlock()\n\t\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"deleted\"})\n\t\tdefault:\n\t\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\t}\n\t\treturn\n\t}\n\n\taction
      := parts[1]\n\tswitch action {\n\tcase \"trigger\":\n\t\tif r.Method != \"POST\"
      {\n\t\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\t\treturn\n\t\t}\n\n\t\tvar
      req struct {\n\t\t\tBranch  string            `json:\"branch\"`\n\t\t\tCommit
      \ string            `json:\"commit\"`\n\t\t\tVariables map[string]string `json:\"variables\"`\n\t\t}\n\t\tjson.NewDecoder(r.Body).Decode(&req)\n\n\t\tif
      req.Branch == \"\" {\n\t\t\treq.Branch = pipeline.Branch\n\t\t}\n\t\tif req.Branch
      == \"\" {\n\t\t\treq.Branch = \"main\"\n\t\t}\n\n\t\tjob := &BuildJob{\n\t\t\tID:
      \        generateID(\"build\"),\n\t\t\tPipelineID: pipelineID,\n\t\t\tPipeline:
      \  pipeline.Name,\n\t\t\tRepo:       pipeline.RepoURL,\n\t\t\tBranch:     req.Branch,\n\t\t\tCommit:
      \    req.Commit,\n\t\t\tStatus:     \"queued\",\n\t\t\tPriority:   1,\n\t\t\tVariables:
      \ req.Variables,\n\t\t\tCreatedAt:  time.Now(),\n\t\t}\n\n\t\tbuildQueueMu.Lock()\n\t\tbuildQueue
      = append([]*BuildJob{job}, buildQueue...)\n\t\tbuildQueueMu.Unlock()\n\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"triggered\", \"buildId\": job.ID})\n\n\tcase \"executions\":\n\t\texecutionsMu.RLock()\n\t\tresult
      := make([]*PipelineExecution, 0)\n\t\tfor _, exec := range executions {\n\t\t\tif
      exec.PipelineID == pipelineID {\n\t\t\t\tresult = append(result, exec)\n\t\t\t}\n\t\t}\n\t\texecutionsMu.RUnlock()\n\t\tjson.NewEncoder(w).Encode(result)\n\n\tdefault:\n\t\thttp.Error(w,
      \"Unknown action\", http.StatusNotFound)\n\t}\n}\n\nfunc handleGitWebhook(w
      http.ResponseWriter, r *http.Request) {\n\tif r.Method != \"POST\" {\n\t\thttp.Error(w,
      \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\tbody,
      err := io.ReadAll(r.Body)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(),
      http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tlog.Printf(\"Git webhook received:
      %s\", string(body))\n\n\tvar payload map[string]interface{}\n\tif err := json.Unmarshal(body,
      &payload); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tevent
      := parseGitWebhook(payload)\n\tevent.ID = generateID(\"webhook\")\n\tevent.Timestamp
      = time.Now()\n\tevent.Source = \"git\"\n\n\twebhookEventsMu.Lock()\n\twebhookEvents
      = append([]*WebhookEvent{event}, webhookEvents...)\n\tif len(webhookEvents)
      > 100 {\n\t\twebhookEvents = webhookEvents[:100]\n\t}\n\twebhookEventsMu.Unlock()\n\n\t//
      Find matching pipeline and trigger\n\tgo processTrigger(event)\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"status\":
      \ \"received\",\n\t\t\"eventId\": event.ID,\n\t})\n}\n\nfunc handleHolmGitWebhook(w
      http.ResponseWriter, r *http.Request) {\n\tif r.Method != \"POST\" {\n\t\thttp.Error(w,
      \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\tbody,
      err := io.ReadAll(r.Body)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(),
      http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tlog.Printf(\"HolmGit webhook received:
      %s\", string(body))\n\n\tvar payload map[string]interface{}\n\tif err := json.Unmarshal(body,
      &payload); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tevent
      := &WebhookEvent{\n\t\tID:        generateID(\"webhook\"),\n\t\tType:      \"push\",\n\t\tSource:
      \   \"holmgit\",\n\t\tPayload:   payload,\n\t\tTimestamp: time.Now(),\n\t}\n\n\t//
      Parse HolmGit specific payload\n\tif repo, ok := payload[\"repo\"].(string);
      ok {\n\t\tevent.Repo = repo\n\t}\n\tif branch, ok := payload[\"branch\"].(string);
      ok {\n\t\tevent.Branch = branch\n\t}\n\tif event.Branch == \"\" {\n\t\tevent.Branch
      = \"main\"\n\t}\n\n\twebhookEventsMu.Lock()\n\twebhookEvents = append([]*WebhookEvent{event},
      webhookEvents...)\n\tif len(webhookEvents) > 100 {\n\t\twebhookEvents = webhookEvents[:100]\n\t}\n\twebhookEventsMu.Unlock()\n\n\t//
      Find matching pipeline and trigger\n\tgo processTrigger(event)\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\"status\":
      \ \"received\",\n\t\t\"eventId\": event.ID,\n\t})\n}\n\nfunc parseGitWebhook(payload
      map[string]interface{}) *WebhookEvent {\n\tevent := &WebhookEvent{\n\t\tType:
      \   \"push\",\n\t\tPayload: payload,\n\t}\n\n\t// Parse repository info\n\tif
      repo, ok := payload[\"repository\"].(map[string]interface{}); ok {\n\t\tif name,
      ok := repo[\"name\"].(string); ok {\n\t\t\tevent.Repo = name\n\t\t}\n\t\tif
      fullName, ok := repo[\"full_name\"].(string); ok {\n\t\t\tevent.Repo = fullName\n\t\t}\n\t}\n\n\t//
      Parse branch from ref\n\tif ref, ok := payload[\"ref\"].(string); ok {\n\t\tevent.Branch
      = strings.TrimPrefix(ref, \"refs/heads/\")\n\t}\n\n\t// Parse commit\n\tif after,
      ok := payload[\"after\"].(string); ok && len(after) >= 7 {\n\t\tevent.Commit
      = after[:7]\n\t}\n\n\t// Parse author and message\n\tif commits, ok := payload[\"commits\"].([]interface{});
      ok && len(commits) > 0 {\n\t\tif commit, ok := commits[0].(map[string]interface{});
      ok {\n\t\t\tif msg, ok := commit[\"message\"].(string); ok {\n\t\t\t\tevent.Message
      = msg\n\t\t\t}\n\t\t\tif author, ok := commit[\"author\"].(map[string]interface{});
      ok {\n\t\t\t\tif name, ok := author[\"name\"].(string); ok {\n\t\t\t\t\tevent.Author
      = name\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Parse pusher\n\tif pusher, ok
      := payload[\"pusher\"].(map[string]interface{}); ok {\n\t\tif name, ok := pusher[\"name\"].(string);
      ok && event.Author == \"\" {\n\t\t\tevent.Author = name\n\t\t}\n\t}\n\n\treturn
      event\n}\n\nfunc processTrigger(event *WebhookEvent) {\n\tlog.Printf(\"Processing
      webhook trigger: repo=%s branch=%s\", event.Repo, event.Branch)\n\n\tpipelinesMu.RLock()\n\tdefer
      pipelinesMu.RUnlock()\n\n\tfor _, pipeline := range pipelines {\n\t\tif !pipeline.Enabled
      {\n\t\t\tcontinue\n\t\t}\n\n\t\t// Check if repo matches\n\t\tif pipeline.RepoURL
      != \"\" && !strings.Contains(event.Repo, pipeline.RepoURL) &&\n\t\t\t!strings.Contains(pipeline.RepoURL,
      event.Repo) {\n\t\t\tcontinue\n\t\t}\n\n\t\t// Check triggers\n\t\tfor _, trigger
      := range pipeline.Triggers {\n\t\t\tif trigger.Type != \"webhook\" {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t//
      Check branch match\n\t\t\tbranchMatch := len(trigger.Branches) == 0\n\t\t\tfor
      _, b := range trigger.Branches {\n\t\t\t\tif b == event.Branch || b == \"*\"
      {\n\t\t\t\t\tbranchMatch = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif
      !branchMatch {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Check event match\n\t\t\teventMatch
      := len(trigger.Events) == 0\n\t\t\tfor _, e := range trigger.Events {\n\t\t\t\tif
      e == event.Type || e == \"*\" {\n\t\t\t\t\teventMatch = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif
      !eventMatch {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Trigger the pipeline\n\t\t\tlog.Printf(\"Triggering
      pipeline %s for %s/%s\", pipeline.Name, event.Repo, event.Branch)\n\n\t\t\tjob
      := &BuildJob{\n\t\t\t\tID:         generateID(\"build\"),\n\t\t\t\tPipelineID:
      pipeline.ID,\n\t\t\t\tPipeline:   pipeline.Name,\n\t\t\t\tRepo:       event.Repo,\n\t\t\t\tBranch:
      \    event.Branch,\n\t\t\t\tCommit:     event.Commit,\n\t\t\t\tAuthor:     event.Author,\n\t\t\t\tMessage:
      \   event.Message,\n\t\t\t\tStatus:     \"queued\",\n\t\t\t\tPriority:   1,\n\t\t\t\tVariables:
      \ make(map[string]string),\n\t\t\t\tCreatedAt:  time.Now(),\n\t\t\t}\n\n\t\t\tbuildQueueMu.Lock()\n\t\t\tbuildQueue
      = append([]*BuildJob{job}, buildQueue...)\n\t\t\tbuildQueueMu.Unlock()\n\n\t\t\t//
      Mark event as processed\n\t\t\twebhookEventsMu.Lock()\n\t\t\tfor _, we := range
      webhookEvents {\n\t\t\t\tif we.ID == event.ID {\n\t\t\t\t\twe.Processed = true\n\t\t\t\t\twe.PipelineID
      = pipeline.ID\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\twebhookEventsMu.Unlock()\n\n\t\t\tbreak
      // Only trigger once per pipeline\n\t\t}\n\t}\n}\n\nfunc handleWebhooks(w http.ResponseWriter,
      r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\twebhookEventsMu.RLock()\n\tdefer
      webhookEventsMu.RUnlock()\n\n\tjson.NewEncoder(w).Encode(webhookEvents)\n}\n\nfunc
      handleQueue(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\n\tswitch r.Method {\n\tcase \"GET\":\n\t\tbuildQueueMu.RLock()\n\t\tjson.NewEncoder(w).Encode(buildQueue)\n\t\tbuildQueueMu.RUnlock()\n\n\tcase
      \"POST\":\n\t\tvar req struct {\n\t\t\tPipelineID string            `json:\"pipelineId\"`\n\t\t\tPipeline
      \  string            `json:\"pipeline\"`\n\t\t\tRepo       string            `json:\"repo\"`\n\t\t\tBranch
      \    string            `json:\"branch\"`\n\t\t\tCommit     string            `json:\"commit\"`\n\t\t\tVariables
      \ map[string]string `json:\"variables\"`\n\t\t}\n\n\t\tif err := json.NewDecoder(r.Body).Decode(&req);
      err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\n\t\tif
      req.Branch == \"\" {\n\t\t\treq.Branch = \"main\"\n\t\t}\n\n\t\tjob := &BuildJob{\n\t\t\tID:
      \        generateID(\"build\"),\n\t\t\tPipelineID: req.PipelineID,\n\t\t\tPipeline:
      \  req.Pipeline,\n\t\t\tRepo:       req.Repo,\n\t\t\tBranch:     req.Branch,\n\t\t\tCommit:
      \    req.Commit,\n\t\t\tStatus:     \"queued\",\n\t\t\tPriority:   1,\n\t\t\tVariables:
      \ req.Variables,\n\t\t\tCreatedAt:  time.Now(),\n\t\t}\n\n\t\tbuildQueueMu.Lock()\n\t\tbuildQueue
      = append([]*BuildJob{job}, buildQueue...)\n\t\tbuildQueueMu.Unlock()\n\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"queued\", \"id\": job.ID})\n\n\tdefault:\n\t\thttp.Error(w, \"Method not allowed\",
      http.StatusMethodNotAllowed)\n\t}\n}\n\nfunc handleQueueActions(w http.ResponseWriter,
      r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\tpath
      := strings.TrimPrefix(r.URL.Path, \"/api/queue/\")\n\tparts := strings.SplitN(path,
      \"/\", 2)\n\tjobID := parts[0]\n\n\tif len(parts) == 2 && parts[1] == \"cancel\"
      {\n\t\tif r.Method != \"POST\" {\n\t\t\thttp.Error(w, \"Method not allowed\",
      http.StatusMethodNotAllowed)\n\t\t\treturn\n\t\t}\n\n\t\tbuildQueueMu.Lock()\n\t\tfor
      _, job := range buildQueue {\n\t\t\tif job.ID == jobID && job.Status == \"queued\"
      {\n\t\t\t\tjob.Status = \"cancelled\"\n\t\t\t\tnow := time.Now()\n\t\t\t\tjob.CompletedAt
      = &now\n\t\t\t}\n\t\t}\n\t\tbuildQueueMu.Unlock()\n\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"cancelled\"})\n\t\treturn\n\t}\n\n\t// GET job details\n\tbuildQueueMu.RLock()\n\tvar
      job *BuildJob\n\tfor _, j := range buildQueue {\n\t\tif j.ID == jobID {\n\t\t\tjob
      = j\n\t\t\tbreak\n\t\t}\n\t}\n\tbuildQueueMu.RUnlock()\n\n\tif job == nil {\n\t\thttp.Error(w,
      \"Job not found\", http.StatusNotFound)\n\t\treturn\n\t}\n\n\tjson.NewEncoder(w).Encode(job)\n}\n\nfunc
      handleExecutions(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\n\texecutionsMu.RLock()\n\tdefer executionsMu.RUnlock()\n\n\t//
      Support filtering\n\tpipelineID := r.URL.Query().Get(\"pipelineId\")\n\tstatus
      := r.URL.Query().Get(\"status\")\n\tlimit := 50\n\n\tresult := make([]*PipelineExecution,
      0)\n\tfor _, exec := range executions {\n\t\tif pipelineID != \"\" && exec.PipelineID
      != pipelineID {\n\t\t\tcontinue\n\t\t}\n\t\tif status != \"\" && exec.Status
      != status {\n\t\t\tcontinue\n\t\t}\n\t\tresult = append(result, exec)\n\t\tif
      len(result) >= limit {\n\t\t\tbreak\n\t\t}\n\t}\n\n\tjson.NewEncoder(w).Encode(result)\n}\n\nfunc
      handleExecutionActions(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/executions/\")\n\tparts
      := strings.SplitN(path, \"/\", 2)\n\texecutionID := parts[0]\n\n\texecutionsMu.RLock()\n\tvar
      execution *PipelineExecution\n\tfor _, e := range executions {\n\t\tif e.ID
      == executionID {\n\t\t\texecution = e\n\t\t\tbreak\n\t\t}\n\t}\n\texecutionsMu.RUnlock()\n\n\tif
      execution == nil {\n\t\thttp.Error(w, \"Execution not found\", http.StatusNotFound)\n\t\treturn\n\t}\n\n\tif
      len(parts) == 1 {\n\t\tjson.NewEncoder(w).Encode(execution)\n\t\treturn\n\t}\n\n\taction
      := parts[1]\n\tswitch action {\n\tcase \"logs\":\n\t\t// Get all logs for this
      execution\n\t\tbuildLogsMu.RLock()\n\t\tlogs := make(map[string]*BuildLog)\n\t\tfor
      id, log := range buildLogs {\n\t\t\tif log.ExecutionID == executionID {\n\t\t\t\tlogs[id]
      = log\n\t\t\t}\n\t\t}\n\t\tbuildLogsMu.RUnlock()\n\t\tjson.NewEncoder(w).Encode(logs)\n\n\tcase
      \"retry\":\n\t\tif r.Method != \"POST\" {\n\t\t\thttp.Error(w, \"Method not
      allowed\", http.StatusMethodNotAllowed)\n\t\t\treturn\n\t\t}\n\n\t\t// Create
      new build job from execution\n\t\tjob := &BuildJob{\n\t\t\tID:         generateID(\"build\"),\n\t\t\tPipelineID:
      execution.PipelineID,\n\t\t\tPipeline:   execution.PipelineName,\n\t\t\tRepo:
      \      execution.Repo,\n\t\t\tBranch:     execution.Branch,\n\t\t\tCommit:     execution.Commit,\n\t\t\tStatus:
      \    \"queued\",\n\t\t\tPriority:   1,\n\t\t\tVariables:  make(map[string]string),\n\t\t\tCreatedAt:
      \ time.Now(),\n\t\t}\n\n\t\tbuildQueueMu.Lock()\n\t\tbuildQueue = append([]*BuildJob{job},
      buildQueue...)\n\t\tbuildQueueMu.Unlock()\n\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"retried\", \"buildId\": job.ID})\n\n\tdefault:\n\t\thttp.Error(w, \"Unknown
      action\", http.StatusNotFound)\n\t}\n}\n\nfunc handleLogs(w http.ResponseWriter,
      r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\tlogID
      := strings.TrimPrefix(r.URL.Path, \"/api/logs/\")\n\n\tbuildLogsMu.RLock()\n\tlog,
      exists := buildLogs[logID]\n\tbuildLogsMu.RUnlock()\n\n\tif !exists {\n\t\thttp.Error(w,
      \"Log not found\", http.StatusNotFound)\n\t\treturn\n\t}\n\n\t// Support streaming
      via query param\n\tif r.URL.Query().Get(\"stream\") == \"true\" {\n\t\t// Server-sent
      events for log streaming\n\t\tw.Header().Set(\"Content-Type\", \"text/event-stream\")\n\t\tw.Header().Set(\"Cache-Control\",
      \"no-cache\")\n\t\tw.Header().Set(\"Connection\", \"keep-alive\")\n\n\t\tflusher,
      ok := w.(http.Flusher)\n\t\tif !ok {\n\t\t\thttp.Error(w, \"Streaming not supported\",
      http.StatusInternalServerError)\n\t\t\treturn\n\t\t}\n\n\t\tlastIndex := 0\n\t\tfor
      {\n\t\t\tbuildLogsMu.RLock()\n\t\t\tcurrentLog := buildLogs[logID]\n\t\t\tlines
      := currentLog.Lines[lastIndex:]\n\t\t\tlastIndex = len(currentLog.Lines)\n\t\t\tbuildLogsMu.RUnlock()\n\n\t\t\tfor
      _, line := range lines {\n\t\t\t\tdata, _ := json.Marshal(line)\n\t\t\t\tfmt.Fprintf(w,
      \"data: %s\\n\\n\", data)\n\t\t\t}\n\t\t\tflusher.Flush()\n\n\t\t\ttime.Sleep(1
      * time.Second)\n\t\t}\n\t}\n\n\tjson.NewEncoder(w).Encode(log)\n}\n\nfunc handleBuild(w
      http.ResponseWriter, r *http.Request) {\n\tif r.Method != \"POST\" {\n\t\thttp.Error(w,
      \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\tvar
      req struct {\n\t\tRepo        string   `json:\"repo\"`\n\t\tBranch      string
      \  `json:\"branch\"`\n\t\tDockerfile  string   `json:\"dockerfile\"`\n\t\tContext
      \    string   `json:\"context\"`\n\t\tDestination string   `json:\"destination\"`\n\t\tBuildArgs
      \  []string `json:\"buildArgs\"`\n\t}\n\n\tif err := json.NewDecoder(r.Body).Decode(&req);
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tif
      req.Branch == \"\" {\n\t\treq.Branch = \"main\"\n\t}\n\tif req.Dockerfile ==
      \"\" {\n\t\treq.Dockerfile = \"Dockerfile\"\n\t}\n\tif req.Context == \"\" {\n\t\treq.Context
      = \".\"\n\t}\n\n\t// Create a quick build job\n\tjob := &BuildJob{\n\t\tID:
      \       generateID(\"build\"),\n\t\tRepo:      req.Repo,\n\t\tBranch:    req.Branch,\n\t\tStatus:
      \   \"queued\",\n\t\tPriority:  2, // Higher priority for manual builds\n\t\tVariables:
      map[string]string{\n\t\t\t\"DOCKERFILE\":  req.Dockerfile,\n\t\t\t\"CONTEXT\":
      \    req.Context,\n\t\t\t\"DESTINATION\": req.Destination,\n\t\t},\n\t\tCreatedAt:
      time.Now(),\n\t}\n\n\tbuildQueueMu.Lock()\n\t// Insert at front for priority\n\tnewQueue
      := make([]*BuildJob, 0, len(buildQueue)+1)\n\tnewQueue = append(newQueue, job)\n\tnewQueue
      = append(newQueue, buildQueue...)\n\tbuildQueue = newQueue\n\tbuildQueueMu.Unlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":
      \ \"queued\",\n\t\t\"buildId\": job.ID,\n\t})\n}\n\nfunc handleBuilds(w http.ResponseWriter,
      r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\tbuildQueueMu.RLock()\n\tdefer
      buildQueueMu.RUnlock()\n\n\t// Return recent builds (last 20)\n\tlimit := 20\n\tif
      len(buildQueue) < limit {\n\t\tlimit = len(buildQueue)\n\t}\n\n\tjson.NewEncoder(w).Encode(buildQueue[:limit])\n}\n\nfunc
      handleDeploy(w http.ResponseWriter, r *http.Request) {\n\tif r.Method != \"POST\"
      {\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\tvar
      req struct {\n\t\tDeployment string `json:\"deployment\"`\n\t\tNamespace  string
      `json:\"namespace\"`\n\t\tImage      string `json:\"image\"`\n\t\tTag        string
      `json:\"tag\"`\n\t}\n\n\tif err := json.NewDecoder(r.Body).Decode(&req); err
      != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tif
      req.Namespace == \"\" {\n\t\treq.Namespace = \"holm\"\n\t}\n\tif req.Tag ==
      \"\" {\n\t\treq.Tag = \"latest\"\n\t}\n\tif req.Image == \"\" && req.Deployment
      != \"\" {\n\t\treq.Image = fmt.Sprintf(\"%s/%s:%s\", registryURL, req.Deployment,
      req.Tag)\n\t}\n\n\tlog.Printf(\"Deploy trigger: %s/%s -> %s\", req.Namespace,
      req.Deployment, req.Image)\n\n\t// Forward to deploy-controller\n\tdeployPayload
      := map[string]string{\n\t\t\"deployment\": req.Deployment,\n\t\t\"namespace\":
      \ req.Namespace,\n\t\t\"image\":      req.Image,\n\t}\n\n\tdata, _ := json.Marshal(deployPayload)\n\tresp,
      err := http.Post(\"http://deploy-controller.holm.svc.cluster.local:8080/api/deploy\",\n\t\t\"application/json\",
      bytes.NewReader(data))\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\n\tif
      err != nil {\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\t\"status\":
      \ \"error\",\n\t\t\t\"message\": err.Error(),\n\t\t})\n\t\treturn\n\t}\n\tdefer
      resp.Body.Close()\n\n\tbody, _ := io.ReadAll(resp.Body)\n\tvar result map[string]interface{}\n\tjson.Unmarshal(body,
      &result)\n\tresult[\"triggered\"] = true\n\n\tjson.NewEncoder(w).Encode(result)\n}\n\nfunc
      handleUI(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\"
      {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"text/html; charset=utf-8\")\n\thtml, err := os.ReadFile(\"/app/ui.html\")\n\tif
      err != nil {\n\t\t// Serve embedded fallback UI\n\t\tw.Write([]byte(fallbackUI))\n\t\treturn\n\t}\n\tw.Write(html)\n}\n\nconst
      fallbackUI = `<!DOCTYPE html>\n<html><head><title>CI/CD Controller</title></head>\n<body><h1>CI/CD
      Controller</h1><p>UI loading...</p></body></html>`\n"
    ui.html: |
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>CI/CD Controller</title>
          <style>
              * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
              }
              body {
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                  min-height: 100vh;
                  color: #e4e4e7;
              }
              .container {
                  max-width: 1400px;
                  margin: 0 auto;
                  padding: 20px;
              }
              header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 30px;
                  padding: 20px;
                  background: rgba(255,255,255,0.05);
                  border-radius: 12px;
                  backdrop-filter: blur(10px);
              }
              h1 {
                  font-size: 24px;
                  display: flex;
                  align-items: center;
                  gap: 12px;
              }
              h1 .icon {
                  font-size: 32px;
              }
              .status-badge {
                  padding: 8px 16px;
                  border-radius: 20px;
                  font-size: 14px;
                  font-weight: 500;
              }
              .status-healthy {
                  background: rgba(34, 197, 94, 0.2);
                  color: #22c55e;
                  border: 1px solid rgba(34, 197, 94, 0.3);
              }
              .tabs {
                  display: flex;
                  gap: 10px;
                  margin-bottom: 20px;
              }
              .tab {
                  padding: 12px 24px;
                  background: rgba(255,255,255,0.05);
                  border: 1px solid rgba(255,255,255,0.1);
                  border-radius: 8px;
                  cursor: pointer;
                  transition: all 0.2s;
                  color: #a1a1aa;
              }
              .tab:hover {
                  background: rgba(255,255,255,0.1);
              }
              .tab.active {
                  background: rgba(59, 130, 246, 0.2);
                  border-color: rgba(59, 130, 246, 0.5);
                  color: #60a5fa;
              }
              .panel {
                  display: none;
                  background: rgba(255,255,255,0.05);
                  border-radius: 12px;
                  padding: 20px;
              }
              .panel.active {
                  display: block;
              }
              .card {
                  background: rgba(255,255,255,0.05);
                  border: 1px solid rgba(255,255,255,0.1);
                  border-radius: 12px;
                  padding: 20px;
                  margin-bottom: 15px;
              }
              .card-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 15px;
              }
              .card-title {
                  font-size: 18px;
                  font-weight: 600;
              }
              table {
                  width: 100%;
                  border-collapse: collapse;
              }
              th, td {
                  padding: 12px;
                  text-align: left;
                  border-bottom: 1px solid rgba(255,255,255,0.1);
              }
              th {
                  color: #a1a1aa;
                  font-weight: 500;
                  font-size: 12px;
                  text-transform: uppercase;
              }
              .status-pill {
                  display: inline-block;
                  padding: 4px 12px;
                  border-radius: 12px;
                  font-size: 12px;
                  font-weight: 500;
              }
              .status-success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
              .status-failed { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
              .status-running { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
              .status-queued { background: rgba(234, 179, 8, 0.2); color: #eab308; }
              .status-cancelled { background: rgba(113, 113, 122, 0.2); color: #71717a; }
              .btn {
                  padding: 8px 16px;
                  border: none;
                  border-radius: 6px;
                  cursor: pointer;
                  font-size: 14px;
                  font-weight: 500;
                  transition: all 0.2s;
              }
              .btn-primary {
                  background: #3b82f6;
                  color: white;
              }
              .btn-primary:hover {
                  background: #2563eb;
              }
              .btn-secondary {
                  background: rgba(255,255,255,0.1);
                  color: #e4e4e7;
              }
              .btn-secondary:hover {
                  background: rgba(255,255,255,0.2);
              }
              .btn-danger {
                  background: rgba(239, 68, 68, 0.2);
                  color: #ef4444;
              }
              .btn-danger:hover {
                  background: rgba(239, 68, 68, 0.3);
              }
              .actions {
                  display: flex;
                  gap: 8px;
              }
              .empty-state {
                  text-align: center;
                  padding: 60px 20px;
                  color: #71717a;
              }
              .empty-state .icon {
                  font-size: 48px;
                  margin-bottom: 16px;
              }
              .form-group {
                  margin-bottom: 15px;
              }
              .form-group label {
                  display: block;
                  margin-bottom: 8px;
                  color: #a1a1aa;
                  font-size: 14px;
              }
              .form-group input, .form-group select {
                  width: 100%;
                  padding: 10px 14px;
                  background: rgba(255,255,255,0.05);
                  border: 1px solid rgba(255,255,255,0.2);
                  border-radius: 8px;
                  color: #e4e4e7;
                  font-size: 14px;
              }
              .form-group input:focus, .form-group select:focus {
                  outline: none;
                  border-color: #3b82f6;
              }
              .modal-backdrop {
                  display: none;
                  position: fixed;
                  top: 0;
                  left: 0;
                  right: 0;
                  bottom: 0;
                  background: rgba(0,0,0,0.7);
                  z-index: 100;
                  justify-content: center;
                  align-items: center;
              }
              .modal-backdrop.active {
                  display: flex;
              }
              .modal {
                  background: #1a1a2e;
                  border-radius: 12px;
                  padding: 24px;
                  width: 500px;
                  max-width: 90%;
              }
              .modal h2 {
                  margin-bottom: 20px;
              }
              .modal-actions {
                  display: flex;
                  justify-content: flex-end;
                  gap: 10px;
                  margin-top: 20px;
              }
              .log-viewer {
                  background: #0d0d14;
                  border-radius: 8px;
                  padding: 16px;
                  font-family: 'Monaco', 'Menlo', monospace;
                  font-size: 13px;
                  max-height: 400px;
                  overflow-y: auto;
              }
              .log-line {
                  display: flex;
                  gap: 12px;
                  padding: 4px 0;
              }
              .log-time {
                  color: #71717a;
                  flex-shrink: 0;
              }
              .log-level {
                  flex-shrink: 0;
                  width: 50px;
              }
              .log-level.info { color: #60a5fa; }
              .log-level.warn { color: #eab308; }
              .log-level.error { color: #ef4444; }
              .log-message {
                  color: #e4e4e7;
              }
              .stats-grid {
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                  margin-bottom: 20px;
              }
              .stat-card {
                  background: rgba(255,255,255,0.05);
                  border-radius: 12px;
                  padding: 20px;
                  text-align: center;
              }
              .stat-value {
                  font-size: 36px;
                  font-weight: 700;
                  margin-bottom: 8px;
              }
              .stat-label {
                  color: #71717a;
                  font-size: 14px;
              }
              .stat-value.success { color: #22c55e; }
              .stat-value.failed { color: #ef4444; }
              .stat-value.running { color: #60a5fa; }
              .webhook-url {
                  background: rgba(0,0,0,0.3);
                  padding: 12px;
                  border-radius: 8px;
                  font-family: monospace;
                  font-size: 13px;
                  word-break: break-all;
                  margin: 10px 0;
              }
              @keyframes pulse {
                  0%, 100% { opacity: 1; }
                  50% { opacity: 0.5; }
              }
              .running-indicator {
                  animation: pulse 2s infinite;
              }
          </style>
      </head>
      <body>
          <div class="container">
              <header>
                  <h1>
                      <span class="icon">&#9881;</span>
                      CI/CD Controller
                  </h1>
                  <span class="status-badge status-healthy" id="health-status">Healthy</span>
              </header>

              <div class="tabs">
                  <div class="tab active" data-tab="pipelines">Pipelines</div>
                  <div class="tab" data-tab="executions">Executions</div>
                  <div class="tab" data-tab="queue">Build Queue</div>
                  <div class="tab" data-tab="webhooks">Webhooks</div>
              </div>

              <div id="pipelines" class="panel active">
                  <div class="stats-grid">
                      <div class="stat-card">
                          <div class="stat-value" id="total-pipelines">0</div>
                          <div class="stat-label">Total Pipelines</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value success" id="success-count">0</div>
                          <div class="stat-label">Successful Builds</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value failed" id="failed-count">0</div>
                          <div class="stat-label">Failed Builds</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value running" id="running-count">0</div>
                          <div class="stat-label">Running</div>
                      </div>
                  </div>

                  <div class="card">
                      <div class="card-header">
                          <span class="card-title">Pipelines</span>
                          <button class="btn btn-primary" onclick="showCreatePipeline()">+ New Pipeline</button>
                      </div>
                      <table>
                          <thead>
                              <tr>
                                  <th>Name</th>
                                  <th>Repository</th>
                                  <th>Branch</th>
                                  <th>Last Build</th>
                                  <th>Status</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody id="pipelines-table">
                          </tbody>
                      </table>
                  </div>
              </div>

              <div id="executions" class="panel">
                  <div class="card">
                      <div class="card-header">
                          <span class="card-title">Pipeline Executions</span>
                          <button class="btn btn-secondary" onclick="loadExecutions()">Refresh</button>
                      </div>
                      <table>
                          <thead>
                              <tr>
                                  <th>Pipeline</th>
                                  <th>Build #</th>
                                  <th>Branch</th>
                                  <th>Commit</th>
                                  <th>Trigger</th>
                                  <th>Status</th>
                                  <th>Duration</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody id="executions-table">
                          </tbody>
                      </table>
                  </div>
              </div>

              <div id="queue" class="panel">
                  <div class="card">
                      <div class="card-header">
                          <span class="card-title">Build Queue</span>
                          <button class="btn btn-secondary" onclick="loadQueue()">Refresh</button>
                      </div>
                      <table>
                          <thead>
                              <tr>
                                  <th>Pipeline</th>
                                  <th>Repository</th>
                                  <th>Branch</th>
                                  <th>Commit</th>
                                  <th>Status</th>
                                  <th>Created</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody id="queue-table">
                          </tbody>
                      </table>
                  </div>
              </div>

              <div id="webhooks" class="panel">
                  <div class="card">
                      <div class="card-header">
                          <span class="card-title">Webhook Configuration</span>
                      </div>
                      <p style="color: #a1a1aa; margin-bottom: 15px;">Configure your Git repository to send webhooks to:</p>
                      <div class="webhook-url" id="webhook-url"></div>
                      <p style="color: #71717a; font-size: 13px;">Supported events: push, tag</p>
                  </div>

                  <div class="card">
                      <div class="card-header">
                          <span class="card-title">Recent Webhook Events</span>
                          <button class="btn btn-secondary" onclick="loadWebhooks()">Refresh</button>
                      </div>
                      <table>
                          <thead>
                              <tr>
                                  <th>Source</th>
                                  <th>Repository</th>
                                  <th>Branch</th>
                                  <th>Event</th>
                                  <th>Processed</th>
                                  <th>Time</th>
                              </tr>
                          </thead>
                          <tbody id="webhooks-table">
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>

          <!-- Create Pipeline Modal -->
          <div class="modal-backdrop" id="create-pipeline-modal">
              <div class="modal">
                  <h2>Create Pipeline</h2>
                  <form id="pipeline-form">
                      <div class="form-group">
                          <label>Pipeline Name</label>
                          <input type="text" name="name" required placeholder="my-app">
                      </div>
                      <div class="form-group">
                          <label>Repository URL</label>
                          <input type="text" name="repoUrl" placeholder="my-repo">
                      </div>
                      <div class="form-group">
                          <label>Branch</label>
                          <input type="text" name="branch" value="main" placeholder="main">
                      </div>
                      <div class="form-group">
                          <label>Description</label>
                          <input type="text" name="description" placeholder="Build and deploy my app">
                      </div>
                      <div class="modal-actions">
                          <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                          <button type="submit" class="btn btn-primary">Create Pipeline</button>
                      </div>
                  </form>
              </div>
          </div>

          <!-- Logs Modal -->
          <div class="modal-backdrop" id="logs-modal">
              <div class="modal" style="width: 800px;">
                  <h2>Build Logs</h2>
                  <div class="log-viewer" id="log-content">
                  </div>
                  <div class="modal-actions">
                      <button class="btn btn-secondary" onclick="closeLogsModal()">Close</button>
                  </div>
              </div>
          </div>

          <script>
              const API_BASE = '';
              let pipelines = [];
              let executions = [];
              let queue = [];

              // Tab switching
              document.querySelectorAll('.tab').forEach(tab => {
                  tab.addEventListener('click', () => {
                      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                      tab.classList.add('active');
                      document.getElementById(tab.dataset.tab).classList.add('active');

                      // Load data for tab
                      switch(tab.dataset.tab) {
                          case 'pipelines': loadPipelines(); break;
                          case 'executions': loadExecutions(); break;
                          case 'queue': loadQueue(); break;
                          case 'webhooks': loadWebhooks(); break;
                      }
                  });
              });

              async function loadPipelines() {
                  try {
                      const resp = await fetch(API_BASE + '/api/pipelines');
                      pipelines = await resp.json();
                      renderPipelines();
                      updateStats();
                  } catch (e) {
                      console.error('Failed to load pipelines:', e);
                  }
              }

              function renderPipelines() {
                  const tbody = document.getElementById('pipelines-table');
                  if (!pipelines || pipelines.length === 0) {
                      tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No pipelines configured</td></tr>';
                      return;
                  }
                  tbody.innerHTML = pipelines.map(p => `
                      <tr>
                          <td><strong>${p.name || 'Unnamed'}</strong></td>
                          <td>${p.repoUrl || '-'}</td>
                          <td>${p.branch || 'main'}</td>
                          <td>-</td>
                          <td><span class="status-pill ${p.enabled ? 'status-success' : 'status-cancelled'}">${p.enabled ? 'Enabled' : 'Disabled'}</span></td>
                          <td class="actions">
                              <button class="btn btn-primary" onclick="triggerPipeline('${p.id}')">Run</button>
                              <button class="btn btn-danger" onclick="deletePipeline('${p.id}')">Delete</button>
                          </td>
                      </tr>
                  `).join('');
              }

              async function loadExecutions() {
                  try {
                      const resp = await fetch(API_BASE + '/api/executions');
                      executions = await resp.json();
                      renderExecutions();
                  } catch (e) {
                      console.error('Failed to load executions:', e);
                  }
              }

              function renderExecutions() {
                  const tbody = document.getElementById('executions-table');
                  if (!executions || executions.length === 0) {
                      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No executions yet</td></tr>';
                      return;
                  }
                  tbody.innerHTML = executions.map(e => `
                      <tr>
                          <td>${e.pipelineName || 'Unknown'}</td>
                          <td>#${e.buildNumber || '?'}</td>
                          <td>${e.branch || '-'}</td>
                          <td><code>${(e.commit || '-').substring(0, 7)}</code></td>
                          <td>${e.trigger || 'manual'}</td>
                          <td><span class="status-pill status-${e.status} ${e.status === 'running' ? 'running-indicator' : ''}">${e.status}</span></td>
                          <td>${e.duration ? e.duration.toFixed(1) + 's' : '-'}</td>
                          <td class="actions">
                              <button class="btn btn-secondary" onclick="viewLogs('${e.id}')">Logs</button>
                              <button class="btn btn-secondary" onclick="retryExecution('${e.id}')">Retry</button>
                          </td>
                      </tr>
                  `).join('');
              }

              async function loadQueue() {
                  try {
                      const resp = await fetch(API_BASE + '/api/queue');
                      queue = await resp.json();
                      renderQueue();
                  } catch (e) {
                      console.error('Failed to load queue:', e);
                  }
              }

              function renderQueue() {
                  const tbody = document.getElementById('queue-table');
                  if (!queue || queue.length === 0) {
                      tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Build queue is empty</td></tr>';
                      return;
                  }
                  tbody.innerHTML = queue.map(j => `
                      <tr>
                          <td>${j.pipeline || 'Unknown'}</td>
                          <td>${j.repo || '-'}</td>
                          <td>${j.branch || '-'}</td>
                          <td><code>${(j.commit || '-').substring(0, 7)}</code></td>
                          <td><span class="status-pill status-${j.status} ${j.status === 'running' ? 'running-indicator' : ''}">${j.status}</span></td>
                          <td>${new Date(j.createdAt).toLocaleString()}</td>
                          <td class="actions">
                              ${j.status === 'queued' ? `<button class="btn btn-danger" onclick="cancelBuild('${j.id}')">Cancel</button>` : ''}
                          </td>
                      </tr>
                  `).join('');
              }

              async function loadWebhooks() {
                  try {
                      const resp = await fetch(API_BASE + '/api/webhooks');
                      const webhooks = await resp.json();
                      renderWebhooks(webhooks);
                  } catch (e) {
                      console.error('Failed to load webhooks:', e);
                  }

                  // Set webhook URL
                  const url = window.location.origin + '/api/webhook/holmgit';
                  document.getElementById('webhook-url').textContent = url;
              }

              function renderWebhooks(webhooks) {
                  const tbody = document.getElementById('webhooks-table');
                  if (!webhooks || webhooks.length === 0) {
                      tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No webhook events received</td></tr>';
                      return;
                  }
                  tbody.innerHTML = webhooks.map(w => `
                      <tr>
                          <td>${w.source || 'unknown'}</td>
                          <td>${w.repo || '-'}</td>
                          <td>${w.branch || '-'}</td>
                          <td>${w.type || 'push'}</td>
                          <td><span class="status-pill ${w.processed ? 'status-success' : 'status-queued'}">${w.processed ? 'Yes' : 'No'}</span></td>
                          <td>${new Date(w.timestamp).toLocaleString()}</td>
                      </tr>
                  `).join('');
              }

              async function updateStats() {
                  document.getElementById('total-pipelines').textContent = pipelines.length;

                  try {
                      const resp = await fetch(API_BASE + '/api/executions');
                      const execs = await resp.json();

                      let success = 0, failed = 0, running = 0;
                      execs.forEach(e => {
                          if (e.status === 'success') success++;
                          else if (e.status === 'failed') failed++;
                          else if (e.status === 'running') running++;
                      });

                      document.getElementById('success-count').textContent = success;
                      document.getElementById('failed-count').textContent = failed;
                      document.getElementById('running-count').textContent = running;
                  } catch (e) {}
              }

              function showCreatePipeline() {
                  document.getElementById('create-pipeline-modal').classList.add('active');
              }

              function closeModal() {
                  document.getElementById('create-pipeline-modal').classList.remove('active');
              }

              document.getElementById('pipeline-form').addEventListener('submit', async (e) => {
                  e.preventDefault();
                  const form = e.target;
                  const data = {
                      name: form.name.value,
                      repoUrl: form.repoUrl.value,
                      branch: form.branch.value || 'main',
                      description: form.description.value,
                      enabled: true,
                      stages: [
                          { name: 'build', type: 'build', timeout: 600 },
                          { name: 'deploy', type: 'deploy', dependsOn: ['build'], timeout: 300 }
                      ],
                      triggers: [
                          { type: 'webhook', branches: ['main', 'master'], events: ['push'] }
                      ]
                  };

                  try {
                      await fetch(API_BASE + '/api/pipelines', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify(data)
                      });
                      closeModal();
                      form.reset();
                      loadPipelines();
                  } catch (e) {
                      alert('Failed to create pipeline');
                  }
              });

              async function triggerPipeline(id) {
                  try {
                      await fetch(API_BASE + `/api/pipelines/${id}/trigger`, {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({})
                      });
                      loadQueue();
                      loadExecutions();
                  } catch (e) {
                      alert('Failed to trigger pipeline');
                  }
              }

              async function deletePipeline(id) {
                  if (!confirm('Are you sure you want to delete this pipeline?')) return;
                  try {
                      await fetch(API_BASE + `/api/pipelines/${id}`, { method: 'DELETE' });
                      loadPipelines();
                  } catch (e) {
                      alert('Failed to delete pipeline');
                  }
              }

              async function cancelBuild(id) {
                  try {
                      await fetch(API_BASE + `/api/queue/${id}/cancel`, { method: 'POST' });
                      loadQueue();
                  } catch (e) {
                      alert('Failed to cancel build');
                  }
              }

              async function retryExecution(id) {
                  try {
                      await fetch(API_BASE + `/api/executions/${id}/retry`, { method: 'POST' });
                      loadQueue();
                      loadExecutions();
                  } catch (e) {
                      alert('Failed to retry execution');
                  }
              }

              async function viewLogs(execId) {
                  try {
                      const resp = await fetch(API_BASE + `/api/executions/${execId}/logs`);
                      const logs = await resp.json();

                      const content = document.getElementById('log-content');
                      let html = '';

                      for (const [id, log] of Object.entries(logs)) {
                          html += `<div style="margin-bottom: 15px;"><strong>Stage: ${log.stage}</strong></div>`;
                          log.lines.forEach(line => {
                              const time = new Date(line.timestamp).toLocaleTimeString();
                              html += `<div class="log-line">
                                  <span class="log-time">${time}</span>
                                  <span class="log-level ${line.level}">[${line.level.toUpperCase()}]</span>
                                  <span class="log-message">${line.message}</span>
                              </div>`;
                          });
                      }

                      if (!html) {
                          html = '<div style="color: #71717a;">No logs available</div>';
                      }

                      content.innerHTML = html;
                      document.getElementById('logs-modal').classList.add('active');
                  } catch (e) {
                      alert('Failed to load logs');
                  }
              }

              function closeLogsModal() {
                  document.getElementById('logs-modal').classList.remove('active');
              }

              // Initial load
              loadPipelines();

              // Auto-refresh
              setInterval(() => {
                  const activeTab = document.querySelector('.tab.active').dataset.tab;
                  switch(activeTab) {
                      case 'pipelines': loadPipelines(); break;
                      case 'executions': loadExecutions(); break;
                      case 'queue': loadQueue(); break;
                  }
              }, 10000);
          </script>
      </body>
      </html>
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-15T16:41:36Z"
    name: cicd-controller-src
    namespace: holm
    resourceVersion: "742"
    uid: 73e5cbff-06cc-4920-8810-4d4ed60e1605
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder
      WORKDIR /app
      COPY go.mod ./
      COPY main.go .
      COPY index.html .
      RUN go mod tidy
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -o clock-app .

      FROM alpine:latest
      RUN apk add --no-cache ca-certificates tzdata
      WORKDIR /app
      COPY --from=builder /app/clock-app .
      COPY --from=builder /app/index.html .
      EXPOSE 30007
      CMD ["./clock-app"]
    go.mod: |
      module clock-app

      go 1.21
    index.html: |
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
          <title>Clock</title>
          <style>
              /* Catppuccin Mocha Theme */
              :root {
                  --ctp-base: #1e1e2e;
                  --ctp-mantle: #181825;
                  --ctp-crust: #11111b;
                  --ctp-surface0: #313244;
                  --ctp-surface1: #45475a;
                  --ctp-surface2: #585b70;
                  --ctp-overlay0: #6c7086;
                  --ctp-overlay1: #7f849c;
                  --ctp-overlay2: #9399b2;
                  --ctp-subtext0: #a6adc8;
                  --ctp-subtext1: #bac2de;
                  --ctp-text: #cdd6f4;
                  --ctp-lavender: #b4befe;
                  --ctp-blue: #89b4fa;
                  --ctp-sapphire: #74c7ec;
                  --ctp-sky: #89dceb;
                  --ctp-teal: #94e2d5;
                  --ctp-green: #a6e3a1;
                  --ctp-yellow: #f9e2af;
                  --ctp-peach: #fab387;
                  --ctp-maroon: #eba0ac;
                  --ctp-red: #f38ba8;
                  --ctp-mauve: #cba6f7;
                  --ctp-pink: #f5c2e7;
                  --ctp-flamingo: #f2cdcd;
                  --ctp-rosewater: #f5e0dc;
              }

              * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
                  -webkit-tap-highlight-color: transparent;
              }

              body {
                  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
                  background: var(--ctp-base);
                  min-height: 100vh;
                  color: var(--ctp-text);
              }

              .app-container {
                  max-width: 420px;
                  margin: 0 auto;
                  min-height: 100vh;
                  display: flex;
                  flex-direction: column;
              }

              /* Tab Navigation */
              .tab-nav {
                  display: flex;
                  background: var(--ctp-crust);
                  border-top: 1px solid var(--ctp-surface0);
                  position: fixed;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  z-index: 100;
              }

              .tab-nav-inner {
                  display: flex;
                  max-width: 420px;
                  margin: 0 auto;
                  width: 100%;
              }

              .tab-btn {
                  flex: 1;
                  background: none;
                  border: none;
                  padding: 10px 8px 20px;
                  color: var(--ctp-overlay0);
                  cursor: pointer;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  gap: 4px;
                  transition: color 0.2s;
              }

              .tab-btn.active {
                  color: var(--ctp-mauve);
              }

              .tab-btn svg {
                  width: 24px;
                  height: 24px;
              }

              .tab-btn span {
                  font-size: 10px;
                  font-weight: 500;
              }

              /* Tab Content */
              .tab-content {
                  display: none;
                  flex: 1;
                  padding: 20px;
                  padding-bottom: 100px;
                  overflow-y: auto;
              }

              .tab-content.active {
                  display: block;
              }

              .tab-header {
                  font-size: 34px;
                  font-weight: 700;
                  margin-bottom: 20px;
                  color: var(--ctp-text);
              }

              /* World Clock */
              .world-clock-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1px;
                  background: var(--ctp-surface0);
                  border-radius: 12px;
                  overflow: hidden;
              }

              .clock-item {
                  background: var(--ctp-mantle);
                  padding: 16px;
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
              }

              .clock-item:first-child {
                  border-radius: 12px 12px 0 0;
              }

              .clock-item:last-child {
                  border-radius: 0 0 12px 12px;
              }

              .clock-item:only-child {
                  border-radius: 12px;
              }

              .clock-info {
                  display: flex;
                  flex-direction: column;
                  gap: 2px;
              }

              .clock-offset {
                  font-size: 14px;
                  color: var(--ctp-overlay1);
              }

              .clock-city {
                  font-size: 18px;
                  font-weight: 500;
                  color: var(--ctp-text);
              }

              .clock-time-display {
                  display: flex;
                  align-items: baseline;
                  gap: 4px;
              }

              .clock-time {
                  font-size: 42px;
                  font-weight: 300;
                  color: var(--ctp-text);
                  font-variant-numeric: tabular-nums;
              }

              .clock-period {
                  font-size: 24px;
                  font-weight: 300;
                  color: var(--ctp-overlay1);
              }

              .add-clock-btn {
                  margin-top: 16px;
                  width: 100%;
                  padding: 14px;
                  background: var(--ctp-surface0);
                  border: none;
                  border-radius: 12px;
                  color: var(--ctp-mauve);
                  font-size: 16px;
                  font-weight: 500;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  gap: 8px;
                  transition: background 0.2s;
              }

              .add-clock-btn:hover {
                  background: var(--ctp-surface1);
              }

              /* Alarm */
              .alarm-list {
                  display: flex;
                  flex-direction: column;
                  gap: 1px;
                  background: var(--ctp-surface0);
                  border-radius: 12px;
                  overflow: hidden;
              }

              .alarm-item {
                  background: var(--ctp-mantle);
                  padding: 16px;
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
              }

              .alarm-item:first-child {
                  border-radius: 12px 12px 0 0;
              }

              .alarm-item:last-child {
                  border-radius: 0 0 12px 12px;
              }

              .alarm-item:only-child {
                  border-radius: 12px;
              }

              .alarm-item.disabled .alarm-time,
              .alarm-item.disabled .alarm-label {
                  color: var(--ctp-overlay0);
              }

              .alarm-info {
                  display: flex;
                  flex-direction: column;
                  gap: 2px;
              }

              .alarm-time {
                  font-size: 48px;
                  font-weight: 300;
                  color: var(--ctp-text);
                  font-variant-numeric: tabular-nums;
              }

              .alarm-label {
                  font-size: 14px;
                  color: var(--ctp-overlay1);
              }

              /* Toggle Switch */
              .toggle {
                  position: relative;
                  width: 51px;
                  height: 31px;
                  background: var(--ctp-surface1);
                  border-radius: 16px;
                  cursor: pointer;
                  transition: background 0.3s;
              }

              .toggle.active {
                  background: var(--ctp-green);
              }

              .toggle::after {
                  content: '';
                  position: absolute;
                  top: 2px;
                  left: 2px;
                  width: 27px;
                  height: 27px;
                  background: white;
                  border-radius: 50%;
                  transition: transform 0.3s;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
              }

              .toggle.active::after {
                  transform: translateX(20px);
              }

              .add-alarm-btn {
                  position: fixed;
                  top: 20px;
                  right: 20px;
                  background: none;
                  border: none;
                  color: var(--ctp-mauve);
                  font-size: 32px;
                  cursor: pointer;
                  width: 44px;
                  height: 44px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
              }

              .no-alarms {
                  text-align: center;
                  padding: 60px 20px;
                  color: var(--ctp-overlay0);
              }

              /* Stopwatch */
              .stopwatch-display {
                  text-align: center;
                  padding: 40px 0;
              }

              .stopwatch-time {
                  font-size: 72px;
                  font-weight: 200;
                  font-variant-numeric: tabular-nums;
                  color: var(--ctp-text);
                  letter-spacing: -2px;
              }

              .stopwatch-ms {
                  font-size: 48px;
                  color: var(--ctp-overlay1);
              }

              .stopwatch-controls {
                  display: flex;
                  justify-content: center;
                  gap: 40px;
                  margin-top: 30px;
              }

              .stopwatch-btn {
                  width: 80px;
                  height: 80px;
                  border-radius: 50%;
                  border: 2px solid;
                  font-size: 16px;
                  font-weight: 500;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  transition: all 0.2s;
              }

              .stopwatch-btn.lap {
                  background: var(--ctp-surface0);
                  border-color: var(--ctp-surface1);
                  color: var(--ctp-text);
              }

              .stopwatch-btn.lap:disabled {
                  opacity: 0.5;
                  cursor: not-allowed;
              }

              .stopwatch-btn.lap:not(:disabled):hover {
                  background: var(--ctp-surface1);
              }

              .stopwatch-btn.start {
                  background: rgba(166, 227, 161, 0.2);
                  border-color: var(--ctp-green);
                  color: var(--ctp-green);
              }

              .stopwatch-btn.start:hover {
                  background: rgba(166, 227, 161, 0.3);
              }

              .stopwatch-btn.stop {
                  background: rgba(243, 139, 168, 0.2);
                  border-color: var(--ctp-red);
                  color: var(--ctp-red);
              }

              .stopwatch-btn.stop:hover {
                  background: rgba(243, 139, 168, 0.3);
              }

              .lap-list {
                  margin-top: 30px;
                  border-top: 1px solid var(--ctp-surface0);
              }

              .lap-item {
                  display: flex;
                  justify-content: space-between;
                  padding: 12px 0;
                  border-bottom: 1px solid var(--ctp-surface0);
                  font-variant-numeric: tabular-nums;
              }

              .lap-item.best {
                  color: var(--ctp-green);
              }

              .lap-item.worst {
                  color: var(--ctp-red);
              }

              .lap-number {
                  color: var(--ctp-overlay1);
              }

              /* Timer */
              .timer-display {
                  text-align: center;
                  padding: 40px 0;
              }

              .timer-time {
                  font-size: 72px;
                  font-weight: 200;
                  font-variant-numeric: tabular-nums;
                  color: var(--ctp-text);
                  letter-spacing: -2px;
              }

              .timer-controls {
                  display: flex;
                  justify-content: center;
                  gap: 40px;
                  margin-top: 30px;
              }

              .timer-btn {
                  width: 80px;
                  height: 80px;
                  border-radius: 50%;
                  border: 2px solid;
                  font-size: 16px;
                  font-weight: 500;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  transition: all 0.2s;
              }

              .timer-btn.cancel {
                  background: var(--ctp-surface0);
                  border-color: var(--ctp-surface1);
                  color: var(--ctp-text);
              }

              .timer-btn.cancel:hover {
                  background: var(--ctp-surface1);
              }

              .timer-btn.start {
                  background: rgba(166, 227, 161, 0.2);
                  border-color: var(--ctp-green);
                  color: var(--ctp-green);
              }

              .timer-btn.start:hover {
                  background: rgba(166, 227, 161, 0.3);
              }

              .timer-btn.pause {
                  background: rgba(249, 226, 175, 0.2);
                  border-color: var(--ctp-yellow);
                  color: var(--ctp-yellow);
              }

              .timer-btn.pause:hover {
                  background: rgba(249, 226, 175, 0.3);
              }

              /* Timer Picker */
              .timer-picker {
                  display: flex;
                  justify-content: center;
                  gap: 10px;
                  padding: 40px 0;
              }

              .picker-column {
                  display: flex;
                  flex-direction: column;
                  align-items: center;
              }

              .picker-label {
                  font-size: 12px;
                  color: var(--ctp-overlay1);
                  margin-bottom: 8px;
                  text-transform: uppercase;
              }

              .picker-scroll {
                  height: 180px;
                  overflow-y: auto;
                  width: 70px;
                  scroll-snap-type: y mandatory;
                  scrollbar-width: none;
                  position: relative;
              }

              .picker-scroll::-webkit-scrollbar {
                  display: none;
              }

              .picker-scroll::before,
              .picker-scroll::after {
                  content: '';
                  display: block;
                  height: 72px;
              }

              .picker-option {
                  height: 36px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 24px;
                  color: var(--ctp-overlay0);
                  scroll-snap-align: center;
                  cursor: pointer;
                  transition: all 0.2s;
              }

              .picker-option.selected {
                  color: var(--ctp-text);
                  font-size: 28px;
                  font-weight: 500;
              }

              .picker-highlight {
                  position: absolute;
                  top: 50%;
                  left: 0;
                  right: 0;
                  height: 36px;
                  transform: translateY(-50%);
                  border-top: 1px solid var(--ctp-surface1);
                  border-bottom: 1px solid var(--ctp-surface1);
                  pointer-events: none;
              }

              /* Quick Timers */
              .quick-timers {
                  margin-top: 20px;
              }

              .quick-timers-title {
                  font-size: 14px;
                  color: var(--ctp-overlay1);
                  margin-bottom: 12px;
                  text-transform: uppercase;
              }

              .quick-timer-grid {
                  display: grid;
                  grid-template-columns: repeat(4, 1fr);
                  gap: 8px;
              }

              .quick-timer-btn {
                  padding: 12px 8px;
                  background: var(--ctp-surface0);
                  border: none;
                  border-radius: 10px;
                  color: var(--ctp-text);
                  font-size: 14px;
                  cursor: pointer;
                  transition: background 0.2s;
              }

              .quick-timer-btn:hover {
                  background: var(--ctp-surface1);
              }

              /* Modal */
              .modal-overlay {
                  display: none;
                  position: fixed;
                  top: 0;
                  left: 0;
                  right: 0;
                  bottom: 0;
                  background: rgba(0,0,0,0.6);
                  z-index: 200;
                  align-items: flex-end;
                  justify-content: center;
              }

              .modal-overlay.active {
                  display: flex;
              }

              .modal {
                  background: var(--ctp-mantle);
                  border-radius: 16px 16px 0 0;
                  width: 100%;
                  max-width: 420px;
                  max-height: 80vh;
                  overflow-y: auto;
              }

              .modal-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  padding: 16px;
                  border-bottom: 1px solid var(--ctp-surface0);
              }

              .modal-title {
                  font-size: 18px;
                  font-weight: 600;
              }

              .modal-btn {
                  background: none;
                  border: none;
                  color: var(--ctp-mauve);
                  font-size: 16px;
                  cursor: pointer;
                  padding: 8px;
              }

              .modal-body {
                  padding: 16px;
              }

              .timezone-search {
                  width: 100%;
                  padding: 12px 16px;
                  background: var(--ctp-surface0);
                  border: none;
                  border-radius: 10px;
                  color: var(--ctp-text);
                  font-size: 16px;
                  margin-bottom: 16px;
              }

              .timezone-search::placeholder {
                  color: var(--ctp-overlay0);
              }

              .timezone-list {
                  max-height: 300px;
                  overflow-y: auto;
              }

              .timezone-item {
                  padding: 14px;
                  cursor: pointer;
                  border-radius: 8px;
                  transition: background 0.2s;
              }

              .timezone-item:hover {
                  background: var(--ctp-surface0);
              }

              .timezone-name {
                  font-size: 16px;
                  color: var(--ctp-text);
              }

              .timezone-offset-text {
                  font-size: 13px;
                  color: var(--ctp-overlay1);
                  margin-top: 2px;
              }

              /* Alarm Modal */
              .alarm-time-picker {
                  display: flex;
                  justify-content: center;
                  gap: 10px;
                  padding: 20px 0;
              }

              .alarm-input-group {
                  margin-top: 16px;
              }

              .alarm-input-label {
                  font-size: 13px;
                  color: var(--ctp-overlay1);
                  margin-bottom: 8px;
                  display: block;
              }

              .alarm-input {
                  width: 100%;
                  padding: 12px 16px;
                  background: var(--ctp-surface0);
                  border: none;
                  border-radius: 10px;
                  color: var(--ctp-text);
                  font-size: 16px;
              }

              .alarm-input::placeholder {
                  color: var(--ctp-overlay0);
              }

              /* Alarm Ringing */
              .alarm-ringing {
                  display: none;
                  position: fixed;
                  top: 0;
                  left: 0;
                  right: 0;
                  bottom: 0;
                  background: var(--ctp-base);
                  z-index: 300;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
              }

              .alarm-ringing.active {
                  display: flex;
              }

              .alarm-ringing-time {
                  font-size: 80px;
                  font-weight: 200;
                  color: var(--ctp-text);
                  margin-bottom: 10px;
              }

              .alarm-ringing-label {
                  font-size: 24px;
                  color: var(--ctp-overlay1);
                  margin-bottom: 60px;
              }

              .alarm-stop-btn {
                  width: 120px;
                  height: 120px;
                  border-radius: 50%;
                  background: var(--ctp-red);
                  border: none;
                  color: white;
                  font-size: 18px;
                  font-weight: 600;
                  cursor: pointer;
                  transition: transform 0.2s;
              }

              .alarm-stop-btn:hover {
                  transform: scale(1.05);
              }

              .alarm-snooze-btn {
                  margin-top: 30px;
                  padding: 14px 40px;
                  background: var(--ctp-surface0);
                  border: none;
                  border-radius: 30px;
                  color: var(--ctp-text);
                  font-size: 16px;
                  cursor: pointer;
              }

              /* Delete button */
              .delete-btn {
                  background: none;
                  border: none;
                  color: var(--ctp-red);
                  cursor: pointer;
                  padding: 8px;
                  margin-left: 12px;
                  opacity: 0.7;
                  transition: opacity 0.2s;
              }

              .delete-btn:hover {
                  opacity: 1;
              }

              /* Timer finished animation */
              @keyframes pulse {
                  0%, 100% { opacity: 1; }
                  50% { opacity: 0.5; }
              }

              .timer-finished .timer-time {
                  color: var(--ctp-red);
                  animation: pulse 1s infinite;
              }
          </style>
      </head>
      <body>
          <div class="app-container">
              <!-- World Clock Tab -->
              <div class="tab-content active" id="worldClockTab">
                  <h1 class="tab-header">World Clock</h1>
                  <div class="world-clock-list" id="worldClockList"></div>
                  <button class="add-clock-btn" id="addClockBtn">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                      Add City
                  </button>
              </div>

              <!-- Alarm Tab -->
              <div class="tab-content" id="alarmTab">
                  <h1 class="tab-header">Alarms</h1>
                  <button class="add-alarm-btn" id="addAlarmBtn">+</button>
                  <div class="alarm-list" id="alarmList">
                      <div class="no-alarms">No Alarms</div>
                  </div>
              </div>

              <!-- Stopwatch Tab -->
              <div class="tab-content" id="stopwatchTab">
                  <h1 class="tab-header">Stopwatch</h1>
                  <div class="stopwatch-display">
                      <span class="stopwatch-time" id="stopwatchTime">00:00</span><span class="stopwatch-ms" id="stopwatchMs">.00</span>
                  </div>
                  <div class="stopwatch-controls">
                      <button class="stopwatch-btn lap" id="lapResetBtn" disabled>Lap</button>
                      <button class="stopwatch-btn start" id="startStopBtn">Start</button>
                  </div>
                  <div class="lap-list" id="lapList"></div>
              </div>

              <!-- Timer Tab -->
              <div class="tab-content" id="timerTab">
                  <h1 class="tab-header">Timer</h1>
                  <div id="timerSetup">
                      <div class="timer-picker">
                          <div class="picker-column">
                              <span class="picker-label">Hours</span>
                              <div class="picker-scroll" id="hourPicker">
                                  <div class="picker-highlight"></div>
                              </div>
                          </div>
                          <div class="picker-column">
                              <span class="picker-label">Min</span>
                              <div class="picker-scroll" id="minutePicker">
                                  <div class="picker-highlight"></div>
                              </div>
                          </div>
                          <div class="picker-column">
                              <span class="picker-label">Sec</span>
                              <div class="picker-scroll" id="secondPicker">
                                  <div class="picker-highlight"></div>
                              </div>
                          </div>
                      </div>
                      <div class="timer-controls">
                          <button class="timer-btn cancel" id="timerCancelBtn" style="visibility: hidden;">Cancel</button>
                          <button class="timer-btn start" id="timerStartBtn">Start</button>
                      </div>
                      <div class="quick-timers">
                          <div class="quick-timers-title">Quick Timers</div>
                          <div class="quick-timer-grid">
                              <button class="quick-timer-btn" data-seconds="60">1 min</button>
                              <button class="quick-timer-btn" data-seconds="180">3 min</button>
                              <button class="quick-timer-btn" data-seconds="300">5 min</button>
                              <button class="quick-timer-btn" data-seconds="600">10 min</button>
                              <button class="quick-timer-btn" data-seconds="900">15 min</button>
                              <button class="quick-timer-btn" data-seconds="1200">20 min</button>
                              <button class="quick-timer-btn" data-seconds="1800">30 min</button>
                              <button class="quick-timer-btn" data-seconds="3600">1 hr</button>
                          </div>
                      </div>
                  </div>
                  <div id="timerRunning" style="display: none;">
                      <div class="timer-display">
                          <span class="timer-time" id="timerTime">00:00:00</span>
                      </div>
                      <div class="timer-controls">
                          <button class="timer-btn cancel" id="timerCancelBtn2">Cancel</button>
                          <button class="timer-btn pause" id="timerPauseBtn">Pause</button>
                      </div>
                  </div>
              </div>

              <!-- Tab Navigation -->
              <nav class="tab-nav">
                  <div class="tab-nav-inner">
                      <button class="tab-btn active" data-tab="worldClockTab">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <circle cx="12" cy="12" r="10"></circle>
                              <line x1="12" y1="6" x2="12" y2="12"></line>
                              <line x1="12" y1="12" x2="16" y2="14"></line>
                          </svg>
                          <span>World Clock</span>
                      </button>
                      <button class="tab-btn" data-tab="alarmTab">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <circle cx="12" cy="13" r="8"></circle>
                              <path d="M12 9v4l2 2"></path>
                              <path d="M5 3L2 6"></path>
                              <path d="M22 6l-3-3"></path>
                          </svg>
                          <span>Alarm</span>
                      </button>
                      <button class="tab-btn" data-tab="stopwatchTab">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <circle cx="12" cy="13" r="8"></circle>
                              <path d="M12 9v4"></path>
                              <path d="M10 2h4"></path>
                          </svg>
                          <span>Stopwatch</span>
                      </button>
                      <button class="tab-btn" data-tab="timerTab">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M12 2v4"></path>
                              <path d="M12 18v4"></path>
                              <circle cx="12" cy="12" r="8"></circle>
                              <path d="M12 8v4l2 2"></path>
                          </svg>
                          <span>Timer</span>
                      </button>
                  </div>
              </nav>
          </div>

          <!-- Timezone Modal -->
          <div class="modal-overlay" id="timezoneModal">
              <div class="modal">
                  <div class="modal-header">
                      <button class="modal-btn" id="closeTimezoneModal">Cancel</button>
                      <span class="modal-title">Add City</span>
                      <div style="width: 60px;"></div>
                  </div>
                  <div class="modal-body">
                      <input type="text" class="timezone-search" id="timezoneSearch" placeholder="Search cities...">
                      <div class="timezone-list" id="timezoneList"></div>
                  </div>
              </div>
          </div>

          <!-- Alarm Modal -->
          <div class="modal-overlay" id="alarmModal">
              <div class="modal">
                  <div class="modal-header">
                      <button class="modal-btn" id="closeAlarmModal">Cancel</button>
                      <span class="modal-title">Add Alarm</span>
                      <button class="modal-btn" id="saveAlarmBtn">Save</button>
                  </div>
                  <div class="modal-body">
                      <div class="alarm-time-picker">
                          <div class="picker-column">
                              <span class="picker-label">Hour</span>
                              <div class="picker-scroll" id="alarmHourPicker">
                                  <div class="picker-highlight"></div>
                              </div>
                          </div>
                          <div class="picker-column">
                              <span class="picker-label">Min</span>
                              <div class="picker-scroll" id="alarmMinutePicker">
                                  <div class="picker-highlight"></div>
                              </div>
                          </div>
                      </div>
                      <div class="alarm-input-group">
                          <label class="alarm-input-label">Label</label>
                          <input type="text" class="alarm-input" id="alarmLabelInput" placeholder="Alarm">
                      </div>
                  </div>
              </div>
          </div>

          <!-- Alarm Ringing Screen -->
          <div class="alarm-ringing" id="alarmRinging">
              <div class="alarm-ringing-time" id="ringingTime">07:00</div>
              <div class="alarm-ringing-label" id="ringingLabel">Alarm</div>
              <button class="alarm-stop-btn" id="stopAlarmBtn">Stop</button>
              <button class="alarm-snooze-btn" id="snoozeAlarmBtn">Snooze (5 min)</button>
          </div>

          <script>
              // =====================
              // Tab Navigation
              // =====================
              const tabBtns = document.querySelectorAll('.tab-btn');
              const tabContents = document.querySelectorAll('.tab-content');

              tabBtns.forEach(btn => {
                  btn.addEventListener('click', () => {
                      const tabId = btn.dataset.tab;

                      tabBtns.forEach(b => b.classList.remove('active'));
                      tabContents.forEach(c => c.classList.remove('active'));

                      btn.classList.add('active');
                      document.getElementById(tabId).classList.add('active');
                  });
              });

              // =====================
              // World Clock
              // =====================
              const timezones = [
                  { city: 'New York', timezone: 'America/New_York', country: 'USA' },
                  { city: 'Los Angeles', timezone: 'America/Los_Angeles', country: 'USA' },
                  { city: 'Chicago', timezone: 'America/Chicago', country: 'USA' },
                  { city: 'London', timezone: 'Europe/London', country: 'UK' },
                  { city: 'Paris', timezone: 'Europe/Paris', country: 'France' },
                  { city: 'Berlin', timezone: 'Europe/Berlin', country: 'Germany' },
                  { city: 'Tokyo', timezone: 'Asia/Tokyo', country: 'Japan' },
                  { city: 'Sydney', timezone: 'Australia/Sydney', country: 'Australia' },
                  { city: 'Dubai', timezone: 'Asia/Dubai', country: 'UAE' },
                  { city: 'Singapore', timezone: 'Asia/Singapore', country: 'Singapore' },
                  { city: 'Hong Kong', timezone: 'Asia/Hong_Kong', country: 'China' },
                  { city: 'Mumbai', timezone: 'Asia/Kolkata', country: 'India' },
                  { city: 'Moscow', timezone: 'Europe/Moscow', country: 'Russia' },
                  { city: 'Amsterdam', timezone: 'Europe/Amsterdam', country: 'Netherlands' },
                  { city: 'Toronto', timezone: 'America/Toronto', country: 'Canada' },
                  { city: 'Vancouver', timezone: 'America/Vancouver', country: 'Canada' },
                  { city: 'Seoul', timezone: 'Asia/Seoul', country: 'South Korea' },
                  { city: 'Beijing', timezone: 'Asia/Shanghai', country: 'China' },
                  { city: 'Bangkok', timezone: 'Asia/Bangkok', country: 'Thailand' },
                  { city: 'Jakarta', timezone: 'Asia/Jakarta', country: 'Indonesia' },
                  { city: 'Cairo', timezone: 'Africa/Cairo', country: 'Egypt' },
                  { city: 'Johannesburg', timezone: 'Africa/Johannesburg', country: 'South Africa' },
                  { city: 'Sao Paulo', timezone: 'America/Sao_Paulo', country: 'Brazil' },
                  { city: 'Mexico City', timezone: 'America/Mexico_City', country: 'Mexico' },
                  { city: 'Auckland', timezone: 'Pacific/Auckland', country: 'New Zealand' },
                  { city: 'Honolulu', timezone: 'Pacific/Honolulu', country: 'USA' },
                  { city: 'Anchorage', timezone: 'America/Anchorage', country: 'USA' },
                  { city: 'Denver', timezone: 'America/Denver', country: 'USA' },
                  { city: 'Phoenix', timezone: 'America/Phoenix', country: 'USA' },
                  { city: 'Miami', timezone: 'America/New_York', country: 'USA' },
              ];

              let worldClocks = JSON.parse(localStorage.getItem('worldClocks') || '[]');
              const worldClockList = document.getElementById('worldClockList');

              function getTimezoneOffset(tz) {
                  const now = new Date();
                  const localOffset = now.getTimezoneOffset();
                  const tzDate = new Date(now.toLocaleString('en-US', { timeZone: tz }));
                  const tzOffset = (now - tzDate) / 60000 + localOffset;
                  const hours = Math.floor(Math.abs(tzOffset) / 60);
                  const mins = Math.abs(tzOffset) % 60;
                  const sign = tzOffset <= 0 ? '+' : '-';

                  if (tzOffset === 0) return 'Same time';

                  const diffHours = Math.abs(Math.round(tzOffset / 60));
                  const direction = tzOffset > 0 ? 'behind' : 'ahead';
                  return diffHours === 1 ? `1HR ${direction}` : `${diffHours}HRS ${direction}`;
              }

              function formatTime(date, tz) {
                  return date.toLocaleTimeString('en-US', {
                      timeZone: tz,
                      hour: 'numeric',
                      minute: '2-digit',
                      hour12: true
                  });
              }

              function renderWorldClocks() {
                  if (worldClocks.length === 0) {
                      worldClockList.innerHTML = '<div class="clock-item"><div class="clock-info"><div class="clock-city">No cities added</div><div class="clock-offset">Tap "Add City" to get started</div></div></div>';
                      return;
                  }

                  worldClockList.innerHTML = worldClocks.map((clock, index) => {
                      const now = new Date();
                      const timeStr = formatTime(now, clock.timezone);
                      const [time, period] = timeStr.split(' ');
                      const offset = getTimezoneOffset(clock.timezone);

                      return `
                          <div class="clock-item">
                              <div class="clock-info">
                                  <div class="clock-offset">${offset}</div>
                                  <div class="clock-city">${clock.city}</div>
                              </div>
                              <div style="display: flex; align-items: center;">
                                  <div class="clock-time-display">
                                      <span class="clock-time">${time}</span>
                                      <span class="clock-period">${period}</span>
                                  </div>
                                  <button class="delete-btn" onclick="deleteWorldClock(${index})">
                                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                          <polyline points="3 6 5 6 21 6"></polyline>
                                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                      </svg>
                                  </button>
                              </div>
                          </div>
                      `;
                  }).join('');
              }

              function deleteWorldClock(index) {
                  worldClocks.splice(index, 1);
                  localStorage.setItem('worldClocks', JSON.stringify(worldClocks));
                  renderWorldClocks();
              }

              // Update clocks every second
              setInterval(renderWorldClocks, 1000);
              renderWorldClocks();

              // Timezone Modal
              const timezoneModal = document.getElementById('timezoneModal');
              const timezoneSearch = document.getElementById('timezoneSearch');
              const timezoneList = document.getElementById('timezoneList');

              document.getElementById('addClockBtn').addEventListener('click', () => {
                  timezoneModal.classList.add('active');
                  timezoneSearch.value = '';
                  renderTimezoneList('');
              });

              document.getElementById('closeTimezoneModal').addEventListener('click', () => {
                  timezoneModal.classList.remove('active');
              });

              timezoneSearch.addEventListener('input', (e) => {
                  renderTimezoneList(e.target.value);
              });

              function renderTimezoneList(search) {
                  const filtered = timezones.filter(tz =>
                      tz.city.toLowerCase().includes(search.toLowerCase()) ||
                      tz.country.toLowerCase().includes(search.toLowerCase())
                  );

                  timezoneList.innerHTML = filtered.map(tz => {
                      const now = new Date();
                      const timeStr = formatTime(now, tz.timezone);

                      return `
                          <div class="timezone-item" data-city="${tz.city}" data-timezone="${tz.timezone}">
                              <div class="timezone-name">${tz.city}, ${tz.country}</div>
                              <div class="timezone-offset-text">${timeStr}</div>
                          </div>
                      `;
                  }).join('');

                  timezoneList.querySelectorAll('.timezone-item').forEach(item => {
                      item.addEventListener('click', () => {
                          const city = item.dataset.city;
                          const timezone = item.dataset.timezone;

                          if (!worldClocks.find(c => c.timezone === timezone)) {
                              worldClocks.push({ city, timezone });
                              localStorage.setItem('worldClocks', JSON.stringify(worldClocks));
                              renderWorldClocks();
                          }

                          timezoneModal.classList.remove('active');
                      });
                  });
              }

              // =====================
              // Alarms
              // =====================
              let alarms = JSON.parse(localStorage.getItem('alarms') || '[]');
              const alarmList = document.getElementById('alarmList');
              let currentRingingAlarm = null;
              let alarmAudio = null;

              function renderAlarms() {
                  if (alarms.length === 0) {
                      alarmList.innerHTML = '<div class="no-alarms">No Alarms</div>';
                      return;
                  }

                  alarmList.innerHTML = alarms.map((alarm, index) => {
                      const hour = alarm.hour.toString().padStart(2, '0');
                      const minute = alarm.minute.toString().padStart(2, '0');

                      return `
                          <div class="alarm-item ${alarm.enabled ? '' : 'disabled'}">
                              <div class="alarm-info">
                                  <div class="alarm-time">${hour}:${minute}</div>
                                  <div class="alarm-label">${alarm.label || 'Alarm'}</div>
                              </div>
                              <div style="display: flex; align-items: center;">
                                  <div class="toggle ${alarm.enabled ? 'active' : ''}" data-index="${index}"></div>
                                  <button class="delete-btn" onclick="deleteAlarm(${index})">
                                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                          <polyline points="3 6 5 6 21 6"></polyline>
                                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                      </svg>
                                  </button>
                              </div>
                          </div>
                      `;
                  }).join('');

                  alarmList.querySelectorAll('.toggle').forEach(toggle => {
                      toggle.addEventListener('click', () => {
                          const index = parseInt(toggle.dataset.index);
                          alarms[index].enabled = !alarms[index].enabled;
                          localStorage.setItem('alarms', JSON.stringify(alarms));
                          renderAlarms();
                      });
                  });
              }

              function deleteAlarm(index) {
                  alarms.splice(index, 1);
                  localStorage.setItem('alarms', JSON.stringify(alarms));
                  renderAlarms();
              }

              renderAlarms();

              // Alarm Modal
              const alarmModal = document.getElementById('alarmModal');
              const alarmHourPicker = document.getElementById('alarmHourPicker');
              const alarmMinutePicker = document.getElementById('alarmMinutePicker');
              const alarmLabelInput = document.getElementById('alarmLabelInput');

              function initPicker(container, max, pad = true) {
                  const highlight = container.querySelector('.picker-highlight');
                  for (let i = 0; i < max; i++) {
                      const option = document.createElement('div');
                      option.className = 'picker-option';
                      option.textContent = pad ? i.toString().padStart(2, '0') : i;
                      option.dataset.value = i;
                      container.insertBefore(option, highlight);
                  }
              }

              initPicker(alarmHourPicker, 24);
              initPicker(alarmMinutePicker, 60);

              function getPickerValue(container) {
                  const scrollTop = container.scrollTop;
                  const itemHeight = 36;
                  const index = Math.round(scrollTop / itemHeight);
                  return index;
              }

              function setPickerValue(container, value) {
                  const itemHeight = 36;
                  container.scrollTop = value * itemHeight;
                  updatePickerSelection(container);
              }

              function updatePickerSelection(container) {
                  const scrollTop = container.scrollTop;
                  const itemHeight = 36;
                  const selectedIndex = Math.round(scrollTop / itemHeight);

                  container.querySelectorAll('.picker-option').forEach((opt, i) => {
                      opt.classList.toggle('selected', i === selectedIndex);
                  });
              }

              [alarmHourPicker, alarmMinutePicker].forEach(picker => {
                  picker.addEventListener('scroll', () => updatePickerSelection(picker));
              });

              document.getElementById('addAlarmBtn').addEventListener('click', () => {
                  alarmModal.classList.add('active');
                  alarmLabelInput.value = '';
                  const now = new Date();
                  setTimeout(() => {
                      setPickerValue(alarmHourPicker, now.getHours());
                      setPickerValue(alarmMinutePicker, now.getMinutes());
                  }, 100);
              });

              document.getElementById('closeAlarmModal').addEventListener('click', () => {
                  alarmModal.classList.remove('active');
              });

              document.getElementById('saveAlarmBtn').addEventListener('click', () => {
                  const hour = getPickerValue(alarmHourPicker);
                  const minute = getPickerValue(alarmMinutePicker);
                  const label = alarmLabelInput.value || 'Alarm';

                  alarms.push({ hour, minute, label, enabled: true });
                  alarms.sort((a, b) => (a.hour * 60 + a.minute) - (b.hour * 60 + b.minute));
                  localStorage.setItem('alarms', JSON.stringify(alarms));
                  renderAlarms();
                  alarmModal.classList.remove('active');
              });

              // Check alarms every second
              function checkAlarms() {
                  const now = new Date();
                  const currentHour = now.getHours();
                  const currentMinute = now.getMinutes();
                  const currentSecond = now.getSeconds();

                  if (currentSecond !== 0) return;

                  alarms.forEach(alarm => {
                      if (alarm.enabled && alarm.hour === currentHour && alarm.minute === currentMinute) {
                          triggerAlarm(alarm);
                      }
                  });
              }

              function triggerAlarm(alarm) {
                  currentRingingAlarm = alarm;
                  document.getElementById('ringingTime').textContent =
                      `${alarm.hour.toString().padStart(2, '0')}:${alarm.minute.toString().padStart(2, '0')}`;
                  document.getElementById('ringingLabel').textContent = alarm.label || 'Alarm';
                  document.getElementById('alarmRinging').classList.add('active');

                  // Play alarm sound (using Web Audio API for a beep)
                  try {
                      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                      const playBeep = () => {
                          const oscillator = audioContext.createOscillator();
                          const gainNode = audioContext.createGain();
                          oscillator.connect(gainNode);
                          gainNode.connect(audioContext.destination);
                          oscillator.frequency.value = 880;
                          oscillator.type = 'sine';
                          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                          oscillator.start(audioContext.currentTime);
                          oscillator.stop(audioContext.currentTime + 0.5);
                      };

                      playBeep();
                      alarmAudio = setInterval(playBeep, 1000);
                  } catch (e) {
                      console.log('Audio not available');
                  }
              }

              document.getElementById('stopAlarmBtn').addEventListener('click', () => {
                  document.getElementById('alarmRinging').classList.remove('active');
                  if (alarmAudio) {
                      clearInterval(alarmAudio);
                      alarmAudio = null;
                  }
                  currentRingingAlarm = null;
              });

              document.getElementById('snoozeAlarmBtn').addEventListener('click', () => {
                  document.getElementById('alarmRinging').classList.remove('active');
                  if (alarmAudio) {
                      clearInterval(alarmAudio);
                      alarmAudio = null;
                  }

                  // Snooze for 5 minutes
                  if (currentRingingAlarm) {
                      const snoozeTime = new Date();
                      snoozeTime.setMinutes(snoozeTime.getMinutes() + 5);

                      setTimeout(() => {
                          if (currentRingingAlarm) {
                              triggerAlarm(currentRingingAlarm);
                          }
                      }, 5 * 60 * 1000);
                  }
                  currentRingingAlarm = null;
              });

              setInterval(checkAlarms, 1000);

              // =====================
              // Stopwatch
              // =====================
              let stopwatchRunning = false;
              let stopwatchTime = 0;
              let stopwatchInterval = null;
              let laps = [];
              let lastLapTime = 0;

              const stopwatchTimeEl = document.getElementById('stopwatchTime');
              const stopwatchMsEl = document.getElementById('stopwatchMs');
              const startStopBtn = document.getElementById('startStopBtn');
              const lapResetBtn = document.getElementById('lapResetBtn');
              const lapListEl = document.getElementById('lapList');

              function formatStopwatch(ms) {
                  const totalSeconds = Math.floor(ms / 1000);
                  const minutes = Math.floor(totalSeconds / 60);
                  const seconds = totalSeconds % 60;
                  const centiseconds = Math.floor((ms % 1000) / 10);

                  return {
                      main: `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`,
                      ms: `.${centiseconds.toString().padStart(2, '0')}`
                  };
              }

              function updateStopwatchDisplay() {
                  const formatted = formatStopwatch(stopwatchTime);
                  stopwatchTimeEl.textContent = formatted.main;
                  stopwatchMsEl.textContent = formatted.ms;
              }

              function startStopwatch() {
                  stopwatchRunning = true;
                  const startTime = Date.now() - stopwatchTime;

                  stopwatchInterval = setInterval(() => {
                      stopwatchTime = Date.now() - startTime;
                      updateStopwatchDisplay();
                  }, 10);

                  startStopBtn.textContent = 'Stop';
                  startStopBtn.classList.remove('start');
                  startStopBtn.classList.add('stop');
                  lapResetBtn.textContent = 'Lap';
                  lapResetBtn.disabled = false;
              }

              function stopStopwatch() {
                  stopwatchRunning = false;
                  clearInterval(stopwatchInterval);

                  startStopBtn.textContent = 'Start';
                  startStopBtn.classList.remove('stop');
                  startStopBtn.classList.add('start');
                  lapResetBtn.textContent = 'Reset';
              }

              function resetStopwatch() {
                  stopwatchTime = 0;
                  lastLapTime = 0;
                  laps = [];
                  updateStopwatchDisplay();
                  renderLaps();
                  lapResetBtn.disabled = true;
              }

              function addLap() {
                  const lapTime = stopwatchTime - lastLapTime;
                  laps.unshift({ lap: laps.length + 1, time: lapTime, total: stopwatchTime });
                  lastLapTime = stopwatchTime;
                  renderLaps();
              }

              function renderLaps() {
                  if (laps.length === 0) {
                      lapListEl.innerHTML = '';
                      return;
                  }

                  const times = laps.map(l => l.time);
                  const minTime = Math.min(...times);
                  const maxTime = Math.max(...times);

                  lapListEl.innerHTML = laps.map(lap => {
                      const formatted = formatStopwatch(lap.time);
                      let className = 'lap-item';
                      if (laps.length > 2) {
                          if (lap.time === minTime) className += ' best';
                          else if (lap.time === maxTime) className += ' worst';
                      }

                      return `
                          <div class="${className}">
                              <span class="lap-number">Lap ${lap.lap}</span>
                              <span>${formatted.main}${formatted.ms}</span>
                          </div>
                      `;
                  }).join('');
              }

              startStopBtn.addEventListener('click', () => {
                  if (stopwatchRunning) {
                      stopStopwatch();
                  } else {
                      startStopwatch();
                  }
              });

              lapResetBtn.addEventListener('click', () => {
                  if (stopwatchRunning) {
                      addLap();
                  } else {
                      resetStopwatch();
                  }
              });

              // =====================
              // Timer
              // =====================
              let timerRunning = false;
              let timerPaused = false;
              let timerTime = 0;
              let timerInterval = null;
              let timerEndTime = 0;

              const timerSetup = document.getElementById('timerSetup');
              const timerRunningDiv = document.getElementById('timerRunning');
              const timerTimeEl = document.getElementById('timerTime');
              const timerStartBtn = document.getElementById('timerStartBtn');
              const timerCancelBtn = document.getElementById('timerCancelBtn');
              const timerCancelBtn2 = document.getElementById('timerCancelBtn2');
              const timerPauseBtn = document.getElementById('timerPauseBtn');
              const hourPicker = document.getElementById('hourPicker');
              const minutePicker = document.getElementById('minutePicker');
              const secondPicker = document.getElementById('secondPicker');

              // Initialize timer pickers
              initPicker(hourPicker, 24);
              initPicker(minutePicker, 60);
              initPicker(secondPicker, 60);

              [hourPicker, minutePicker, secondPicker].forEach(picker => {
                  picker.addEventListener('scroll', () => updatePickerSelection(picker));
              });

              function formatTimer(seconds) {
                  const h = Math.floor(seconds / 3600);
                  const m = Math.floor((seconds % 3600) / 60);
                  const s = seconds % 60;

                  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
              }

              function updateTimerDisplay() {
                  timerTimeEl.textContent = formatTimer(timerTime);
              }

              function startTimer(seconds) {
                  timerTime = seconds;
                  timerRunning = true;
                  timerPaused = false;
                  timerEndTime = Date.now() + (seconds * 1000);

                  timerSetup.style.display = 'none';
                  timerRunningDiv.style.display = 'block';
                  timerRunningDiv.classList.remove('timer-finished');

                  updateTimerDisplay();

                  timerInterval = setInterval(() => {
                      const remaining = Math.max(0, Math.ceil((timerEndTime - Date.now()) / 1000));
                      timerTime = remaining;
                      updateTimerDisplay();

                      if (remaining === 0) {
                          timerFinished();
                      }
                  }, 100);

                  timerPauseBtn.textContent = 'Pause';
                  timerPauseBtn.classList.remove('start');
                  timerPauseBtn.classList.add('pause');
              }

              function timerFinished() {
                  clearInterval(timerInterval);
                  timerRunning = false;
                  timerRunningDiv.classList.add('timer-finished');

                  // Play timer sound
                  try {
                      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                      const playBeep = () => {
                          const oscillator = audioContext.createOscillator();
                          const gainNode = audioContext.createGain();
                          oscillator.connect(gainNode);
                          gainNode.connect(audioContext.destination);
                          oscillator.frequency.value = 1000;
                          oscillator.type = 'sine';
                          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                          oscillator.start(audioContext.currentTime);
                          oscillator.stop(audioContext.currentTime + 0.3);
                      };

                      for (let i = 0; i < 5; i++) {
                          setTimeout(playBeep, i * 400);
                      }
                  } catch (e) {
                      console.log('Audio not available');
                  }
              }

              function pauseTimer() {
                  timerPaused = true;
                  clearInterval(timerInterval);

                  timerPauseBtn.textContent = 'Resume';
                  timerPauseBtn.classList.remove('pause');
                  timerPauseBtn.classList.add('start');
              }

              function resumeTimer() {
                  timerPaused = false;
                  timerEndTime = Date.now() + (timerTime * 1000);

                  timerInterval = setInterval(() => {
                      const remaining = Math.max(0, Math.ceil((timerEndTime - Date.now()) / 1000));
                      timerTime = remaining;
                      updateTimerDisplay();

                      if (remaining === 0) {
                          timerFinished();
                      }
                  }, 100);

                  timerPauseBtn.textContent = 'Pause';
                  timerPauseBtn.classList.remove('start');
                  timerPauseBtn.classList.add('pause');
              }

              function cancelTimer() {
                  clearInterval(timerInterval);
                  timerRunning = false;
                  timerPaused = false;
                  timerTime = 0;

                  timerSetup.style.display = 'block';
                  timerRunningDiv.style.display = 'none';
              }

              timerStartBtn.addEventListener('click', () => {
                  const hours = getPickerValue(hourPicker);
                  const minutes = getPickerValue(minutePicker);
                  const seconds = getPickerValue(secondPicker);
                  const totalSeconds = hours * 3600 + minutes * 60 + seconds;

                  if (totalSeconds > 0) {
                      startTimer(totalSeconds);
                  }
              });

              timerPauseBtn.addEventListener('click', () => {
                  if (timerPaused) {
                      resumeTimer();
                  } else if (timerRunning) {
                      pauseTimer();
                  } else {
                      // Timer finished, restart
                      const hours = getPickerValue(hourPicker);
                      const minutes = getPickerValue(minutePicker);
                      const seconds = getPickerValue(secondPicker);
                      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
                      if (totalSeconds > 0) {
                          startTimer(totalSeconds);
                      }
                  }
              });

              timerCancelBtn2.addEventListener('click', cancelTimer);

              // Quick timers
              document.querySelectorAll('.quick-timer-btn').forEach(btn => {
                  btn.addEventListener('click', () => {
                      const seconds = parseInt(btn.dataset.seconds);
                      startTimer(seconds);
                  });
              });

              // Initialize timer pickers with default values
              setTimeout(() => {
                  setPickerValue(hourPicker, 0);
                  setPickerValue(minutePicker, 5);
                  setPickerValue(secondPicker, 0);
              }, 100);
          </script>
      </body>
      </html>
    main.go: "package main\n\nimport (\n\t\"embed\"\n\t\"log\"\n\t\"net/http\"\n)\n\n//go:embed
      index.html\nvar content embed.FS\n\nfunc main() {\n\thttp.HandleFunc(\"/\",
      handleIndex)\n\thttp.HandleFunc(\"/health\", handleHealth)\n\n\tlog.Println(\"Clock
      App listening on :30007\")\n\tlog.Fatal(http.ListenAndServe(\":30007\", nil))\n}\n\nfunc
      handleIndex(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\"
      {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\tdata, _ := content.ReadFile(\"index.html\")\n\tw.Header().Set(\"Content-Type\",
      \"text/html\")\n\tw.Write(data)\n}\n\nfunc handleHealth(w http.ResponseWriter,
      r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"text/plain\")\n\tw.Write([]byte(\"ok\"))\n}\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM golang:1.21-alpine AS builder\nWORKDIR /app\nCOPY go.mod ./\nCOPY main.go .\nCOPY index.html .\nRUN go mod tidy\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -o clock-app .\n\nFROM alpine:latest\nRUN apk add --no-cache ca-certificates tzdata\nWORKDIR /app\nCOPY --from=builder /app/clock-app .\nCOPY --from=builder /app/index.html .\nEXPOSE 30007\nCMD [\"./clock-app\"]\n","go.mod":"module clock-app\n\ngo 1.21\n","index.html":"\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\"\u003e\n    \u003ctitle\u003eClock\u003c/title\u003e\n    \u003cstyle\u003e\n        /* Catppuccin Mocha Theme */\n        :root {\n            --ctp-base: #1e1e2e;\n            --ctp-mantle: #181825;\n            --ctp-crust: #11111b;\n            --ctp-surface0: #313244;\n            --ctp-surface1: #45475a;\n            --ctp-surface2: #585b70;\n            --ctp-overlay0: #6c7086;\n            --ctp-overlay1: #7f849c;\n            --ctp-overlay2: #9399b2;\n            --ctp-subtext0: #a6adc8;\n            --ctp-subtext1: #bac2de;\n            --ctp-text: #cdd6f4;\n            --ctp-lavender: #b4befe;\n            --ctp-blue: #89b4fa;\n            --ctp-sapphire: #74c7ec;\n            --ctp-sky: #89dceb;\n            --ctp-teal: #94e2d5;\n            --ctp-green: #a6e3a1;\n            --ctp-yellow: #f9e2af;\n            --ctp-peach: #fab387;\n            --ctp-maroon: #eba0ac;\n            --ctp-red: #f38ba8;\n            --ctp-mauve: #cba6f7;\n            --ctp-pink: #f5c2e7;\n            --ctp-flamingo: #f2cdcd;\n            --ctp-rosewater: #f5e0dc;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            -webkit-tap-highlight-color: transparent;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;\n            background: var(--ctp-base);\n            min-height: 100vh;\n            color: var(--ctp-text);\n        }\n\n        .app-container {\n            max-width: 420px;\n            margin: 0 auto;\n            min-height: 100vh;\n            display: flex;\n            flex-direction: column;\n        }\n\n        /* Tab Navigation */\n        .tab-nav {\n            display: flex;\n            background: var(--ctp-crust);\n            border-top: 1px solid var(--ctp-surface0);\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            z-index: 100;\n        }\n\n        .tab-nav-inner {\n            display: flex;\n            max-width: 420px;\n            margin: 0 auto;\n            width: 100%;\n        }\n\n        .tab-btn {\n            flex: 1;\n            background: none;\n            border: none;\n            padding: 10px 8px 20px;\n            color: var(--ctp-overlay0);\n            cursor: pointer;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 4px;\n            transition: color 0.2s;\n        }\n\n        .tab-btn.active {\n            color: var(--ctp-mauve);\n        }\n\n        .tab-btn svg {\n            width: 24px;\n            height: 24px;\n        }\n\n        .tab-btn span {\n            font-size: 10px;\n            font-weight: 500;\n        }\n\n        /* Tab Content */\n        .tab-content {\n            display: none;\n            flex: 1;\n            padding: 20px;\n            padding-bottom: 100px;\n            overflow-y: auto;\n        }\n\n        .tab-content.active {\n            display: block;\n        }\n\n        .tab-header {\n            font-size: 34px;\n            font-weight: 700;\n            margin-bottom: 20px;\n            color: var(--ctp-text);\n        }\n\n        /* World Clock */\n        .world-clock-list {\n            display: flex;\n            flex-direction: column;\n            gap: 1px;\n            background: var(--ctp-surface0);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n\n        .clock-item {\n            background: var(--ctp-mantle);\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .clock-item:first-child {\n            border-radius: 12px 12px 0 0;\n        }\n\n        .clock-item:last-child {\n            border-radius: 0 0 12px 12px;\n        }\n\n        .clock-item:only-child {\n            border-radius: 12px;\n        }\n\n        .clock-info {\n            display: flex;\n            flex-direction: column;\n            gap: 2px;\n        }\n\n        .clock-offset {\n            font-size: 14px;\n            color: var(--ctp-overlay1);\n        }\n\n        .clock-city {\n            font-size: 18px;\n            font-weight: 500;\n            color: var(--ctp-text);\n        }\n\n        .clock-time-display {\n            display: flex;\n            align-items: baseline;\n            gap: 4px;\n        }\n\n        .clock-time {\n            font-size: 42px;\n            font-weight: 300;\n            color: var(--ctp-text);\n            font-variant-numeric: tabular-nums;\n        }\n\n        .clock-period {\n            font-size: 24px;\n            font-weight: 300;\n            color: var(--ctp-overlay1);\n        }\n\n        .add-clock-btn {\n            margin-top: 16px;\n            width: 100%;\n            padding: 14px;\n            background: var(--ctp-surface0);\n            border: none;\n            border-radius: 12px;\n            color: var(--ctp-mauve);\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            transition: background 0.2s;\n        }\n\n        .add-clock-btn:hover {\n            background: var(--ctp-surface1);\n        }\n\n        /* Alarm */\n        .alarm-list {\n            display: flex;\n            flex-direction: column;\n            gap: 1px;\n            background: var(--ctp-surface0);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n\n        .alarm-item {\n            background: var(--ctp-mantle);\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .alarm-item:first-child {\n            border-radius: 12px 12px 0 0;\n        }\n\n        .alarm-item:last-child {\n            border-radius: 0 0 12px 12px;\n        }\n\n        .alarm-item:only-child {\n            border-radius: 12px;\n        }\n\n        .alarm-item.disabled .alarm-time,\n        .alarm-item.disabled .alarm-label {\n            color: var(--ctp-overlay0);\n        }\n\n        .alarm-info {\n            display: flex;\n            flex-direction: column;\n            gap: 2px;\n        }\n\n        .alarm-time {\n            font-size: 48px;\n            font-weight: 300;\n            color: var(--ctp-text);\n            font-variant-numeric: tabular-nums;\n        }\n\n        .alarm-label {\n            font-size: 14px;\n            color: var(--ctp-overlay1);\n        }\n\n        /* Toggle Switch */\n        .toggle {\n            position: relative;\n            width: 51px;\n            height: 31px;\n            background: var(--ctp-surface1);\n            border-radius: 16px;\n            cursor: pointer;\n            transition: background 0.3s;\n        }\n\n        .toggle.active {\n            background: var(--ctp-green);\n        }\n\n        .toggle::after {\n            content: '';\n            position: absolute;\n            top: 2px;\n            left: 2px;\n            width: 27px;\n            height: 27px;\n            background: white;\n            border-radius: 50%;\n            transition: transform 0.3s;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        }\n\n        .toggle.active::after {\n            transform: translateX(20px);\n        }\n\n        .add-alarm-btn {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: none;\n            border: none;\n            color: var(--ctp-mauve);\n            font-size: 32px;\n            cursor: pointer;\n            width: 44px;\n            height: 44px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .no-alarms {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--ctp-overlay0);\n        }\n\n        /* Stopwatch */\n        .stopwatch-display {\n            text-align: center;\n            padding: 40px 0;\n        }\n\n        .stopwatch-time {\n            font-size: 72px;\n            font-weight: 200;\n            font-variant-numeric: tabular-nums;\n            color: var(--ctp-text);\n            letter-spacing: -2px;\n        }\n\n        .stopwatch-ms {\n            font-size: 48px;\n            color: var(--ctp-overlay1);\n        }\n\n        .stopwatch-controls {\n            display: flex;\n            justify-content: center;\n            gap: 40px;\n            margin-top: 30px;\n        }\n\n        .stopwatch-btn {\n            width: 80px;\n            height: 80px;\n            border-radius: 50%;\n            border: 2px solid;\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.2s;\n        }\n\n        .stopwatch-btn.lap {\n            background: var(--ctp-surface0);\n            border-color: var(--ctp-surface1);\n            color: var(--ctp-text);\n        }\n\n        .stopwatch-btn.lap:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        .stopwatch-btn.lap:not(:disabled):hover {\n            background: var(--ctp-surface1);\n        }\n\n        .stopwatch-btn.start {\n            background: rgba(166, 227, 161, 0.2);\n            border-color: var(--ctp-green);\n            color: var(--ctp-green);\n        }\n\n        .stopwatch-btn.start:hover {\n            background: rgba(166, 227, 161, 0.3);\n        }\n\n        .stopwatch-btn.stop {\n            background: rgba(243, 139, 168, 0.2);\n            border-color: var(--ctp-red);\n            color: var(--ctp-red);\n        }\n\n        .stopwatch-btn.stop:hover {\n            background: rgba(243, 139, 168, 0.3);\n        }\n\n        .lap-list {\n            margin-top: 30px;\n            border-top: 1px solid var(--ctp-surface0);\n        }\n\n        .lap-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 12px 0;\n            border-bottom: 1px solid var(--ctp-surface0);\n            font-variant-numeric: tabular-nums;\n        }\n\n        .lap-item.best {\n            color: var(--ctp-green);\n        }\n\n        .lap-item.worst {\n            color: var(--ctp-red);\n        }\n\n        .lap-number {\n            color: var(--ctp-overlay1);\n        }\n\n        /* Timer */\n        .timer-display {\n            text-align: center;\n            padding: 40px 0;\n        }\n\n        .timer-time {\n            font-size: 72px;\n            font-weight: 200;\n            font-variant-numeric: tabular-nums;\n            color: var(--ctp-text);\n            letter-spacing: -2px;\n        }\n\n        .timer-controls {\n            display: flex;\n            justify-content: center;\n            gap: 40px;\n            margin-top: 30px;\n        }\n\n        .timer-btn {\n            width: 80px;\n            height: 80px;\n            border-radius: 50%;\n            border: 2px solid;\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.2s;\n        }\n\n        .timer-btn.cancel {\n            background: var(--ctp-surface0);\n            border-color: var(--ctp-surface1);\n            color: var(--ctp-text);\n        }\n\n        .timer-btn.cancel:hover {\n            background: var(--ctp-surface1);\n        }\n\n        .timer-btn.start {\n            background: rgba(166, 227, 161, 0.2);\n            border-color: var(--ctp-green);\n            color: var(--ctp-green);\n        }\n\n        .timer-btn.start:hover {\n            background: rgba(166, 227, 161, 0.3);\n        }\n\n        .timer-btn.pause {\n            background: rgba(249, 226, 175, 0.2);\n            border-color: var(--ctp-yellow);\n            color: var(--ctp-yellow);\n        }\n\n        .timer-btn.pause:hover {\n            background: rgba(249, 226, 175, 0.3);\n        }\n\n        /* Timer Picker */\n        .timer-picker {\n            display: flex;\n            justify-content: center;\n            gap: 10px;\n            padding: 40px 0;\n        }\n\n        .picker-column {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n\n        .picker-label {\n            font-size: 12px;\n            color: var(--ctp-overlay1);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n        }\n\n        .picker-scroll {\n            height: 180px;\n            overflow-y: auto;\n            width: 70px;\n            scroll-snap-type: y mandatory;\n            scrollbar-width: none;\n            position: relative;\n        }\n\n        .picker-scroll::-webkit-scrollbar {\n            display: none;\n        }\n\n        .picker-scroll::before,\n        .picker-scroll::after {\n            content: '';\n            display: block;\n            height: 72px;\n        }\n\n        .picker-option {\n            height: 36px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            color: var(--ctp-overlay0);\n            scroll-snap-align: center;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .picker-option.selected {\n            color: var(--ctp-text);\n            font-size: 28px;\n            font-weight: 500;\n        }\n\n        .picker-highlight {\n            position: absolute;\n            top: 50%;\n            left: 0;\n            right: 0;\n            height: 36px;\n            transform: translateY(-50%);\n            border-top: 1px solid var(--ctp-surface1);\n            border-bottom: 1px solid var(--ctp-surface1);\n            pointer-events: none;\n        }\n\n        /* Quick Timers */\n        .quick-timers {\n            margin-top: 20px;\n        }\n\n        .quick-timers-title {\n            font-size: 14px;\n            color: var(--ctp-overlay1);\n            margin-bottom: 12px;\n            text-transform: uppercase;\n        }\n\n        .quick-timer-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 8px;\n        }\n\n        .quick-timer-btn {\n            padding: 12px 8px;\n            background: var(--ctp-surface0);\n            border: none;\n            border-radius: 10px;\n            color: var(--ctp-text);\n            font-size: 14px;\n            cursor: pointer;\n            transition: background 0.2s;\n        }\n\n        .quick-timer-btn:hover {\n            background: var(--ctp-surface1);\n        }\n\n        /* Modal */\n        .modal-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0,0,0,0.6);\n            z-index: 200;\n            align-items: flex-end;\n            justify-content: center;\n        }\n\n        .modal-overlay.active {\n            display: flex;\n        }\n\n        .modal {\n            background: var(--ctp-mantle);\n            border-radius: 16px 16px 0 0;\n            width: 100%;\n            max-width: 420px;\n            max-height: 80vh;\n            overflow-y: auto;\n        }\n\n        .modal-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 16px;\n            border-bottom: 1px solid var(--ctp-surface0);\n        }\n\n        .modal-title {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .modal-btn {\n            background: none;\n            border: none;\n            color: var(--ctp-mauve);\n            font-size: 16px;\n            cursor: pointer;\n            padding: 8px;\n        }\n\n        .modal-body {\n            padding: 16px;\n        }\n\n        .timezone-search {\n            width: 100%;\n            padding: 12px 16px;\n            background: var(--ctp-surface0);\n            border: none;\n            border-radius: 10px;\n            color: var(--ctp-text);\n            font-size: 16px;\n            margin-bottom: 16px;\n        }\n\n        .timezone-search::placeholder {\n            color: var(--ctp-overlay0);\n        }\n\n        .timezone-list {\n            max-height: 300px;\n            overflow-y: auto;\n        }\n\n        .timezone-item {\n            padding: 14px;\n            cursor: pointer;\n            border-radius: 8px;\n            transition: background 0.2s;\n        }\n\n        .timezone-item:hover {\n            background: var(--ctp-surface0);\n        }\n\n        .timezone-name {\n            font-size: 16px;\n            color: var(--ctp-text);\n        }\n\n        .timezone-offset-text {\n            font-size: 13px;\n            color: var(--ctp-overlay1);\n            margin-top: 2px;\n        }\n\n        /* Alarm Modal */\n        .alarm-time-picker {\n            display: flex;\n            justify-content: center;\n            gap: 10px;\n            padding: 20px 0;\n        }\n\n        .alarm-input-group {\n            margin-top: 16px;\n        }\n\n        .alarm-input-label {\n            font-size: 13px;\n            color: var(--ctp-overlay1);\n            margin-bottom: 8px;\n            display: block;\n        }\n\n        .alarm-input {\n            width: 100%;\n            padding: 12px 16px;\n            background: var(--ctp-surface0);\n            border: none;\n            border-radius: 10px;\n            color: var(--ctp-text);\n            font-size: 16px;\n        }\n\n        .alarm-input::placeholder {\n            color: var(--ctp-overlay0);\n        }\n\n        /* Alarm Ringing */\n        .alarm-ringing {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: var(--ctp-base);\n            z-index: 300;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .alarm-ringing.active {\n            display: flex;\n        }\n\n        .alarm-ringing-time {\n            font-size: 80px;\n            font-weight: 200;\n            color: var(--ctp-text);\n            margin-bottom: 10px;\n        }\n\n        .alarm-ringing-label {\n            font-size: 24px;\n            color: var(--ctp-overlay1);\n            margin-bottom: 60px;\n        }\n\n        .alarm-stop-btn {\n            width: 120px;\n            height: 120px;\n            border-radius: 50%;\n            background: var(--ctp-red);\n            border: none;\n            color: white;\n            font-size: 18px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: transform 0.2s;\n        }\n\n        .alarm-stop-btn:hover {\n            transform: scale(1.05);\n        }\n\n        .alarm-snooze-btn {\n            margin-top: 30px;\n            padding: 14px 40px;\n            background: var(--ctp-surface0);\n            border: none;\n            border-radius: 30px;\n            color: var(--ctp-text);\n            font-size: 16px;\n            cursor: pointer;\n        }\n\n        /* Delete button */\n        .delete-btn {\n            background: none;\n            border: none;\n            color: var(--ctp-red);\n            cursor: pointer;\n            padding: 8px;\n            margin-left: 12px;\n            opacity: 0.7;\n            transition: opacity 0.2s;\n        }\n\n        .delete-btn:hover {\n            opacity: 1;\n        }\n\n        /* Timer finished animation */\n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.5; }\n        }\n\n        .timer-finished .timer-time {\n            color: var(--ctp-red);\n            animation: pulse 1s infinite;\n        }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003cdiv class=\"app-container\"\u003e\n        \u003c!-- World Clock Tab --\u003e\n        \u003cdiv class=\"tab-content active\" id=\"worldClockTab\"\u003e\n            \u003ch1 class=\"tab-header\"\u003eWorld Clock\u003c/h1\u003e\n            \u003cdiv class=\"world-clock-list\" id=\"worldClockList\"\u003e\u003c/div\u003e\n            \u003cbutton class=\"add-clock-btn\" id=\"addClockBtn\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cline x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"\u003e\u003c/line\u003e\n                    \u003cline x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"\u003e\u003c/line\u003e\n                \u003c/svg\u003e\n                Add City\n            \u003c/button\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Alarm Tab --\u003e\n        \u003cdiv class=\"tab-content\" id=\"alarmTab\"\u003e\n            \u003ch1 class=\"tab-header\"\u003eAlarms\u003c/h1\u003e\n            \u003cbutton class=\"add-alarm-btn\" id=\"addAlarmBtn\"\u003e+\u003c/button\u003e\n            \u003cdiv class=\"alarm-list\" id=\"alarmList\"\u003e\n                \u003cdiv class=\"no-alarms\"\u003eNo Alarms\u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Stopwatch Tab --\u003e\n        \u003cdiv class=\"tab-content\" id=\"stopwatchTab\"\u003e\n            \u003ch1 class=\"tab-header\"\u003eStopwatch\u003c/h1\u003e\n            \u003cdiv class=\"stopwatch-display\"\u003e\n                \u003cspan class=\"stopwatch-time\" id=\"stopwatchTime\"\u003e00:00\u003c/span\u003e\u003cspan class=\"stopwatch-ms\" id=\"stopwatchMs\"\u003e.00\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"stopwatch-controls\"\u003e\n                \u003cbutton class=\"stopwatch-btn lap\" id=\"lapResetBtn\" disabled\u003eLap\u003c/button\u003e\n                \u003cbutton class=\"stopwatch-btn start\" id=\"startStopBtn\"\u003eStart\u003c/button\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"lap-list\" id=\"lapList\"\u003e\u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Timer Tab --\u003e\n        \u003cdiv class=\"tab-content\" id=\"timerTab\"\u003e\n            \u003ch1 class=\"tab-header\"\u003eTimer\u003c/h1\u003e\n            \u003cdiv id=\"timerSetup\"\u003e\n                \u003cdiv class=\"timer-picker\"\u003e\n                    \u003cdiv class=\"picker-column\"\u003e\n                        \u003cspan class=\"picker-label\"\u003eHours\u003c/span\u003e\n                        \u003cdiv class=\"picker-scroll\" id=\"hourPicker\"\u003e\n                            \u003cdiv class=\"picker-highlight\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"picker-column\"\u003e\n                        \u003cspan class=\"picker-label\"\u003eMin\u003c/span\u003e\n                        \u003cdiv class=\"picker-scroll\" id=\"minutePicker\"\u003e\n                            \u003cdiv class=\"picker-highlight\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"picker-column\"\u003e\n                        \u003cspan class=\"picker-label\"\u003eSec\u003c/span\u003e\n                        \u003cdiv class=\"picker-scroll\" id=\"secondPicker\"\u003e\n                            \u003cdiv class=\"picker-highlight\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"timer-controls\"\u003e\n                    \u003cbutton class=\"timer-btn cancel\" id=\"timerCancelBtn\" style=\"visibility: hidden;\"\u003eCancel\u003c/button\u003e\n                    \u003cbutton class=\"timer-btn start\" id=\"timerStartBtn\"\u003eStart\u003c/button\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"quick-timers\"\u003e\n                    \u003cdiv class=\"quick-timers-title\"\u003eQuick Timers\u003c/div\u003e\n                    \u003cdiv class=\"quick-timer-grid\"\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"60\"\u003e1 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"180\"\u003e3 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"300\"\u003e5 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"600\"\u003e10 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"900\"\u003e15 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"1200\"\u003e20 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"1800\"\u003e30 min\u003c/button\u003e\n                        \u003cbutton class=\"quick-timer-btn\" data-seconds=\"3600\"\u003e1 hr\u003c/button\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id=\"timerRunning\" style=\"display: none;\"\u003e\n                \u003cdiv class=\"timer-display\"\u003e\n                    \u003cspan class=\"timer-time\" id=\"timerTime\"\u003e00:00:00\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"timer-controls\"\u003e\n                    \u003cbutton class=\"timer-btn cancel\" id=\"timerCancelBtn2\"\u003eCancel\u003c/button\u003e\n                    \u003cbutton class=\"timer-btn pause\" id=\"timerPauseBtn\"\u003ePause\u003c/button\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Tab Navigation --\u003e\n        \u003cnav class=\"tab-nav\"\u003e\n            \u003cdiv class=\"tab-nav-inner\"\u003e\n                \u003cbutton class=\"tab-btn active\" data-tab=\"worldClockTab\"\u003e\n                    \u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                        \u003ccircle cx=\"12\" cy=\"12\" r=\"10\"\u003e\u003c/circle\u003e\n                        \u003cline x1=\"12\" y1=\"6\" x2=\"12\" y2=\"12\"\u003e\u003c/line\u003e\n                        \u003cline x1=\"12\" y1=\"12\" x2=\"16\" y2=\"14\"\u003e\u003c/line\u003e\n                    \u003c/svg\u003e\n                    \u003cspan\u003eWorld Clock\u003c/span\u003e\n                \u003c/button\u003e\n                \u003cbutton class=\"tab-btn\" data-tab=\"alarmTab\"\u003e\n                    \u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                        \u003ccircle cx=\"12\" cy=\"13\" r=\"8\"\u003e\u003c/circle\u003e\n                        \u003cpath d=\"M12 9v4l2 2\"\u003e\u003c/path\u003e\n                        \u003cpath d=\"M5 3L2 6\"\u003e\u003c/path\u003e\n                        \u003cpath d=\"M22 6l-3-3\"\u003e\u003c/path\u003e\n                    \u003c/svg\u003e\n                    \u003cspan\u003eAlarm\u003c/span\u003e\n                \u003c/button\u003e\n                \u003cbutton class=\"tab-btn\" data-tab=\"stopwatchTab\"\u003e\n                    \u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                        \u003ccircle cx=\"12\" cy=\"13\" r=\"8\"\u003e\u003c/circle\u003e\n                        \u003cpath d=\"M12 9v4\"\u003e\u003c/path\u003e\n                        \u003cpath d=\"M10 2h4\"\u003e\u003c/path\u003e\n                    \u003c/svg\u003e\n                    \u003cspan\u003eStopwatch\u003c/span\u003e\n                \u003c/button\u003e\n                \u003cbutton class=\"tab-btn\" data-tab=\"timerTab\"\u003e\n                    \u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                        \u003cpath d=\"M12 2v4\"\u003e\u003c/path\u003e\n                        \u003cpath d=\"M12 18v4\"\u003e\u003c/path\u003e\n                        \u003ccircle cx=\"12\" cy=\"12\" r=\"8\"\u003e\u003c/circle\u003e\n                        \u003cpath d=\"M12 8v4l2 2\"\u003e\u003c/path\u003e\n                    \u003c/svg\u003e\n                    \u003cspan\u003eTimer\u003c/span\u003e\n                \u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/nav\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Timezone Modal --\u003e\n    \u003cdiv class=\"modal-overlay\" id=\"timezoneModal\"\u003e\n        \u003cdiv class=\"modal\"\u003e\n            \u003cdiv class=\"modal-header\"\u003e\n                \u003cbutton class=\"modal-btn\" id=\"closeTimezoneModal\"\u003eCancel\u003c/button\u003e\n                \u003cspan class=\"modal-title\"\u003eAdd City\u003c/span\u003e\n                \u003cdiv style=\"width: 60px;\"\u003e\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"modal-body\"\u003e\n                \u003cinput type=\"text\" class=\"timezone-search\" id=\"timezoneSearch\" placeholder=\"Search cities...\"\u003e\n                \u003cdiv class=\"timezone-list\" id=\"timezoneList\"\u003e\u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Alarm Modal --\u003e\n    \u003cdiv class=\"modal-overlay\" id=\"alarmModal\"\u003e\n        \u003cdiv class=\"modal\"\u003e\n            \u003cdiv class=\"modal-header\"\u003e\n                \u003cbutton class=\"modal-btn\" id=\"closeAlarmModal\"\u003eCancel\u003c/button\u003e\n                \u003cspan class=\"modal-title\"\u003eAdd Alarm\u003c/span\u003e\n                \u003cbutton class=\"modal-btn\" id=\"saveAlarmBtn\"\u003eSave\u003c/button\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"modal-body\"\u003e\n                \u003cdiv class=\"alarm-time-picker\"\u003e\n                    \u003cdiv class=\"picker-column\"\u003e\n                        \u003cspan class=\"picker-label\"\u003eHour\u003c/span\u003e\n                        \u003cdiv class=\"picker-scroll\" id=\"alarmHourPicker\"\u003e\n                            \u003cdiv class=\"picker-highlight\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"picker-column\"\u003e\n                        \u003cspan class=\"picker-label\"\u003eMin\u003c/span\u003e\n                        \u003cdiv class=\"picker-scroll\" id=\"alarmMinutePicker\"\u003e\n                            \u003cdiv class=\"picker-highlight\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"alarm-input-group\"\u003e\n                    \u003clabel class=\"alarm-input-label\"\u003eLabel\u003c/label\u003e\n                    \u003cinput type=\"text\" class=\"alarm-input\" id=\"alarmLabelInput\" placeholder=\"Alarm\"\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Alarm Ringing Screen --\u003e\n    \u003cdiv class=\"alarm-ringing\" id=\"alarmRinging\"\u003e\n        \u003cdiv class=\"alarm-ringing-time\" id=\"ringingTime\"\u003e07:00\u003c/div\u003e\n        \u003cdiv class=\"alarm-ringing-label\" id=\"ringingLabel\"\u003eAlarm\u003c/div\u003e\n        \u003cbutton class=\"alarm-stop-btn\" id=\"stopAlarmBtn\"\u003eStop\u003c/button\u003e\n        \u003cbutton class=\"alarm-snooze-btn\" id=\"snoozeAlarmBtn\"\u003eSnooze (5 min)\u003c/button\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n        // =====================\n        // Tab Navigation\n        // =====================\n        const tabBtns = document.querySelectorAll('.tab-btn');\n        const tabContents = document.querySelectorAll('.tab-content');\n\n        tabBtns.forEach(btn =\u003e {\n            btn.addEventListener('click', () =\u003e {\n                const tabId = btn.dataset.tab;\n\n                tabBtns.forEach(b =\u003e b.classList.remove('active'));\n                tabContents.forEach(c =\u003e c.classList.remove('active'));\n\n                btn.classList.add('active');\n                document.getElementById(tabId).classList.add('active');\n            });\n        });\n\n        // =====================\n        // World Clock\n        // =====================\n        const timezones = [\n            { city: 'New York', timezone: 'America/New_York', country: 'USA' },\n            { city: 'Los Angeles', timezone: 'America/Los_Angeles', country: 'USA' },\n            { city: 'Chicago', timezone: 'America/Chicago', country: 'USA' },\n            { city: 'London', timezone: 'Europe/London', country: 'UK' },\n            { city: 'Paris', timezone: 'Europe/Paris', country: 'France' },\n            { city: 'Berlin', timezone: 'Europe/Berlin', country: 'Germany' },\n            { city: 'Tokyo', timezone: 'Asia/Tokyo', country: 'Japan' },\n            { city: 'Sydney', timezone: 'Australia/Sydney', country: 'Australia' },\n            { city: 'Dubai', timezone: 'Asia/Dubai', country: 'UAE' },\n            { city: 'Singapore', timezone: 'Asia/Singapore', country: 'Singapore' },\n            { city: 'Hong Kong', timezone: 'Asia/Hong_Kong', country: 'China' },\n            { city: 'Mumbai', timezone: 'Asia/Kolkata', country: 'India' },\n            { city: 'Moscow', timezone: 'Europe/Moscow', country: 'Russia' },\n            { city: 'Amsterdam', timezone: 'Europe/Amsterdam', country: 'Netherlands' },\n            { city: 'Toronto', timezone: 'America/Toronto', country: 'Canada' },\n            { city: 'Vancouver', timezone: 'America/Vancouver', country: 'Canada' },\n            { city: 'Seoul', timezone: 'Asia/Seoul', country: 'South Korea' },\n            { city: 'Beijing', timezone: 'Asia/Shanghai', country: 'China' },\n            { city: 'Bangkok', timezone: 'Asia/Bangkok', country: 'Thailand' },\n            { city: 'Jakarta', timezone: 'Asia/Jakarta', country: 'Indonesia' },\n            { city: 'Cairo', timezone: 'Africa/Cairo', country: 'Egypt' },\n            { city: 'Johannesburg', timezone: 'Africa/Johannesburg', country: 'South Africa' },\n            { city: 'Sao Paulo', timezone: 'America/Sao_Paulo', country: 'Brazil' },\n            { city: 'Mexico City', timezone: 'America/Mexico_City', country: 'Mexico' },\n            { city: 'Auckland', timezone: 'Pacific/Auckland', country: 'New Zealand' },\n            { city: 'Honolulu', timezone: 'Pacific/Honolulu', country: 'USA' },\n            { city: 'Anchorage', timezone: 'America/Anchorage', country: 'USA' },\n            { city: 'Denver', timezone: 'America/Denver', country: 'USA' },\n            { city: 'Phoenix', timezone: 'America/Phoenix', country: 'USA' },\n            { city: 'Miami', timezone: 'America/New_York', country: 'USA' },\n        ];\n\n        let worldClocks = JSON.parse(localStorage.getItem('worldClocks') || '[]');\n        const worldClockList = document.getElementById('worldClockList');\n\n        function getTimezoneOffset(tz) {\n            const now = new Date();\n            const localOffset = now.getTimezoneOffset();\n            const tzDate = new Date(now.toLocaleString('en-US', { timeZone: tz }));\n            const tzOffset = (now - tzDate) / 60000 + localOffset;\n            const hours = Math.floor(Math.abs(tzOffset) / 60);\n            const mins = Math.abs(tzOffset) % 60;\n            const sign = tzOffset \u003c= 0 ? '+' : '-';\n\n            if (tzOffset === 0) return 'Same time';\n\n            const diffHours = Math.abs(Math.round(tzOffset / 60));\n            const direction = tzOffset \u003e 0 ? 'behind' : 'ahead';\n            return diffHours === 1 ? `1HR ${direction}` : `${diffHours}HRS ${direction}`;\n        }\n\n        function formatTime(date, tz) {\n            return date.toLocaleTimeString('en-US', {\n                timeZone: tz,\n                hour: 'numeric',\n                minute: '2-digit',\n                hour12: true\n            });\n        }\n\n        function renderWorldClocks() {\n            if (worldClocks.length === 0) {\n                worldClockList.innerHTML = '\u003cdiv class=\"clock-item\"\u003e\u003cdiv class=\"clock-info\"\u003e\u003cdiv class=\"clock-city\"\u003eNo cities added\u003c/div\u003e\u003cdiv class=\"clock-offset\"\u003eTap \"Add City\" to get started\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e';\n                return;\n            }\n\n            worldClockList.innerHTML = worldClocks.map((clock, index) =\u003e {\n                const now = new Date();\n                const timeStr = formatTime(now, clock.timezone);\n                const [time, period] = timeStr.split(' ');\n                const offset = getTimezoneOffset(clock.timezone);\n\n                return `\n                    \u003cdiv class=\"clock-item\"\u003e\n                        \u003cdiv class=\"clock-info\"\u003e\n                            \u003cdiv class=\"clock-offset\"\u003e${offset}\u003c/div\u003e\n                            \u003cdiv class=\"clock-city\"\u003e${clock.city}\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv style=\"display: flex; align-items: center;\"\u003e\n                            \u003cdiv class=\"clock-time-display\"\u003e\n                                \u003cspan class=\"clock-time\"\u003e${time}\u003c/span\u003e\n                                \u003cspan class=\"clock-period\"\u003e${period}\u003c/span\u003e\n                            \u003c/div\u003e\n                            \u003cbutton class=\"delete-btn\" onclick=\"deleteWorldClock(${index})\"\u003e\n                                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                                    \u003cpolyline points=\"3 6 5 6 21 6\"\u003e\u003c/polyline\u003e\n                                    \u003cpath d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\u003e\u003c/path\u003e\n                                \u003c/svg\u003e\n                            \u003c/button\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                `;\n            }).join('');\n        }\n\n        function deleteWorldClock(index) {\n            worldClocks.splice(index, 1);\n            localStorage.setItem('worldClocks', JSON.stringify(worldClocks));\n            renderWorldClocks();\n        }\n\n        // Update clocks every second\n        setInterval(renderWorldClocks, 1000);\n        renderWorldClocks();\n\n        // Timezone Modal\n        const timezoneModal = document.getElementById('timezoneModal');\n        const timezoneSearch = document.getElementById('timezoneSearch');\n        const timezoneList = document.getElementById('timezoneList');\n\n        document.getElementById('addClockBtn').addEventListener('click', () =\u003e {\n            timezoneModal.classList.add('active');\n            timezoneSearch.value = '';\n            renderTimezoneList('');\n        });\n\n        document.getElementById('closeTimezoneModal').addEventListener('click', () =\u003e {\n            timezoneModal.classList.remove('active');\n        });\n\n        timezoneSearch.addEventListener('input', (e) =\u003e {\n            renderTimezoneList(e.target.value);\n        });\n\n        function renderTimezoneList(search) {\n            const filtered = timezones.filter(tz =\u003e\n                tz.city.toLowerCase().includes(search.toLowerCase()) ||\n                tz.country.toLowerCase().includes(search.toLowerCase())\n            );\n\n            timezoneList.innerHTML = filtered.map(tz =\u003e {\n                const now = new Date();\n                const timeStr = formatTime(now, tz.timezone);\n\n                return `\n                    \u003cdiv class=\"timezone-item\" data-city=\"${tz.city}\" data-timezone=\"${tz.timezone}\"\u003e\n                        \u003cdiv class=\"timezone-name\"\u003e${tz.city}, ${tz.country}\u003c/div\u003e\n                        \u003cdiv class=\"timezone-offset-text\"\u003e${timeStr}\u003c/div\u003e\n                    \u003c/div\u003e\n                `;\n            }).join('');\n\n            timezoneList.querySelectorAll('.timezone-item').forEach(item =\u003e {\n                item.addEventListener('click', () =\u003e {\n                    const city = item.dataset.city;\n                    const timezone = item.dataset.timezone;\n\n                    if (!worldClocks.find(c =\u003e c.timezone === timezone)) {\n                        worldClocks.push({ city, timezone });\n                        localStorage.setItem('worldClocks', JSON.stringify(worldClocks));\n                        renderWorldClocks();\n                    }\n\n                    timezoneModal.classList.remove('active');\n                });\n            });\n        }\n\n        // =====================\n        // Alarms\n        // =====================\n        let alarms = JSON.parse(localStorage.getItem('alarms') || '[]');\n        const alarmList = document.getElementById('alarmList');\n        let currentRingingAlarm = null;\n        let alarmAudio = null;\n\n        function renderAlarms() {\n            if (alarms.length === 0) {\n                alarmList.innerHTML = '\u003cdiv class=\"no-alarms\"\u003eNo Alarms\u003c/div\u003e';\n                return;\n            }\n\n            alarmList.innerHTML = alarms.map((alarm, index) =\u003e {\n                const hour = alarm.hour.toString().padStart(2, '0');\n                const minute = alarm.minute.toString().padStart(2, '0');\n\n                return `\n                    \u003cdiv class=\"alarm-item ${alarm.enabled ? '' : 'disabled'}\"\u003e\n                        \u003cdiv class=\"alarm-info\"\u003e\n                            \u003cdiv class=\"alarm-time\"\u003e${hour}:${minute}\u003c/div\u003e\n                            \u003cdiv class=\"alarm-label\"\u003e${alarm.label || 'Alarm'}\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv style=\"display: flex; align-items: center;\"\u003e\n                            \u003cdiv class=\"toggle ${alarm.enabled ? 'active' : ''}\" data-index=\"${index}\"\u003e\u003c/div\u003e\n                            \u003cbutton class=\"delete-btn\" onclick=\"deleteAlarm(${index})\"\u003e\n                                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                                    \u003cpolyline points=\"3 6 5 6 21 6\"\u003e\u003c/polyline\u003e\n                                    \u003cpath d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"\u003e\u003c/path\u003e\n                                \u003c/svg\u003e\n                            \u003c/button\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                `;\n            }).join('');\n\n            alarmList.querySelectorAll('.toggle').forEach(toggle =\u003e {\n                toggle.addEventListener('click', () =\u003e {\n                    const index = parseInt(toggle.dataset.index);\n                    alarms[index].enabled = !alarms[index].enabled;\n                    localStorage.setItem('alarms', JSON.stringify(alarms));\n                    renderAlarms();\n                });\n            });\n        }\n\n        function deleteAlarm(index) {\n            alarms.splice(index, 1);\n            localStorage.setItem('alarms', JSON.stringify(alarms));\n            renderAlarms();\n        }\n\n        renderAlarms();\n\n        // Alarm Modal\n        const alarmModal = document.getElementById('alarmModal');\n        const alarmHourPicker = document.getElementById('alarmHourPicker');\n        const alarmMinutePicker = document.getElementById('alarmMinutePicker');\n        const alarmLabelInput = document.getElementById('alarmLabelInput');\n\n        function initPicker(container, max, pad = true) {\n            const highlight = container.querySelector('.picker-highlight');\n            for (let i = 0; i \u003c max; i++) {\n                const option = document.createElement('div');\n                option.className = 'picker-option';\n                option.textContent = pad ? i.toString().padStart(2, '0') : i;\n                option.dataset.value = i;\n                container.insertBefore(option, highlight);\n            }\n        }\n\n        initPicker(alarmHourPicker, 24);\n        initPicker(alarmMinutePicker, 60);\n\n        function getPickerValue(container) {\n            const scrollTop = container.scrollTop;\n            const itemHeight = 36;\n            const index = Math.round(scrollTop / itemHeight);\n            return index;\n        }\n\n        function setPickerValue(container, value) {\n            const itemHeight = 36;\n            container.scrollTop = value * itemHeight;\n            updatePickerSelection(container);\n        }\n\n        function updatePickerSelection(container) {\n            const scrollTop = container.scrollTop;\n            const itemHeight = 36;\n            const selectedIndex = Math.round(scrollTop / itemHeight);\n\n            container.querySelectorAll('.picker-option').forEach((opt, i) =\u003e {\n                opt.classList.toggle('selected', i === selectedIndex);\n            });\n        }\n\n        [alarmHourPicker, alarmMinutePicker].forEach(picker =\u003e {\n            picker.addEventListener('scroll', () =\u003e updatePickerSelection(picker));\n        });\n\n        document.getElementById('addAlarmBtn').addEventListener('click', () =\u003e {\n            alarmModal.classList.add('active');\n            alarmLabelInput.value = '';\n            const now = new Date();\n            setTimeout(() =\u003e {\n                setPickerValue(alarmHourPicker, now.getHours());\n                setPickerValue(alarmMinutePicker, now.getMinutes());\n            }, 100);\n        });\n\n        document.getElementById('closeAlarmModal').addEventListener('click', () =\u003e {\n            alarmModal.classList.remove('active');\n        });\n\n        document.getElementById('saveAlarmBtn').addEventListener('click', () =\u003e {\n            const hour = getPickerValue(alarmHourPicker);\n            const minute = getPickerValue(alarmMinutePicker);\n            const label = alarmLabelInput.value || 'Alarm';\n\n            alarms.push({ hour, minute, label, enabled: true });\n            alarms.sort((a, b) =\u003e (a.hour * 60 + a.minute) - (b.hour * 60 + b.minute));\n            localStorage.setItem('alarms', JSON.stringify(alarms));\n            renderAlarms();\n            alarmModal.classList.remove('active');\n        });\n\n        // Check alarms every second\n        function checkAlarms() {\n            const now = new Date();\n            const currentHour = now.getHours();\n            const currentMinute = now.getMinutes();\n            const currentSecond = now.getSeconds();\n\n            if (currentSecond !== 0) return;\n\n            alarms.forEach(alarm =\u003e {\n                if (alarm.enabled \u0026\u0026 alarm.hour === currentHour \u0026\u0026 alarm.minute === currentMinute) {\n                    triggerAlarm(alarm);\n                }\n            });\n        }\n\n        function triggerAlarm(alarm) {\n            currentRingingAlarm = alarm;\n            document.getElementById('ringingTime').textContent =\n                `${alarm.hour.toString().padStart(2, '0')}:${alarm.minute.toString().padStart(2, '0')}`;\n            document.getElementById('ringingLabel').textContent = alarm.label || 'Alarm';\n            document.getElementById('alarmRinging').classList.add('active');\n\n            // Play alarm sound (using Web Audio API for a beep)\n            try {\n                const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n                const playBeep = () =\u003e {\n                    const oscillator = audioContext.createOscillator();\n                    const gainNode = audioContext.createGain();\n                    oscillator.connect(gainNode);\n                    gainNode.connect(audioContext.destination);\n                    oscillator.frequency.value = 880;\n                    oscillator.type = 'sine';\n                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);\n                    oscillator.start(audioContext.currentTime);\n                    oscillator.stop(audioContext.currentTime + 0.5);\n                };\n\n                playBeep();\n                alarmAudio = setInterval(playBeep, 1000);\n            } catch (e) {\n                console.log('Audio not available');\n            }\n        }\n\n        document.getElementById('stopAlarmBtn').addEventListener('click', () =\u003e {\n            document.getElementById('alarmRinging').classList.remove('active');\n            if (alarmAudio) {\n                clearInterval(alarmAudio);\n                alarmAudio = null;\n            }\n            currentRingingAlarm = null;\n        });\n\n        document.getElementById('snoozeAlarmBtn').addEventListener('click', () =\u003e {\n            document.getElementById('alarmRinging').classList.remove('active');\n            if (alarmAudio) {\n                clearInterval(alarmAudio);\n                alarmAudio = null;\n            }\n\n            // Snooze for 5 minutes\n            if (currentRingingAlarm) {\n                const snoozeTime = new Date();\n                snoozeTime.setMinutes(snoozeTime.getMinutes() + 5);\n\n                setTimeout(() =\u003e {\n                    if (currentRingingAlarm) {\n                        triggerAlarm(currentRingingAlarm);\n                    }\n                }, 5 * 60 * 1000);\n            }\n            currentRingingAlarm = null;\n        });\n\n        setInterval(checkAlarms, 1000);\n\n        // =====================\n        // Stopwatch\n        // =====================\n        let stopwatchRunning = false;\n        let stopwatchTime = 0;\n        let stopwatchInterval = null;\n        let laps = [];\n        let lastLapTime = 0;\n\n        const stopwatchTimeEl = document.getElementById('stopwatchTime');\n        const stopwatchMsEl = document.getElementById('stopwatchMs');\n        const startStopBtn = document.getElementById('startStopBtn');\n        const lapResetBtn = document.getElementById('lapResetBtn');\n        const lapListEl = document.getElementById('lapList');\n\n        function formatStopwatch(ms) {\n            const totalSeconds = Math.floor(ms / 1000);\n            const minutes = Math.floor(totalSeconds / 60);\n            const seconds = totalSeconds % 60;\n            const centiseconds = Math.floor((ms % 1000) / 10);\n\n            return {\n                main: `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`,\n                ms: `.${centiseconds.toString().padStart(2, '0')}`\n            };\n        }\n\n        function updateStopwatchDisplay() {\n            const formatted = formatStopwatch(stopwatchTime);\n            stopwatchTimeEl.textContent = formatted.main;\n            stopwatchMsEl.textContent = formatted.ms;\n        }\n\n        function startStopwatch() {\n            stopwatchRunning = true;\n            const startTime = Date.now() - stopwatchTime;\n\n            stopwatchInterval = setInterval(() =\u003e {\n                stopwatchTime = Date.now() - startTime;\n                updateStopwatchDisplay();\n            }, 10);\n\n            startStopBtn.textContent = 'Stop';\n            startStopBtn.classList.remove('start');\n            startStopBtn.classList.add('stop');\n            lapResetBtn.textContent = 'Lap';\n            lapResetBtn.disabled = false;\n        }\n\n        function stopStopwatch() {\n            stopwatchRunning = false;\n            clearInterval(stopwatchInterval);\n\n            startStopBtn.textContent = 'Start';\n            startStopBtn.classList.remove('stop');\n            startStopBtn.classList.add('start');\n            lapResetBtn.textContent = 'Reset';\n        }\n\n        function resetStopwatch() {\n            stopwatchTime = 0;\n            lastLapTime = 0;\n            laps = [];\n            updateStopwatchDisplay();\n            renderLaps();\n            lapResetBtn.disabled = true;\n        }\n\n        function addLap() {\n            const lapTime = stopwatchTime - lastLapTime;\n            laps.unshift({ lap: laps.length + 1, time: lapTime, total: stopwatchTime });\n            lastLapTime = stopwatchTime;\n            renderLaps();\n        }\n\n        function renderLaps() {\n            if (laps.length === 0) {\n                lapListEl.innerHTML = '';\n                return;\n            }\n\n            const times = laps.map(l =\u003e l.time);\n            const minTime = Math.min(...times);\n            const maxTime = Math.max(...times);\n\n            lapListEl.innerHTML = laps.map(lap =\u003e {\n                const formatted = formatStopwatch(lap.time);\n                let className = 'lap-item';\n                if (laps.length \u003e 2) {\n                    if (lap.time === minTime) className += ' best';\n                    else if (lap.time === maxTime) className += ' worst';\n                }\n\n                return `\n                    \u003cdiv class=\"${className}\"\u003e\n                        \u003cspan class=\"lap-number\"\u003eLap ${lap.lap}\u003c/span\u003e\n                        \u003cspan\u003e${formatted.main}${formatted.ms}\u003c/span\u003e\n                    \u003c/div\u003e\n                `;\n            }).join('');\n        }\n\n        startStopBtn.addEventListener('click', () =\u003e {\n            if (stopwatchRunning) {\n                stopStopwatch();\n            } else {\n                startStopwatch();\n            }\n        });\n\n        lapResetBtn.addEventListener('click', () =\u003e {\n            if (stopwatchRunning) {\n                addLap();\n            } else {\n                resetStopwatch();\n            }\n        });\n\n        // =====================\n        // Timer\n        // =====================\n        let timerRunning = false;\n        let timerPaused = false;\n        let timerTime = 0;\n        let timerInterval = null;\n        let timerEndTime = 0;\n\n        const timerSetup = document.getElementById('timerSetup');\n        const timerRunningDiv = document.getElementById('timerRunning');\n        const timerTimeEl = document.getElementById('timerTime');\n        const timerStartBtn = document.getElementById('timerStartBtn');\n        const timerCancelBtn = document.getElementById('timerCancelBtn');\n        const timerCancelBtn2 = document.getElementById('timerCancelBtn2');\n        const timerPauseBtn = document.getElementById('timerPauseBtn');\n        const hourPicker = document.getElementById('hourPicker');\n        const minutePicker = document.getElementById('minutePicker');\n        const secondPicker = document.getElementById('secondPicker');\n\n        // Initialize timer pickers\n        initPicker(hourPicker, 24);\n        initPicker(minutePicker, 60);\n        initPicker(secondPicker, 60);\n\n        [hourPicker, minutePicker, secondPicker].forEach(picker =\u003e {\n            picker.addEventListener('scroll', () =\u003e updatePickerSelection(picker));\n        });\n\n        function formatTimer(seconds) {\n            const h = Math.floor(seconds / 3600);\n            const m = Math.floor((seconds % 3600) / 60);\n            const s = seconds % 60;\n\n            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n        }\n\n        function updateTimerDisplay() {\n            timerTimeEl.textContent = formatTimer(timerTime);\n        }\n\n        function startTimer(seconds) {\n            timerTime = seconds;\n            timerRunning = true;\n            timerPaused = false;\n            timerEndTime = Date.now() + (seconds * 1000);\n\n            timerSetup.style.display = 'none';\n            timerRunningDiv.style.display = 'block';\n            timerRunningDiv.classList.remove('timer-finished');\n\n            updateTimerDisplay();\n\n            timerInterval = setInterval(() =\u003e {\n                const remaining = Math.max(0, Math.ceil((timerEndTime - Date.now()) / 1000));\n                timerTime = remaining;\n                updateTimerDisplay();\n\n                if (remaining === 0) {\n                    timerFinished();\n                }\n            }, 100);\n\n            timerPauseBtn.textContent = 'Pause';\n            timerPauseBtn.classList.remove('start');\n            timerPauseBtn.classList.add('pause');\n        }\n\n        function timerFinished() {\n            clearInterval(timerInterval);\n            timerRunning = false;\n            timerRunningDiv.classList.add('timer-finished');\n\n            // Play timer sound\n            try {\n                const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n                const playBeep = () =\u003e {\n                    const oscillator = audioContext.createOscillator();\n                    const gainNode = audioContext.createGain();\n                    oscillator.connect(gainNode);\n                    gainNode.connect(audioContext.destination);\n                    oscillator.frequency.value = 1000;\n                    oscillator.type = 'sine';\n                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);\n                    oscillator.start(audioContext.currentTime);\n                    oscillator.stop(audioContext.currentTime + 0.3);\n                };\n\n                for (let i = 0; i \u003c 5; i++) {\n                    setTimeout(playBeep, i * 400);\n                }\n            } catch (e) {\n                console.log('Audio not available');\n            }\n        }\n\n        function pauseTimer() {\n            timerPaused = true;\n            clearInterval(timerInterval);\n\n            timerPauseBtn.textContent = 'Resume';\n            timerPauseBtn.classList.remove('pause');\n            timerPauseBtn.classList.add('start');\n        }\n\n        function resumeTimer() {\n            timerPaused = false;\n            timerEndTime = Date.now() + (timerTime * 1000);\n\n            timerInterval = setInterval(() =\u003e {\n                const remaining = Math.max(0, Math.ceil((timerEndTime - Date.now()) / 1000));\n                timerTime = remaining;\n                updateTimerDisplay();\n\n                if (remaining === 0) {\n                    timerFinished();\n                }\n            }, 100);\n\n            timerPauseBtn.textContent = 'Pause';\n            timerPauseBtn.classList.remove('start');\n            timerPauseBtn.classList.add('pause');\n        }\n\n        function cancelTimer() {\n            clearInterval(timerInterval);\n            timerRunning = false;\n            timerPaused = false;\n            timerTime = 0;\n\n            timerSetup.style.display = 'block';\n            timerRunningDiv.style.display = 'none';\n        }\n\n        timerStartBtn.addEventListener('click', () =\u003e {\n            const hours = getPickerValue(hourPicker);\n            const minutes = getPickerValue(minutePicker);\n            const seconds = getPickerValue(secondPicker);\n            const totalSeconds = hours * 3600 + minutes * 60 + seconds;\n\n            if (totalSeconds \u003e 0) {\n                startTimer(totalSeconds);\n            }\n        });\n\n        timerPauseBtn.addEventListener('click', () =\u003e {\n            if (timerPaused) {\n                resumeTimer();\n            } else if (timerRunning) {\n                pauseTimer();\n            } else {\n                // Timer finished, restart\n                const hours = getPickerValue(hourPicker);\n                const minutes = getPickerValue(minutePicker);\n                const seconds = getPickerValue(secondPicker);\n                const totalSeconds = hours * 3600 + minutes * 60 + seconds;\n                if (totalSeconds \u003e 0) {\n                    startTimer(totalSeconds);\n                }\n            }\n        });\n\n        timerCancelBtn2.addEventListener('click', cancelTimer);\n\n        // Quick timers\n        document.querySelectorAll('.quick-timer-btn').forEach(btn =\u003e {\n            btn.addEventListener('click', () =\u003e {\n                const seconds = parseInt(btn.dataset.seconds);\n                startTimer(seconds);\n            });\n        });\n\n        // Initialize timer pickers with default values\n        setTimeout(() =\u003e {\n            setPickerValue(hourPicker, 0);\n            setPickerValue(minutePicker, 5);\n            setPickerValue(secondPicker, 0);\n        }, 100);\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n","main.go":"package main\n\nimport (\n\t\"embed\"\n\t\"log\"\n\t\"net/http\"\n)\n\n//go:embed index.html\nvar content embed.FS\n\nfunc main() {\n\thttp.HandleFunc(\"/\", handleIndex)\n\thttp.HandleFunc(\"/health\", handleHealth)\n\n\tlog.Println(\"Clock App listening on :30007\")\n\tlog.Fatal(http.ListenAndServe(\":30007\", nil))\n}\n\nfunc handleIndex(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\tdata, _ := content.ReadFile(\"index.html\")\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write(data)\n}\n\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"text/plain\")\n\tw.Write([]byte(\"ok\"))\n}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"clock-app-src","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:06:51Z"
    name: clock-app-src
    namespace: holm
    resourceVersion: "743"
    uid: 938e3a2d-2a00-4bf5-96ed-9e3c1afb14d3
- apiVersion: v1
  data:
    Dockerfile: |
      FROM ghcr.io/astral-sh/uv:python3.11-bookworm

      WORKDIR /app

      # Install kubectl
      RUN apt-get update && apt-get install -y curl && \
          curl -LO "https://dl.k8s.io/release/v1.29.0/bin/linux/arm64/kubectl" && \
          chmod +x kubectl && \
          mv kubectl /usr/local/bin/ && \
          apt-get clean && rm -rf /var/lib/apt/lists/*

      # Install Python dependencies using uv
      COPY requirements.txt .
      RUN uv pip install --system --no-cache -r requirements.txt

      # Copy application
      COPY main.py .

      EXPOSE 8080

      CMD ["python", "main.py"]
    main.py: |
      #!/usr/bin/env python3
      """
      Deploy Controller - Automatic deployment after successful builds.
      Watches for new images in registry and auto-deploys them.
      """

      import asyncio
      import os
      import subprocess
      import json
      import yaml
      import httpx
      from datetime import datetime
      from typing import Optional
      from fastapi import FastAPI, HTTPException, BackgroundTasks
      from fastapi.responses import HTMLResponse
      from pydantic import BaseModel
      import logging

      logging.basicConfig(level=logging.INFO)
      logger = logging.getLogger(__name__)

      app = FastAPI(title="Deploy Controller", version="1.0.0")

      # Configuration
      REGISTRY_URL = os.getenv("REGISTRY_URL", "http://registry.holm.svc.cluster.local:5000")
      NAMESPACE = "holm"
      CHECK_INTERVAL = 30  # seconds

      # State tracking
      deployments_state: dict = {}
      deployment_history: list = []
      auto_deploy_enabled = False  # Disabled by default - enable via API when needed
      last_check_time: Optional[datetime] = None


      class DeployRequest(BaseModel):
          image: str
          replicas: int = 1


      class DeploymentInfo(BaseModel):
          name: str
          image: str
          replicas: int
          ready: int
          status: str
          last_updated: str


      def generate_deployment_yaml(service_name: str, replicas: int = 1) -> str:
          """Generate Kubernetes deployment YAML for a service."""
          deployment = {
              "apiVersion": "apps/v1",
              "kind": "Deployment",
              "metadata": {
                  "name": service_name,
                  "namespace": NAMESPACE,
                  "labels": {
                      "app": service_name,
                      "managed-by": "deploy-controller"
                  }
              },
              "spec": {
                  "replicas": replicas,
                  "selector": {
                      "matchLabels": {
                          "app": service_name
                      }
                  },
                  "template": {
                      "metadata": {
                          "labels": {
                              "app": service_name
                          }
                      },
                      "spec": {
                          "affinity": {
                              "nodeAffinity": {
                                  "requiredDuringSchedulingIgnoredDuringExecution": {
                                      "nodeSelectorTerms": [{
                                          "matchExpressions": [{
                                              "key": "kubernetes.io/hostname",
                                              "operator": "NotIn",
                                              "values": ["openmediavault"]
                                          }]
                                      }]
                                  }
                              }
                          },
                          "containers": [{
                              "name": service_name,
                              "image": f"localhost:31500/{service_name}:latest",
                              "ports": [{
                                  "containerPort": 8080
                              }],
                              "imagePullPolicy": "Always"
                          }]
                      }
                  }
              }
          }
          return yaml.dump(deployment, default_flow_style=False)


      def run_kubectl(args: list, input_data: str = None) -> tuple[bool, str]:
          """Run a kubectl command and return success status and output."""
          cmd = ["kubectl"] + args
          try:
              result = subprocess.run(
                  cmd,
                  input=input_data,
                  capture_output=True,
                  text=True,
                  timeout=60
              )
              if result.returncode == 0:
                  return True, result.stdout
              return False, result.stderr
          except subprocess.TimeoutExpired:
              return False, "Command timed out"
          except Exception as e:
              return False, str(e)


      async def get_registry_images() -> list[str]:
          """Get list of images from the registry."""
          try:
              async with httpx.AsyncClient(timeout=10) as client:
                  response = await client.get(f"{REGISTRY_URL}/v2/_catalog")
                  if response.status_code == 200:
                      data = response.json()
                      repos = data.get("repositories", [])
                      # Return all images (no holm/ prefix filter needed)
                      return repos
                  return []
          except Exception as e:
              logger.error(f"Failed to get registry images: {e}")
              return []


      async def get_image_tags(image: str) -> list[str]:
          """Get tags for an image from the registry."""
          try:
              async with httpx.AsyncClient(timeout=10) as client:
                  response = await client.get(f"{REGISTRY_URL}/v2/{image}/tags/list")
                  if response.status_code == 200:
                      data = response.json()
                      return data.get("tags", [])
                  return []
          except Exception as e:
              logger.error(f"Failed to get tags for {image}: {e}")
              return []


      async def get_image_digest(image: str, tag: str = "latest") -> Optional[str]:
          """Get the digest of an image tag."""
          try:
              async with httpx.AsyncClient(timeout=10) as client:
                  response = await client.head(
                      f"{REGISTRY_URL}/v2/{image}/manifests/{tag}",
                      headers={"Accept": "application/vnd.oci.image.manifest.v1+json, application/vnd.docker.distribution.manifest.v2+json"}
                  )
                  if response.status_code == 200:
                      return response.headers.get("Docker-Content-Digest")
                  return None
          except Exception as e:
              logger.error(f"Failed to get digest for {image}:{tag}: {e}")
              return None


      def get_current_deployments() -> dict:
          """Get current deployments in the holm namespace."""
          success, output = run_kubectl([
              "get", "deployments", "-n", NAMESPACE,
              "-o", "json"
          ])
          if not success:
              logger.error(f"Failed to get deployments: {output}")
              return {}

          try:
              data = json.loads(output)
              deployments = {}
              for item in data.get("items", []):
                  name = item["metadata"]["name"]
                  containers = item["spec"]["template"]["spec"]["containers"]
                  if containers:
                      image = containers[0].get("image", "")
                      replicas = item["spec"].get("replicas", 1)
                      ready = item.get("status", {}).get("readyReplicas", 0)
                      deployments[name] = {
                          "image": image,
                          "replicas": replicas,
                          "ready": ready or 0,
                          "labels": item["metadata"].get("labels", {})
                      }
              return deployments
          except json.JSONDecodeError as e:
              logger.error(f"Failed to parse deployments: {e}")
              return {}


      def deploy_service(service_name: str, replicas: int = 1) -> tuple[bool, str]:
          """Deploy a service to the cluster."""
          yaml_content = generate_deployment_yaml(service_name, replicas)
          success, output = run_kubectl(
              ["apply", "-f", "-"],
              input_data=yaml_content
          )

          if success:
              deployment_history.append({
                  "action": "deploy",
                  "service": service_name,
                  "timestamp": datetime.now().isoformat(),
                  "success": True,
                  "message": output.strip()
              })
              logger.info(f"Deployed {service_name}: {output.strip()}")
          else:
              deployment_history.append({
                  "action": "deploy",
                  "service": service_name,
                  "timestamp": datetime.now().isoformat(),
                  "success": False,
                  "message": output.strip()
              })
              logger.error(f"Failed to deploy {service_name}: {output}")

          return success, output


      def rollback_deployment(name: str) -> tuple[bool, str]:
          """Rollback a deployment to previous version."""
          success, output = run_kubectl([
              "rollout", "undo", "deployment", name, "-n", NAMESPACE
          ])

          deployment_history.append({
              "action": "rollback",
              "service": name,
              "timestamp": datetime.now().isoformat(),
              "success": success,
              "message": output.strip()
          })

          return success, output


      def restart_deployment(name: str) -> tuple[bool, str]:
          """Restart a deployment to pull latest image."""
          success, output = run_kubectl([
              "rollout", "restart", "deployment", name, "-n", NAMESPACE
          ])

          if success:
              deployment_history.append({
                  "action": "restart",
                  "service": name,
                  "timestamp": datetime.now().isoformat(),
                  "success": True,
                  "message": output.strip()
              })
              logger.info(f"Restarted {name}: {output.strip()}")

          return success, output


      async def check_deployment_health(name: str, timeout: int = 120) -> bool:
          """Wait for deployment to be healthy."""
          success, output = run_kubectl([
              "rollout", "status", "deployment", name,
              "-n", NAMESPACE, "--timeout", f"{timeout}s"
          ])
          return success


      async def auto_deploy_loop():
          """Main auto-deploy loop that checks for new images."""
          global last_check_time, deployments_state

          while True:
              if auto_deploy_enabled:
                  try:
                      last_check_time = datetime.now()
                      logger.info("Checking for new images...")

                      # Get images from registry
                      registry_images = await get_registry_images()
                      logger.info(f"Found {len(registry_images)} images in registry")

                      # Get current deployments
                      current_deployments = get_current_deployments()
                      deployments_state = current_deployments

                      # Check each image
                      for image in registry_images:
                          # Image name is the service name (no holm/ prefix)
                          service_name = image

                          # Get image digest
                          current_digest = await get_image_digest(image, "latest")

                          if service_name not in current_deployments:
                              # New service - deploy it
                              logger.info(f"New service detected: {service_name}")
                              success, msg = deploy_service(service_name)
                              if success:
                                  # Wait for health check
                                  healthy = await check_deployment_health(service_name)
                                  if not healthy:
                                      logger.warning(f"Deployment {service_name} not healthy, rolling back")
                                      rollback_deployment(service_name)
                          else:
                              # Check if image has changed (using digest stored in state)
                              stored_digest = deployments_state.get(service_name, {}).get("digest")
                              if current_digest and stored_digest and current_digest != stored_digest:
                                  logger.info(f"Image updated for {service_name}, restarting deployment")
                                  success, msg = restart_deployment(service_name)
                                  if success:
                                      healthy = await check_deployment_health(service_name)
                                      if not healthy:
                                          logger.warning(f"Deployment {service_name} not healthy after update, rolling back")
                                          rollback_deployment(service_name)

                              # Update stored digest
                              if service_name in deployments_state:
                                  deployments_state[service_name]["digest"] = current_digest

                  except Exception as e:
                      logger.error(f"Error in auto-deploy loop: {e}")

              await asyncio.sleep(CHECK_INTERVAL)


      @app.on_event("startup")
      async def startup_event():
          """Start the auto-deploy background task."""
          asyncio.create_task(auto_deploy_loop())


      @app.get("/", response_class=HTMLResponse)
      async def dashboard():
          """Deployment dashboard."""
          current_deployments = get_current_deployments()
          registry_images = await get_registry_images()

          # Calculate pending deployments
          deployed_services = set(current_deployments.keys())
          registry_services = set(registry_images)
          pending = registry_services - deployed_services

          html = """
          <!DOCTYPE html>
          <html>
          <head>
              <title>Deploy Controller</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      margin: 0;
                      padding: 20px;
                      background: #0a0a0a;
                      color: #e0e0e0;
                  }
                  h1, h2 { color: #4fc3f7; margin-bottom: 20px; }
                  .container { max-width: 1200px; margin: 0 auto; }
                  .card {
                      background: #1a1a2e;
                      border-radius: 8px;
                      padding: 20px;
                      margin-bottom: 20px;
                      border: 1px solid #333;
                  }
                  .status-badge {
                      display: inline-block;
                      padding: 4px 12px;
                      border-radius: 20px;
                      font-size: 12px;
                      font-weight: 500;
                  }
                  .status-running { background: #1b5e20; color: #a5d6a7; }
                  .status-pending { background: #e65100; color: #ffcc80; }
                  .status-error { background: #b71c1c; color: #ef9a9a; }
                  table {
                      width: 100%;
                      border-collapse: collapse;
                  }
                  th, td {
                      text-align: left;
                      padding: 12px;
                      border-bottom: 1px solid #333;
                  }
                  th { color: #4fc3f7; font-weight: 500; }
                  .btn {
                      padding: 8px 16px;
                      border-radius: 4px;
                      border: none;
                      cursor: pointer;
                      font-size: 14px;
                      margin-right: 8px;
                  }
                  .btn-primary { background: #4fc3f7; color: #000; }
                  .btn-danger { background: #ef5350; color: #fff; }
                  .btn:hover { opacity: 0.8; }
                  .stats {
                      display: grid;
                      grid-template-columns: repeat(4, 1fr);
                      gap: 20px;
                      margin-bottom: 20px;
                  }
                  .stat-card {
                      background: #1a1a2e;
                      border-radius: 8px;
                      padding: 20px;
                      text-align: center;
                      border: 1px solid #333;
                  }
                  .stat-value { font-size: 32px; font-weight: bold; color: #4fc3f7; }
                  .stat-label { color: #888; margin-top: 8px; }
                  .auto-deploy-status {
                      display: inline-block;
                      padding: 8px 16px;
                      border-radius: 4px;
                      margin-left: 20px;
                  }
                  .auto-deploy-enabled { background: #1b5e20; }
                  .auto-deploy-disabled { background: #b71c1c; }
                  .history-item {
                      padding: 10px;
                      border-left: 3px solid;
                      margin-bottom: 10px;
                      background: #0d0d1a;
                  }
                  .history-success { border-color: #4caf50; }
                  .history-failure { border-color: #ef5350; }
                  .refresh-info { color: #666; font-size: 14px; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>Deploy Controller
                      <span class="auto-deploy-status """ + ("auto-deploy-enabled" if auto_deploy_enabled else "auto-deploy-disabled") + """">
                          Auto-Deploy: """ + ("Enabled" if auto_deploy_enabled else "Disabled") + """
                      </span>
                  </h1>

                  <div class="stats">
                      <div class="stat-card">
                          <div class="stat-value">""" + str(len(current_deployments)) + """</div>
                          <div class="stat-label">Deployments</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value">""" + str(len(registry_images)) + """</div>
                          <div class="stat-label">Registry Images</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value">""" + str(len(pending)) + """</div>
                          <div class="stat-label">Pending Deploy</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-value">""" + str(sum(1 for d in current_deployments.values() if d.get('ready', 0) >= d.get('replicas', 1))) + """</div>
                          <div class="stat-label">Healthy</div>
                      </div>
                  </div>

                  <div class="card">
                      <h2>Current Deployments</h2>
                      <table>
                          <thead>
                              <tr>
                                  <th>Service</th>
                                  <th>Image</th>
                                  <th>Replicas</th>
                                  <th>Status</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody>
          """

          for name, info in sorted(current_deployments.items()):
              ready = info.get('ready', 0)
              replicas = info.get('replicas', 1)
              status_class = "status-running" if ready >= replicas else "status-pending"
              status_text = "Running" if ready >= replicas else f"Starting ({ready}/{replicas})"

              html += f"""
                              <tr>
                                  <td><strong>{name}</strong></td>
                                  <td style="font-family: monospace; font-size: 12px;">{info.get('image', 'unknown')}</td>
                                  <td>{ready}/{replicas}</td>
                                  <td><span class="status-badge {status_class}">{status_text}</span></td>
                                  <td>
                                      <button class="btn btn-danger" onclick="rollback('{name}')">Rollback</button>
                                  </td>
                              </tr>
              """

          html += """
                          </tbody>
                      </table>
                  </div>

                  <div class="card">
                      <h2>Pending Deployments</h2>
          """

          if pending:
              html += "<ul>"
              for service in sorted(pending):
                  html += f'<li>{service} <button class="btn btn-primary" onclick="deploy(\'{service}\')">Deploy Now</button></li>'
              html += "</ul>"
          else:
              html += "<p>No pending deployments</p>"

          html += """
                  </div>

                  <div class="card">
                      <h2>Recent Activity</h2>
          """

          for entry in reversed(deployment_history[-10:]):
              status_class = "history-success" if entry.get('success') else "history-failure"
              html += f"""
                      <div class="history-item {status_class}">
                          <strong>{entry.get('action', 'unknown').upper()}</strong> - {entry.get('service', 'unknown')}
                          <br><small>{entry.get('timestamp', '')} - {entry.get('message', '')}</small>
                      </div>
              """

          if not deployment_history:
              html += "<p>No recent activity</p>"

          html += """
                  </div>

                  <p class="refresh-info">
                      Last check: """ + (last_check_time.strftime("%Y-%m-%d %H:%M:%S") if last_check_time else "Never") + """ |
                      Auto-refresh every """ + str(CHECK_INTERVAL) + """ seconds
                  </p>
              </div>

              <script>
                  async function deploy(service) {
                      if (confirm('Deploy ' + service + '?')) {
                          const response = await fetch('/api/deploy', {
                              method: 'POST',
                              headers: {'Content-Type': 'application/json'},
                              body: JSON.stringify({image: service})
                          });
                          const result = await response.json();
                          alert(result.message || 'Deployed');
                          location.reload();
                      }
                  }

                  async function rollback(service) {
                      if (confirm('Rollback ' + service + '?')) {
                          const response = await fetch('/api/rollback/' + service, {
                              method: 'POST'
                          });
                          const result = await response.json();
                          alert(result.message || 'Rolled back');
                          location.reload();
                      }
                  }

                  // Auto-refresh every 30 seconds
                  setTimeout(() => location.reload(), 30000);
              </script>
          </body>
          </html>
          """

          return html


      @app.get("/api/deployments")
      async def list_deployments():
          """List all deployments."""
          deployments = get_current_deployments()
          return {
              "deployments": [
                  {
                      "name": name,
                      "image": info.get("image", ""),
                      "replicas": info.get("replicas", 1),
                      "ready": info.get("ready", 0),
                      "status": "running" if info.get("ready", 0) >= info.get("replicas", 1) else "pending"
                  }
                  for name, info in deployments.items()
              ],
              "total": len(deployments)
          }


      @app.post("/api/deploy")
      async def deploy_image(request: DeployRequest, background_tasks: BackgroundTasks):
          """Deploy an image."""
          # Extract service name from image
          image = request.image
          if image.startswith("holm/"):
              service_name = image.replace("holm/", "")
          else:
              service_name = image

          success, message = deploy_service(service_name, request.replicas)

          if not success:
              raise HTTPException(status_code=500, detail=message)

          return {
              "success": True,
              "message": f"Deployed {service_name}",
              "service": service_name
          }


      @app.post("/api/rollback/{name}")
      async def rollback_service(name: str):
          """Rollback a deployment."""
          success, message = rollback_deployment(name)

          if not success:
              raise HTTPException(status_code=500, detail=message)

          return {
              "success": True,
              "message": f"Rolled back {name}",
              "service": name
          }


      @app.get("/api/images")
      async def list_images():
          """List images in registry."""
          images = await get_registry_images()
          result = []

          for image in images:
              tags = await get_image_tags(image)
              result.append({
                  "name": image,
                  "tags": tags
              })

          return {
              "images": result,
              "total": len(result)
          }


      @app.get("/api/pending")
      async def list_pending():
          """List images not yet deployed."""
          registry_images = await get_registry_images()
          current_deployments = get_current_deployments()

          deployed_services = set(current_deployments.keys())

          pending = []
          for image in registry_images:
              service_name = image
              if service_name not in deployed_services:
                  pending.append({
                      "image": image,
                      "service": service_name
                  })

          return {
              "pending": pending,
              "total": len(pending)
          }


      @app.get("/api/history")
      async def get_history():
          """Get deployment history."""
          return {
              "history": list(reversed(deployment_history[-50:])),
              "total": len(deployment_history)
          }


      @app.post("/api/auto-deploy/{enabled}")
      async def set_auto_deploy(enabled: bool):
          """Enable or disable auto-deploy."""
          global auto_deploy_enabled
          auto_deploy_enabled = enabled
          return {
              "auto_deploy": auto_deploy_enabled,
              "message": f"Auto-deploy {'enabled' if enabled else 'disabled'}"
          }


      @app.get("/health")
      async def health_check():
          """Health check endpoint."""
          # Try to connect to registry
          registry_ok = False
          try:
              async with httpx.AsyncClient(timeout=5) as client:
                  response = await client.get(f"{REGISTRY_URL}/v2/")
                  registry_ok = response.status_code == 200
          except:
              pass

          # Try kubectl
          kubectl_ok, _ = run_kubectl(["version", "--client"])

          return {
              "status": "healthy" if registry_ok and kubectl_ok else "degraded",
              "registry": "connected" if registry_ok else "disconnected",
              "kubectl": "available" if kubectl_ok else "unavailable",
              "auto_deploy": auto_deploy_enabled,
              "last_check": last_check_time.isoformat() if last_check_time else None,
              "timestamp": datetime.now().isoformat()
          }


      if __name__ == "__main__":
          import uvicorn
          uvicorn.run(app, host="0.0.0.0", port=8080)
    requirements.txt: |
      fastapi==0.109.0
      uvicorn==0.27.0
      httpx==0.26.0
      pyyaml==6.0.1
      pydantic==2.5.3
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T04:26:58Z"
    name: deploy-controller-src
    namespace: holm
    resourceVersion: "744"
    uid: f42a8ff2-210f-4e2b-9cd9-91dc196a3fcd
- apiVersion: v1
  data:
    config.json: |
      {
        "auths": {},
        "insecure-registries": ["192.168.8.197:31500", "localhost:31500", "registry.holm.svc.cluster.local:5000"]
      }
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"config.json":"{\n  \"auths\": {},\n  \"insecure-registries\": [\"192.168.8.197:31500\", \"localhost:31500\", \"registry.holm.svc.cluster.local:5000\"]\n}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"docker-registry-config","namespace":"holm"}}
    creationTimestamp: "2026-01-18T05:48:36Z"
    name: docker-registry-config
    namespace: holm
    resourceVersion: "745"
    uid: f68ddc3e-5edb-4f27-ac7e-64099edf7c51
- apiVersion: v1
  data:
    Dockerfile: |
      FROM python:3.11-slim

      WORKDIR /app

      COPY requirements.txt .
      RUN pip install --no-cache-dir -r requirements.txt

      COPY app.py .

      EXPOSE 8080

      CMD ["gunicorn", "--bind", "0.0.0.0:8080", "--workers", "2", "--threads", "4", "app:app"]
    app.py: |
      #!/usr/bin/env python3
      """HolmOS iOS Shell - iPhone SpringBoard-style interface for HolmOS."""

      import os
      import json
      from flask import Flask, jsonify, request, Response, redirect

      app = Flask(__name__)

      CLUSTER_HOST = os.environ.get('CLUSTER_HOST', '192.168.8.197')

      # App Registry - defines all apps, pages, dock, and folders
      APP_REGISTRY = {
          "version": "1.0.0",
          "theme": "catppuccin-mocha",
          "pages": [
              {
                  "id": "page1",
                  "apps": [
                      {"id": "calculator", "name": "Calculator", "icon": "calc", "port": 30010, "color": "#333333"},
                      {"id": "clock", "name": "Clock", "icon": "clock", "port": 30011, "color": "#1c1c1e"},
                      {"id": "audiobook", "name": "Audiobook", "icon": "headphones", "port": 30700, "color": "#fc3c44"},
                      {"id": "terminal", "name": "Terminal", "icon": "terminal", "port": 30800, "color": "#1e1e2e"},
                      {"id": "vault", "name": "Vault", "icon": "lock", "port": 30870, "color": "#8e8e93"},
                      {"id": "scribe", "name": "Scribe", "icon": "pencil", "port": 30860, "color": "#ffd60a"},
                      {"id": "backup", "name": "Backup", "icon": "cloud", "port": 30850, "color": "#5ac8fa"},
                      {"id": "nova", "name": "Nova", "icon": "sparkles", "port": 30004, "color": "#cba6f7"},
                      {"id": "metrics", "name": "Metrics", "icon": "chart", "port": 30950, "color": "#f38ba8"},
                      {"id": "registry", "name": "Registry", "icon": "box", "port": 31750, "color": "#89b4fa"},
                      {"id": "tests", "name": "Tests", "icon": "check", "port": 30900, "color": "#a6e3a1"},
                      {"id": "auth", "name": "Auth", "icon": "key", "port": 30100, "color": "#fab387"}
                  ]
              },
              {
                  "id": "page2",
                  "apps": [
                      {"id": "git", "name": "HolmGit", "icon": "git", "port": 30500, "color": "#f05033"},
                      {"id": "cicd", "name": "CI/CD", "icon": "gear", "port": 30020, "color": "#45475a"},
                      {"id": "deploy", "name": "Deploy", "icon": "rocket", "port": 30021, "color": "#89b4fa"},
                      {"id": "cluster", "name": "Cluster", "icon": "server", "port": 30502, "color": "#cba6f7"}
                  ]
              }
          ],
          "dock": [
              {"id": "chat", "name": "Chat", "icon": "message", "port": 30003, "color": "#a6e3a1"},
              {"id": "store", "name": "Store", "icon": "bag", "port": 30002, "color": "#89b4fa"},
              {"id": "settings", "name": "Settings", "icon": "settings", "port": 30600, "color": "#6c7086"},
              {"id": "files", "name": "Files", "icon": "folder", "port": 30088, "color": "#89b4fa"}
          ]
      }

      # SVG Icons
      ICONS = {
          "calc": '<path d="M4 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4zm2 4h12v3H6V6zm0 5h3v3H6v-3zm5 0h3v3h-3v-3zm5 0h3v8h-3v-8zm-10 5h3v3H6v-3zm5 0h3v3h-3v-3z"/>',
          "clock": '<circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>',
          "headphones": '<path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/>',
          "terminal": '<rect x="2" y="4" width="20" height="16" rx="2"/><path d="m6 10 4 2-4 2m6 0h4"/>',
          "lock": '<rect x="5" y="11" width="14" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',
          "pencil": '<path d="M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>',
          "cloud": '<path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>',
          "sparkles": '<path d="m12 3-1.9 5.8a2 2 0 0 1-1.3 1.3L3 12l5.8 1.9a2 2 0 0 1 1.3 1.3L12 21l1.9-5.8a2 2 0 0 1 1.3-1.3L21 12l-5.8-1.9a2 2 0 0 1-1.3-1.3Z"/>',
          "chart": '<path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/>',
          "box": '<path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5M12 22V12"/>',
          "check": '<path d="M20 6 9 17l-5-5"/>',
          "key": '<path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78Zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/>',
          "git": '<circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9M12 12v3"/>',
          "gear": '<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>',
          "rocket": '<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>',
          "server": '<rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/>',
          "message": '<path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>',
          "bag": '<path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/>',
          "settings": '<path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>',
          "folder": '<path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/>'
      }

      INDEX_HTML = '''<!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, maximum-scale=1">
          <meta name="apple-mobile-web-app-capable" content="yes">
          <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
          <meta name="theme-color" content="#1e1e2e">
          <title>HolmOS</title>
          <link rel="manifest" href="/manifest.json">
          <link rel="apple-touch-icon" href="/icon-192.png">
          <style>
              :root {
                  --base: #1e1e2e; --mantle: #181825; --crust: #11111b;
                  --text: #cdd6f4; --subtext0: #a6adc8; --subtext1: #bac2de;
                  --surface0: #313244; --surface1: #45475a; --surface2: #585b70;
                  --overlay0: #6c7086; --blue: #89b4fa; --mauve: #cba6f7;
                  --green: #a6e3a1; --red: #f38ba8; --peach: #fab387;
                  --safe-top: env(safe-area-inset-top, 20px);
                  --safe-bottom: env(safe-area-inset-bottom, 20px);
              }
              * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: pan-y; }
              html, body { height: 100%; overflow: hidden; overscroll-behavior: none; }
              body {
                  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
                  background: var(--base); color: var(--text);
                  display: flex; flex-direction: column;
                  padding-top: var(--safe-top); padding-bottom: var(--safe-bottom);
              }

              /* Pages Container */
              .pages-wrapper {
                  flex: 1; display: flex; overflow: hidden;
                  padding-top: var(--safe-top); padding-bottom: 120px;
              }
              .pages {
                  display: flex; transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
                  width: 100%; height: 100%;
              }
              .page {
                  min-width: 100%; height: 100%; padding: 20px;
                  display: grid; grid-template-columns: repeat(4, 1fr);
                  gap: 24px 16px; align-content: start;
              }

              /* App Icons */
              .app {
                  display: flex; flex-direction: column; align-items: center; gap: 6px;
                  cursor: pointer; transition: transform 0.15s;
              }
              .app:active { transform: scale(0.9); }
              .app.jiggle { animation: jiggle 0.15s infinite alternate; }
              @keyframes jiggle { 0% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }
              .app-icon {
                  width: 60px; height: 60px; border-radius: 14px;
                  display: flex; align-items: center; justify-content: center;
                  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                  position: relative; overflow: hidden;
              }
              .app-icon::after {
                  content: ""; position: absolute; top: 0; left: 0; right: 0; height: 50%;
                  background: linear-gradient(180deg, rgba(255,255,255,0.25) 0%, transparent 100%);
                  border-radius: 14px 14px 0 0;
              }
              .app-icon svg { width: 32px; height: 32px; fill: white; stroke: white; stroke-width: 1.5; z-index: 1; }
              .app-name {
                  font-size: 11px; font-weight: 500; text-align: center;
                  text-shadow: 0 1px 3px rgba(0,0,0,0.8);
                  max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
              }

              /* Page Dots */
              .page-dots {
                  display: flex; justify-content: center; gap: 8px;
                  padding: 12px; position: fixed; bottom: 100px; left: 0; right: 0;
              }
              .dot {
                  width: 8px; height: 8px; border-radius: 50%;
                  background: var(--surface2); transition: all 0.2s;
              }
              .dot.active { background: var(--text); transform: scale(1.2); }

              /* Dock */
              .dock {
                  position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
                  background: rgba(30,30,46,0.7); backdrop-filter: blur(20px);
                  border-radius: 28px; padding: 12px 20px;
                  display: flex; gap: 20px;
                  border: 1px solid rgba(255,255,255,0.1);
                  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
                  margin-bottom: var(--safe-bottom);
              }
              .dock .app { gap: 0; }
              .dock .app-icon { width: 52px; height: 52px; border-radius: 12px; }
              .dock .app-icon svg { width: 28px; height: 28px; }
              .dock .app-name { display: none; }

              /* Spotlight Search */
              .spotlight {
                  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                  background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
                  z-index: 200; display: none; flex-direction: column;
                  padding: 60px 20px 20px; padding-top: calc(var(--safe-top) + 60px);
              }
              .spotlight.active { display: flex; }
              .spotlight-input {
                  width: 100%; padding: 12px 16px; border-radius: 12px;
                  background: var(--surface0); border: none; color: var(--text);
                  font-size: 16px; outline: none;
              }
              .spotlight-results {
                  margin-top: 16px; flex: 1; overflow-y: auto;
              }
              .spotlight-result {
                  display: flex; align-items: center; gap: 12px;
                  padding: 12px; border-radius: 12px; cursor: pointer;
              }
              .spotlight-result:hover { background: var(--surface0); }
              .spotlight-result .app-icon { width: 44px; height: 44px; border-radius: 10px; }
              .spotlight-result .app-icon svg { width: 24px; height: 24px; }

              /* App Container */
              .app-container {
                  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                  background: var(--base); z-index: 300;
                  transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
              }
              .app-container.active { transform: translateY(0); }
              .app-header {
                  display: flex; align-items: center; justify-content: space-between;
                  padding: 12px 16px; background: var(--mantle);
                  border-bottom: 1px solid var(--surface0);
                  padding-top: calc(var(--safe-top) + 12px);
              }
              .app-title { font-size: 16px; font-weight: 600; }
              .app-close {
                  width: 32px; height: 32px; border-radius: 50%;
                  background: var(--surface0); border: none; color: var(--text);
                  font-size: 20px; cursor: pointer; display: flex;
                  align-items: center; justify-content: center;
              }
              .app-frame { flex: 1; width: 100%; height: calc(100% - 56px - var(--safe-top)); border: none; }

              /* Home Indicator */
              .home-indicator {
                  position: fixed; bottom: 8px; left: 50%; transform: translateX(-50%);
                  width: 134px; height: 5px; background: var(--text);
                  border-radius: 3px; opacity: 0.3;
              }
              .app-container .home-indicator { opacity: 0.5; }

              @media (min-width: 768px) {
                  .page { grid-template-columns: repeat(6, 1fr); max-width: 600px; margin: 0 auto; }
                  .dock { gap: 24px; padding: 14px 24px; }
              }
          </style>
      </head>
      <body>
          <div class="pages-wrapper" id="pagesWrapper">
              <div class="pages" id="pages"></div>
          </div>

          <div class="page-dots" id="pageDots"></div>

          <div class="dock" id="dock"></div>

          <div class="spotlight" id="spotlight">
              <input type="text" class="spotlight-input" placeholder="Search apps..." id="searchInput" autocomplete="off">
              <div class="spotlight-results" id="searchResults"></div>
          </div>

          <div class="app-container" id="appContainer">
              <div class="app-header">
                  <span class="app-title" id="appTitle">App</span>
                  <button class="app-close" onclick="closeApp()">&#10005;</button>
              </div>
              <iframe class="app-frame" id="appFrame"></iframe>
              <div class="home-indicator"></div>
          </div>

          <div class="home-indicator"></div>

          <script>
              const HOST = "''' + CLUSTER_HOST + '''";
              const registry = ''' + json.dumps(APP_REGISTRY) + ''';
              const icons = ''' + json.dumps(ICONS) + ''';

              let currentPage = 0;
              let touchStartX = 0;
              let touchStartY = 0;
              let isDragging = false;
              let isJiggling = false;
              let longPressTimer = null;

              function createIcon(iconName) {
                  return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">${icons[iconName] || icons.sparkles}</svg>`;
              }

              function createApp(app, inDock = false) {
                  return `
                      <div class="app ${isJiggling ? 'jiggle' : ''}" data-id="${app.id}" data-port="${app.port}"
                           onclick="launchApp('${app.id}', '${app.name}', ${app.port})"
                           ontouchstart="handleTouchStart(event, '${app.id}')"
                           ontouchend="handleTouchEnd(event)">
                          <div class="app-icon" style="background: linear-gradient(135deg, ${app.color}, ${adjustColor(app.color, -30)})">
                              ${createIcon(app.icon)}
                          </div>
                          ${!inDock ? `<span class="app-name">${app.name}</span>` : ''}
                      </div>
                  `;
              }

              function adjustColor(hex, amount) {
                  const num = parseInt(hex.slice(1), 16);
                  const r = Math.max(0, Math.min(255, (num >> 16) + amount));
                  const g = Math.max(0, Math.min(255, ((num >> 8) & 0xff) + amount));
                  const b = Math.max(0, Math.min(255, (num & 0xff) + amount));
                  return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, '0')}`;
              }

              function render() {
                  // Render pages
                  document.getElementById('pages').innerHTML = registry.pages.map(page =>
                      `<div class="page">${page.apps.map(app => createApp(app)).join('')}</div>`
                  ).join('');

                  // Render dock
                  document.getElementById('dock').innerHTML = registry.dock.map(app => createApp(app, true)).join('');

                  // Render page dots
                  document.getElementById('pageDots').innerHTML = registry.pages.map((_, i) =>
                      `<div class="dot ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})"></div>`
                  ).join('');

                  updatePagePosition();
              }

              function goToPage(index) {
                  currentPage = Math.max(0, Math.min(registry.pages.length - 1, index));
                  updatePagePosition();
                  document.querySelectorAll('.dot').forEach((dot, i) => {
                      dot.classList.toggle('active', i === currentPage);
                  });
              }

              function updatePagePosition() {
                  document.getElementById('pages').style.transform = `translateX(-${currentPage * 100}%)`;
              }

              function launchApp(id, name, port) {
                  if (isJiggling) return;
                  if (!port) { alert(name + ' coming soon!'); return; }

                  document.getElementById('appTitle').textContent = name;
                  document.getElementById('appFrame').src = `http://${HOST}:${port}`;
                  document.getElementById('appContainer').classList.add('active');
              }

              function closeApp() {
                  document.getElementById('appContainer').classList.remove('active');
                  setTimeout(() => { document.getElementById('appFrame').src = ''; }, 300);
              }

              // Touch handling for swipe
              const wrapper = document.getElementById('pagesWrapper');
              wrapper.addEventListener('touchstart', e => {
                  touchStartX = e.touches[0].clientX;
                  touchStartY = e.touches[0].clientY;
              });

              wrapper.addEventListener('touchmove', e => {
                  if (Math.abs(e.touches[0].clientY - touchStartY) > 50) return; // Vertical scroll
                  const diff = touchStartX - e.touches[0].clientX;
                  if (Math.abs(diff) > 20) isDragging = true;
              });

              wrapper.addEventListener('touchend', e => {
                  if (!isDragging) return;
                  const diff = touchStartX - e.changedTouches[0].clientX;
                  if (diff > 50) goToPage(currentPage + 1);
                  else if (diff < -50) goToPage(currentPage - 1);
                  isDragging = false;
              });

              // Long press for jiggle mode
              function handleTouchStart(e, appId) {
                  longPressTimer = setTimeout(() => {
                      isJiggling = !isJiggling;
                      render();
                  }, 500);
              }

              function handleTouchEnd(e) {
                  clearTimeout(longPressTimer);
              }

              // Pull down for spotlight
              let pullStartY = 0;
              document.addEventListener('touchstart', e => { pullStartY = e.touches[0].clientY; });
              document.addEventListener('touchend', e => {
                  const pullDiff = e.changedTouches[0].clientY - pullStartY;
                  if (pullDiff > 100 && pullStartY < 100) {
                      document.getElementById('spotlight').classList.add('active');
                      document.getElementById('searchInput').focus();
                  }
              });

              // Spotlight search
              document.getElementById('searchInput').addEventListener('input', e => {
                  const query = e.target.value.toLowerCase();
                  const allApps = [...registry.pages.flatMap(p => p.apps), ...registry.dock];
                  const results = allApps.filter(app => app.name.toLowerCase().includes(query));

                  document.getElementById('searchResults').innerHTML = results.map(app => `
                      <div class="spotlight-result" onclick="launchApp('${app.id}', '${app.name}', ${app.port}); closeSpotlight();">
                          <div class="app-icon" style="background: linear-gradient(135deg, ${app.color}, ${adjustColor(app.color, -30)})">
                              ${createIcon(app.icon)}
                          </div>
                          <span>${app.name}</span>
                      </div>
                  `).join('');
              });

              function closeSpotlight() {
                  document.getElementById('spotlight').classList.remove('active');
                  document.getElementById('searchInput').value = '';
                  document.getElementById('searchResults').innerHTML = '';
              }

              document.getElementById('spotlight').addEventListener('click', e => {
                  if (e.target.id === 'spotlight') closeSpotlight();
              });

              // Keyboard shortcuts
              document.addEventListener('keydown', e => {
                  if (e.key === 'Escape') {
                      closeApp();
                      closeSpotlight();
                      isJiggling = false;
                      render();
                  }
              });

              render();
          </script>
      </body>
      </html>'''

      @app.route("/")
      def index():
          return Response(INDEX_HTML, mimetype="text/html")

      @app.route("/manifest.json")
      def manifest():
          return jsonify({
              "name": "HolmOS",
              "short_name": "HolmOS",
              "start_url": "/",
              "display": "standalone",
              "background_color": "#1e1e2e",
              "theme_color": "#1e1e2e",
              "icons": [
                  {"src": "/icon-192.png", "sizes": "192x192", "type": "image/png"},
                  {"src": "/icon-512.png", "sizes": "512x512", "type": "image/png"}
              ]
          })

      @app.route("/api/registry")
      def get_registry():
          return jsonify(APP_REGISTRY)

      @app.route("/health")
      def health():
          return jsonify({"status": "healthy"})

      @app.route("/ready")
      def ready():
          return jsonify({"status": "ready"})

      if __name__ == "__main__":
          port = int(os.environ.get("PORT", 8080))
          app.run(host="0.0.0.0", port=port)
    requirements.txt: |
      flask>=2.3.0
      gunicorn>=21.0.0
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM python:3.11-slim\n\nWORKDIR /app\n\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY app.py .\n\nEXPOSE 8080\n\nCMD [\"gunicorn\", \"--bind\", \"0.0.0.0:8080\", \"--workers\", \"2\", \"--threads\", \"4\", \"app:app\"]\n","app.py":"#!/usr/bin/env python3\n\"\"\"HolmOS iOS Shell - iPhone SpringBoard-style interface for HolmOS.\"\"\"\n\nimport os\nimport json\nfrom flask import Flask, jsonify, request, Response, redirect\n\napp = Flask(__name__)\n\nCLUSTER_HOST = os.environ.get('CLUSTER_HOST', '192.168.8.197')\n\n# App Registry - defines all apps, pages, dock, and folders\nAPP_REGISTRY = {\n    \"version\": \"1.0.0\",\n    \"theme\": \"catppuccin-mocha\",\n    \"pages\": [\n        {\n            \"id\": \"page1\",\n            \"apps\": [\n                {\"id\": \"calculator\", \"name\": \"Calculator\", \"icon\": \"calc\", \"port\": 30010, \"color\": \"#333333\"},\n                {\"id\": \"clock\", \"name\": \"Clock\", \"icon\": \"clock\", \"port\": 30011, \"color\": \"#1c1c1e\"},\n                {\"id\": \"audiobook\", \"name\": \"Audiobook\", \"icon\": \"headphones\", \"port\": 30700, \"color\": \"#fc3c44\"},\n                {\"id\": \"terminal\", \"name\": \"Terminal\", \"icon\": \"terminal\", \"port\": 30800, \"color\": \"#1e1e2e\"},\n                {\"id\": \"vault\", \"name\": \"Vault\", \"icon\": \"lock\", \"port\": 30870, \"color\": \"#8e8e93\"},\n                {\"id\": \"scribe\", \"name\": \"Scribe\", \"icon\": \"pencil\", \"port\": 30860, \"color\": \"#ffd60a\"},\n                {\"id\": \"backup\", \"name\": \"Backup\", \"icon\": \"cloud\", \"port\": 30850, \"color\": \"#5ac8fa\"},\n                {\"id\": \"nova\", \"name\": \"Nova\", \"icon\": \"sparkles\", \"port\": 30004, \"color\": \"#cba6f7\"},\n                {\"id\": \"metrics\", \"name\": \"Metrics\", \"icon\": \"chart\", \"port\": 30950, \"color\": \"#f38ba8\"},\n                {\"id\": \"registry\", \"name\": \"Registry\", \"icon\": \"box\", \"port\": 31750, \"color\": \"#89b4fa\"},\n                {\"id\": \"tests\", \"name\": \"Tests\", \"icon\": \"check\", \"port\": 30900, \"color\": \"#a6e3a1\"},\n                {\"id\": \"auth\", \"name\": \"Auth\", \"icon\": \"key\", \"port\": 30100, \"color\": \"#fab387\"}\n            ]\n        },\n        {\n            \"id\": \"page2\",\n            \"apps\": [\n                {\"id\": \"git\", \"name\": \"HolmGit\", \"icon\": \"git\", \"port\": 30500, \"color\": \"#f05033\"},\n                {\"id\": \"cicd\", \"name\": \"CI/CD\", \"icon\": \"gear\", \"port\": 30020, \"color\": \"#45475a\"},\n                {\"id\": \"deploy\", \"name\": \"Deploy\", \"icon\": \"rocket\", \"port\": 30021, \"color\": \"#89b4fa\"},\n                {\"id\": \"cluster\", \"name\": \"Cluster\", \"icon\": \"server\", \"port\": 30502, \"color\": \"#cba6f7\"}\n            ]\n        }\n    ],\n    \"dock\": [\n        {\"id\": \"chat\", \"name\": \"Chat\", \"icon\": \"message\", \"port\": 30003, \"color\": \"#a6e3a1\"},\n        {\"id\": \"store\", \"name\": \"Store\", \"icon\": \"bag\", \"port\": 30002, \"color\": \"#89b4fa\"},\n        {\"id\": \"settings\", \"name\": \"Settings\", \"icon\": \"settings\", \"port\": 30600, \"color\": \"#6c7086\"},\n        {\"id\": \"files\", \"name\": \"Files\", \"icon\": \"folder\", \"port\": 30088, \"color\": \"#89b4fa\"}\n    ]\n}\n\n# SVG Icons\nICONS = {\n    \"calc\": '\u003cpath d=\"M4 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4zm2 4h12v3H6V6zm0 5h3v3H6v-3zm5 0h3v3h-3v-3zm5 0h3v8h-3v-8zm-10 5h3v3H6v-3zm5 0h3v3h-3v-3z\"/\u003e',\n    \"clock\": '\u003ccircle cx=\"12\" cy=\"12\" r=\"10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/\u003e\u003cpath d=\"M12 6v6l4 2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/\u003e',\n    \"headphones\": '\u003cpath d=\"M3 18v-6a9 9 0 0 1 18 0v6\"/\u003e\u003cpath d=\"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z\"/\u003e',\n    \"terminal\": '\u003crect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\"/\u003e\u003cpath d=\"m6 10 4 2-4 2m6 0h4\"/\u003e',\n    \"lock\": '\u003crect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\"/\u003e\u003cpath d=\"M7 11V7a5 5 0 0 1 10 0v4\"/\u003e',\n    \"pencil\": '\u003cpath d=\"M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\"/\u003e',\n    \"cloud\": '\u003cpath d=\"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z\"/\u003e',\n    \"sparkles\": '\u003cpath d=\"m12 3-1.9 5.8a2 2 0 0 1-1.3 1.3L3 12l5.8 1.9a2 2 0 0 1 1.3 1.3L12 21l1.9-5.8a2 2 0 0 1 1.3-1.3L21 12l-5.8-1.9a2 2 0 0 1-1.3-1.3Z\"/\u003e',\n    \"chart\": '\u003cpath d=\"M3 3v18h18\"/\u003e\u003cpath d=\"m19 9-5 5-4-4-3 3\"/\u003e',\n    \"box\": '\u003cpath d=\"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z\"/\u003e\u003cpath d=\"m3.3 7 8.7 5 8.7-5M12 22V12\"/\u003e',\n    \"check\": '\u003cpath d=\"M20 6 9 17l-5-5\"/\u003e',\n    \"key\": '\u003cpath d=\"m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78Zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4\"/\u003e',\n    \"git\": '\u003ccircle cx=\"12\" cy=\"18\" r=\"3\"/\u003e\u003ccircle cx=\"6\" cy=\"6\" r=\"3\"/\u003e\u003ccircle cx=\"18\" cy=\"6\" r=\"3\"/\u003e\u003cpath d=\"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9M12 12v3\"/\u003e',\n    \"gear\": '\u003ccircle cx=\"12\" cy=\"12\" r=\"3\"/\u003e\u003cpath d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"/\u003e',\n    \"rocket\": '\u003cpath d=\"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z\"/\u003e\u003cpath d=\"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z\"/\u003e\u003cpath d=\"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0\"/\u003e\u003cpath d=\"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5\"/\u003e',\n    \"server\": '\u003crect width=\"20\" height=\"8\" x=\"2\" y=\"2\" rx=\"2\" ry=\"2\"/\u003e\u003crect width=\"20\" height=\"8\" x=\"2\" y=\"14\" rx=\"2\" ry=\"2\"/\u003e\u003cline x1=\"6\" x2=\"6.01\" y1=\"6\" y2=\"6\"/\u003e\u003cline x1=\"6\" x2=\"6.01\" y1=\"18\" y2=\"18\"/\u003e',\n    \"message\": '\u003cpath d=\"M7.9 20A9 9 0 1 0 4 16.1L2 22Z\"/\u003e',\n    \"bag\": '\u003cpath d=\"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z\"/\u003e\u003cpath d=\"M3 6h18\"/\u003e\u003cpath d=\"M16 10a4 4 0 0 1-8 0\"/\u003e',\n    \"settings\": '\u003cpath d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"/\u003e\u003ccircle cx=\"12\" cy=\"12\" r=\"3\"/\u003e',\n    \"folder\": '\u003cpath d=\"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z\"/\u003e'\n}\n\nINDEX_HTML = '''\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, maximum-scale=1\"\u003e\n    \u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\"\u003e\n    \u003cmeta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\"\u003e\n    \u003cmeta name=\"theme-color\" content=\"#1e1e2e\"\u003e\n    \u003ctitle\u003eHolmOS\u003c/title\u003e\n    \u003clink rel=\"manifest\" href=\"/manifest.json\"\u003e\n    \u003clink rel=\"apple-touch-icon\" href=\"/icon-192.png\"\u003e\n    \u003cstyle\u003e\n        :root {\n            --base: #1e1e2e; --mantle: #181825; --crust: #11111b;\n            --text: #cdd6f4; --subtext0: #a6adc8; --subtext1: #bac2de;\n            --surface0: #313244; --surface1: #45475a; --surface2: #585b70;\n            --overlay0: #6c7086; --blue: #89b4fa; --mauve: #cba6f7;\n            --green: #a6e3a1; --red: #f38ba8; --peach: #fab387;\n            --safe-top: env(safe-area-inset-top, 20px);\n            --safe-bottom: env(safe-area-inset-bottom, 20px);\n        }\n        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: pan-y; }\n        html, body { height: 100%; overflow: hidden; overscroll-behavior: none; }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"SF Pro Display\", sans-serif;\n            background: var(--base); color: var(--text);\n            display: flex; flex-direction: column;\n            padding-top: var(--safe-top); padding-bottom: var(--safe-bottom);\n        }\n\n        /* Pages Container */\n        .pages-wrapper {\n            flex: 1; display: flex; overflow: hidden;\n            padding-top: var(--safe-top); padding-bottom: 120px;\n        }\n        .pages {\n            display: flex; transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);\n            width: 100%; height: 100%;\n        }\n        .page {\n            min-width: 100%; height: 100%; padding: 20px;\n            display: grid; grid-template-columns: repeat(4, 1fr);\n            gap: 24px 16px; align-content: start;\n        }\n\n        /* App Icons */\n        .app {\n            display: flex; flex-direction: column; align-items: center; gap: 6px;\n            cursor: pointer; transition: transform 0.15s;\n        }\n        .app:active { transform: scale(0.9); }\n        .app.jiggle { animation: jiggle 0.15s infinite alternate; }\n        @keyframes jiggle { 0% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }\n        .app-icon {\n            width: 60px; height: 60px; border-radius: 14px;\n            display: flex; align-items: center; justify-content: center;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n            position: relative; overflow: hidden;\n        }\n        .app-icon::after {\n            content: \"\"; position: absolute; top: 0; left: 0; right: 0; height: 50%;\n            background: linear-gradient(180deg, rgba(255,255,255,0.25) 0%, transparent 100%);\n            border-radius: 14px 14px 0 0;\n        }\n        .app-icon svg { width: 32px; height: 32px; fill: white; stroke: white; stroke-width: 1.5; z-index: 1; }\n        .app-name {\n            font-size: 11px; font-weight: 500; text-align: center;\n            text-shadow: 0 1px 3px rgba(0,0,0,0.8);\n            max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n        }\n\n        /* Page Dots */\n        .page-dots {\n            display: flex; justify-content: center; gap: 8px;\n            padding: 12px; position: fixed; bottom: 100px; left: 0; right: 0;\n        }\n        .dot {\n            width: 8px; height: 8px; border-radius: 50%;\n            background: var(--surface2); transition: all 0.2s;\n        }\n        .dot.active { background: var(--text); transform: scale(1.2); }\n\n        /* Dock */\n        .dock {\n            position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);\n            background: rgba(30,30,46,0.7); backdrop-filter: blur(20px);\n            border-radius: 28px; padding: 12px 20px;\n            display: flex; gap: 20px;\n            border: 1px solid rgba(255,255,255,0.1);\n            box-shadow: 0 8px 32px rgba(0,0,0,0.4);\n            margin-bottom: var(--safe-bottom);\n        }\n        .dock .app { gap: 0; }\n        .dock .app-icon { width: 52px; height: 52px; border-radius: 12px; }\n        .dock .app-icon svg { width: 28px; height: 28px; }\n        .dock .app-name { display: none; }\n\n        /* Spotlight Search */\n        .spotlight {\n            position: fixed; top: 0; left: 0; right: 0; bottom: 0;\n            background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);\n            z-index: 200; display: none; flex-direction: column;\n            padding: 60px 20px 20px; padding-top: calc(var(--safe-top) + 60px);\n        }\n        .spotlight.active { display: flex; }\n        .spotlight-input {\n            width: 100%; padding: 12px 16px; border-radius: 12px;\n            background: var(--surface0); border: none; color: var(--text);\n            font-size: 16px; outline: none;\n        }\n        .spotlight-results {\n            margin-top: 16px; flex: 1; overflow-y: auto;\n        }\n        .spotlight-result {\n            display: flex; align-items: center; gap: 12px;\n            padding: 12px; border-radius: 12px; cursor: pointer;\n        }\n        .spotlight-result:hover { background: var(--surface0); }\n        .spotlight-result .app-icon { width: 44px; height: 44px; border-radius: 10px; }\n        .spotlight-result .app-icon svg { width: 24px; height: 24px; }\n\n        /* App Container */\n        .app-container {\n            position: fixed; top: 0; left: 0; right: 0; bottom: 0;\n            background: var(--base); z-index: 300;\n            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);\n        }\n        .app-container.active { transform: translateY(0); }\n        .app-header {\n            display: flex; align-items: center; justify-content: space-between;\n            padding: 12px 16px; background: var(--mantle);\n            border-bottom: 1px solid var(--surface0);\n            padding-top: calc(var(--safe-top) + 12px);\n        }\n        .app-title { font-size: 16px; font-weight: 600; }\n        .app-close {\n            width: 32px; height: 32px; border-radius: 50%;\n            background: var(--surface0); border: none; color: var(--text);\n            font-size: 20px; cursor: pointer; display: flex;\n            align-items: center; justify-content: center;\n        }\n        .app-frame { flex: 1; width: 100%; height: calc(100% - 56px - var(--safe-top)); border: none; }\n\n        /* Home Indicator */\n        .home-indicator {\n            position: fixed; bottom: 8px; left: 50%; transform: translateX(-50%);\n            width: 134px; height: 5px; background: var(--text);\n            border-radius: 3px; opacity: 0.3;\n        }\n        .app-container .home-indicator { opacity: 0.5; }\n\n        @media (min-width: 768px) {\n            .page { grid-template-columns: repeat(6, 1fr); max-width: 600px; margin: 0 auto; }\n            .dock { gap: 24px; padding: 14px 24px; }\n        }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003cdiv class=\"pages-wrapper\" id=\"pagesWrapper\"\u003e\n        \u003cdiv class=\"pages\" id=\"pages\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class=\"page-dots\" id=\"pageDots\"\u003e\u003c/div\u003e\n\n    \u003cdiv class=\"dock\" id=\"dock\"\u003e\u003c/div\u003e\n\n    \u003cdiv class=\"spotlight\" id=\"spotlight\"\u003e\n        \u003cinput type=\"text\" class=\"spotlight-input\" placeholder=\"Search apps...\" id=\"searchInput\" autocomplete=\"off\"\u003e\n        \u003cdiv class=\"spotlight-results\" id=\"searchResults\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class=\"app-container\" id=\"appContainer\"\u003e\n        \u003cdiv class=\"app-header\"\u003e\n            \u003cspan class=\"app-title\" id=\"appTitle\"\u003eApp\u003c/span\u003e\n            \u003cbutton class=\"app-close\" onclick=\"closeApp()\"\u003e\u0026#10005;\u003c/button\u003e\n        \u003c/div\u003e\n        \u003ciframe class=\"app-frame\" id=\"appFrame\"\u003e\u003c/iframe\u003e\n        \u003cdiv class=\"home-indicator\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class=\"home-indicator\"\u003e\u003c/div\u003e\n\n    \u003cscript\u003e\n        const HOST = \"''' + CLUSTER_HOST + '''\";\n        const registry = ''' + json.dumps(APP_REGISTRY) + ''';\n        const icons = ''' + json.dumps(ICONS) + ''';\n\n        let currentPage = 0;\n        let touchStartX = 0;\n        let touchStartY = 0;\n        let isDragging = false;\n        let isJiggling = false;\n        let longPressTimer = null;\n\n        function createIcon(iconName) {\n            return `\u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"\u003e${icons[iconName] || icons.sparkles}\u003c/svg\u003e`;\n        }\n\n        function createApp(app, inDock = false) {\n            return `\n                \u003cdiv class=\"app ${isJiggling ? 'jiggle' : ''}\" data-id=\"${app.id}\" data-port=\"${app.port}\"\n                     onclick=\"launchApp('${app.id}', '${app.name}', ${app.port})\"\n                     ontouchstart=\"handleTouchStart(event, '${app.id}')\"\n                     ontouchend=\"handleTouchEnd(event)\"\u003e\n                    \u003cdiv class=\"app-icon\" style=\"background: linear-gradient(135deg, ${app.color}, ${adjustColor(app.color, -30)})\"\u003e\n                        ${createIcon(app.icon)}\n                    \u003c/div\u003e\n                    ${!inDock ? `\u003cspan class=\"app-name\"\u003e${app.name}\u003c/span\u003e` : ''}\n                \u003c/div\u003e\n            `;\n        }\n\n        function adjustColor(hex, amount) {\n            const num = parseInt(hex.slice(1), 16);\n            const r = Math.max(0, Math.min(255, (num \u003e\u003e 16) + amount));\n            const g = Math.max(0, Math.min(255, ((num \u003e\u003e 8) \u0026 0xff) + amount));\n            const b = Math.max(0, Math.min(255, (num \u0026 0xff) + amount));\n            return `#${(r \u003c\u003c 16 | g \u003c\u003c 8 | b).toString(16).padStart(6, '0')}`;\n        }\n\n        function render() {\n            // Render pages\n            document.getElementById('pages').innerHTML = registry.pages.map(page =\u003e\n                `\u003cdiv class=\"page\"\u003e${page.apps.map(app =\u003e createApp(app)).join('')}\u003c/div\u003e`\n            ).join('');\n\n            // Render dock\n            document.getElementById('dock').innerHTML = registry.dock.map(app =\u003e createApp(app, true)).join('');\n\n            // Render page dots\n            document.getElementById('pageDots').innerHTML = registry.pages.map((_, i) =\u003e\n                `\u003cdiv class=\"dot ${i === currentPage ? 'active' : ''}\" onclick=\"goToPage(${i})\"\u003e\u003c/div\u003e`\n            ).join('');\n\n            updatePagePosition();\n        }\n\n        function goToPage(index) {\n            currentPage = Math.max(0, Math.min(registry.pages.length - 1, index));\n            updatePagePosition();\n            document.querySelectorAll('.dot').forEach((dot, i) =\u003e {\n                dot.classList.toggle('active', i === currentPage);\n            });\n        }\n\n        function updatePagePosition() {\n            document.getElementById('pages').style.transform = `translateX(-${currentPage * 100}%)`;\n        }\n\n        function launchApp(id, name, port) {\n            if (isJiggling) return;\n            if (!port) { alert(name + ' coming soon!'); return; }\n\n            document.getElementById('appTitle').textContent = name;\n            document.getElementById('appFrame').src = `http://${HOST}:${port}`;\n            document.getElementById('appContainer').classList.add('active');\n        }\n\n        function closeApp() {\n            document.getElementById('appContainer').classList.remove('active');\n            setTimeout(() =\u003e { document.getElementById('appFrame').src = ''; }, 300);\n        }\n\n        // Touch handling for swipe\n        const wrapper = document.getElementById('pagesWrapper');\n        wrapper.addEventListener('touchstart', e =\u003e {\n            touchStartX = e.touches[0].clientX;\n            touchStartY = e.touches[0].clientY;\n        });\n\n        wrapper.addEventListener('touchmove', e =\u003e {\n            if (Math.abs(e.touches[0].clientY - touchStartY) \u003e 50) return; // Vertical scroll\n            const diff = touchStartX - e.touches[0].clientX;\n            if (Math.abs(diff) \u003e 20) isDragging = true;\n        });\n\n        wrapper.addEventListener('touchend', e =\u003e {\n            if (!isDragging) return;\n            const diff = touchStartX - e.changedTouches[0].clientX;\n            if (diff \u003e 50) goToPage(currentPage + 1);\n            else if (diff \u003c -50) goToPage(currentPage - 1);\n            isDragging = false;\n        });\n\n        // Long press for jiggle mode\n        function handleTouchStart(e, appId) {\n            longPressTimer = setTimeout(() =\u003e {\n                isJiggling = !isJiggling;\n                render();\n            }, 500);\n        }\n\n        function handleTouchEnd(e) {\n            clearTimeout(longPressTimer);\n        }\n\n        // Pull down for spotlight\n        let pullStartY = 0;\n        document.addEventListener('touchstart', e =\u003e { pullStartY = e.touches[0].clientY; });\n        document.addEventListener('touchend', e =\u003e {\n            const pullDiff = e.changedTouches[0].clientY - pullStartY;\n            if (pullDiff \u003e 100 \u0026\u0026 pullStartY \u003c 100) {\n                document.getElementById('spotlight').classList.add('active');\n                document.getElementById('searchInput').focus();\n            }\n        });\n\n        // Spotlight search\n        document.getElementById('searchInput').addEventListener('input', e =\u003e {\n            const query = e.target.value.toLowerCase();\n            const allApps = [...registry.pages.flatMap(p =\u003e p.apps), ...registry.dock];\n            const results = allApps.filter(app =\u003e app.name.toLowerCase().includes(query));\n\n            document.getElementById('searchResults').innerHTML = results.map(app =\u003e `\n                \u003cdiv class=\"spotlight-result\" onclick=\"launchApp('${app.id}', '${app.name}', ${app.port}); closeSpotlight();\"\u003e\n                    \u003cdiv class=\"app-icon\" style=\"background: linear-gradient(135deg, ${app.color}, ${adjustColor(app.color, -30)})\"\u003e\n                        ${createIcon(app.icon)}\n                    \u003c/div\u003e\n                    \u003cspan\u003e${app.name}\u003c/span\u003e\n                \u003c/div\u003e\n            `).join('');\n        });\n\n        function closeSpotlight() {\n            document.getElementById('spotlight').classList.remove('active');\n            document.getElementById('searchInput').value = '';\n            document.getElementById('searchResults').innerHTML = '';\n        }\n\n        document.getElementById('spotlight').addEventListener('click', e =\u003e {\n            if (e.target.id === 'spotlight') closeSpotlight();\n        });\n\n        // Keyboard shortcuts\n        document.addEventListener('keydown', e =\u003e {\n            if (e.key === 'Escape') {\n                closeApp();\n                closeSpotlight();\n                isJiggling = false;\n                render();\n            }\n        });\n\n        render();\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e'''\n\n@app.route(\"/\")\ndef index():\n    return Response(INDEX_HTML, mimetype=\"text/html\")\n\n@app.route(\"/manifest.json\")\ndef manifest():\n    return jsonify({\n        \"name\": \"HolmOS\",\n        \"short_name\": \"HolmOS\",\n        \"start_url\": \"/\",\n        \"display\": \"standalone\",\n        \"background_color\": \"#1e1e2e\",\n        \"theme_color\": \"#1e1e2e\",\n        \"icons\": [\n            {\"src\": \"/icon-192.png\", \"sizes\": \"192x192\", \"type\": \"image/png\"},\n            {\"src\": \"/icon-512.png\", \"sizes\": \"512x512\", \"type\": \"image/png\"}\n        ]\n    })\n\n@app.route(\"/api/registry\")\ndef get_registry():\n    return jsonify(APP_REGISTRY)\n\n@app.route(\"/health\")\ndef health():\n    return jsonify({\"status\": \"healthy\"})\n\n@app.route(\"/ready\")\ndef ready():\n    return jsonify({\"status\": \"ready\"})\n\nif __name__ == \"__main__\":\n    port = int(os.environ.get(\"PORT\", 8080))\n    app.run(host=\"0.0.0.0\", port=port)\n","requirements.txt":"flask\u003e=2.3.0\ngunicorn\u003e=21.0.0\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"ios-shell-src","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:06:52Z"
    name: ios-shell-src
    namespace: holm
    resourceVersion: "746"
    uid: b2508bd3-dcc5-42cd-846f-3d8b206228ba
- apiVersion: v1
  data:
    ca.crt: |
      -----BEGIN CERTIFICATE-----
      MIIBdjCCAR2gAwIBAgIBADAKBggqhkjOPQQDAjAjMSEwHwYDVQQDDBhrM3Mtc2Vy
      dmVyLWNhQDE3Njg0ODg1OTUwHhcNMjYwMTE1MTQ0OTU1WhcNMzYwMTEzMTQ0OTU1
      WjAjMSEwHwYDVQQDDBhrM3Mtc2VydmVyLWNhQDE3Njg0ODg1OTUwWTATBgcqhkjO
      PQIBBggqhkjOPQMBBwNCAAS5M3qca7X6I+z9JEP6m2z24D0Vxp/N9riBEnGH45Cd
      2BskCdidQJnMjVhm+Cb/XskOINIf6xwmtSvUe0yvjF1eo0IwQDAOBgNVHQ8BAf8E
      BAMCAqQwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUirW/RlF+LEjL/PJV27md
      5o8hlsUwCgYIKoZIzj0EAwIDRwAwRAIgWFi90tm3iGOxztyDXsQS5Xmt3KWl3hX5
      GVkFVp7VWrYCIH350uTqoqKYVuEL3AXTToIVryQVnEEUCxKpDRVjLsm9
      -----END CERTIFICATE-----
  kind: ConfigMap
  metadata:
    annotations:
      kubernetes.io/description: Contains a CA bundle that can be used to verify the
        kube-apiserver when using internal endpoints such as the internal service
        IP or kubernetes.default.svc. No other usage is guaranteed across distributions
        of Kubernetes clusters.
    creationTimestamp: "2026-01-15T16:28:20Z"
    name: kube-root-ca.crt
    namespace: holm
    resourceVersion: "747"
    uid: 39c61389-6b79-443a-8985-f30f4569fe39
- apiVersion: v1
  data:
    kubeconfig.yaml: |
      apiVersion: v1
      clusters:
      - cluster:
          certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUzTmpnME9EZzFPVFV3SGhjTk1qWXdNVEUxTVRRME9UVTFXaGNOTXpZd01URXpNVFEwT1RVMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUzTmpnME9EZzFPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTNU0zcWNhN1g2SSt6OUpFUDZtMnoyNEQwVnhwL045cmlCRW5HSDQ1Q2QKMkJza0NkaWRRSm5NalZobStDYi9Yc2tPSU5JZjZ4d210U3ZVZTB5dmpGMWVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWlyVy9SbEYrTEVqTC9QSlYyN21kCjVvOGhsc1V3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnV0ZpOTB0bTNpR094enR5RFhzUVM1WG10M0tXbDNoWDUKR1ZrRlZwN1ZXcllDSUgzNTB1VHFvcUtZVnVFTDNBWFRUb0lWcnlRVm5FRVVDeEtwRFJWakxzbTkKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
          server: https://192.168.8.197:6443
        name: default
      contexts:
      - context:
          cluster: default
          user: default
        name: default
      current-context: default
      kind: Config
      users:
      - name: default
        user:
          client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJRVIyeGV5bXR1dWt3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOelk0TkRnNE5UazBNQjRYRFRJMk1ERXhOVEUwTkRrMU5Gb1hEVEkzTURFeApOVEUwTkRrMU5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJPTHJrcldhN0RJeXkrUlIKaDRHc2xTL3I3ZmdUeThMS1BFNEhnY0NIU1RhZ2JOcW9RTVJlNkpYbmFsa3VqSzQ4MjIyc0Y1eVpkWDRNWEdZTwpCbVp1S2EyalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCVHpNSXRreGNZdEhXV0ZZSVpEVXBoVU1BNVFWekFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlBY0dVeVZwb1dxb084dC9ReWZkZGxFZUhJUzRBeEd1SzlkUTBCVi9Ua1NjZ0loQUxLRHFXaHhwYlYram80Rgo4NGxRbjgzSUVMZzlveDFzcEV0bm13L3JsbE5SCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUzTmpnME9EZzFPVFF3SGhjTk1qWXdNVEUxTVRRME9UVTBXaGNOTXpZd01URXpNVFEwT1RVMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUzTmpnME9EZzFPVFF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTL3d2VUxMOHlTSCtHYk5jYk4wS3lJcGY4c1lSQUpDMjd6b3BhL1QwZEwKOWJ6ZWYzSWR1ZkVkT0p2NHZTWmRFdHpBWVNEc21WZUpIZzIxU3JHWFp4djlvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVTh6Q0xaTVhHTFIxbGhXQ0dRMUtZClZEQU9VRmN3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUlnVXlvZERhRnV1VkFUREZERDlUVlNyVGNRYlNxWC9FazIKVFA3WXNNNk4ybHNDSVFDQUllNWZwcWVBZWIxVzdzcFdEUTZlQkxocCtIVTNQbXdZZEhWM2x4R1crUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
          client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUhHVGwvOU5wUjlHMVZTRk5MV1ZoVGJxYko4aDRUSjg3UXB1aGdHaFRBRzhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFNHV1U3RacnNNakxMNUZHSGdheVZMK3Z0K0JQTHdzbzhUZ2VCd0lkSk5xQnMycWhBeEY3bwpsZWRxV1M2TXJqemJiYXdYbkpsMWZneGNaZzRHWm00cHJRPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"kubeconfig.yaml":"apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUzTmpnME9EZzFPVFV3SGhjTk1qWXdNVEUxTVRRME9UVTFXaGNOTXpZd01URXpNVFEwT1RVMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUzTmpnME9EZzFPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTNU0zcWNhN1g2SSt6OUpFUDZtMnoyNEQwVnhwL045cmlCRW5HSDQ1Q2QKMkJza0NkaWRRSm5NalZobStDYi9Yc2tPSU5JZjZ4d210U3ZVZTB5dmpGMWVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWlyVy9SbEYrTEVqTC9QSlYyN21kCjVvOGhsc1V3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnV0ZpOTB0bTNpR094enR5RFhzUVM1WG10M0tXbDNoWDUKR1ZrRlZwN1ZXcllDSUgzNTB1VHFvcUtZVnVFTDNBWFRUb0lWcnlRVm5FRVVDeEtwRFJWakxzbTkKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n    server: https://192.168.8.197:6443\n  name: default\ncontexts:\n- context:\n    cluster: default\n    user: default\n  name: default\ncurrent-context: default\nkind: Config\nusers:\n- name: default\n  user:\n    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJRVIyeGV5bXR1dWt3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOelk0TkRnNE5UazBNQjRYRFRJMk1ERXhOVEUwTkRrMU5Gb1hEVEkzTURFeApOVEUwTkRrMU5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJPTHJrcldhN0RJeXkrUlIKaDRHc2xTL3I3ZmdUeThMS1BFNEhnY0NIU1RhZ2JOcW9RTVJlNkpYbmFsa3VqSzQ4MjIyc0Y1eVpkWDRNWEdZTwpCbVp1S2EyalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCVHpNSXRreGNZdEhXV0ZZSVpEVXBoVU1BNVFWekFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlBY0dVeVZwb1dxb084dC9ReWZkZGxFZUhJUzRBeEd1SzlkUTBCVi9Ua1NjZ0loQUxLRHFXaHhwYlYram80Rgo4NGxRbjgzSUVMZzlveDFzcEV0bm13L3JsbE5SCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUzTmpnME9EZzFPVFF3SGhjTk1qWXdNVEUxTVRRME9UVTBXaGNOTXpZd01URXpNVFEwT1RVMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUzTmpnME9EZzFPVFF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTL3d2VUxMOHlTSCtHYk5jYk4wS3lJcGY4c1lSQUpDMjd6b3BhL1QwZEwKOWJ6ZWYzSWR1ZkVkT0p2NHZTWmRFdHpBWVNEc21WZUpIZzIxU3JHWFp4djlvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVTh6Q0xaTVhHTFIxbGhXQ0dRMUtZClZEQU9VRmN3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUlnVXlvZERhRnV1VkFUREZERDlUVlNyVGNRYlNxWC9FazIKVFA3WXNNNk4ybHNDSVFDQUllNWZwcWVBZWIxVzdzcFdEUTZlQkxocCtIVTNQbXdZZEhWM2x4R1crUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\n    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUhHVGwvOU5wUjlHMVZTRk5MV1ZoVGJxYko4aDRUSjg3UXB1aGdHaFRBRzhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFNHV1U3RacnNNakxMNUZHSGdheVZMK3Z0K0JQTHdzbzhUZ2VCd0lkSk5xQnMycWhBeEY3bwpsZWRxV1M2TXJqemJiYXdYbkpsMWZneGNaZzRHWm00cHJRPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=\n"},"kind":"ConfigMap","metadata":{"annotations":{},"creationTimestamp":null,"name":"kubeconfig","namespace":"holm"}}
    creationTimestamp: "2026-01-16T23:05:44Z"
    name: kubeconfig
    namespace: holm
    resourceVersion: "748"
    uid: e2370a5a-18b4-4e11-bc34-708e06d7d626
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder
      WORKDIR /app
      COPY go.mod ./
      COPY *.go ./
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o metrics-dashboard .

      FROM alpine:3.19
      RUN apk --no-cache add ca-certificates
      WORKDIR /app
      COPY --from=builder /app/metrics-dashboard .
      EXPOSE 8080
      CMD ["./metrics-dashboard"]
  kind: ConfigMap
  metadata:
    annotations:
      argocd.argoproj.io/tracking-id: holmos:/ConfigMap:holm/metrics-dashboard-dockerfile
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM golang:1.21-alpine AS builder\nWORKDIR /app\nCOPY go.mod ./\nCOPY *.go ./\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags=\"-s -w\" -o metrics-dashboard .\n\nFROM alpine:3.19\nRUN apk --no-cache add ca-certificates\nWORKDIR /app\nCOPY --from=builder /app/metrics-dashboard .\nEXPOSE 8080\nCMD [\"./metrics-dashboard\"]\n"},"kind":"ConfigMap","metadata":{"annotations":{"argocd.argoproj.io/tracking-id":"holmos:/ConfigMap:holm/metrics-dashboard-dockerfile"},"name":"metrics-dashboard-dockerfile","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:23:52Z"
    name: metrics-dashboard-dockerfile
    namespace: holm
    resourceVersion: "749"
    uid: 023fdac9-3641-48e5-8776-4343b94d1c7b
- apiVersion: v1
  data:
    Dockerfile: |
      FROM public.ecr.aws/docker/library/golang:1.21-alpine AS builder

      WORKDIR /app

      # Copy go mod file
      COPY go.mod ./

      # Copy source files
      COPY *.go ./

      # Build the binary
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o metrics-dashboard .

      # Final image
      FROM public.ecr.aws/docker/library/alpine:3.19

      RUN apk --no-cache add ca-certificates

      WORKDIR /app

      COPY --from=builder /app/metrics-dashboard .

      EXPOSE 8080

      CMD ["./metrics-dashboard"]
    dashboard.go: "package main\n\nimport (\n\t\"net/http\"\n)\n\nfunc serveDashboard(w
      http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w,
      r)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write([]byte(dashboardHTML))\n}\n\nconst
      dashboardHTML = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n
      \   <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n
      \   <title>Metrics Dashboard - HolmOS Cluster</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n
      \   <script src=\"https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js\"></script>\n
      \   <style>\n        :root {\n            --bg-primary: #0f0f1a;\n            --bg-secondary:
      #1a1a2e;\n            --bg-card: #16213e;\n            --bg-hover: #1f3460;\n
      \           --text-primary: #e4e4e7;\n            --text-secondary: #a1a1aa;\n
      \           --accent-blue: #3b82f6;\n            --accent-green: #10b981;\n
      \           --accent-yellow: #f59e0b;\n            --accent-red: #ef4444;\n
      \           --accent-purple: #8b5cf6;\n            --accent-cyan: #06b6d4;\n
      \           --border-color: #2d3748;\n        }\n        * { margin: 0; padding:
      0; box-sizing: border-box; }\n        body { font-family: 'Inter', -apple-system,
      BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary);
      min-height: 100vh; }\n        .app-container { display: flex; min-height: 100vh;
      }\n        .sidebar { width: 240px; background: var(--bg-secondary); border-right:
      1px solid var(--border-color); display: flex; flex-direction: column; position:
      fixed; height: 100vh; z-index: 100; }\n        .logo { padding: 20px; border-bottom:
      1px solid var(--border-color); display: flex; align-items: center; gap: 12px;
      }\n        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg,
      var(--accent-blue), var(--accent-purple)); border-radius: 8px; display: flex;
      align-items: center; justify-content: center; font-size: 18px; }\n        .logo
      h1 { font-size: 1.1rem; font-weight: 600; }\n        .logo span { color: var(--text-secondary);
      font-size: 0.75rem; }\n        .nav-menu { flex: 1; padding: 16px 0; }\n        .nav-item
      { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color:
      var(--text-secondary); cursor: pointer; transition: all 0.2s; border-left: 3px
      solid transparent; }\n        .nav-item:hover, .nav-item.active { background:
      var(--bg-hover); color: var(--text-primary); border-left-color: var(--accent-blue);
      }\n        .nav-item svg { width: 20px; height: 20px; }\n        .main-content
      { flex: 1; margin-left: 240px; padding: 24px; }\n        .header { display:
      flex; justify-content: space-between; align-items: center; margin-bottom: 24px;
      }\n        .header h2 { font-size: 1.5rem; font-weight: 600; }\n        .time-range-selector
      { display: flex; gap: 8px; background: var(--bg-secondary); padding: 4px; border-radius:
      8px; }\n        .time-btn { padding: 8px 16px; border: none; background: transparent;
      color: var(--text-secondary); border-radius: 6px; cursor: pointer; transition:
      all 0.2s; font-size: 0.875rem; }\n        .time-btn:hover { color: var(--text-primary);
      }\n        .time-btn.active { background: var(--accent-blue); color: white;
      }\n        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 16px; margin-bottom: 24px; }\n        .summary-card { background: var(--bg-card);
      border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); }\n
      \       .summary-card .label { color: var(--text-secondary); font-size: 0.875rem;
      margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }\n        .summary-card
      .value { font-size: 2rem; font-weight: 700; }\n        .summary-card .sub {
      color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px; }\n        .summary-card.cpu
      .value { color: var(--accent-cyan); }\n        .summary-card.memory .value {
      color: var(--accent-green); }\n        .summary-card.nodes .value { color: var(--accent-yellow);
      }\n        .summary-card.pods .value { color: var(--accent-purple); }\n        .charts-grid
      { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom:
      24px; }\n        .chart-card { background: var(--bg-card); border-radius: 12px;
      padding: 20px; border: 1px solid var(--border-color); }\n        .chart-card
      h3 { font-size: 1rem; margin-bottom: 16px; display: flex; align-items: center;
      gap: 8px; }\n        .chart-card h3::before { content: ''; width: 10px; height:
      10px; border-radius: 50%; }\n        .chart-card.cpu h3::before { background:
      var(--accent-cyan); }\n        .chart-card.memory h3::before { background: var(--accent-green);
      }\n        .chart-card.network h3::before { background: var(--accent-yellow);
      }\n        .chart-card.disk h3::before { background: var(--accent-purple); }\n
      \       .chart-container { height: 200px; position: relative; }\n        .section-title
      { font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; display: flex;
      align-items: center; gap: 8px; }\n        .nodes-grid { display: grid; grid-template-columns:
      repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 24px; }\n        .node-card
      { background: var(--bg-card); border-radius: 10px; padding: 16px; border: 1px
      solid var(--border-color); transition: all 0.2s; cursor: pointer; }\n        .node-card:hover
      { border-color: var(--accent-blue); transform: translateY(-2px); }\n        .node-card
      .node-header { display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px; }\n        .node-card .node-name { font-weight: 600; font-size:
      0.95rem; }\n        .status-badge { padding: 4px 10px; border-radius: 12px;
      font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }\n        .status-badge.ready
      { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }\n        .status-badge.notready
      { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }\n        .node-metrics
      { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }\n        .metric-item
      { display: flex; flex-direction: column; gap: 4px; }\n        .metric-item .metric-label
      { font-size: 0.75rem; color: var(--text-secondary); }\n        .metric-item
      .metric-bar { height: 6px; background: var(--bg-primary); border-radius: 3px;
      overflow: hidden; }\n        .metric-item .metric-bar-fill { height: 100%; border-radius:
      3px; transition: width 0.3s; }\n        .metric-item .metric-bar-fill.cpu {
      background: var(--accent-cyan); }\n        .metric-item .metric-bar-fill.memory
      { background: var(--accent-green); }\n        .metric-item .metric-value { font-size:
      0.85rem; font-weight: 600; }\n        .table-container { background: var(--bg-card);
      border-radius: 12px; border: 1px solid var(--border-color); overflow: hidden;
      margin-bottom: 24px; }\n        .table-header { padding: 16px 20px; border-bottom:
      1px solid var(--border-color); display: flex; justify-content: space-between;
      align-items: center; }\n        .table-header h3 { font-size: 1rem; }\n        .search-input
      { background: var(--bg-primary); border: 1px solid var(--border-color); padding:
      8px 12px; border-radius: 6px; color: var(--text-primary); width: 200px; }\n
      \       .search-input:focus { outline: none; border-color: var(--accent-blue);
      }\n        table { width: 100%; border-collapse: collapse; }\n        th, td
      { padding: 12px 20px; text-align: left; border-bottom: 1px solid var(--border-color);
      }\n        th { background: var(--bg-secondary); color: var(--text-secondary);
      font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }\n        tr:hover
      { background: var(--bg-hover); }\n        .deployment-name { font-weight: 600;
      }\n        .replica-badge { display: inline-flex; align-items: center; gap:
      4px; }\n        .replica-badge.healthy { color: var(--accent-green); }\n        .replica-badge.degraded
      { color: var(--accent-yellow); }\n        .alerts-container { display: grid;
      grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }\n        .alert-rules-card,
      .triggered-alerts-card { background: var(--bg-card); border-radius: 12px; border:
      1px solid var(--border-color); }\n        .alert-card-header { padding: 16px
      20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content:
      space-between; align-items: center; }\n        .alert-card-header h3 { font-size:
      1rem; }\n        .btn-add { background: var(--accent-blue); color: white; border:
      none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;
      display: flex; align-items: center; gap: 6px; }\n        .btn-add:hover { background:
      #2563eb; }\n        .alert-list { max-height: 300px; overflow-y: auto; }\n        .alert-item
      { padding: 12px 20px; border-bottom: 1px solid var(--border-color); display:
      flex; justify-content: space-between; align-items: center; }\n        .alert-item:last-child
      { border-bottom: none; }\n        .alert-info { display: flex; flex-direction:
      column; gap: 4px; }\n        .alert-name { font-weight: 600; font-size: 0.9rem;
      }\n        .alert-condition { color: var(--text-secondary); font-size: 0.8rem;
      }\n        .alert-actions { display: flex; gap: 8px; }\n        .btn-icon {
      background: transparent; border: none; color: var(--text-secondary); cursor:
      pointer; padding: 4px; }\n        .btn-icon:hover { color: var(--text-primary);
      }\n        .btn-icon.delete:hover { color: var(--accent-red); }\n        .triggered-alert
      { padding: 12px 20px; border-bottom: 1px solid var(--border-color); background:
      rgba(239, 68, 68, 0.1); }\n        .triggered-alert.resolved { background: transparent;
      opacity: 0.6; }\n        .triggered-alert .alert-message { font-weight: 600;
      color: var(--accent-red); margin-bottom: 4px; }\n        .triggered-alert.resolved
      .alert-message { color: var(--accent-green); }\n        .triggered-alert .alert-time
      { font-size: 0.75rem; color: var(--text-secondary); }\n        .modal-overlay
      { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,
      0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index:
      1000; }\n        .modal-overlay.active { display: flex; }\n        .modal {
      background: var(--bg-card); border-radius: 12px; width: 400px; max-width: 90%;
      }\n        .modal-header { padding: 20px; border-bottom: 1px solid var(--border-color);
      display: flex; justify-content: space-between; align-items: center; }\n        .modal-header
      h3 { font-size: 1.1rem; }\n        .modal-body { padding: 20px; }\n        .form-group
      { margin-bottom: 16px; }\n        .form-group label { display: block; margin-bottom:
      6px; font-size: 0.875rem; color: var(--text-secondary); }\n        .form-group
      input, .form-group select { width: 100%; padding: 10px 12px; background: var(--bg-primary);
      border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary);
      font-size: 0.9rem; }\n        .form-group input:focus, .form-group select:focus
      { outline: none; border-color: var(--accent-blue); }\n        .modal-footer
      { padding: 16px 20px; border-top: 1px solid var(--border-color); display: flex;
      justify-content: flex-end; gap: 12px; }\n        .btn-cancel { background: transparent;
      border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 6px;
      color: var(--text-secondary); cursor: pointer; }\n        .btn-cancel:hover
      { color: var(--text-primary); }\n        .btn-save { background: var(--accent-blue);
      border: none; padding: 8px 16px; border-radius: 6px; color: white; cursor: pointer;
      }\n        .btn-save:hover { background: #2563eb; }\n        .view-content {
      display: none; }\n        .view-content.active { display: block; }\n        @media
      (max-width: 1200px) { .summary-grid { grid-template-columns: repeat(2, 1fr);
      } .charts-grid { grid-template-columns: 1fr; } .alerts-container { grid-template-columns:
      1fr; } }\n        @media (max-width: 768px) { .sidebar { width: 60px; } .sidebar
      .logo h1, .sidebar .logo span, .sidebar .nav-item span { display: none; } .main-content
      { margin-left: 60px; } .summary-grid { grid-template-columns: 1fr; } }\n        ::-webkit-scrollbar
      { width: 8px; height: 8px; }\n        ::-webkit-scrollbar-track { background:
      var(--bg-primary); }\n        ::-webkit-scrollbar-thumb { background: var(--border-color);
      border-radius: 4px; }\n        ::-webkit-scrollbar-thumb:hover { background:
      #4a5568; }\n        .empty-state { padding: 40px; text-align: center; color:
      var(--text-secondary); }\n        .loading { display: flex; align-items: center;
      justify-content: center; padding: 40px; }\n        .spinner { width: 40px; height:
      40px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue);
      border-radius: 50%; animation: spin 1s linear infinite; }\n        @keyframes
      spin { to { transform: rotate(360deg); } }\n    </style>\n</head>\n<body>\n
      \   <div class=\"app-container\">\n        <nav class=\"sidebar\">\n            <div
      class=\"logo\">\n                <div class=\"logo-icon\">M</div>\n                <div>\n
      \                   <h1>Metrics</h1>\n                    <span>HolmOS Cluster</span>\n
      \               </div>\n            </div>\n            <div class=\"nav-menu\">\n
      \               <div class=\"nav-item active\" data-view=\"overview\">\n                    <svg
      xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4
      6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2
      2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2
      2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2
      2 0 01-2-2v-2z\" /></svg>\n                    <span>Overview</span>\n                </div>\n
      \               <div class=\"nav-item\" data-view=\"nodes\">\n                    <svg
      xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5
      12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2
      0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\" /></svg>\n
      \                   <span>Nodes</span>\n                </div>\n                <div
      class=\"nav-item\" data-view=\"deployments\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\"
      fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2
      2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0
      0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" /></svg>\n                    <span>Deployments</span>\n
      \               </div>\n                <div class=\"nav-item\" data-view=\"alerts\">\n
      \                   <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\"
      viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032
      2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165
      6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6
      0H9\" /></svg>\n                    <span>Alerts</span>\n                </div>\n
      \           </div>\n        </nav>\n        <main class=\"main-content\">\n
      \           <div id=\"overview-view\" class=\"view-content active\">\n                <div
      class=\"header\">\n                    <h2>Cluster Overview</h2>\n                    <div
      class=\"time-range-selector\">\n                        <button class=\"time-btn
      active\" data-range=\"1h\">1H</button>\n                        <button class=\"time-btn\"
      data-range=\"6h\">6H</button>\n                        <button class=\"time-btn\"
      data-range=\"24h\">24H</button>\n                        <button class=\"time-btn\"
      data-range=\"7d\">7D</button>\n                        <button class=\"time-btn\"
      data-range=\"30d\">30D</button>\n                    </div>\n                </div>\n
      \               <div class=\"summary-grid\">\n                    <div class=\"summary-card
      cpu\"><div class=\"label\">CPU Usage</div><div class=\"value\" id=\"cluster-cpu\">--</div><div
      class=\"sub\" id=\"cluster-cpu-detail\">-- cores used of -- cores</div></div>\n
      \                   <div class=\"summary-card memory\"><div class=\"label\">Memory
      Usage</div><div class=\"value\" id=\"cluster-memory\">--</div><div class=\"sub\"
      id=\"cluster-memory-detail\">-- GB used of -- GB</div></div>\n                    <div
      class=\"summary-card nodes\"><div class=\"label\">Nodes</div><div class=\"value\"
      id=\"cluster-nodes\">--</div><div class=\"sub\" id=\"cluster-nodes-detail\">--
      ready</div></div>\n                    <div class=\"summary-card pods\"><div
      class=\"label\">Pods</div><div class=\"value\" id=\"cluster-pods\">--</div><div
      class=\"sub\" id=\"cluster-deployments\">-- deployments</div></div>\n                </div>\n
      \               <div class=\"charts-grid\">\n                    <div class=\"chart-card
      cpu\"><h3>Cluster CPU</h3><div class=\"chart-container\"><canvas id=\"cluster-cpu-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card memory\"><h3>Cluster Memory</h3><div
      class=\"chart-container\"><canvas id=\"cluster-memory-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card network\"><h3>Node CPU Comparison</h3><div
      class=\"chart-container\"><canvas id=\"node-cpu-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card disk\"><h3>Node Memory Comparison</h3><div
      class=\"chart-container\"><canvas id=\"node-memory-chart\"></canvas></div></div>\n
      \               </div>\n            </div>\n            <div id=\"nodes-view\"
      class=\"view-content\">\n                <div class=\"header\"><h2>Cluster Nodes</h2></div>\n
      \               <div class=\"nodes-grid\" id=\"nodes-grid\"><div class=\"loading\"><div
      class=\"spinner\"></div></div></div>\n            </div>\n            <div id=\"deployments-view\"
      class=\"view-content\">\n                <div class=\"header\"><h2>Deployments</h2></div>\n
      \               <div class=\"table-container\">\n                    <div class=\"table-header\"><h3>All
      Deployments</h3><input type=\"text\" class=\"search-input\" placeholder=\"Search
      deployments...\" id=\"deployment-search\"></div>\n                    <table><thead><tr><th>Name</th><th>Namespace</th><th>Replicas</th><th>CPU</th><th>Memory</th></tr></thead><tbody
      id=\"deployments-table\"></tbody></table>\n                </div>\n            </div>\n
      \           <div id=\"alerts-view\" class=\"view-content\">\n                <div
      class=\"header\"><h2>Alert Management</h2></div>\n                <div class=\"alerts-container\">\n
      \                   <div class=\"alert-rules-card\">\n                        <div
      class=\"alert-card-header\"><h3>Alert Rules</h3><button class=\"btn-add\" onclick=\"openAlertModal()\"><svg
      width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12
      4v16m8-8H4\"/></svg>Add Rule</button></div>\n                        <div class=\"alert-list\"
      id=\"alert-rules-list\"></div>\n                    </div>\n                    <div
      class=\"triggered-alerts-card\">\n                        <div class=\"alert-card-header\"><h3>Triggered
      Alerts</h3></div>\n                        <div class=\"alert-list\" id=\"triggered-alerts-list\"></div>\n
      \                   </div>\n                </div>\n            </div>\n        </main>\n
      \   </div>\n    <div class=\"modal-overlay\" id=\"alert-modal\">\n        <div
      class=\"modal\">\n            <div class=\"modal-header\"><h3>Create Alert Rule</h3><button
      class=\"btn-icon\" onclick=\"closeAlertModal()\"><svg width=\"20\" height=\"20\"
      fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg></button></div>\n
      \           <div class=\"modal-body\">\n                <div class=\"form-group\"><label>Rule
      Name</label><input type=\"text\" id=\"alert-name\" placeholder=\"High CPU Alert\"></div>\n
      \               <div class=\"form-group\"><label>Metric</label><select id=\"alert-metric\"><option
      value=\"cpu\">CPU Usage (%)</option><option value=\"memory\">Memory Usage (%)</option></select></div>\n
      \               <div class=\"form-group\"><label>Condition</label><select id=\"alert-condition\"><option
      value=\">\">> Greater than</option><option value=\">=\">>= Greater than or equal</option><option
      value=\"<\">< Less than</option><option value=\"<=\"><= Less than or equal</option></select></div>\n
      \               <div class=\"form-group\"><label>Threshold (%)</label><input
      type=\"number\" id=\"alert-threshold\" placeholder=\"90\" min=\"0\" max=\"100\"></div>\n
      \               <div class=\"form-group\"><label>Node (leave empty for all)</label><select
      id=\"alert-node\"><option value=\"*\">All Nodes</option></select></div>\n            </div>\n
      \           <div class=\"modal-footer\"><button class=\"btn-cancel\" onclick=\"closeAlertModal()\">Cancel</button><button
      class=\"btn-save\" onclick=\"saveAlertRule()\">Create Rule</button></div>\n
      \       </div>\n    </div>\n    <script>\n        let currentTimeRange = '1h';\n
      \       let clusterCPUChart, clusterMemoryChart, nodeCPUChart, nodeMemoryChart;\n
      \       let nodes = [];\n        let deployments = [];\n        let alertRules
      = [];\n        let triggeredAlerts = [];\n        const chartConfig = {\n            responsive:
      true, maintainAspectRatio: false,\n            interaction: { intersect: false,
      mode: 'index' },\n            scales: {\n                x: { type: 'time',
      time: { unit: 'minute' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks:
      { color: '#a1a1aa' } },\n                y: { beginAtZero: true, max: 100, grid:
      { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a1a1aa', callback: (v)
      => v + '%' } }\n            },\n            plugins: { legend: { display: false
      }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748', borderWidth:
      1, titleColor: '#e4e4e7', bodyColor: '#a1a1aa', callbacks: { label: (ctx) =>
      ctx.parsed.y.toFixed(1) + '%' } } },\n            elements: { point: { radius:
      0 }, line: { tension: 0.3, borderWidth: 2 } }\n        };\n        const barChartConfig
      = {\n            responsive: true, maintainAspectRatio: false, indexAxis: 'y',\n
      \           scales: { x: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)'
      }, ticks: { color: '#a1a1aa', callback: (v) => v + '%' } }, y: { grid: { display:
      false }, ticks: { color: '#a1a1aa' } } },\n            plugins: { legend: {
      display: false }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748',
      borderWidth: 1, callbacks: { label: (ctx) => ctx.parsed.x.toFixed(1) + '%' }
      } }\n        };\n        function initCharts() {\n            clusterCPUChart
      = new Chart(document.getElementById('cluster-cpu-chart').getContext('2d'), {
      type: 'line', data: { datasets: [{ label: 'CPU', data: [], borderColor: '#06b6d4',
      backgroundColor: 'rgba(6, 182, 212, 0.1)', fill: true }] }, options: chartConfig
      });\n            clusterMemoryChart = new Chart(document.getElementById('cluster-memory-chart').getContext('2d'),
      { type: 'line', data: { datasets: [{ label: 'Memory', data: [], borderColor:
      '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true }] }, options:
      chartConfig });\n            nodeCPUChart = new Chart(document.getElementById('node-cpu-chart').getContext('2d'),
      { type: 'bar', data: { labels: [], datasets: [{ label: 'CPU %', data: [], backgroundColor:
      '#06b6d4' }] }, options: barChartConfig });\n            nodeMemoryChart = new
      Chart(document.getElementById('node-memory-chart').getContext('2d'), { type:
      'bar', data: { labels: [], datasets: [{ label: 'Memory %', data: [], backgroundColor:
      '#10b981' }] }, options: barChartConfig });\n        }\n        async function
      fetchClusterSummary() {\n            try {\n                const r = await
      fetch('/api/cluster'); const d = await r.json();\n                document.getElementById('cluster-cpu').textContent
      = d.cpu_pct.toFixed(1) + '%';\n                document.getElementById('cluster-cpu-detail').textContent
      = (d.used_cpu_cores/1000).toFixed(1) + ' cores of ' + (d.total_cpu_cores/1000).toFixed(1)
      + ' cores';\n                document.getElementById('cluster-memory').textContent
      = d.memory_pct.toFixed(1) + '%';\n                document.getElementById('cluster-memory-detail').textContent
      = d.used_memory_gb.toFixed(1) + ' GB of ' + d.total_memory_gb.toFixed(1) + '
      GB';\n                document.getElementById('cluster-nodes').textContent =
      d.total_nodes;\n                document.getElementById('cluster-nodes-detail').textContent
      = d.ready_nodes + ' ready';\n                document.getElementById('cluster-pods').textContent
      = d.total_pods;\n                document.getElementById('cluster-deployments').textContent
      = d.total_deployments + ' deployments';\n            } catch (e) { console.error('Failed
      to fetch cluster summary:', e); }\n        }\n        async function fetchNodes()
      {\n            try { const r = await fetch('/api/nodes'); nodes = await r.json();
      updateNodesGrid(); updateNodeCharts(); updateAlertNodeSelector(); } catch (e)
      { console.error('Failed to fetch nodes:', e); }\n        }\n        async function
      fetchDeployments() {\n            try { const r = await fetch('/api/deployments?namespace=holm');
      deployments = await r.json(); updateDeploymentsTable(); } catch (e) { console.error('Failed
      to fetch deployments:', e); }\n        }\n        async function fetchHistory()
      {\n            try {\n                const cpuR = await fetch('/api/history?metric=cluster_cpu&range='
      + currentTimeRange); const cpuD = await cpuR.json();\n                const
      memR = await fetch('/api/history?metric=cluster_mem&range=' + currentTimeRange);
      const memD = await memR.json();\n                if (cpuD && cpuD.length > 0)
      { clusterCPUChart.data.datasets[0].data = cpuD.map(p => ({ x: new Date(p.timestamp),
      y: p.value })); clusterCPUChart.update('none'); }\n                if (memD
      && memD.length > 0) { clusterMemoryChart.data.datasets[0].data = memD.map(p
      => ({ x: new Date(p.timestamp), y: p.value })); clusterMemoryChart.update('none');
      }\n            } catch (e) { console.error('Failed to fetch history:', e); }\n
      \       }\n        async function fetchAlertRules() { try { const r = await
      fetch('/api/alerts/rules'); alertRules = await r.json(); updateAlertRulesList();
      } catch (e) { console.error('Failed to fetch alert rules:', e); } }\n        async
      function fetchTriggeredAlerts() { try { const r = await fetch('/api/alerts/triggered');
      triggeredAlerts = await r.json(); updateTriggeredAlertsList(); } catch (e) {
      console.error('Failed to fetch triggered alerts:', e); } }\n        function
      updateNodesGrid() {\n            const g = document.getElementById('nodes-grid');\n
      \           if (!nodes || nodes.length === 0) { g.innerHTML = '<div class=\"empty-state\">No
      nodes found</div>'; return; }\n            g.innerHTML = nodes.map(n => '<div
      class=\"node-card\" onclick=\"showNodeDetails(\\'' + n.name + '\\')\"><div class=\"node-header\"><span
      class=\"node-name\">' + n.name + '</span><span class=\"status-badge ' + (n.status
      === 'Ready' ? 'ready' : 'notready') + '\">' + n.status + '</span></div><div
      class=\"node-metrics\"><div class=\"metric-item\"><span class=\"metric-label\">CPU</span><div
      class=\"metric-bar\"><div class=\"metric-bar-fill cpu\" style=\"width: ' + Math.min(100,
      n.cpu_pct) + '%\"></div></div><span class=\"metric-value\">' + n.cpu_pct.toFixed(1)
      + '%</span></div><div class=\"metric-item\"><span class=\"metric-label\">Memory</span><div
      class=\"metric-bar\"><div class=\"metric-bar-fill memory\" style=\"width: '
      + Math.min(100, n.memory_pct) + '%\"></div></div><span class=\"metric-value\">'
      + n.memory_pct.toFixed(1) + '%</span></div></div><div style=\"margin-top: 12px;
      color: var(--text-secondary); font-size: 0.8rem;\">' + n.pods + ' pods | ' +
      (n.cpu_cores/1000).toFixed(2) + ' CPU | ' + (n.memory_mb/1024).toFixed(1) +
      ' GB RAM</div></div>').join('');\n        }\n        function updateNodeCharts()
      {\n            if (!nodes || nodes.length === 0) return;\n            nodeCPUChart.data.labels
      = nodes.map(n => n.name);\n            nodeCPUChart.data.datasets[0].data =
      nodes.map(n => n.cpu_pct);\n            nodeCPUChart.data.datasets[0].backgroundColor
      = nodes.map(n => n.cpu_pct > 80 ? '#ef4444' : n.cpu_pct > 60 ? '#f59e0b' : '#06b6d4');\n
      \           nodeCPUChart.update('none');\n            nodeMemoryChart.data.labels
      = nodes.map(n => n.name);\n            nodeMemoryChart.data.datasets[0].data
      = nodes.map(n => n.memory_pct);\n            nodeMemoryChart.data.datasets[0].backgroundColor
      = nodes.map(n => n.memory_pct > 80 ? '#ef4444' : n.memory_pct > 60 ? '#f59e0b'
      : '#10b981');\n            nodeMemoryChart.update('none');\n        }\n        function
      updateDeploymentsTable() {\n            const t = document.getElementById('deployments-table');
      const s = document.getElementById('deployment-search').value.toLowerCase();\n
      \           const f = deployments.filter(d => d.name.toLowerCase().includes(s)
      || d.namespace.toLowerCase().includes(s));\n            if (f.length === 0)
      { t.innerHTML = '<tr><td colspan=\"5\" class=\"empty-state\">No deployments
      found</td></tr>'; return; }\n            t.innerHTML = f.map(d => '<tr><td class=\"deployment-name\">'
      + d.name + '</td><td>' + d.namespace + '</td><td><span class=\"replica-badge
      ' + (d.ready >= d.replicas ? 'healthy' : 'degraded') + '\">' + d.ready + '/'
      + d.replicas + '</span></td><td>' + d.cpu_total.toFixed(0) + 'm</td><td>' +
      d.memory_mb.toFixed(0) + ' MB</td></tr>').join('');\n        }\n        function
      updateAlertRulesList() {\n            const l = document.getElementById('alert-rules-list');\n
      \           if (!alertRules || alertRules.length === 0) { l.innerHTML = '<div
      class=\"empty-state\">No alert rules configured</div>'; return; }\n            l.innerHTML
      = alertRules.map(r => '<div class=\"alert-item\"><div class=\"alert-info\"><span
      class=\"alert-name\">' + r.name + '</span><span class=\"alert-condition\">'
      + r.metric.toUpperCase() + ' ' + r.condition + ' ' + r.threshold + '% on ' +
      (r.node === '*' ? 'all nodes' : r.node) + '</span></div><div class=\"alert-actions\"><button
      class=\"btn-icon delete\" onclick=\"deleteAlertRule(\\'' + r.id + '\\')\" title=\"Delete\"><svg
      width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19
      7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1
      1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/></svg></button></div></div>').join('');\n
      \       }\n        function updateTriggeredAlertsList() {\n            const
      l = document.getElementById('triggered-alerts-list');\n            if (!triggeredAlerts
      || triggeredAlerts.length === 0) { l.innerHTML = '<div class=\"empty-state\">No
      alerts triggered</div>'; return; }\n            const sorted = [...triggeredAlerts].sort((a,
      b) => new Date(b.timestamp) - new Date(a.timestamp));\n            l.innerHTML
      = sorted.map(a => '<div class=\"triggered-alert ' + (a.resolved ? 'resolved'
      : '') + '\"><div class=\"alert-message\">' + a.message + '</div><div class=\"alert-condition\">Value:
      ' + a.value.toFixed(1) + '% (threshold: ' + a.threshold + '%)</div><div class=\"alert-time\">'
      + new Date(a.timestamp).toLocaleString() + '</div>' + (!a.resolved ? '<button
      class=\"btn-icon\" onclick=\"resolveAlert(\\'' + a.id + '\\')\" style=\"margin-top:
      8px;\">Mark Resolved</button>' : '') + '</div>').join('');\n        }\n        function
      updateAlertNodeSelector() { const s = document.getElementById('alert-node');
      s.innerHTML = '<option value=\"*\">All Nodes</option>'; nodes.forEach(n => {
      s.innerHTML += '<option value=\"' + n.name + '\">' + n.name + '</option>'; });
      }\n        function openAlertModal() { document.getElementById('alert-modal').classList.add('active');
      }\n        function closeAlertModal() { document.getElementById('alert-modal').classList.remove('active');
      document.getElementById('alert-name').value = ''; document.getElementById('alert-threshold').value
      = ''; }\n        async function saveAlertRule() {\n            const r = { name:
      document.getElementById('alert-name').value, metric: document.getElementById('alert-metric').value,
      condition: document.getElementById('alert-condition').value, threshold: parseFloat(document.getElementById('alert-threshold').value),
      node: document.getElementById('alert-node').value, enabled: true };\n            if
      (!r.name || isNaN(r.threshold)) { alert('Please fill in all required fields');
      return; }\n            try { await fetch('/api/alerts/rules', { method: 'POST',
      headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(r) });
      closeAlertModal(); fetchAlertRules(); } catch (e) { console.error('Failed to
      create alert rule:', e); }\n        }\n        async function deleteAlertRule(id)
      { if (!confirm('Delete this alert rule?')) return; try { await fetch('/api/alerts/rules?id='
      + id, { method: 'DELETE' }); fetchAlertRules(); } catch (e) { console.error('Failed
      to delete alert rule:', e); } }\n        async function resolveAlert(id) { try
      { await fetch('/api/alerts/resolve?id=' + id, { method: 'POST' }); fetchTriggeredAlerts();
      } catch (e) { console.error('Failed to resolve alert:', e); } }\n        function
      showNodeDetails(nodeName) { console.log('Show details for:', nodeName); }\n
      \       document.querySelectorAll('.nav-item').forEach(i => { i.addEventListener('click',
      () => { document.querySelectorAll('.nav-item').forEach(j => j.classList.remove('active'));
      i.classList.add('active'); const v = i.dataset.view; document.querySelectorAll('.view-content').forEach(c
      => c.classList.remove('active')); document.getElementById(v + '-view').classList.add('active');
      }); });\n        document.querySelectorAll('.time-btn').forEach(b => { b.addEventListener('click',
      () => { document.querySelectorAll('.time-btn').forEach(c => c.classList.remove('active'));
      b.classList.add('active'); currentTimeRange = b.dataset.range; let u = 'minute';
      if (currentTimeRange === '7d' || currentTimeRange === '30d') u = 'day'; else
      if (currentTimeRange === '24h') u = 'hour'; clusterCPUChart.options.scales.x.time.unit
      = u; clusterMemoryChart.options.scales.x.time.unit = u; fetchHistory(); });
      });\n        document.getElementById('deployment-search').addEventListener('input',
      updateDeploymentsTable);\n        function init() { initCharts(); fetchClusterSummary();
      fetchNodes(); fetchDeployments(); fetchHistory(); fetchAlertRules(); fetchTriggeredAlerts();
      setInterval(() => { fetchClusterSummary(); fetchNodes(); fetchHistory(); fetchTriggeredAlerts();
      }, 10000); setInterval(fetchDeployments, 30000); }\n        init();\n    </script>\n</body>\n</html>`\n"
    go.mod: |
      module settings-web

      go 1.21
    main.go: "package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"net/url\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n)\n\n//
      Metrics storage\nvar (\n\tmetricsHistory   = make(map[string][]MetricPoint)\n\talertRules
      \      = []AlertRule{}\n\ttriggeredAlerts  = []TriggeredAlert{}\n\thistoryMutex
      \    = sync.RWMutex{}\n\talertMutex       = sync.RWMutex{}\n\tmaxHistoryPoints
      = 8640 // 24 hours at 10-second intervals or 30 days at 5-min intervals\n)\n\n//
      Data structures\ntype MetricPoint struct {\n\tTimestamp time.Time `json:\"timestamp\"`\n\tValue
      \    float64   `json:\"value\"`\n\tNode      string    `json:\"node,omitempty\"`\n}\n\ntype
      NodeMetrics struct {\n\tName      string  `json:\"name\"`\n\tCPUCores  float64
      `json:\"cpu_cores\"`\n\tCPUPct    float64 `json:\"cpu_pct\"`\n\tMemoryMB  float64
      `json:\"memory_mb\"`\n\tMemoryPct float64 `json:\"memory_pct\"`\n\tPods      int
      \    `json:\"pods\"`\n\tStatus    string  `json:\"status\"`\n}\n\ntype PodMetrics
      struct {\n\tName       string  `json:\"name\"`\n\tNamespace  string  `json:\"namespace\"`\n\tNode
      \      string  `json:\"node\"`\n\tCPUm       float64 `json:\"cpu_m\"`\n\tMemoryMB
      \  float64 `json:\"memory_mb\"`\n\tStatus     string  `json:\"status\"`\n\tDeployment
      string  `json:\"deployment\"`\n}\n\ntype DeploymentMetrics struct {\n\tName
      \      string       `json:\"name\"`\n\tNamespace  string       `json:\"namespace\"`\n\tReplicas
      \  int          `json:\"replicas\"`\n\tReady      int          `json:\"ready\"`\n\tCPUTotal
      \  float64      `json:\"cpu_total\"`\n\tMemoryMB   float64      `json:\"memory_mb\"`\n\tPodMetrics
      []PodMetrics `json:\"pods\"`\n}\n\ntype ClusterSummary struct {\n\tTotalNodes
      \      int     `json:\"total_nodes\"`\n\tReadyNodes       int     `json:\"ready_nodes\"`\n\tTotalPods
      \       int     `json:\"total_pods\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tTotalCPUCores
      \   float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores     float64 `json:\"used_cpu_cores\"`\n\tTotalMemoryGB
      \   float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tCPUPct
      \          float64 `json:\"cpu_pct\"`\n\tMemoryPct        float64 `json:\"memory_pct\"`\n}\n\ntype
      AlertRule struct {\n\tID          string    `json:\"id\"`\n\tName        string
      \   `json:\"name\"`\n\tMetric      string    `json:\"metric\"`\n\tCondition
      \  string    `json:\"condition\"`\n\tThreshold   float64   `json:\"threshold\"`\n\tNode
      \       string    `json:\"node\"`\n\tNamespace   string    `json:\"namespace,omitempty\"`\n\tPod
      \        string    `json:\"pod,omitempty\"`\n\tSeverity    string    `json:\"severity\"`
      // critical, warning, info\n\tDuration    int       `json:\"duration\"` // seconds
      threshold must be exceeded\n\tEnabled     bool      `json:\"enabled\"`\n\tCreated
      \    time.Time `json:\"created\"`\n\tLastChecked time.Time `json:\"last_checked,omitempty\"`\n}\n\ntype
      TriggeredAlert struct {\n\tID           string    `json:\"id\"`\n\tRuleID       string
      \   `json:\"rule_id\"`\n\tRuleName     string    `json:\"rule_name\"`\n\tMessage
      \     string    `json:\"message\"`\n\tValue        float64   `json:\"value\"`\n\tThreshold
      \   float64   `json:\"threshold\"`\n\tSeverity     string    `json:\"severity\"`\n\tNode
      \        string    `json:\"node,omitempty\"`\n\tNamespace    string    `json:\"namespace,omitempty\"`\n\tPod
      \         string    `json:\"pod,omitempty\"`\n\tMetric       string    `json:\"metric\"`\n\tTimestamp
      \   time.Time `json:\"timestamp\"`\n\tResolvedAt   time.Time `json:\"resolved_at,omitempty\"`\n\tResolved
      \    bool      `json:\"resolved\"`\n\tAcknowledged bool      `json:\"acknowledged\"`\n}\n\n//
      ClusterMetrics represents comprehensive cluster-wide metrics\ntype ClusterMetrics
      struct {\n\tTimestamp      time.Time              `json:\"timestamp\"`\n\tSummary
      \       ClusterSummary         `json:\"summary\"`\n\tNodeMetrics    []NodeMetrics
      \         `json:\"node_metrics\"`\n\tTopPodsByCPU   []PodMetrics           `json:\"top_pods_by_cpu\"`\n\tTopPodsByMem
      \  []PodMetrics           `json:\"top_pods_by_memory\"`\n\tNamespaces     []NamespaceMetrics
      \    `json:\"namespaces\"`\n\tResourceQuotas []ResourceQuotaStatus  `json:\"resource_quotas,omitempty\"`\n\tAlerts
      \        AlertsSummary          `json:\"alerts\"`\n}\n\n// NamespaceMetrics
      contains metrics aggregated by namespace\ntype NamespaceMetrics struct {\n\tName
      \       string  `json:\"name\"`\n\tPodCount    int     `json:\"pod_count\"`\n\tCPUUsage
      \   float64 `json:\"cpu_usage_m\"`\n\tMemoryUsage float64 `json:\"memory_usage_mb\"`\n\tCPUPct
      \     float64 `json:\"cpu_pct\"`\n\tMemoryPct   float64 `json:\"memory_pct\"`\n}\n\n//
      ResourceQuotaStatus represents quota usage\ntype ResourceQuotaStatus struct
      {\n\tNamespace  string  `json:\"namespace\"`\n\tCPUUsed    float64 `json:\"cpu_used\"`\n\tCPULimit
      \  float64 `json:\"cpu_limit\"`\n\tMemUsed    float64 `json:\"mem_used_mb\"`\n\tMemLimit
      \  float64 `json:\"mem_limit_mb\"`\n\tPodsUsed   int     `json:\"pods_used\"`\n\tPodsLimit
      \ int     `json:\"pods_limit\"`\n}\n\n// AlertsSummary provides alert statistics\ntype
      AlertsSummary struct {\n\tTotal      int `json:\"total\"`\n\tCritical   int
      `json:\"critical\"`\n\tWarning    int `json:\"warning\"`\n\tInfo       int `json:\"info\"`\n\tActive
      \    int `json:\"active\"`\n\tResolved   int `json:\"resolved\"`\n}\n\n// NodeDetailedMetrics
      provides in-depth metrics for a single node\ntype NodeDetailedMetrics struct
      {\n\tNodeMetrics\n\tAllocatable   ResourceCapacity  `json:\"allocatable\"`\n\tCapacity
      \     ResourceCapacity  `json:\"capacity\"`\n\tConditions    []NodeCondition
      \  `json:\"conditions\"`\n\tPods          []PodMetrics      `json:\"pods\"`\n\tCPUHistory
      \   []MetricPoint     `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint
      \    `json:\"memory_history\"`\n\tLabels        map[string]string `json:\"labels,omitempty\"`\n\tTaints
      \       []string          `json:\"taints,omitempty\"`\n}\n\n// ResourceCapacity
      represents node resource capacity\ntype ResourceCapacity struct {\n\tCPU     float64
      `json:\"cpu_cores\"`\n\tMemory  float64 `json:\"memory_mb\"`\n\tPods    int
      \    `json:\"pods\"`\n\tStorage float64 `json:\"storage_gb,omitempty\"`\n}\n\n//
      NodeCondition represents node status conditions\ntype NodeCondition struct {\n\tType
      \   string `json:\"type\"`\n\tStatus  string `json:\"status\"`\n\tMessage string
      `json:\"message,omitempty\"`\n}\n\n// PodDetailedMetrics provides in-depth metrics
      for a single pod\ntype PodDetailedMetrics struct {\n\tPodMetrics\n\tContainers
      \   []ContainerMetrics `json:\"containers\"`\n\tRestartCount  int                `json:\"restart_count\"`\n\tStartTime
      \    time.Time          `json:\"start_time\"`\n\tCPUHistory    []MetricPoint
      \     `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint      `json:\"memory_history\"`\n\tEvents
      \       []PodEvent         `json:\"events,omitempty\"`\n\tLabels        map[string]string
      \ `json:\"labels,omitempty\"`\n}\n\n// ContainerMetrics represents metrics for
      individual containers\ntype ContainerMetrics struct {\n\tName         string
      \ `json:\"name\"`\n\tCPUm         float64 `json:\"cpu_m\"`\n\tMemoryMB     float64
      `json:\"memory_mb\"`\n\tRestartCount int     `json:\"restart_count\"`\n\tReady
      \       bool    `json:\"ready\"`\n\tState        string  `json:\"state\"`\n}\n\n//
      PodEvent represents a Kubernetes event\ntype PodEvent struct {\n\tType      string
      \   `json:\"type\"`\n\tReason    string    `json:\"reason\"`\n\tMessage   string
      \   `json:\"message\"`\n\tCount     int       `json:\"count\"`\n\tTimestamp
      time.Time `json:\"timestamp\"`\n}\n\n// HistoricalData represents a time-series
      response\ntype HistoricalData struct {\n\tMetric     string        `json:\"metric\"`\n\tNode
      \      string        `json:\"node,omitempty\"`\n\tNamespace  string        `json:\"namespace,omitempty\"`\n\tPod
      \       string        `json:\"pod,omitempty\"`\n\tResolution string        `json:\"resolution\"`\n\tStart
      \     time.Time     `json:\"start\"`\n\tEnd        time.Time     `json:\"end\"`\n\tPoints
      \    []MetricPoint `json:\"points\"`\n}\n\n// AlertsResponse provides unified
      alerts API response\ntype AlertsResponse struct {\n\tRules     []AlertRule      `json:\"rules\"`\n\tTriggered
      []TriggeredAlert `json:\"triggered\"`\n\tSummary   AlertsSummary    `json:\"summary\"`\n}\n\n//
      K8s API response structures\ntype K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric
      `json:\"items\"`\n}\n\ntype K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName
      string `json:\"name\"`\n\t} `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string
      `json:\"cpu\"`\n\t\tMemory string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype
      K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype
      K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct
      {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string
      `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t}
      `json:\"containers\"`\n}\n\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype
      K8sNode struct {\n\tMetadata struct {\n\t\tName   string            `json:\"name\"`\n\t\tLabels
      map[string]string `json:\"labels\"`\n\t} `json:\"metadata\"`\n\tSpec struct
      {\n\t\tTaints []struct {\n\t\t\tKey    string `json:\"key\"`\n\t\t\tValue  string
      `json:\"value\"`\n\t\t\tEffect string `json:\"effect\"`\n\t\t} `json:\"taints\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType    string
      `json:\"type\"`\n\t\t\tStatus  string `json:\"status\"`\n\t\t\tMessage string
      `json:\"message\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity struct {\n\t\t\tCPU
      \    string `json:\"cpu\"`\n\t\t\tMemory  string `json:\"memory\"`\n\t\t\tPods
      \   string `json:\"pods\"`\n\t\t\tStorage string `json:\"ephemeral-storage\"`\n\t\t}
      `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU     string `json:\"cpu\"`\n\t\t\tMemory
      \ string `json:\"memory\"`\n\t\t\tPods    string `json:\"pods\"`\n\t\t\tStorage
      string `json:\"ephemeral-storage\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sPodList struct {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct
      {\n\tMetadata struct {\n\t\tName              string            `json:\"name\"`\n\t\tNamespace
      \        string            `json:\"namespace\"`\n\t\tLabels            map[string]string
      `json:\"labels\"`\n\t\tCreationTimestamp string            `json:\"creationTimestamp\"`\n\t\tOwnerReferences
      \  []struct {\n\t\t\tKind string `json:\"kind\"`\n\t\t\tName string `json:\"name\"`\n\t\t}
      `json:\"ownerReferences\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName
      \  string `json:\"nodeName\"`\n\t\tContainers []struct {\n\t\t\tName      string
      `json:\"name\"`\n\t\t\tResources struct {\n\t\t\t\tRequests struct {\n\t\t\t\t\tCPU
      \   string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t}
      `json:\"requests\"`\n\t\t\t\tLimits struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory
      string `json:\"memory\"`\n\t\t\t\t} `json:\"limits\"`\n\t\t\t} `json:\"resources\"`\n\t\t}
      `json:\"containers\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string
      \   `json:\"phase\"`\n\t\tStartTime         string    `json:\"startTime\"`\n\t\tContainerStatuses
      []struct {\n\t\t\tName         string `json:\"name\"`\n\t\t\tReady        bool
      \  `json:\"ready\"`\n\t\t\tRestartCount int    `json:\"restartCount\"`\n\t\t\tState
      \       struct {\n\t\t\t\tRunning    *struct{} `json:\"running\"`\n\t\t\t\tWaiting
      \   *struct{ Reason string `json:\"reason\"` } `json:\"waiting\"`\n\t\t\t\tTerminated
      *struct{ Reason string `json:\"reason\"` } `json:\"terminated\"`\n\t\t\t} `json:\"state\"`\n\t\t}
      `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype K8sDeploymentList
      struct {\n\tItems []K8sDeployment `json:\"items\"`\n}\n\ntype K8sDeployment
      struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas
      int `json:\"replicas\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tReplicas
      \     int `json:\"replicas\"`\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t}
      `json:\"status\"`\n}\n\n// PrometheusResponse for historical queries\ntype PrometheusResponse
      struct {\n\tStatus string `json:\"status\"`\n\tData   struct {\n\t\tResultType
      string `json:\"resultType\"`\n\t\tResult     []struct {\n\t\t\tMetric map[string]string
      `json:\"metric\"`\n\t\t\tValues [][]interface{}   `json:\"values\"`\n\t\t} `json:\"result\"`\n\t}
      `json:\"data\"`\n}\n\n// K8s API client\nfunc k8sAPIRequest(path string) ([]byte,
      error) {\n\ttoken, err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token:
      %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort
      := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer
      = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\",
      apiServer, apiPort, path)\n\n\ttransport := &http.Transport{\n\t\tTLSClientConfig:
      &tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := &http.Client{\n\t\tTransport:
      transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\",
      apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\",
      \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n//
      Prometheus query helper\nfunc queryPrometheus(query string, start, end time.Time,
      step string) (*PrometheusResponse, error) {\n\tpromURL := os.Getenv(\"PROMETHEUS_URL\")\n\tif
      promURL == \"\" {\n\t\tpromURL = \"http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\"\n\t}\n\n\tparams
      := url.Values{}\n\tparams.Set(\"query\", query)\n\tparams.Set(\"start\", strconv.FormatInt(start.Unix(),
      10))\n\tparams.Set(\"end\", strconv.FormatInt(end.Unix(), 10))\n\tparams.Set(\"step\",
      step)\n\n\tresp, err := http.Get(fmt.Sprintf(\"%s/api/v1/query_range?%s\", promURL,
      params.Encode()))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tvar
      result PrometheusResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&result);
      err != nil {\n\t\treturn nil, err\n\t}\n\treturn &result, nil\n}\n\n// Parse
      K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif
      strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif
      strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn
      val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts
      = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\")
      {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if
      strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier
      = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s,
      \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s,
      64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch
      all metrics from K8s\nfunc fetchNodeMetrics() ([]NodeMetrics, error) {\n\t//
      Get node metrics\n\tmetricsData, err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeMetricsList K8sNodeMetricsList\n\tif
      err := json.Unmarshal(metricsData, &nodeMetricsList); err != nil {\n\t\treturn
      nil, err\n\t}\n\n\t// Get node info for capacity\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err
      := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get pod counts per node\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err
      := json.Unmarshal(podData, &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tpodCounts
      := make(map[string]int)\n\tfor _, pod := range podList.Items {\n\t\tif pod.Status.Phase
      == \"Running\" {\n\t\t\tpodCounts[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t// Build
      node capacity map\n\ttype nodeCapInfo struct {\n\t\tCPUCores float64\n\t\tMemoryMB
      float64\n\t\tStatus   string\n\t}\n\tnodeCapacity := make(map[string]nodeCapInfo)\n\n\tfor
      _, node := range nodeList.Items {\n\t\tstatus := \"NotReady\"\n\t\tfor _, cond
      := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" && cond.Status
      == \"True\" {\n\t\t\t\tstatus = \"Ready\"\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tnodeCapacity[node.Metadata.Name]
      = nodeCapInfo{\n\t\t\tCPUCores: parseCPU(node.Status.Allocatable.CPU),\n\t\t\tMemoryMB:
      parseMemory(node.Status.Allocatable.Memory),\n\t\t\tStatus:   status,\n\t\t}\n\t}\n\n\t//
      Build result\n\tvar result []NodeMetrics\n\tfor _, nm := range nodeMetricsList.Items
      {\n\t\tcap := nodeCapacity[nm.Metadata.Name]\n\t\tcpuUsed := parseCPU(nm.Usage.CPU)\n\t\tmemUsed
      := parseMemory(nm.Usage.Memory)\n\n\t\tcpuPct := 0.0\n\t\tif cap.CPUCores >
      0 {\n\t\t\tcpuPct = (cpuUsed / cap.CPUCores) * 100\n\t\t}\n\t\tmemPct := 0.0\n\t\tif
      cap.MemoryMB > 0 {\n\t\t\tmemPct = (memUsed / cap.MemoryMB) * 100\n\t\t}\n\n\t\tresult
      = append(result, NodeMetrics{\n\t\t\tName:      nm.Metadata.Name,\n\t\t\tCPUCores:
      \ cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:  memUsed,\n\t\t\tMemoryPct:
      memPct,\n\t\t\tPods:      podCounts[nm.Metadata.Name],\n\t\t\tStatus:    cap.Status,\n\t\t})\n\t}\n\n\tsort.Slice(result,
      func(i, j int) bool {\n\t\treturn result[i].Name < result[j].Name\n\t})\n\n\treturn
      result, nil\n}\n\nfunc fetchPodMetrics() ([]PodMetrics, error) {\n\tmetricsData,
      err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\n\tvar podMetricsList K8sPodMetricsList\n\tif
      err := json.Unmarshal(metricsData, &podMetricsList); err != nil {\n\t\treturn
      nil, err\n\t}\n\n\t// Get pod info for node and status\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err
      := json.Unmarshal(podData, &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\ttype
      podInfo struct {\n\t\tNode       string\n\t\tStatus     string\n\t\tDeployment
      string\n\t}\n\tpodInfoMap := make(map[string]podInfo)\n\n\tfor _, pod := range
      podList.Items {\n\t\tkey := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\t\tdeployment
      := \"\"\n\t\tfor _, owner := range pod.Metadata.OwnerReferences {\n\t\t\tif
      owner.Kind == \"ReplicaSet\" {\n\t\t\t\t// Extract deployment name from replicaset
      name (remove hash suffix)\n\t\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\t\tif
      len(parts) > 1 {\n\t\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1],
      \"-\")\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tpodInfoMap[key] = podInfo{\n\t\t\tNode:
      \      pod.Spec.NodeName,\n\t\t\tStatus:     pod.Status.Phase,\n\t\t\tDeployment:
      deployment,\n\t\t}\n\t}\n\n\tvar result []PodMetrics\n\tfor _, pm := range podMetricsList.Items
      {\n\t\tkey := pm.Metadata.Namespace + \"/\" + pm.Metadata.Name\n\t\tinfo :=
      podInfoMap[key]\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, container
      := range pm.Containers {\n\t\t\ttotalCPU += parseCPU(container.Usage.CPU)\n\t\t\ttotalMem
      += parseMemory(container.Usage.Memory)\n\t\t}\n\n\t\tresult = append(result,
      PodMetrics{\n\t\t\tName:       pm.Metadata.Name,\n\t\t\tNamespace:  pm.Metadata.Namespace,\n\t\t\tNode:
      \      info.Node,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:
      \    info.Status,\n\t\t\tDeployment: info.Deployment,\n\t\t})\n\t}\n\n\treturn
      result, nil\n}\n\nfunc fetchDeploymentMetrics() ([]DeploymentMetrics, error)
      {\n\t// Get deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tif
      err := json.Unmarshal(deployData, &deployList); err != nil {\n\t\treturn nil,
      err\n\t}\n\n\t// Get pod metrics\n\tpods, err := fetchPodMetrics()\n\tif err
      != nil {\n\t\treturn nil, err\n\t}\n\n\t// Group pods by deployment\n\tdeployPods
      := make(map[string][]PodMetrics)\n\tfor _, pod := range pods {\n\t\tif pod.Deployment
      != \"\" {\n\t\t\tkey := pod.Namespace + \"/\" + pod.Deployment\n\t\t\tdeployPods[key]
      = append(deployPods[key], pod)\n\t\t}\n\t}\n\n\tvar result []DeploymentMetrics\n\tfor
      _, deploy := range deployList.Items {\n\t\tkey := deploy.Metadata.Namespace
      + \"/\" + deploy.Metadata.Name\n\t\tpods := deployPods[key]\n\n\t\tvar totalCPU,
      totalMem float64\n\t\tfor _, pod := range pods {\n\t\t\ttotalCPU += pod.CPUm\n\t\t\ttotalMem
      += pod.MemoryMB\n\t\t}\n\n\t\tresult = append(result, DeploymentMetrics{\n\t\t\tName:
      \      deploy.Metadata.Name,\n\t\t\tNamespace:  deploy.Metadata.Namespace,\n\t\t\tReplicas:
      \  deploy.Status.Replicas,\n\t\t\tReady:      deploy.Status.ReadyReplicas,\n\t\t\tCPUTotal:
      \  totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tPodMetrics: pods,\n\t\t})\n\t}\n\n\tsort.Slice(result,
      func(i, j int) bool {\n\t\treturn result[i].CPUTotal > result[j].CPUTotal\n\t})\n\n\treturn
      result, nil\n}\n\nfunc fetchClusterSummary() (*ClusterSummary, error) {\n\tnodes,
      err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get node capacity info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err
      := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar
      totalCPU, totalMem float64\n\treadyNodes := 0\n\tfor _, node := range nodeList.Items
      {\n\t\ttotalCPU += parseCPU(node.Status.Allocatable.CPU)\n\t\ttotalMem += parseMemory(node.Status.Allocatable.Memory)\n\t\tfor
      _, cond := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" &&
      cond.Status == \"True\" {\n\t\t\t\treadyNodes++\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tvar
      usedCPU, usedMem float64\n\ttotalPods := 0\n\tfor _, node := range nodes {\n\t\tusedCPU
      += node.CPUCores\n\t\tusedMem += node.MemoryMB\n\t\ttotalPods += node.Pods\n\t}\n\n\t//
      Count deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tjson.Unmarshal(deployData,
      &deployList)\n\n\tcpuPct := 0.0\n\tif totalCPU > 0 {\n\t\tcpuPct = (usedCPU
      / totalCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif totalMem > 0 {\n\t\tmemPct = (usedMem
      / totalMem) * 100\n\t}\n\n\treturn &ClusterSummary{\n\t\tTotalNodes:       len(nodeList.Items),\n\t\tReadyNodes:
      \      readyNodes,\n\t\tTotalPods:        totalPods,\n\t\tTotalDeployments:
      len(deployList.Items),\n\t\tTotalCPUCores:    totalCPU,\n\t\tUsedCPUCores:     usedCPU,\n\t\tTotalMemoryGB:
      \   totalMem / 1024,\n\t\tUsedMemoryGB:     usedMem / 1024,\n\t\tCPUPct:           cpuPct,\n\t\tMemoryPct:
      \       memPct,\n\t}, nil\n}\n\n// Record metrics for history\nfunc recordMetrics()
      {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor
      range ticker.C {\n\t\tnodes, err := fetchNodeMetrics()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error
      fetching metrics: %v\", err)\n\t\t\tcontinue\n\t\t}\n\n\t\tnow := time.Now()\n\t\thistoryMutex.Lock()\n\n\t\t//
      Record per-node metrics\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, node
      := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\n\t\t\tcpuKey
      := \"node_cpu_\" + node.Name\n\t\t\tmemKey := \"node_mem_\" + node.Name\n\n\t\t\tmetricsHistory[cpuKey]
      = append(metricsHistory[cpuKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    node.CPUPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\t\t\tmetricsHistory[memKey]
      = append(metricsHistory[memKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    node.MemoryPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\n\t\t\t// Trim
      history\n\t\t\tif len(metricsHistory[cpuKey]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[cpuKey]
      = metricsHistory[cpuKey][len(metricsHistory[cpuKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif
      len(metricsHistory[memKey]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[memKey]
      = metricsHistory[memKey][len(metricsHistory[memKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\t//
      Record cluster-wide averages\n\t\tif len(nodes) > 0 {\n\t\t\tmetricsHistory[\"cluster_cpu\"]
      = append(metricsHistory[\"cluster_cpu\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    totalCPU / float64(len(nodes)),\n\t\t\t})\n\t\t\tmetricsHistory[\"cluster_mem\"]
      = append(metricsHistory[\"cluster_mem\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    totalMem / float64(len(nodes)),\n\t\t\t})\n\n\t\t\tif len(metricsHistory[\"cluster_cpu\"])
      > maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_cpu\"] = metricsHistory[\"cluster_cpu\"][len(metricsHistory[\"cluster_cpu\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif
      len(metricsHistory[\"cluster_mem\"]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_mem\"]
      = metricsHistory[\"cluster_mem\"][len(metricsHistory[\"cluster_mem\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\thistoryMutex.Unlock()\n\n\t\t//
      Check alert rules\n\t\tcheckAlerts(nodes)\n\t}\n}\n\nfunc checkAlerts(nodes
      []NodeMetrics) {\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tnow
      := time.Now()\n\n\tfor i := range alertRules {\n\t\trule := &alertRules[i]\n\t\tif
      !rule.Enabled {\n\t\t\tcontinue\n\t\t}\n\t\trule.LastChecked = now\n\n\t\tfor
      _, node := range nodes {\n\t\t\tif rule.Node != \"\" && rule.Node != \"*\" &&
      rule.Node != node.Name {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tvar value float64\n\t\t\tvar
      metricName string\n\t\t\tswitch rule.Metric {\n\t\t\tcase \"cpu\":\n\t\t\t\tvalue
      = node.CPUPct\n\t\t\t\tmetricName = \"CPU\"\n\t\t\tcase \"memory\":\n\t\t\t\tvalue
      = node.MemoryPct\n\t\t\t\tmetricName = \"Memory\"\n\t\t\tcase \"pods\":\n\t\t\t\tvalue
      = float64(node.Pods)\n\t\t\t\tmetricName = \"Pods\"\n\t\t\tdefault:\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\ttriggered
      := false\n\t\t\tswitch rule.Condition {\n\t\t\tcase \">\":\n\t\t\t\ttriggered
      = value > rule.Threshold\n\t\t\tcase \">=\":\n\t\t\t\ttriggered = value >= rule.Threshold\n\t\t\tcase
      \"<\":\n\t\t\t\ttriggered = value < rule.Threshold\n\t\t\tcase \"<=\":\n\t\t\t\ttriggered
      = value <= rule.Threshold\n\t\t\tcase \"==\":\n\t\t\t\ttriggered = value ==
      rule.Threshold\n\t\t\tcase \"!=\":\n\t\t\t\ttriggered = value != rule.Threshold\n\t\t\t}\n\n\t\t\talertKey
      := fmt.Sprintf(\"%s-%s\", rule.ID, node.Name)\n\n\t\t\tif triggered {\n\t\t\t\t//
      Check if this alert is already triggered\n\t\t\t\talreadyTriggered := false\n\t\t\t\tfor
      _, ta := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID && !ta.Resolved
      && ta.Node == node.Name {\n\t\t\t\t\t\talreadyTriggered = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif
      !alreadyTriggered {\n\t\t\t\t\tseverity := rule.Severity\n\t\t\t\t\tif severity
      == \"\" {\n\t\t\t\t\t\tseverity = \"warning\"\n\t\t\t\t\t}\n\n\t\t\t\t\tmessage
      := fmt.Sprintf(\"%s %s %.1f%% %s %.1f%% on node %s\",\n\t\t\t\t\t\tmetricName,
      rule.Condition, rule.Threshold, \"- Current:\", value, node.Name)\n\n\t\t\t\t\ttriggeredAlerts
      = append(triggeredAlerts, TriggeredAlert{\n\t\t\t\t\t\tID:        fmt.Sprintf(\"alert-%d-%s\",
      now.UnixNano(), alertKey),\n\t\t\t\t\t\tRuleID:    rule.ID,\n\t\t\t\t\t\tRuleName:
      \ rule.Name,\n\t\t\t\t\t\tMessage:   message,\n\t\t\t\t\t\tValue:     value,\n\t\t\t\t\t\tThreshold:
      rule.Threshold,\n\t\t\t\t\t\tSeverity:  severity,\n\t\t\t\t\t\tNode:      node.Name,\n\t\t\t\t\t\tMetric:
      \   rule.Metric,\n\t\t\t\t\t\tTimestamp: now,\n\t\t\t\t\t\tResolved:  false,\n\t\t\t\t\t})\n\t\t\t\t\tlog.Printf(\"Alert
      triggered: %s (severity: %s)\", message, severity)\n\t\t\t\t}\n\t\t\t} else
      {\n\t\t\t\t// Check if we should resolve an existing alert\n\t\t\t\tfor i, ta
      := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID && !ta.Resolved
      && ta.Node == node.Name {\n\t\t\t\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\t\t\t\ttriggeredAlerts[i].ResolvedAt
      = now\n\t\t\t\t\t\tlog.Printf(\"Alert resolved: %s on %s\", rule.Name, node.Name)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Clean up old resolved alerts (keep for 24 hours)\n\tcutoff := now.Add(-24 *
      time.Hour)\n\tvar activeAlerts []TriggeredAlert\n\tfor _, alert := range triggeredAlerts
      {\n\t\tif !alert.Resolved || alert.ResolvedAt.After(cutoff) {\n\t\t\tactiveAlerts
      = append(activeAlerts, alert)\n\t\t}\n\t}\n\ttriggeredAlerts = activeAlerts\n}\n\n//
      HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"healthy\"})\n}\n\nfunc handleNodes(w http.ResponseWriter, r *http.Request)
      {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w
      http.ResponseWriter, r *http.Request) {\n\tpods, err := fetchPodMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\t//
      Filter by namespace if provided\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tif
      namespace != \"\" {\n\t\tvar filtered []PodMetrics\n\t\tfor _, pod := range
      pods {\n\t\t\tif pod.Namespace == namespace {\n\t\t\t\tfiltered = append(filtered,
      pod)\n\t\t\t}\n\t\t}\n\t\tpods = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleDeployments(w
      http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tnamespace
      := r.URL.Query().Get(\"namespace\")\n\tif namespace != \"\" {\n\t\tvar filtered
      []DeploymentMetrics\n\t\tfor _, deploy := range deployments {\n\t\t\tif deploy.Namespace
      == namespace {\n\t\t\t\tfiltered = append(filtered, deploy)\n\t\t\t}\n\t\t}\n\t\tdeployments
      = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(deployments)\n}\n\nfunc
      handleClusterSummary(w http.ResponseWriter, r *http.Request) {\n\tsummary, err
      := fetchClusterSummary()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(),
      http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(summary)\n}\n\nfunc handleHistory(w
      http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam
      := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\n\tif
      rangeParam == \"\" {\n\t\trangeParam = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch
      rangeParam {\n\tcase \"1h\":\n\t\tduration = time.Hour\n\tcase \"6h\":\n\t\tduration
      = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration
      = 7 * 24 * time.Hour\n\tcase \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration
      = time.Hour\n\t}\n\n\tcutoff := time.Now().Add(-duration)\n\n\t// Try Prometheus
      first for longer ranges\n\tif duration > time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric,
      node, duration)\n\t\tif err == nil && len(promData) > 0 {\n\t\t\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(promData)\n\t\t\treturn\n\t\t}\n\t}\n\n\t//
      Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar
      key string\n\tif node != \"\" && node != \"*\" {\n\t\tkey = metric + \"_\" +
      node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar result []MetricPoint\n\tif
      points, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range points {\n\t\t\tif
      p.Timestamp.After(cutoff) {\n\t\t\t\tresult = append(result, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(result)\n}\n\nfunc getPrometheusHistory(metric,
      node string, duration time.Duration) ([]MetricPoint, error) {\n\tend := time.Now()\n\tstart
      := end.Add(-duration)\n\n\tvar step string\n\tswitch {\n\tcase duration <= time.Hour:\n\t\tstep
      = \"15s\"\n\tcase duration <= 6*time.Hour:\n\t\tstep = \"1m\"\n\tcase duration
      <= 24*time.Hour:\n\t\tstep = \"5m\"\n\tcase duration <= 7*24*time.Hour:\n\t\tstep
      = \"30m\"\n\tdefault:\n\t\tstep = \"2h\"\n\t}\n\n\tvar query string\n\tswitch
      metric {\n\tcase \"cluster_cpu\":\n\t\tquery = \"avg(100 - (avg by (instance)
      (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m])) * 100))\"\n\tcase \"cluster_mem\":\n\t\tquery
      = \"avg((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
      * 100)\"\n\tcase \"node_cpu\":\n\t\tif node != \"\" {\n\t\t\tquery = fmt.Sprintf(\"100
      - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\", instance=~\\\"%s.*\\\"}[5m]))
      * 100)\", node)\n\t\t} else {\n\t\t\tquery = \"100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m]))
      * 100)\"\n\t\t}\n\tcase \"node_mem\":\n\t\tif node != \"\" {\n\t\t\tquery =
      fmt.Sprintf(\"(1 - (node_memory_MemAvailable_bytes{instance=~\\\"%s.*\\\"} /
      node_memory_MemTotal_bytes{instance=~\\\"%s.*\\\"})) * 100\", node, node)\n\t\t}
      else {\n\t\t\tquery = \"(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
      * 100\"\n\t\t}\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown metric: %s\",
      metric)\n\t}\n\n\tresp, err := queryPrometheus(query, start, end, step)\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar result []MetricPoint\n\tfor
      _, series := range resp.Data.Result {\n\t\tnodeName := series.Metric[\"instance\"]\n\t\tfor
      _, val := range series.Values {\n\t\t\tts, _ := val[0].(float64)\n\t\t\tvalStr,
      _ := val[1].(string)\n\t\t\tvalue, _ := strconv.ParseFloat(valStr, 64)\n\t\t\tresult
      = append(result, MetricPoint{\n\t\t\t\tTimestamp: time.Unix(int64(ts), 0),\n\t\t\t\tValue:
      \    value,\n\t\t\t\tNode:      nodeName,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn
      result, nil\n}\n\nfunc handleAlertRules(w http.ResponseWriter, r *http.Request)
      {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(alertRules)\n}\n\nfunc handleCreateAlertRule(w
      http.ResponseWriter, r *http.Request) {\n\tvar rule AlertRule\n\tif err := json.NewDecoder(r.Body).Decode(&rule);
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\trule.ID
      = fmt.Sprintf(\"rule-%d\", time.Now().UnixNano())\n\trule.Created = time.Now()\n\tif
      rule.Node == \"\" {\n\t\trule.Node = \"*\"\n\t}\n\n\talertMutex.Lock()\n\talertRules
      = append(alertRules, rule)\n\talertMutex.Unlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(rule)\n}\n\nfunc handleDeleteAlertRule(w
      http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, rule := range alertRules {\n\t\tif rule.ID ==
      id {\n\t\t\talertRules = append(alertRules[:i], alertRules[i+1:]...)\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"rule not found\", http.StatusNotFound)\n}\n\nfunc handleTriggeredAlerts(w
      http.ResponseWriter, r *http.Request) {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(triggeredAlerts)\n}\n\nfunc
      handleResolveAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID
      == id {\n\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"alert not found\", http.StatusNotFound)\n}\n\n// Fetch comprehensive cluster-wide
      metrics\nfunc fetchClusterMetrics() (*ClusterMetrics, error) {\n\tsummary, err
      := fetchClusterSummary()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tnodes,
      err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tpods,
      err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get top pods by CPU\n\tsortedByCPU := make([]PodMetrics, len(pods))\n\tcopy(sortedByCPU,
      pods)\n\tsort.Slice(sortedByCPU, func(i, j int) bool {\n\t\treturn sortedByCPU[i].CPUm
      > sortedByCPU[j].CPUm\n\t})\n\ttopCPU := sortedByCPU\n\tif len(topCPU) > 10
      {\n\t\ttopCPU = topCPU[:10]\n\t}\n\n\t// Get top pods by memory\n\tsortedByMem
      := make([]PodMetrics, len(pods))\n\tcopy(sortedByMem, pods)\n\tsort.Slice(sortedByMem,
      func(i, j int) bool {\n\t\treturn sortedByMem[i].MemoryMB > sortedByMem[j].MemoryMB\n\t})\n\ttopMem
      := sortedByMem\n\tif len(topMem) > 10 {\n\t\ttopMem = topMem[:10]\n\t}\n\n\t//
      Aggregate by namespace\n\tnsMetrics := make(map[string]*NamespaceMetrics)\n\tfor
      _, pod := range pods {\n\t\tif _, ok := nsMetrics[pod.Namespace]; !ok {\n\t\t\tnsMetrics[pod.Namespace]
      = &NamespaceMetrics{Name: pod.Namespace}\n\t\t}\n\t\tnsMetrics[pod.Namespace].PodCount++\n\t\tnsMetrics[pod.Namespace].CPUUsage
      += pod.CPUm\n\t\tnsMetrics[pod.Namespace].MemoryUsage += pod.MemoryMB\n\t}\n\n\tvar
      namespaces []NamespaceMetrics\n\tfor _, ns := range nsMetrics {\n\t\tif summary.UsedCPUCores
      > 0 {\n\t\t\tns.CPUPct = (ns.CPUUsage / summary.UsedCPUCores) * 100\n\t\t}\n\t\tif
      summary.UsedMemoryGB > 0 {\n\t\t\tns.MemoryPct = (ns.MemoryUsage / (summary.UsedMemoryGB
      * 1024)) * 100\n\t\t}\n\t\tnamespaces = append(namespaces, *ns)\n\t}\n\tsort.Slice(namespaces,
      func(i, j int) bool {\n\t\treturn namespaces[i].CPUUsage > namespaces[j].CPUUsage\n\t})\n\n\t//
      Get alerts summary\n\talertMutex.RLock()\n\talertsSummary := AlertsSummary{}\n\tfor
      _, alert := range triggeredAlerts {\n\t\talertsSummary.Total++\n\t\tif alert.Resolved
      {\n\t\t\talertsSummary.Resolved++\n\t\t} else {\n\t\t\talertsSummary.Active++\n\t\t\tswitch
      alert.Severity {\n\t\t\tcase \"critical\":\n\t\t\t\talertsSummary.Critical++\n\t\t\tcase
      \"warning\":\n\t\t\t\talertsSummary.Warning++\n\t\t\tcase \"info\":\n\t\t\t\talertsSummary.Info++\n\t\t\t}\n\t\t}\n\t}\n\talertMutex.RUnlock()\n\n\treturn
      &ClusterMetrics{\n\t\tTimestamp:    time.Now(),\n\t\tSummary:      *summary,\n\t\tNodeMetrics:
      \ nodes,\n\t\tTopPodsByCPU: topCPU,\n\t\tTopPodsByMem: topMem,\n\t\tNamespaces:
      \  namespaces,\n\t\tAlerts:       alertsSummary,\n\t}, nil\n}\n\n// Fetch detailed
      metrics for a specific node\nfunc fetchNodeDetailedMetrics(nodeName string)
      (*NodeDetailedMetrics, error) {\n\t// Get node info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes/\"
      + nodeName)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node:
      %v\", err)\n\t}\n\n\tvar node K8sNode\n\tif err := json.Unmarshal(nodeData,
      &node); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get node metrics\n\tmetricsData,
      err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes/\" + nodeName)\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node metrics: %v\",
      err)\n\t}\n\n\tvar nodeMetric K8sNodeMetric\n\tif err := json.Unmarshal(metricsData,
      &nodeMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pods on this
      node\n\tallPods, err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil,
      err\n\t}\n\n\tvar nodePods []PodMetrics\n\tfor _, pod := range allPods {\n\t\tif
      pod.Node == nodeName {\n\t\t\tnodePods = append(nodePods, pod)\n\t\t}\n\t}\n\n\t//
      Calculate metrics\n\tallocatableCPU := parseCPU(node.Status.Allocatable.CPU)\n\tallocatableMem
      := parseMemory(node.Status.Allocatable.Memory)\n\tcpuUsed := parseCPU(nodeMetric.Usage.CPU)\n\tmemUsed
      := parseMemory(nodeMetric.Usage.Memory)\n\n\tcpuPct := 0.0\n\tif allocatableCPU
      > 0 {\n\t\tcpuPct = (cpuUsed / allocatableCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif
      allocatableMem > 0 {\n\t\tmemPct = (memUsed / allocatableMem) * 100\n\t}\n\n\t//
      Get status\n\tstatus := \"NotReady\"\n\tvar conditions []NodeCondition\n\tfor
      _, cond := range node.Status.Conditions {\n\t\tconditions = append(conditions,
      NodeCondition{\n\t\t\tType:    cond.Type,\n\t\t\tStatus:  cond.Status,\n\t\t\tMessage:
      cond.Message,\n\t\t})\n\t\tif cond.Type == \"Ready\" && cond.Status == \"True\"
      {\n\t\t\tstatus = \"Ready\"\n\t\t}\n\t}\n\n\t// Get taints\n\tvar taints []string\n\tfor
      _, taint := range node.Spec.Taints {\n\t\ttaints = append(taints, fmt.Sprintf(\"%s=%s:%s\",
      taint.Key, taint.Value, taint.Effect))\n\t}\n\n\t// Get history from memory\n\thistoryMutex.RLock()\n\tcpuHistory
      := metricsHistory[\"node_cpu_\"+nodeName]\n\tmemHistory := metricsHistory[\"node_mem_\"+nodeName]\n\thistoryMutex.RUnlock()\n\n\t//
      Parse capacity values\n\tallocPods, _ := strconv.Atoi(node.Status.Allocatable.Pods)\n\tcapPods,
      _ := strconv.Atoi(node.Status.Capacity.Pods)\n\tallocStorage := parseMemory(node.Status.Allocatable.Storage)
      / 1024 // to GB\n\tcapStorage := parseMemory(node.Status.Capacity.Storage) /
      1024\n\n\treturn &NodeDetailedMetrics{\n\t\tNodeMetrics: NodeMetrics{\n\t\t\tName:
      \     nodeName,\n\t\t\tCPUCores:  cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:
      \ memUsed,\n\t\t\tMemoryPct: memPct,\n\t\t\tPods:      len(nodePods),\n\t\t\tStatus:
      \   status,\n\t\t},\n\t\tAllocatable: ResourceCapacity{\n\t\t\tCPU:     allocatableCPU,\n\t\t\tMemory:
      \ allocatableMem,\n\t\t\tPods:    allocPods,\n\t\t\tStorage: allocStorage,\n\t\t},\n\t\tCapacity:
      ResourceCapacity{\n\t\t\tCPU:     parseCPU(node.Status.Capacity.CPU),\n\t\t\tMemory:
      \ parseMemory(node.Status.Capacity.Memory),\n\t\t\tPods:    capPods,\n\t\t\tStorage:
      capStorage,\n\t\t},\n\t\tConditions:    conditions,\n\t\tPods:          nodePods,\n\t\tCPUHistory:
      \   cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        node.Metadata.Labels,\n\t\tTaints:
      \       taints,\n\t}, nil\n}\n\n// Fetch detailed metrics for a specific pod\nfunc
      fetchPodDetailedMetrics(namespace, podName string) (*PodDetailedMetrics, error)
      {\n\t// Get pod info\n\tpodData, err := k8sAPIRequest(fmt.Sprintf(\"/api/v1/namespaces/%s/pods/%s\",
      namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to get pod: %v\", err)\n\t}\n\n\tvar pod K8sPod\n\tif err := json.Unmarshal(podData,
      &pod); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod metrics\n\tmetricsData,
      err := k8sAPIRequest(fmt.Sprintf(\"/apis/metrics.k8s.io/v1beta1/namespaces/%s/pods/%s\",
      namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to get pod metrics: %v\", err)\n\t}\n\n\tvar podMetric K8sPodMetric\n\tif err
      := json.Unmarshal(metricsData, &podMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Build container metrics\n\tvar containers []ContainerMetrics\n\tvar totalCPU,
      totalMem float64\n\ttotalRestarts := 0\n\n\tcontainerUsage := make(map[string]struct{
      cpu, mem float64 })\n\tfor _, c := range podMetric.Containers {\n\t\tcpu :=
      parseCPU(c.Usage.CPU)\n\t\tmem := parseMemory(c.Usage.Memory)\n\t\tcontainerUsage[c.Name]
      = struct{ cpu, mem float64 }{cpu, mem}\n\t\ttotalCPU += cpu\n\t\ttotalMem +=
      mem\n\t}\n\n\tfor _, cs := range pod.Status.ContainerStatuses {\n\t\tusage :=
      containerUsage[cs.Name]\n\t\tstate := \"unknown\"\n\t\tif cs.State.Running !=
      nil {\n\t\t\tstate = \"running\"\n\t\t} else if cs.State.Waiting != nil {\n\t\t\tstate
      = \"waiting: \" + cs.State.Waiting.Reason\n\t\t} else if cs.State.Terminated
      != nil {\n\t\t\tstate = \"terminated: \" + cs.State.Terminated.Reason\n\t\t}\n\n\t\tcontainers
      = append(containers, ContainerMetrics{\n\t\t\tName:         cs.Name,\n\t\t\tCPUm:
      \        usage.cpu,\n\t\t\tMemoryMB:     usage.mem,\n\t\t\tRestartCount: cs.RestartCount,\n\t\t\tReady:
      \       cs.Ready,\n\t\t\tState:        state,\n\t\t})\n\t\ttotalRestarts +=
      cs.RestartCount\n\t}\n\n\t// Get deployment name\n\tdeployment := \"\"\n\tfor
      _, owner := range pod.Metadata.OwnerReferences {\n\t\tif owner.Kind == \"ReplicaSet\"
      {\n\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\tif len(parts) > 1
      {\n\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1], \"-\")\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Parse start time\n\tstartTime, _ := time.Parse(time.RFC3339, pod.Status.StartTime)\n\n\t//
      Get history from memory (if we stored pod-level history)\n\thistoryMutex.RLock()\n\tcpuKey
      := fmt.Sprintf(\"pod_cpu_%s_%s\", namespace, podName)\n\tmemKey := fmt.Sprintf(\"pod_mem_%s_%s\",
      namespace, podName)\n\tcpuHistory := metricsHistory[cpuKey]\n\tmemHistory :=
      metricsHistory[memKey]\n\thistoryMutex.RUnlock()\n\n\treturn &PodDetailedMetrics{\n\t\tPodMetrics:
      PodMetrics{\n\t\t\tName:       podName,\n\t\t\tNamespace:  namespace,\n\t\t\tNode:
      \      pod.Spec.NodeName,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:
      \    pod.Status.Phase,\n\t\t\tDeployment: deployment,\n\t\t},\n\t\tContainers:
      \   containers,\n\t\tRestartCount:  totalRestarts,\n\t\tStartTime:     startTime,\n\t\tCPUHistory:
      \   cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        pod.Metadata.Labels,\n\t},
      nil\n}\n\n// HTTP Handlers for new endpoints\n\nfunc handleClusterMetrics(w
      http.ResponseWriter, r *http.Request) {\n\tmetrics, err := fetchClusterMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(metrics)\n}\n\nfunc handleNodeDetails(w
      http.ResponseWriter, r *http.Request) {\n\t// Extract node name from path\n\tpath
      := strings.TrimPrefix(r.URL.Path, \"/api/nodes/\")\n\tnodeName := strings.Split(path,
      \"/\")[0]\n\n\tif nodeName == \"\" {\n\t\t// List all nodes\n\t\thandleNodes(w,
      r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchNodeDetailedMetrics(nodeName)\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handlePodDetails(w
      http.ResponseWriter, r *http.Request) {\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tpodName
      := r.URL.Query().Get(\"name\")\n\n\t// Also support path-based: /api/pods/namespace/name\n\tpath
      := strings.TrimPrefix(r.URL.Path, \"/api/pods/\")\n\tparts := strings.Split(path,
      \"/\")\n\tif len(parts) >= 2 && namespace == \"\" {\n\t\tnamespace = parts[0]\n\t\tpodName
      = parts[1]\n\t}\n\n\tif namespace == \"\" || podName == \"\" {\n\t\t// List
      all pods\n\t\thandlePods(w, r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchPodDetailedMetrics(namespace,
      podName)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handleUnifiedAlerts(w
      http.ResponseWriter, r *http.Request) {\n\tswitch r.Method {\n\tcase \"GET\":\n\t\talertMutex.RLock()\n\t\tdefer
      alertMutex.RUnlock()\n\n\t\tsummary := AlertsSummary{}\n\t\tfor _, alert :=
      range triggeredAlerts {\n\t\t\tsummary.Total++\n\t\t\tif alert.Resolved {\n\t\t\t\tsummary.Resolved++\n\t\t\t}
      else {\n\t\t\t\tsummary.Active++\n\t\t\t\tswitch alert.Severity {\n\t\t\t\tcase
      \"critical\":\n\t\t\t\t\tsummary.Critical++\n\t\t\t\tcase \"warning\":\n\t\t\t\t\tsummary.Warning++\n\t\t\t\tcase
      \"info\":\n\t\t\t\t\tsummary.Info++\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tresponse
      := AlertsResponse{\n\t\t\tRules:     alertRules,\n\t\t\tTriggered: triggeredAlerts,\n\t\t\tSummary:
      \  summary,\n\t\t}\n\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(response)\n\n\tcase
      \"POST\":\n\t\thandleCreateAlertRule(w, r)\n\n\tcase \"DELETE\":\n\t\thandleDeleteAlertRule(w,
      r)\n\n\tdefault:\n\t\thttp.Error(w, \"method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\nfunc
      handleAcknowledgeAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID
      == id {\n\t\t\ttriggeredAlerts[i].Acknowledged = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"alert not found\", http.StatusNotFound)\n}\n\nfunc handleHistoryExtended(w
      http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam
      := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\tnamespace
      := r.URL.Query().Get(\"namespace\")\n\tpod := r.URL.Query().Get(\"pod\")\n\tresolution
      := r.URL.Query().Get(\"resolution\")\n\n\tif rangeParam == \"\" {\n\t\trangeParam
      = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch rangeParam {\n\tcase
      \"5m\":\n\t\tduration = 5 * time.Minute\n\tcase \"15m\":\n\t\tduration = 15
      * time.Minute\n\tcase \"30m\":\n\t\tduration = 30 * time.Minute\n\tcase \"1h\":\n\t\tduration
      = time.Hour\n\tcase \"6h\":\n\t\tduration = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration
      = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration = 7 * 24 * time.Hour\n\tcase
      \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration = time.Hour\n\t}\n\n\tcutoff
      := time.Now().Add(-duration)\n\tend := time.Now()\n\n\t// Determine resolution
      if not specified\n\tif resolution == \"\" {\n\t\tswitch {\n\t\tcase duration
      <= 30*time.Minute:\n\t\t\tresolution = \"10s\"\n\t\tcase duration <= time.Hour:\n\t\t\tresolution
      = \"30s\"\n\t\tcase duration <= 6*time.Hour:\n\t\t\tresolution = \"1m\"\n\t\tcase
      duration <= 24*time.Hour:\n\t\t\tresolution = \"5m\"\n\t\tdefault:\n\t\t\tresolution
      = \"15m\"\n\t\t}\n\t}\n\n\t// Try Prometheus first for longer ranges\n\tif duration
      > time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric, node, duration)\n\t\tif
      err == nil && len(promData) > 0 {\n\t\t\tresponse := HistoricalData{\n\t\t\t\tMetric:
      \    metric,\n\t\t\t\tNode:       node,\n\t\t\t\tNamespace:  namespace,\n\t\t\t\tPod:
      \       pod,\n\t\t\t\tResolution: resolution,\n\t\t\t\tStart:      cutoff,\n\t\t\t\tEnd:
      \       end,\n\t\t\t\tPoints:     promData,\n\t\t\t}\n\t\t\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(response)\n\t\t\treturn\n\t\t}\n\t}\n\n\t//
      Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar
      key string\n\tif pod != \"\" && namespace != \"\" {\n\t\tkey = fmt.Sprintf(\"pod_%s_%s_%s\",
      metric, namespace, pod)\n\t} else if node != \"\" && node != \"*\" {\n\t\tkey
      = metric + \"_\" + node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar points []MetricPoint\n\tif
      history, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range history {\n\t\t\tif
      p.Timestamp.After(cutoff) {\n\t\t\t\tpoints = append(points, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tresponse
      := HistoricalData{\n\t\tMetric:     metric,\n\t\tNode:       node,\n\t\tNamespace:
      \ namespace,\n\t\tPod:        pod,\n\t\tResolution: resolution,\n\t\tStart:
      \     cutoff,\n\t\tEnd:        end,\n\t\tPoints:     points,\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\n// Legacy
      API compatibility\nfunc handleLegacyMetrics(w http.ResponseWriter, r *http.Request)
      {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar cpuPoints,
      memPoints, reqPoints []map[string]interface{}\n\tnow := time.Now()\n\n\t// Generate
      some historical-looking data points\n\tfor i := 0; i < 20; i++ {\n\t\tts :=
      now.Add(time.Duration(-i*5) * time.Second)\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor
      _, node := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\t\t}\n\t\tavgCPU
      := totalCPU / float64(len(nodes))\n\t\tavgMem := totalMem / float64(len(nodes))\n\n\t\tcpuPoints
      = append([]map[string]interface{}{{\n\t\t\t\"name\":      \"cpu_usage\",\n\t\t\t\"value\":
      \    avgCPU,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}},
      cpuPoints...)\n\n\t\tmemPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":
      \     \"memory_usage\",\n\t\t\t\"value\":     avgMem,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\":
      ts.Format(time.RFC3339Nano),\n\t\t}}, memPoints...)\n\n\t\treqPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":
      \     \"requests\",\n\t\t\t\"value\":     float64(100 + i*5),\n\t\t\t\"unit\":
      \     \"req/s\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}},
      reqPoints...)\n\t}\n\n\tresponse := map[string]interface{}{\n\t\t\"cpu\":      cpuPoints,\n\t\t\"memory\":
      \  memPoints,\n\t\t\"requests\": reqPoints,\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\nfunc handleLegacyServices(w
      http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar
      services []map[string]string\n\tfor _, deploy := range deployments {\n\t\tif
      deploy.Namespace != \"holm\" {\n\t\t\tcontinue\n\t\t}\n\t\tstatus := \"healthy\"\n\t\tif
      deploy.Ready < deploy.Replicas {\n\t\t\tstatus = \"unhealthy\"\n\t\t}\n\t\tservices
      = append(services, map[string]string{\n\t\t\t\"name\":      deploy.Name,\n\t\t\t\"namespace\":
      deploy.Namespace,\n\t\t\t\"status\":    status,\n\t\t\t\"endpoint\":  fmt.Sprintf(\"http://%s:8080\",
      deploy.Name),\n\t\t})\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(services)\n}\n\nfunc
      main() {\n\t// Start metrics collection\n\tgo recordMetrics()\n\n\t// Initialize
      default alert rules\n\talertRules = []AlertRule{\n\t\t{ID: \"default-1\", Name:
      \"Critical CPU\", Metric: \"cpu\", Condition: \">\", Threshold: 95, Node: \"*\",
      Severity: \"critical\", Duration: 60, Enabled: true, Created: time.Now()},\n\t\t{ID:
      \"default-2\", Name: \"High CPU\", Metric: \"cpu\", Condition: \">\", Threshold:
      85, Node: \"*\", Severity: \"warning\", Duration: 120, Enabled: true, Created:
      time.Now()},\n\t\t{ID: \"default-3\", Name: \"Critical Memory\", Metric: \"memory\",
      Condition: \">\", Threshold: 95, Node: \"*\", Severity: \"critical\", Duration:
      60, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-4\", Name: \"High
      Memory\", Metric: \"memory\", Condition: \">\", Threshold: 85, Node: \"*\",
      Severity: \"warning\", Duration: 120, Enabled: true, Created: time.Now()},\n\t\t{ID:
      \"default-5\", Name: \"Node Not Ready\", Metric: \"cpu\", Condition: \"<\",
      Threshold: 0, Node: \"*\", Severity: \"critical\", Duration: 30, Enabled: false,
      Created: time.Now()},\n\t}\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t//
      API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\n\t// Cluster-wide
      metrics (new comprehensive endpoint)\n\tmux.HandleFunc(\"/api/metrics\", handleClusterMetrics)\n\n\t//
      Node endpoints with detail support\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/nodes/\",
      handleNodeDetails) // /api/nodes/{name} for details\n\n\t// Pod endpoints with
      detail support\n\tmux.HandleFunc(\"/api/pods\", handlePods)\n\tmux.HandleFunc(\"/api/pods/\",
      handlePodDetails) // /api/pods/{namespace}/{name} for details\n\n\t// Deployments\n\tmux.HandleFunc(\"/api/deployments\",
      handleDeployments)\n\n\t// Cluster summary\n\tmux.HandleFunc(\"/api/cluster\",
      handleClusterSummary)\n\n\t// Historical data (enhanced)\n\tmux.HandleFunc(\"/api/history\",
      handleHistoryExtended)\n\n\t// Unified alerts endpoint\n\tmux.HandleFunc(\"/api/alerts\",
      handleUnifiedAlerts)\n\n\t// Alert management endpoints\n\tmux.HandleFunc(\"/api/alerts/rules\",
      func(w http.ResponseWriter, r *http.Request) {\n\t\tswitch r.Method {\n\t\tcase
      \"GET\":\n\t\t\thandleAlertRules(w, r)\n\t\tcase \"POST\":\n\t\t\thandleCreateAlertRule(w,
      r)\n\t\tcase \"DELETE\":\n\t\t\thandleDeleteAlertRule(w, r)\n\t\tdefault:\n\t\t\thttp.Error(w,
      \"method not allowed\", http.StatusMethodNotAllowed)\n\t\t}\n\t})\n\tmux.HandleFunc(\"/api/alerts/triggered\",
      handleTriggeredAlerts)\n\tmux.HandleFunc(\"/api/alerts/resolve\", handleResolveAlert)\n\tmux.HandleFunc(\"/api/alerts/acknowledge\",
      handleAcknowledgeAlert)\n\n\t// Legacy API for backward compatibility\n\tmux.HandleFunc(\"/api/metrics/legacy\",
      handleLegacyMetrics)\n\tmux.HandleFunc(\"/api/services\", handleLegacyServices)\n\n\t//
      Serve dashboard\n\tmux.HandleFunc(\"/\", serveDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif
      port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tlog.Printf(\"Starting Metrics
      Dashboard on port %s\", port)\n\tlog.Fatal(http.ListenAndServe(\":\"+port, mux))\n}\n"
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T02:33:13Z"
    name: metrics-dashboard-source
    namespace: holm
    resourceVersion: "750"
    uid: 5c8852f5-7768-4e9e-b772-0fa32d853cdc
- apiVersion: v1
  data:
    Dockerfile: |
      FROM public.ecr.aws/docker/library/golang:1.21-alpine AS builder

      WORKDIR /app

      # Copy go mod file
      COPY go.mod ./

      # Copy source files
      COPY *.go ./

      # Build the binary
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o metrics-dashboard .

      # Final image
      FROM public.ecr.aws/docker/library/alpine:3.19

      RUN apk --no-cache add ca-certificates

      WORKDIR /app

      COPY --from=builder /app/metrics-dashboard .

      EXPOSE 8080

      CMD ["./metrics-dashboard"]
    dashboard.go: "package main\n\nimport (\n\t\"net/http\"\n)\n\nfunc serveDashboard(w
      http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w,
      r)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write([]byte(dashboardHTML))\n}\n\nconst
      dashboardHTML = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n
      \   <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n
      \   <title>Metrics Dashboard - HolmOS Cluster</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n
      \   <script src=\"https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js\"></script>\n
      \   <style>\n        :root {\n            --bg-primary: #0f0f1a;\n            --bg-secondary:
      #1a1a2e;\n            --bg-card: #16213e;\n            --bg-hover: #1f3460;\n
      \           --text-primary: #e4e4e7;\n            --text-secondary: #a1a1aa;\n
      \           --accent-blue: #3b82f6;\n            --accent-green: #10b981;\n
      \           --accent-yellow: #f59e0b;\n            --accent-red: #ef4444;\n
      \           --accent-purple: #8b5cf6;\n            --accent-cyan: #06b6d4;\n
      \           --border-color: #2d3748;\n        }\n        * { margin: 0; padding:
      0; box-sizing: border-box; }\n        body { font-family: 'Inter', -apple-system,
      BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary);
      min-height: 100vh; }\n        .app-container { display: flex; min-height: 100vh;
      }\n        .sidebar { width: 240px; background: var(--bg-secondary); border-right:
      1px solid var(--border-color); display: flex; flex-direction: column; position:
      fixed; height: 100vh; z-index: 100; }\n        .logo { padding: 20px; border-bottom:
      1px solid var(--border-color); display: flex; align-items: center; gap: 12px;
      }\n        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg,
      var(--accent-blue), var(--accent-purple)); border-radius: 8px; display: flex;
      align-items: center; justify-content: center; font-size: 18px; }\n        .logo
      h1 { font-size: 1.1rem; font-weight: 600; }\n        .logo span { color: var(--text-secondary);
      font-size: 0.75rem; }\n        .nav-menu { flex: 1; padding: 16px 0; }\n        .nav-item
      { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color:
      var(--text-secondary); cursor: pointer; transition: all 0.2s; border-left: 3px
      solid transparent; }\n        .nav-item:hover, .nav-item.active { background:
      var(--bg-hover); color: var(--text-primary); border-left-color: var(--accent-blue);
      }\n        .nav-item svg { width: 20px; height: 20px; }\n        .main-content
      { flex: 1; margin-left: 240px; padding: 24px; }\n        .header { display:
      flex; justify-content: space-between; align-items: center; margin-bottom: 24px;
      }\n        .header h2 { font-size: 1.5rem; font-weight: 600; }\n        .time-range-selector
      { display: flex; gap: 8px; background: var(--bg-secondary); padding: 4px; border-radius:
      8px; }\n        .time-btn { padding: 8px 16px; border: none; background: transparent;
      color: var(--text-secondary); border-radius: 6px; cursor: pointer; transition:
      all 0.2s; font-size: 0.875rem; }\n        .time-btn:hover { color: var(--text-primary);
      }\n        .time-btn.active { background: var(--accent-blue); color: white;
      }\n        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 16px; margin-bottom: 24px; }\n        .summary-card { background: var(--bg-card);
      border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); }\n
      \       .summary-card .label { color: var(--text-secondary); font-size: 0.875rem;
      margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }\n        .summary-card
      .value { font-size: 2rem; font-weight: 700; }\n        .summary-card .sub {
      color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px; }\n        .summary-card.cpu
      .value { color: var(--accent-cyan); }\n        .summary-card.memory .value {
      color: var(--accent-green); }\n        .summary-card.nodes .value { color: var(--accent-yellow);
      }\n        .summary-card.pods .value { color: var(--accent-purple); }\n        .charts-grid
      { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom:
      24px; }\n        .chart-card { background: var(--bg-card); border-radius: 12px;
      padding: 20px; border: 1px solid var(--border-color); }\n        .chart-card
      h3 { font-size: 1rem; margin-bottom: 16px; display: flex; align-items: center;
      gap: 8px; }\n        .chart-card h3::before { content: ''; width: 10px; height:
      10px; border-radius: 50%; }\n        .chart-card.cpu h3::before { background:
      var(--accent-cyan); }\n        .chart-card.memory h3::before { background: var(--accent-green);
      }\n        .chart-card.network h3::before { background: var(--accent-yellow);
      }\n        .chart-card.disk h3::before { background: var(--accent-purple); }\n
      \       .chart-container { height: 200px; position: relative; }\n        .section-title
      { font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; display: flex;
      align-items: center; gap: 8px; }\n        .nodes-grid { display: grid; grid-template-columns:
      repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 24px; }\n        .node-card
      { background: var(--bg-card); border-radius: 10px; padding: 16px; border: 1px
      solid var(--border-color); transition: all 0.2s; cursor: pointer; }\n        .node-card:hover
      { border-color: var(--accent-blue); transform: translateY(-2px); }\n        .node-card
      .node-header { display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px; }\n        .node-card .node-name { font-weight: 600; font-size:
      0.95rem; }\n        .status-badge { padding: 4px 10px; border-radius: 12px;
      font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }\n        .status-badge.ready
      { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }\n        .status-badge.notready
      { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }\n        .node-metrics
      { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }\n        .metric-item
      { display: flex; flex-direction: column; gap: 4px; }\n        .metric-item .metric-label
      { font-size: 0.75rem; color: var(--text-secondary); }\n        .metric-item
      .metric-bar { height: 6px; background: var(--bg-primary); border-radius: 3px;
      overflow: hidden; }\n        .metric-item .metric-bar-fill { height: 100%; border-radius:
      3px; transition: width 0.3s; }\n        .metric-item .metric-bar-fill.cpu {
      background: var(--accent-cyan); }\n        .metric-item .metric-bar-fill.memory
      { background: var(--accent-green); }\n        .metric-item .metric-value { font-size:
      0.85rem; font-weight: 600; }\n        .table-container { background: var(--bg-card);
      border-radius: 12px; border: 1px solid var(--border-color); overflow: hidden;
      margin-bottom: 24px; }\n        .table-header { padding: 16px 20px; border-bottom:
      1px solid var(--border-color); display: flex; justify-content: space-between;
      align-items: center; }\n        .table-header h3 { font-size: 1rem; }\n        .search-input
      { background: var(--bg-primary); border: 1px solid var(--border-color); padding:
      8px 12px; border-radius: 6px; color: var(--text-primary); width: 200px; }\n
      \       .search-input:focus { outline: none; border-color: var(--accent-blue);
      }\n        table { width: 100%; border-collapse: collapse; }\n        th, td
      { padding: 12px 20px; text-align: left; border-bottom: 1px solid var(--border-color);
      }\n        th { background: var(--bg-secondary); color: var(--text-secondary);
      font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }\n        tr:hover
      { background: var(--bg-hover); }\n        .deployment-name { font-weight: 600;
      }\n        .replica-badge { display: inline-flex; align-items: center; gap:
      4px; }\n        .replica-badge.healthy { color: var(--accent-green); }\n        .replica-badge.degraded
      { color: var(--accent-yellow); }\n        .alerts-container { display: grid;
      grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }\n        .alert-rules-card,
      .triggered-alerts-card { background: var(--bg-card); border-radius: 12px; border:
      1px solid var(--border-color); }\n        .alert-card-header { padding: 16px
      20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content:
      space-between; align-items: center; }\n        .alert-card-header h3 { font-size:
      1rem; }\n        .btn-add { background: var(--accent-blue); color: white; border:
      none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;
      display: flex; align-items: center; gap: 6px; }\n        .btn-add:hover { background:
      #2563eb; }\n        .alert-list { max-height: 300px; overflow-y: auto; }\n        .alert-item
      { padding: 12px 20px; border-bottom: 1px solid var(--border-color); display:
      flex; justify-content: space-between; align-items: center; }\n        .alert-item:last-child
      { border-bottom: none; }\n        .alert-info { display: flex; flex-direction:
      column; gap: 4px; }\n        .alert-name { font-weight: 600; font-size: 0.9rem;
      }\n        .alert-condition { color: var(--text-secondary); font-size: 0.8rem;
      }\n        .alert-actions { display: flex; gap: 8px; }\n        .btn-icon {
      background: transparent; border: none; color: var(--text-secondary); cursor:
      pointer; padding: 4px; }\n        .btn-icon:hover { color: var(--text-primary);
      }\n        .btn-icon.delete:hover { color: var(--accent-red); }\n        .triggered-alert
      { padding: 12px 20px; border-bottom: 1px solid var(--border-color); background:
      rgba(239, 68, 68, 0.1); }\n        .triggered-alert.resolved { background: transparent;
      opacity: 0.6; }\n        .triggered-alert .alert-message { font-weight: 600;
      color: var(--accent-red); margin-bottom: 4px; }\n        .triggered-alert.resolved
      .alert-message { color: var(--accent-green); }\n        .triggered-alert .alert-time
      { font-size: 0.75rem; color: var(--text-secondary); }\n        .modal-overlay
      { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,
      0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index:
      1000; }\n        .modal-overlay.active { display: flex; }\n        .modal {
      background: var(--bg-card); border-radius: 12px; width: 400px; max-width: 90%;
      }\n        .modal-header { padding: 20px; border-bottom: 1px solid var(--border-color);
      display: flex; justify-content: space-between; align-items: center; }\n        .modal-header
      h3 { font-size: 1.1rem; }\n        .modal-body { padding: 20px; }\n        .form-group
      { margin-bottom: 16px; }\n        .form-group label { display: block; margin-bottom:
      6px; font-size: 0.875rem; color: var(--text-secondary); }\n        .form-group
      input, .form-group select { width: 100%; padding: 10px 12px; background: var(--bg-primary);
      border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary);
      font-size: 0.9rem; }\n        .form-group input:focus, .form-group select:focus
      { outline: none; border-color: var(--accent-blue); }\n        .modal-footer
      { padding: 16px 20px; border-top: 1px solid var(--border-color); display: flex;
      justify-content: flex-end; gap: 12px; }\n        .btn-cancel { background: transparent;
      border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 6px;
      color: var(--text-secondary); cursor: pointer; }\n        .btn-cancel:hover
      { color: var(--text-primary); }\n        .btn-save { background: var(--accent-blue);
      border: none; padding: 8px 16px; border-radius: 6px; color: white; cursor: pointer;
      }\n        .btn-save:hover { background: #2563eb; }\n        .view-content {
      display: none; }\n        .view-content.active { display: block; }\n        @media
      (max-width: 1200px) { .summary-grid { grid-template-columns: repeat(2, 1fr);
      } .charts-grid { grid-template-columns: 1fr; } .alerts-container { grid-template-columns:
      1fr; } }\n        @media (max-width: 768px) { .sidebar { width: 60px; } .sidebar
      .logo h1, .sidebar .logo span, .sidebar .nav-item span { display: none; } .main-content
      { margin-left: 60px; } .summary-grid { grid-template-columns: 1fr; } }\n        ::-webkit-scrollbar
      { width: 8px; height: 8px; }\n        ::-webkit-scrollbar-track { background:
      var(--bg-primary); }\n        ::-webkit-scrollbar-thumb { background: var(--border-color);
      border-radius: 4px; }\n        ::-webkit-scrollbar-thumb:hover { background:
      #4a5568; }\n        .empty-state { padding: 40px; text-align: center; color:
      var(--text-secondary); }\n        .loading { display: flex; align-items: center;
      justify-content: center; padding: 40px; }\n        .spinner { width: 40px; height:
      40px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue);
      border-radius: 50%; animation: spin 1s linear infinite; }\n        @keyframes
      spin { to { transform: rotate(360deg); } }\n    </style>\n</head>\n<body>\n
      \   <div class=\"app-container\">\n        <nav class=\"sidebar\">\n            <div
      class=\"logo\">\n                <div class=\"logo-icon\">M</div>\n                <div>\n
      \                   <h1>Metrics</h1>\n                    <span>HolmOS Cluster</span>\n
      \               </div>\n            </div>\n            <div class=\"nav-menu\">\n
      \               <div class=\"nav-item active\" data-view=\"overview\">\n                    <svg
      xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4
      6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2
      2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2
      2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2
      2 0 01-2-2v-2z\" /></svg>\n                    <span>Overview</span>\n                </div>\n
      \               <div class=\"nav-item\" data-view=\"nodes\">\n                    <svg
      xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5
      12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2
      0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\" /></svg>\n
      \                   <span>Nodes</span>\n                </div>\n                <div
      class=\"nav-item\" data-view=\"deployments\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\"
      fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2
      2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0
      0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" /></svg>\n                    <span>Deployments</span>\n
      \               </div>\n                <div class=\"nav-item\" data-view=\"alerts\">\n
      \                   <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\"
      viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032
      2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165
      6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6
      0H9\" /></svg>\n                    <span>Alerts</span>\n                </div>\n
      \           </div>\n        </nav>\n        <main class=\"main-content\">\n
      \           <div id=\"overview-view\" class=\"view-content active\">\n                <div
      class=\"header\">\n                    <h2>Cluster Overview</h2>\n                    <div
      class=\"time-range-selector\">\n                        <button class=\"time-btn
      active\" data-range=\"1h\">1H</button>\n                        <button class=\"time-btn\"
      data-range=\"6h\">6H</button>\n                        <button class=\"time-btn\"
      data-range=\"24h\">24H</button>\n                        <button class=\"time-btn\"
      data-range=\"7d\">7D</button>\n                        <button class=\"time-btn\"
      data-range=\"30d\">30D</button>\n                    </div>\n                </div>\n
      \               <div class=\"summary-grid\">\n                    <div class=\"summary-card
      cpu\"><div class=\"label\">CPU Usage</div><div class=\"value\" id=\"cluster-cpu\">--</div><div
      class=\"sub\" id=\"cluster-cpu-detail\">-- cores used of -- cores</div></div>\n
      \                   <div class=\"summary-card memory\"><div class=\"label\">Memory
      Usage</div><div class=\"value\" id=\"cluster-memory\">--</div><div class=\"sub\"
      id=\"cluster-memory-detail\">-- GB used of -- GB</div></div>\n                    <div
      class=\"summary-card nodes\"><div class=\"label\">Nodes</div><div class=\"value\"
      id=\"cluster-nodes\">--</div><div class=\"sub\" id=\"cluster-nodes-detail\">--
      ready</div></div>\n                    <div class=\"summary-card pods\"><div
      class=\"label\">Pods</div><div class=\"value\" id=\"cluster-pods\">--</div><div
      class=\"sub\" id=\"cluster-deployments\">-- deployments</div></div>\n                </div>\n
      \               <div class=\"charts-grid\">\n                    <div class=\"chart-card
      cpu\"><h3>Cluster CPU</h3><div class=\"chart-container\"><canvas id=\"cluster-cpu-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card memory\"><h3>Cluster Memory</h3><div
      class=\"chart-container\"><canvas id=\"cluster-memory-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card network\"><h3>Node CPU Comparison</h3><div
      class=\"chart-container\"><canvas id=\"node-cpu-chart\"></canvas></div></div>\n
      \                   <div class=\"chart-card disk\"><h3>Node Memory Comparison</h3><div
      class=\"chart-container\"><canvas id=\"node-memory-chart\"></canvas></div></div>\n
      \               </div>\n            </div>\n            <div id=\"nodes-view\"
      class=\"view-content\">\n                <div class=\"header\"><h2>Cluster Nodes</h2></div>\n
      \               <div class=\"nodes-grid\" id=\"nodes-grid\"><div class=\"loading\"><div
      class=\"spinner\"></div></div></div>\n            </div>\n            <div id=\"deployments-view\"
      class=\"view-content\">\n                <div class=\"header\"><h2>Deployments</h2></div>\n
      \               <div class=\"table-container\">\n                    <div class=\"table-header\"><h3>All
      Deployments</h3><input type=\"text\" class=\"search-input\" placeholder=\"Search
      deployments...\" id=\"deployment-search\"></div>\n                    <table><thead><tr><th>Name</th><th>Namespace</th><th>Replicas</th><th>CPU</th><th>Memory</th></tr></thead><tbody
      id=\"deployments-table\"></tbody></table>\n                </div>\n            </div>\n
      \           <div id=\"alerts-view\" class=\"view-content\">\n                <div
      class=\"header\"><h2>Alert Management</h2></div>\n                <div class=\"alerts-container\">\n
      \                   <div class=\"alert-rules-card\">\n                        <div
      class=\"alert-card-header\"><h3>Alert Rules</h3><button class=\"btn-add\" onclick=\"openAlertModal()\"><svg
      width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12
      4v16m8-8H4\"/></svg>Add Rule</button></div>\n                        <div class=\"alert-list\"
      id=\"alert-rules-list\"></div>\n                    </div>\n                    <div
      class=\"triggered-alerts-card\">\n                        <div class=\"alert-card-header\"><h3>Triggered
      Alerts</h3></div>\n                        <div class=\"alert-list\" id=\"triggered-alerts-list\"></div>\n
      \                   </div>\n                </div>\n            </div>\n        </main>\n
      \   </div>\n    <div class=\"modal-overlay\" id=\"alert-modal\">\n        <div
      class=\"modal\">\n            <div class=\"modal-header\"><h3>Create Alert Rule</h3><button
      class=\"btn-icon\" onclick=\"closeAlertModal()\"><svg width=\"20\" height=\"20\"
      fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\"
      stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg></button></div>\n
      \           <div class=\"modal-body\">\n                <div class=\"form-group\"><label>Rule
      Name</label><input type=\"text\" id=\"alert-name\" placeholder=\"High CPU Alert\"></div>\n
      \               <div class=\"form-group\"><label>Metric</label><select id=\"alert-metric\"><option
      value=\"cpu\">CPU Usage (%)</option><option value=\"memory\">Memory Usage (%)</option></select></div>\n
      \               <div class=\"form-group\"><label>Condition</label><select id=\"alert-condition\"><option
      value=\">\">> Greater than</option><option value=\">=\">>= Greater than or equal</option><option
      value=\"<\">< Less than</option><option value=\"<=\"><= Less than or equal</option></select></div>\n
      \               <div class=\"form-group\"><label>Threshold (%)</label><input
      type=\"number\" id=\"alert-threshold\" placeholder=\"90\" min=\"0\" max=\"100\"></div>\n
      \               <div class=\"form-group\"><label>Node (leave empty for all)</label><select
      id=\"alert-node\"><option value=\"*\">All Nodes</option></select></div>\n            </div>\n
      \           <div class=\"modal-footer\"><button class=\"btn-cancel\" onclick=\"closeAlertModal()\">Cancel</button><button
      class=\"btn-save\" onclick=\"saveAlertRule()\">Create Rule</button></div>\n
      \       </div>\n    </div>\n    <script>\n        let currentTimeRange = '1h';\n
      \       let clusterCPUChart, clusterMemoryChart, nodeCPUChart, nodeMemoryChart;\n
      \       let nodes = [];\n        let deployments = [];\n        let alertRules
      = [];\n        let triggeredAlerts = [];\n        const chartConfig = {\n            responsive:
      true, maintainAspectRatio: false,\n            interaction: { intersect: false,
      mode: 'index' },\n            scales: {\n                x: { type: 'time',
      time: { unit: 'minute' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks:
      { color: '#a1a1aa' } },\n                y: { beginAtZero: true, max: 100, grid:
      { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a1a1aa', callback: (v)
      => v + '%' } }\n            },\n            plugins: { legend: { display: false
      }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748', borderWidth:
      1, titleColor: '#e4e4e7', bodyColor: '#a1a1aa', callbacks: { label: (ctx) =>
      ctx.parsed.y.toFixed(1) + '%' } } },\n            elements: { point: { radius:
      0 }, line: { tension: 0.3, borderWidth: 2 } }\n        };\n        const barChartConfig
      = {\n            responsive: true, maintainAspectRatio: false, indexAxis: 'y',\n
      \           scales: { x: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)'
      }, ticks: { color: '#a1a1aa', callback: (v) => v + '%' } }, y: { grid: { display:
      false }, ticks: { color: '#a1a1aa' } } },\n            plugins: { legend: {
      display: false }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748',
      borderWidth: 1, callbacks: { label: (ctx) => ctx.parsed.x.toFixed(1) + '%' }
      } }\n        };\n        function initCharts() {\n            clusterCPUChart
      = new Chart(document.getElementById('cluster-cpu-chart').getContext('2d'), {
      type: 'line', data: { datasets: [{ label: 'CPU', data: [], borderColor: '#06b6d4',
      backgroundColor: 'rgba(6, 182, 212, 0.1)', fill: true }] }, options: chartConfig
      });\n            clusterMemoryChart = new Chart(document.getElementById('cluster-memory-chart').getContext('2d'),
      { type: 'line', data: { datasets: [{ label: 'Memory', data: [], borderColor:
      '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true }] }, options:
      chartConfig });\n            nodeCPUChart = new Chart(document.getElementById('node-cpu-chart').getContext('2d'),
      { type: 'bar', data: { labels: [], datasets: [{ label: 'CPU %', data: [], backgroundColor:
      '#06b6d4' }] }, options: barChartConfig });\n            nodeMemoryChart = new
      Chart(document.getElementById('node-memory-chart').getContext('2d'), { type:
      'bar', data: { labels: [], datasets: [{ label: 'Memory %', data: [], backgroundColor:
      '#10b981' }] }, options: barChartConfig });\n        }\n        async function
      fetchClusterSummary() {\n            try {\n                const r = await
      fetch('/api/cluster'); const d = await r.json();\n                document.getElementById('cluster-cpu').textContent
      = d.cpu_pct.toFixed(1) + '%';\n                document.getElementById('cluster-cpu-detail').textContent
      = (d.used_cpu_cores/1000).toFixed(1) + ' cores of ' + (d.total_cpu_cores/1000).toFixed(1)
      + ' cores';\n                document.getElementById('cluster-memory').textContent
      = d.memory_pct.toFixed(1) + '%';\n                document.getElementById('cluster-memory-detail').textContent
      = d.used_memory_gb.toFixed(1) + ' GB of ' + d.total_memory_gb.toFixed(1) + '
      GB';\n                document.getElementById('cluster-nodes').textContent =
      d.total_nodes;\n                document.getElementById('cluster-nodes-detail').textContent
      = d.ready_nodes + ' ready';\n                document.getElementById('cluster-pods').textContent
      = d.total_pods;\n                document.getElementById('cluster-deployments').textContent
      = d.total_deployments + ' deployments';\n            } catch (e) { console.error('Failed
      to fetch cluster summary:', e); }\n        }\n        async function fetchNodes()
      {\n            try { const r = await fetch('/api/nodes'); nodes = await r.json();
      updateNodesGrid(); updateNodeCharts(); updateAlertNodeSelector(); } catch (e)
      { console.error('Failed to fetch nodes:', e); }\n        }\n        async function
      fetchDeployments() {\n            try { const r = await fetch('/api/deployments?namespace=holm');
      deployments = await r.json(); updateDeploymentsTable(); } catch (e) { console.error('Failed
      to fetch deployments:', e); }\n        }\n        async function fetchHistory()
      {\n            try {\n                const cpuR = await fetch('/api/history?metric=cluster_cpu&range='
      + currentTimeRange); const cpuD = await cpuR.json();\n                const
      memR = await fetch('/api/history?metric=cluster_mem&range=' + currentTimeRange);
      const memD = await memR.json();\n                if (cpuD && cpuD.length > 0)
      { clusterCPUChart.data.datasets[0].data = cpuD.map(p => ({ x: new Date(p.timestamp),
      y: p.value })); clusterCPUChart.update('none'); }\n                if (memD
      && memD.length > 0) { clusterMemoryChart.data.datasets[0].data = memD.map(p
      => ({ x: new Date(p.timestamp), y: p.value })); clusterMemoryChart.update('none');
      }\n            } catch (e) { console.error('Failed to fetch history:', e); }\n
      \       }\n        async function fetchAlertRules() { try { const r = await
      fetch('/api/alerts/rules'); alertRules = await r.json(); updateAlertRulesList();
      } catch (e) { console.error('Failed to fetch alert rules:', e); } }\n        async
      function fetchTriggeredAlerts() { try { const r = await fetch('/api/alerts/triggered');
      triggeredAlerts = await r.json(); updateTriggeredAlertsList(); } catch (e) {
      console.error('Failed to fetch triggered alerts:', e); } }\n        function
      updateNodesGrid() {\n            const g = document.getElementById('nodes-grid');\n
      \           if (!nodes || nodes.length === 0) { g.innerHTML = '<div class=\"empty-state\">No
      nodes found</div>'; return; }\n            g.innerHTML = nodes.map(n => '<div
      class=\"node-card\" onclick=\"showNodeDetails(\\'' + n.name + '\\')\"><div class=\"node-header\"><span
      class=\"node-name\">' + n.name + '</span><span class=\"status-badge ' + (n.status
      === 'Ready' ? 'ready' : 'notready') + '\">' + n.status + '</span></div><div
      class=\"node-metrics\"><div class=\"metric-item\"><span class=\"metric-label\">CPU</span><div
      class=\"metric-bar\"><div class=\"metric-bar-fill cpu\" style=\"width: ' + Math.min(100,
      n.cpu_pct) + '%\"></div></div><span class=\"metric-value\">' + n.cpu_pct.toFixed(1)
      + '%</span></div><div class=\"metric-item\"><span class=\"metric-label\">Memory</span><div
      class=\"metric-bar\"><div class=\"metric-bar-fill memory\" style=\"width: '
      + Math.min(100, n.memory_pct) + '%\"></div></div><span class=\"metric-value\">'
      + n.memory_pct.toFixed(1) + '%</span></div></div><div style=\"margin-top: 12px;
      color: var(--text-secondary); font-size: 0.8rem;\">' + n.pods + ' pods | ' +
      (n.cpu_cores/1000).toFixed(2) + ' CPU | ' + (n.memory_mb/1024).toFixed(1) +
      ' GB RAM</div></div>').join('');\n        }\n        function updateNodeCharts()
      {\n            if (!nodes || nodes.length === 0) return;\n            nodeCPUChart.data.labels
      = nodes.map(n => n.name);\n            nodeCPUChart.data.datasets[0].data =
      nodes.map(n => n.cpu_pct);\n            nodeCPUChart.data.datasets[0].backgroundColor
      = nodes.map(n => n.cpu_pct > 80 ? '#ef4444' : n.cpu_pct > 60 ? '#f59e0b' : '#06b6d4');\n
      \           nodeCPUChart.update('none');\n            nodeMemoryChart.data.labels
      = nodes.map(n => n.name);\n            nodeMemoryChart.data.datasets[0].data
      = nodes.map(n => n.memory_pct);\n            nodeMemoryChart.data.datasets[0].backgroundColor
      = nodes.map(n => n.memory_pct > 80 ? '#ef4444' : n.memory_pct > 60 ? '#f59e0b'
      : '#10b981');\n            nodeMemoryChart.update('none');\n        }\n        function
      updateDeploymentsTable() {\n            const t = document.getElementById('deployments-table');
      const s = document.getElementById('deployment-search').value.toLowerCase();\n
      \           const f = deployments.filter(d => d.name.toLowerCase().includes(s)
      || d.namespace.toLowerCase().includes(s));\n            if (f.length === 0)
      { t.innerHTML = '<tr><td colspan=\"5\" class=\"empty-state\">No deployments
      found</td></tr>'; return; }\n            t.innerHTML = f.map(d => '<tr><td class=\"deployment-name\">'
      + d.name + '</td><td>' + d.namespace + '</td><td><span class=\"replica-badge
      ' + (d.ready >= d.replicas ? 'healthy' : 'degraded') + '\">' + d.ready + '/'
      + d.replicas + '</span></td><td>' + d.cpu_total.toFixed(0) + 'm</td><td>' +
      d.memory_mb.toFixed(0) + ' MB</td></tr>').join('');\n        }\n        function
      updateAlertRulesList() {\n            const l = document.getElementById('alert-rules-list');\n
      \           if (!alertRules || alertRules.length === 0) { l.innerHTML = '<div
      class=\"empty-state\">No alert rules configured</div>'; return; }\n            l.innerHTML
      = alertRules.map(r => '<div class=\"alert-item\"><div class=\"alert-info\"><span
      class=\"alert-name\">' + r.name + '</span><span class=\"alert-condition\">'
      + r.metric.toUpperCase() + ' ' + r.condition + ' ' + r.threshold + '% on ' +
      (r.node === '*' ? 'all nodes' : r.node) + '</span></div><div class=\"alert-actions\"><button
      class=\"btn-icon delete\" onclick=\"deleteAlertRule(\\'' + r.id + '\\')\" title=\"Delete\"><svg
      width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path
      stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19
      7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1
      1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/></svg></button></div></div>').join('');\n
      \       }\n        function updateTriggeredAlertsList() {\n            const
      l = document.getElementById('triggered-alerts-list');\n            if (!triggeredAlerts
      || triggeredAlerts.length === 0) { l.innerHTML = '<div class=\"empty-state\">No
      alerts triggered</div>'; return; }\n            const sorted = [...triggeredAlerts].sort((a,
      b) => new Date(b.timestamp) - new Date(a.timestamp));\n            l.innerHTML
      = sorted.map(a => '<div class=\"triggered-alert ' + (a.resolved ? 'resolved'
      : '') + '\"><div class=\"alert-message\">' + a.message + '</div><div class=\"alert-condition\">Value:
      ' + a.value.toFixed(1) + '% (threshold: ' + a.threshold + '%)</div><div class=\"alert-time\">'
      + new Date(a.timestamp).toLocaleString() + '</div>' + (!a.resolved ? '<button
      class=\"btn-icon\" onclick=\"resolveAlert(\\'' + a.id + '\\')\" style=\"margin-top:
      8px;\">Mark Resolved</button>' : '') + '</div>').join('');\n        }\n        function
      updateAlertNodeSelector() { const s = document.getElementById('alert-node');
      s.innerHTML = '<option value=\"*\">All Nodes</option>'; nodes.forEach(n => {
      s.innerHTML += '<option value=\"' + n.name + '\">' + n.name + '</option>'; });
      }\n        function openAlertModal() { document.getElementById('alert-modal').classList.add('active');
      }\n        function closeAlertModal() { document.getElementById('alert-modal').classList.remove('active');
      document.getElementById('alert-name').value = ''; document.getElementById('alert-threshold').value
      = ''; }\n        async function saveAlertRule() {\n            const r = { name:
      document.getElementById('alert-name').value, metric: document.getElementById('alert-metric').value,
      condition: document.getElementById('alert-condition').value, threshold: parseFloat(document.getElementById('alert-threshold').value),
      node: document.getElementById('alert-node').value, enabled: true };\n            if
      (!r.name || isNaN(r.threshold)) { alert('Please fill in all required fields');
      return; }\n            try { await fetch('/api/alerts/rules', { method: 'POST',
      headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(r) });
      closeAlertModal(); fetchAlertRules(); } catch (e) { console.error('Failed to
      create alert rule:', e); }\n        }\n        async function deleteAlertRule(id)
      { if (!confirm('Delete this alert rule?')) return; try { await fetch('/api/alerts/rules?id='
      + id, { method: 'DELETE' }); fetchAlertRules(); } catch (e) { console.error('Failed
      to delete alert rule:', e); } }\n        async function resolveAlert(id) { try
      { await fetch('/api/alerts/resolve?id=' + id, { method: 'POST' }); fetchTriggeredAlerts();
      } catch (e) { console.error('Failed to resolve alert:', e); } }\n        function
      showNodeDetails(nodeName) { console.log('Show details for:', nodeName); }\n
      \       document.querySelectorAll('.nav-item').forEach(i => { i.addEventListener('click',
      () => { document.querySelectorAll('.nav-item').forEach(j => j.classList.remove('active'));
      i.classList.add('active'); const v = i.dataset.view; document.querySelectorAll('.view-content').forEach(c
      => c.classList.remove('active')); document.getElementById(v + '-view').classList.add('active');
      }); });\n        document.querySelectorAll('.time-btn').forEach(b => { b.addEventListener('click',
      () => { document.querySelectorAll('.time-btn').forEach(c => c.classList.remove('active'));
      b.classList.add('active'); currentTimeRange = b.dataset.range; let u = 'minute';
      if (currentTimeRange === '7d' || currentTimeRange === '30d') u = 'day'; else
      if (currentTimeRange === '24h') u = 'hour'; clusterCPUChart.options.scales.x.time.unit
      = u; clusterMemoryChart.options.scales.x.time.unit = u; fetchHistory(); });
      });\n        document.getElementById('deployment-search').addEventListener('input',
      updateDeploymentsTable);\n        function init() { initCharts(); fetchClusterSummary();
      fetchNodes(); fetchDeployments(); fetchHistory(); fetchAlertRules(); fetchTriggeredAlerts();
      setInterval(() => { fetchClusterSummary(); fetchNodes(); fetchHistory(); fetchTriggeredAlerts();
      }, 10000); setInterval(fetchDeployments, 30000); }\n        init();\n    </script>\n</body>\n</html>`\n"
    go.mod: |
      module settings-web

      go 1.21
    main.go: "package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"net/url\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n)\n\n//
      Metrics storage\nvar (\n\tmetricsHistory   = make(map[string][]MetricPoint)\n\talertRules
      \      = []AlertRule{}\n\ttriggeredAlerts  = []TriggeredAlert{}\n\thistoryMutex
      \    = sync.RWMutex{}\n\talertMutex       = sync.RWMutex{}\n\tmaxHistoryPoints
      = 8640 // 24 hours at 10-second intervals or 30 days at 5-min intervals\n)\n\n//
      Data structures\ntype MetricPoint struct {\n\tTimestamp time.Time `json:\"timestamp\"`\n\tValue
      \    float64   `json:\"value\"`\n\tNode      string    `json:\"node,omitempty\"`\n}\n\ntype
      NodeMetrics struct {\n\tName      string  `json:\"name\"`\n\tCPUCores  float64
      `json:\"cpu_cores\"`\n\tCPUPct    float64 `json:\"cpu_pct\"`\n\tMemoryMB  float64
      `json:\"memory_mb\"`\n\tMemoryPct float64 `json:\"memory_pct\"`\n\tPods      int
      \    `json:\"pods\"`\n\tStatus    string  `json:\"status\"`\n}\n\ntype PodMetrics
      struct {\n\tName       string  `json:\"name\"`\n\tNamespace  string  `json:\"namespace\"`\n\tNode
      \      string  `json:\"node\"`\n\tCPUm       float64 `json:\"cpu_m\"`\n\tMemoryMB
      \  float64 `json:\"memory_mb\"`\n\tStatus     string  `json:\"status\"`\n\tDeployment
      string  `json:\"deployment\"`\n}\n\ntype DeploymentMetrics struct {\n\tName
      \      string       `json:\"name\"`\n\tNamespace  string       `json:\"namespace\"`\n\tReplicas
      \  int          `json:\"replicas\"`\n\tReady      int          `json:\"ready\"`\n\tCPUTotal
      \  float64      `json:\"cpu_total\"`\n\tMemoryMB   float64      `json:\"memory_mb\"`\n\tPodMetrics
      []PodMetrics `json:\"pods\"`\n}\n\ntype ClusterSummary struct {\n\tTotalNodes
      \      int     `json:\"total_nodes\"`\n\tReadyNodes       int     `json:\"ready_nodes\"`\n\tTotalPods
      \       int     `json:\"total_pods\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tTotalCPUCores
      \   float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores     float64 `json:\"used_cpu_cores\"`\n\tTotalMemoryGB
      \   float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tCPUPct
      \          float64 `json:\"cpu_pct\"`\n\tMemoryPct        float64 `json:\"memory_pct\"`\n}\n\ntype
      AlertRule struct {\n\tID          string    `json:\"id\"`\n\tName        string
      \   `json:\"name\"`\n\tMetric      string    `json:\"metric\"`\n\tCondition
      \  string    `json:\"condition\"`\n\tThreshold   float64   `json:\"threshold\"`\n\tNode
      \       string    `json:\"node\"`\n\tNamespace   string    `json:\"namespace,omitempty\"`\n\tPod
      \        string    `json:\"pod,omitempty\"`\n\tSeverity    string    `json:\"severity\"`
      // critical, warning, info\n\tDuration    int       `json:\"duration\"` // seconds
      threshold must be exceeded\n\tEnabled     bool      `json:\"enabled\"`\n\tCreated
      \    time.Time `json:\"created\"`\n\tLastChecked time.Time `json:\"last_checked,omitempty\"`\n}\n\ntype
      TriggeredAlert struct {\n\tID           string    `json:\"id\"`\n\tRuleID       string
      \   `json:\"rule_id\"`\n\tRuleName     string    `json:\"rule_name\"`\n\tMessage
      \     string    `json:\"message\"`\n\tValue        float64   `json:\"value\"`\n\tThreshold
      \   float64   `json:\"threshold\"`\n\tSeverity     string    `json:\"severity\"`\n\tNode
      \        string    `json:\"node,omitempty\"`\n\tNamespace    string    `json:\"namespace,omitempty\"`\n\tPod
      \         string    `json:\"pod,omitempty\"`\n\tMetric       string    `json:\"metric\"`\n\tTimestamp
      \   time.Time `json:\"timestamp\"`\n\tResolvedAt   time.Time `json:\"resolved_at,omitempty\"`\n\tResolved
      \    bool      `json:\"resolved\"`\n\tAcknowledged bool      `json:\"acknowledged\"`\n}\n\n//
      ClusterMetrics represents comprehensive cluster-wide metrics\ntype ClusterMetrics
      struct {\n\tTimestamp      time.Time              `json:\"timestamp\"`\n\tSummary
      \       ClusterSummary         `json:\"summary\"`\n\tNodeMetrics    []NodeMetrics
      \         `json:\"node_metrics\"`\n\tTopPodsByCPU   []PodMetrics           `json:\"top_pods_by_cpu\"`\n\tTopPodsByMem
      \  []PodMetrics           `json:\"top_pods_by_memory\"`\n\tNamespaces     []NamespaceMetrics
      \    `json:\"namespaces\"`\n\tResourceQuotas []ResourceQuotaStatus  `json:\"resource_quotas,omitempty\"`\n\tAlerts
      \        AlertsSummary          `json:\"alerts\"`\n}\n\n// NamespaceMetrics
      contains metrics aggregated by namespace\ntype NamespaceMetrics struct {\n\tName
      \       string  `json:\"name\"`\n\tPodCount    int     `json:\"pod_count\"`\n\tCPUUsage
      \   float64 `json:\"cpu_usage_m\"`\n\tMemoryUsage float64 `json:\"memory_usage_mb\"`\n\tCPUPct
      \     float64 `json:\"cpu_pct\"`\n\tMemoryPct   float64 `json:\"memory_pct\"`\n}\n\n//
      ResourceQuotaStatus represents quota usage\ntype ResourceQuotaStatus struct
      {\n\tNamespace  string  `json:\"namespace\"`\n\tCPUUsed    float64 `json:\"cpu_used\"`\n\tCPULimit
      \  float64 `json:\"cpu_limit\"`\n\tMemUsed    float64 `json:\"mem_used_mb\"`\n\tMemLimit
      \  float64 `json:\"mem_limit_mb\"`\n\tPodsUsed   int     `json:\"pods_used\"`\n\tPodsLimit
      \ int     `json:\"pods_limit\"`\n}\n\n// AlertsSummary provides alert statistics\ntype
      AlertsSummary struct {\n\tTotal      int `json:\"total\"`\n\tCritical   int
      `json:\"critical\"`\n\tWarning    int `json:\"warning\"`\n\tInfo       int `json:\"info\"`\n\tActive
      \    int `json:\"active\"`\n\tResolved   int `json:\"resolved\"`\n}\n\n// NodeDetailedMetrics
      provides in-depth metrics for a single node\ntype NodeDetailedMetrics struct
      {\n\tNodeMetrics\n\tAllocatable   ResourceCapacity  `json:\"allocatable\"`\n\tCapacity
      \     ResourceCapacity  `json:\"capacity\"`\n\tConditions    []NodeCondition
      \  `json:\"conditions\"`\n\tPods          []PodMetrics      `json:\"pods\"`\n\tCPUHistory
      \   []MetricPoint     `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint
      \    `json:\"memory_history\"`\n\tLabels        map[string]string `json:\"labels,omitempty\"`\n\tTaints
      \       []string          `json:\"taints,omitempty\"`\n}\n\n// ResourceCapacity
      represents node resource capacity\ntype ResourceCapacity struct {\n\tCPU     float64
      `json:\"cpu_cores\"`\n\tMemory  float64 `json:\"memory_mb\"`\n\tPods    int
      \    `json:\"pods\"`\n\tStorage float64 `json:\"storage_gb,omitempty\"`\n}\n\n//
      NodeCondition represents node status conditions\ntype NodeCondition struct {\n\tType
      \   string `json:\"type\"`\n\tStatus  string `json:\"status\"`\n\tMessage string
      `json:\"message,omitempty\"`\n}\n\n// PodDetailedMetrics provides in-depth metrics
      for a single pod\ntype PodDetailedMetrics struct {\n\tPodMetrics\n\tContainers
      \   []ContainerMetrics `json:\"containers\"`\n\tRestartCount  int                `json:\"restart_count\"`\n\tStartTime
      \    time.Time          `json:\"start_time\"`\n\tCPUHistory    []MetricPoint
      \     `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint      `json:\"memory_history\"`\n\tEvents
      \       []PodEvent         `json:\"events,omitempty\"`\n\tLabels        map[string]string
      \ `json:\"labels,omitempty\"`\n}\n\n// ContainerMetrics represents metrics for
      individual containers\ntype ContainerMetrics struct {\n\tName         string
      \ `json:\"name\"`\n\tCPUm         float64 `json:\"cpu_m\"`\n\tMemoryMB     float64
      `json:\"memory_mb\"`\n\tRestartCount int     `json:\"restart_count\"`\n\tReady
      \       bool    `json:\"ready\"`\n\tState        string  `json:\"state\"`\n}\n\n//
      PodEvent represents a Kubernetes event\ntype PodEvent struct {\n\tType      string
      \   `json:\"type\"`\n\tReason    string    `json:\"reason\"`\n\tMessage   string
      \   `json:\"message\"`\n\tCount     int       `json:\"count\"`\n\tTimestamp
      time.Time `json:\"timestamp\"`\n}\n\n// HistoricalData represents a time-series
      response\ntype HistoricalData struct {\n\tMetric     string        `json:\"metric\"`\n\tNode
      \      string        `json:\"node,omitempty\"`\n\tNamespace  string        `json:\"namespace,omitempty\"`\n\tPod
      \       string        `json:\"pod,omitempty\"`\n\tResolution string        `json:\"resolution\"`\n\tStart
      \     time.Time     `json:\"start\"`\n\tEnd        time.Time     `json:\"end\"`\n\tPoints
      \    []MetricPoint `json:\"points\"`\n}\n\n// AlertsResponse provides unified
      alerts API response\ntype AlertsResponse struct {\n\tRules     []AlertRule      `json:\"rules\"`\n\tTriggered
      []TriggeredAlert `json:\"triggered\"`\n\tSummary   AlertsSummary    `json:\"summary\"`\n}\n\n//
      K8s API response structures\ntype K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric
      `json:\"items\"`\n}\n\ntype K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName
      string `json:\"name\"`\n\t} `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string
      `json:\"cpu\"`\n\t\tMemory string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype
      K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype
      K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct
      {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string
      `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t}
      `json:\"containers\"`\n}\n\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype
      K8sNode struct {\n\tMetadata struct {\n\t\tName   string            `json:\"name\"`\n\t\tLabels
      map[string]string `json:\"labels\"`\n\t} `json:\"metadata\"`\n\tSpec struct
      {\n\t\tTaints []struct {\n\t\t\tKey    string `json:\"key\"`\n\t\t\tValue  string
      `json:\"value\"`\n\t\t\tEffect string `json:\"effect\"`\n\t\t} `json:\"taints\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType    string
      `json:\"type\"`\n\t\t\tStatus  string `json:\"status\"`\n\t\t\tMessage string
      `json:\"message\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity struct {\n\t\t\tCPU
      \    string `json:\"cpu\"`\n\t\t\tMemory  string `json:\"memory\"`\n\t\t\tPods
      \   string `json:\"pods\"`\n\t\t\tStorage string `json:\"ephemeral-storage\"`\n\t\t}
      `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU     string `json:\"cpu\"`\n\t\t\tMemory
      \ string `json:\"memory\"`\n\t\t\tPods    string `json:\"pods\"`\n\t\t\tStorage
      string `json:\"ephemeral-storage\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sPodList struct {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct
      {\n\tMetadata struct {\n\t\tName              string            `json:\"name\"`\n\t\tNamespace
      \        string            `json:\"namespace\"`\n\t\tLabels            map[string]string
      `json:\"labels\"`\n\t\tCreationTimestamp string            `json:\"creationTimestamp\"`\n\t\tOwnerReferences
      \  []struct {\n\t\t\tKind string `json:\"kind\"`\n\t\t\tName string `json:\"name\"`\n\t\t}
      `json:\"ownerReferences\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName
      \  string `json:\"nodeName\"`\n\t\tContainers []struct {\n\t\t\tName      string
      `json:\"name\"`\n\t\t\tResources struct {\n\t\t\t\tRequests struct {\n\t\t\t\t\tCPU
      \   string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t}
      `json:\"requests\"`\n\t\t\t\tLimits struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory
      string `json:\"memory\"`\n\t\t\t\t} `json:\"limits\"`\n\t\t\t} `json:\"resources\"`\n\t\t}
      `json:\"containers\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string
      \   `json:\"phase\"`\n\t\tStartTime         string    `json:\"startTime\"`\n\t\tContainerStatuses
      []struct {\n\t\t\tName         string `json:\"name\"`\n\t\t\tReady        bool
      \  `json:\"ready\"`\n\t\t\tRestartCount int    `json:\"restartCount\"`\n\t\t\tState
      \       struct {\n\t\t\t\tRunning    *struct{} `json:\"running\"`\n\t\t\t\tWaiting
      \   *struct{ Reason string `json:\"reason\"` } `json:\"waiting\"`\n\t\t\t\tTerminated
      *struct{ Reason string `json:\"reason\"` } `json:\"terminated\"`\n\t\t\t} `json:\"state\"`\n\t\t}
      `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype K8sDeploymentList
      struct {\n\tItems []K8sDeployment `json:\"items\"`\n}\n\ntype K8sDeployment
      struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas
      int `json:\"replicas\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tReplicas
      \     int `json:\"replicas\"`\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t}
      `json:\"status\"`\n}\n\n// PrometheusResponse for historical queries\ntype PrometheusResponse
      struct {\n\tStatus string `json:\"status\"`\n\tData   struct {\n\t\tResultType
      string `json:\"resultType\"`\n\t\tResult     []struct {\n\t\t\tMetric map[string]string
      `json:\"metric\"`\n\t\t\tValues [][]interface{}   `json:\"values\"`\n\t\t} `json:\"result\"`\n\t}
      `json:\"data\"`\n}\n\n// K8s API client\nfunc k8sAPIRequest(path string) ([]byte,
      error) {\n\ttoken, err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token:
      %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort
      := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer
      = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\",
      apiServer, apiPort, path)\n\n\ttransport := &http.Transport{\n\t\tTLSClientConfig:
      &tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := &http.Client{\n\t\tTransport:
      transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\",
      apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\",
      \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n//
      Prometheus query helper\nfunc queryPrometheus(query string, start, end time.Time,
      step string) (*PrometheusResponse, error) {\n\tpromURL := os.Getenv(\"PROMETHEUS_URL\")\n\tif
      promURL == \"\" {\n\t\tpromURL = \"http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\"\n\t}\n\n\tparams
      := url.Values{}\n\tparams.Set(\"query\", query)\n\tparams.Set(\"start\", strconv.FormatInt(start.Unix(),
      10))\n\tparams.Set(\"end\", strconv.FormatInt(end.Unix(), 10))\n\tparams.Set(\"step\",
      step)\n\n\tresp, err := http.Get(fmt.Sprintf(\"%s/api/v1/query_range?%s\", promURL,
      params.Encode()))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tvar
      result PrometheusResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&result);
      err != nil {\n\t\treturn nil, err\n\t}\n\treturn &result, nil\n}\n\n// Parse
      K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif
      strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif
      strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn
      val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts
      = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\")
      {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if
      strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier
      = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s,
      \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s,
      64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch
      all metrics from K8s\nfunc fetchNodeMetrics() ([]NodeMetrics, error) {\n\t//
      Get node metrics\n\tmetricsData, err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeMetricsList K8sNodeMetricsList\n\tif
      err := json.Unmarshal(metricsData, &nodeMetricsList); err != nil {\n\t\treturn
      nil, err\n\t}\n\n\t// Get node info for capacity\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err
      := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get pod counts per node\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err
      := json.Unmarshal(podData, &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tpodCounts
      := make(map[string]int)\n\tfor _, pod := range podList.Items {\n\t\tif pod.Status.Phase
      == \"Running\" {\n\t\t\tpodCounts[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t// Build
      node capacity map\n\ttype nodeCapInfo struct {\n\t\tCPUCores float64\n\t\tMemoryMB
      float64\n\t\tStatus   string\n\t}\n\tnodeCapacity := make(map[string]nodeCapInfo)\n\n\tfor
      _, node := range nodeList.Items {\n\t\tstatus := \"NotReady\"\n\t\tfor _, cond
      := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" && cond.Status
      == \"True\" {\n\t\t\t\tstatus = \"Ready\"\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tnodeCapacity[node.Metadata.Name]
      = nodeCapInfo{\n\t\t\tCPUCores: parseCPU(node.Status.Allocatable.CPU),\n\t\t\tMemoryMB:
      parseMemory(node.Status.Allocatable.Memory),\n\t\t\tStatus:   status,\n\t\t}\n\t}\n\n\t//
      Build result\n\tvar result []NodeMetrics\n\tfor _, nm := range nodeMetricsList.Items
      {\n\t\tcap := nodeCapacity[nm.Metadata.Name]\n\t\tcpuUsed := parseCPU(nm.Usage.CPU)\n\t\tmemUsed
      := parseMemory(nm.Usage.Memory)\n\n\t\tcpuPct := 0.0\n\t\tif cap.CPUCores >
      0 {\n\t\t\tcpuPct = (cpuUsed / cap.CPUCores) * 100\n\t\t}\n\t\tmemPct := 0.0\n\t\tif
      cap.MemoryMB > 0 {\n\t\t\tmemPct = (memUsed / cap.MemoryMB) * 100\n\t\t}\n\n\t\tresult
      = append(result, NodeMetrics{\n\t\t\tName:      nm.Metadata.Name,\n\t\t\tCPUCores:
      \ cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:  memUsed,\n\t\t\tMemoryPct:
      memPct,\n\t\t\tPods:      podCounts[nm.Metadata.Name],\n\t\t\tStatus:    cap.Status,\n\t\t})\n\t}\n\n\tsort.Slice(result,
      func(i, j int) bool {\n\t\treturn result[i].Name < result[j].Name\n\t})\n\n\treturn
      result, nil\n}\n\nfunc fetchPodMetrics() ([]PodMetrics, error) {\n\tmetricsData,
      err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\n\tvar podMetricsList K8sPodMetricsList\n\tif
      err := json.Unmarshal(metricsData, &podMetricsList); err != nil {\n\t\treturn
      nil, err\n\t}\n\n\t// Get pod info for node and status\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err
      := json.Unmarshal(podData, &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\ttype
      podInfo struct {\n\t\tNode       string\n\t\tStatus     string\n\t\tDeployment
      string\n\t}\n\tpodInfoMap := make(map[string]podInfo)\n\n\tfor _, pod := range
      podList.Items {\n\t\tkey := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\t\tdeployment
      := \"\"\n\t\tfor _, owner := range pod.Metadata.OwnerReferences {\n\t\t\tif
      owner.Kind == \"ReplicaSet\" {\n\t\t\t\t// Extract deployment name from replicaset
      name (remove hash suffix)\n\t\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\t\tif
      len(parts) > 1 {\n\t\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1],
      \"-\")\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tpodInfoMap[key] = podInfo{\n\t\t\tNode:
      \      pod.Spec.NodeName,\n\t\t\tStatus:     pod.Status.Phase,\n\t\t\tDeployment:
      deployment,\n\t\t}\n\t}\n\n\tvar result []PodMetrics\n\tfor _, pm := range podMetricsList.Items
      {\n\t\tkey := pm.Metadata.Namespace + \"/\" + pm.Metadata.Name\n\t\tinfo :=
      podInfoMap[key]\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, container
      := range pm.Containers {\n\t\t\ttotalCPU += parseCPU(container.Usage.CPU)\n\t\t\ttotalMem
      += parseMemory(container.Usage.Memory)\n\t\t}\n\n\t\tresult = append(result,
      PodMetrics{\n\t\t\tName:       pm.Metadata.Name,\n\t\t\tNamespace:  pm.Metadata.Namespace,\n\t\t\tNode:
      \      info.Node,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:
      \    info.Status,\n\t\t\tDeployment: info.Deployment,\n\t\t})\n\t}\n\n\treturn
      result, nil\n}\n\nfunc fetchDeploymentMetrics() ([]DeploymentMetrics, error)
      {\n\t// Get deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tif
      err := json.Unmarshal(deployData, &deployList); err != nil {\n\t\treturn nil,
      err\n\t}\n\n\t// Get pod metrics\n\tpods, err := fetchPodMetrics()\n\tif err
      != nil {\n\t\treturn nil, err\n\t}\n\n\t// Group pods by deployment\n\tdeployPods
      := make(map[string][]PodMetrics)\n\tfor _, pod := range pods {\n\t\tif pod.Deployment
      != \"\" {\n\t\t\tkey := pod.Namespace + \"/\" + pod.Deployment\n\t\t\tdeployPods[key]
      = append(deployPods[key], pod)\n\t\t}\n\t}\n\n\tvar result []DeploymentMetrics\n\tfor
      _, deploy := range deployList.Items {\n\t\tkey := deploy.Metadata.Namespace
      + \"/\" + deploy.Metadata.Name\n\t\tpods := deployPods[key]\n\n\t\tvar totalCPU,
      totalMem float64\n\t\tfor _, pod := range pods {\n\t\t\ttotalCPU += pod.CPUm\n\t\t\ttotalMem
      += pod.MemoryMB\n\t\t}\n\n\t\tresult = append(result, DeploymentMetrics{\n\t\t\tName:
      \      deploy.Metadata.Name,\n\t\t\tNamespace:  deploy.Metadata.Namespace,\n\t\t\tReplicas:
      \  deploy.Status.Replicas,\n\t\t\tReady:      deploy.Status.ReadyReplicas,\n\t\t\tCPUTotal:
      \  totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tPodMetrics: pods,\n\t\t})\n\t}\n\n\tsort.Slice(result,
      func(i, j int) bool {\n\t\treturn result[i].CPUTotal > result[j].CPUTotal\n\t})\n\n\treturn
      result, nil\n}\n\nfunc fetchClusterSummary() (*ClusterSummary, error) {\n\tnodes,
      err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get node capacity info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err
      := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar
      totalCPU, totalMem float64\n\treadyNodes := 0\n\tfor _, node := range nodeList.Items
      {\n\t\ttotalCPU += parseCPU(node.Status.Allocatable.CPU)\n\t\ttotalMem += parseMemory(node.Status.Allocatable.Memory)\n\t\tfor
      _, cond := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" &&
      cond.Status == \"True\" {\n\t\t\t\treadyNodes++\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tvar
      usedCPU, usedMem float64\n\ttotalPods := 0\n\tfor _, node := range nodes {\n\t\tusedCPU
      += node.CPUCores\n\t\tusedMem += node.MemoryMB\n\t\ttotalPods += node.Pods\n\t}\n\n\t//
      Count deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tjson.Unmarshal(deployData,
      &deployList)\n\n\tcpuPct := 0.0\n\tif totalCPU > 0 {\n\t\tcpuPct = (usedCPU
      / totalCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif totalMem > 0 {\n\t\tmemPct = (usedMem
      / totalMem) * 100\n\t}\n\n\treturn &ClusterSummary{\n\t\tTotalNodes:       len(nodeList.Items),\n\t\tReadyNodes:
      \      readyNodes,\n\t\tTotalPods:        totalPods,\n\t\tTotalDeployments:
      len(deployList.Items),\n\t\tTotalCPUCores:    totalCPU,\n\t\tUsedCPUCores:     usedCPU,\n\t\tTotalMemoryGB:
      \   totalMem / 1024,\n\t\tUsedMemoryGB:     usedMem / 1024,\n\t\tCPUPct:           cpuPct,\n\t\tMemoryPct:
      \       memPct,\n\t}, nil\n}\n\n// Record metrics for history\nfunc recordMetrics()
      {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor
      range ticker.C {\n\t\tnodes, err := fetchNodeMetrics()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error
      fetching metrics: %v\", err)\n\t\t\tcontinue\n\t\t}\n\n\t\tnow := time.Now()\n\t\thistoryMutex.Lock()\n\n\t\t//
      Record per-node metrics\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, node
      := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\n\t\t\tcpuKey
      := \"node_cpu_\" + node.Name\n\t\t\tmemKey := \"node_mem_\" + node.Name\n\n\t\t\tmetricsHistory[cpuKey]
      = append(metricsHistory[cpuKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    node.CPUPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\t\t\tmetricsHistory[memKey]
      = append(metricsHistory[memKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    node.MemoryPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\n\t\t\t// Trim
      history\n\t\t\tif len(metricsHistory[cpuKey]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[cpuKey]
      = metricsHistory[cpuKey][len(metricsHistory[cpuKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif
      len(metricsHistory[memKey]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[memKey]
      = metricsHistory[memKey][len(metricsHistory[memKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\t//
      Record cluster-wide averages\n\t\tif len(nodes) > 0 {\n\t\t\tmetricsHistory[\"cluster_cpu\"]
      = append(metricsHistory[\"cluster_cpu\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    totalCPU / float64(len(nodes)),\n\t\t\t})\n\t\t\tmetricsHistory[\"cluster_mem\"]
      = append(metricsHistory[\"cluster_mem\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:
      \    totalMem / float64(len(nodes)),\n\t\t\t})\n\n\t\t\tif len(metricsHistory[\"cluster_cpu\"])
      > maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_cpu\"] = metricsHistory[\"cluster_cpu\"][len(metricsHistory[\"cluster_cpu\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif
      len(metricsHistory[\"cluster_mem\"]) > maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_mem\"]
      = metricsHistory[\"cluster_mem\"][len(metricsHistory[\"cluster_mem\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\thistoryMutex.Unlock()\n\n\t\t//
      Check alert rules\n\t\tcheckAlerts(nodes)\n\t}\n}\n\nfunc checkAlerts(nodes
      []NodeMetrics) {\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tnow
      := time.Now()\n\n\tfor i := range alertRules {\n\t\trule := &alertRules[i]\n\t\tif
      !rule.Enabled {\n\t\t\tcontinue\n\t\t}\n\t\trule.LastChecked = now\n\n\t\tfor
      _, node := range nodes {\n\t\t\tif rule.Node != \"\" && rule.Node != \"*\" &&
      rule.Node != node.Name {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tvar value float64\n\t\t\tvar
      metricName string\n\t\t\tswitch rule.Metric {\n\t\t\tcase \"cpu\":\n\t\t\t\tvalue
      = node.CPUPct\n\t\t\t\tmetricName = \"CPU\"\n\t\t\tcase \"memory\":\n\t\t\t\tvalue
      = node.MemoryPct\n\t\t\t\tmetricName = \"Memory\"\n\t\t\tcase \"pods\":\n\t\t\t\tvalue
      = float64(node.Pods)\n\t\t\t\tmetricName = \"Pods\"\n\t\t\tdefault:\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\ttriggered
      := false\n\t\t\tswitch rule.Condition {\n\t\t\tcase \">\":\n\t\t\t\ttriggered
      = value > rule.Threshold\n\t\t\tcase \">=\":\n\t\t\t\ttriggered = value >= rule.Threshold\n\t\t\tcase
      \"<\":\n\t\t\t\ttriggered = value < rule.Threshold\n\t\t\tcase \"<=\":\n\t\t\t\ttriggered
      = value <= rule.Threshold\n\t\t\tcase \"==\":\n\t\t\t\ttriggered = value ==
      rule.Threshold\n\t\t\tcase \"!=\":\n\t\t\t\ttriggered = value != rule.Threshold\n\t\t\t}\n\n\t\t\talertKey
      := fmt.Sprintf(\"%s-%s\", rule.ID, node.Name)\n\n\t\t\tif triggered {\n\t\t\t\t//
      Check if this alert is already triggered\n\t\t\t\talreadyTriggered := false\n\t\t\t\tfor
      _, ta := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID && !ta.Resolved
      && ta.Node == node.Name {\n\t\t\t\t\t\talreadyTriggered = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif
      !alreadyTriggered {\n\t\t\t\t\tseverity := rule.Severity\n\t\t\t\t\tif severity
      == \"\" {\n\t\t\t\t\t\tseverity = \"warning\"\n\t\t\t\t\t}\n\n\t\t\t\t\tmessage
      := fmt.Sprintf(\"%s %s %.1f%% %s %.1f%% on node %s\",\n\t\t\t\t\t\tmetricName,
      rule.Condition, rule.Threshold, \"- Current:\", value, node.Name)\n\n\t\t\t\t\ttriggeredAlerts
      = append(triggeredAlerts, TriggeredAlert{\n\t\t\t\t\t\tID:        fmt.Sprintf(\"alert-%d-%s\",
      now.UnixNano(), alertKey),\n\t\t\t\t\t\tRuleID:    rule.ID,\n\t\t\t\t\t\tRuleName:
      \ rule.Name,\n\t\t\t\t\t\tMessage:   message,\n\t\t\t\t\t\tValue:     value,\n\t\t\t\t\t\tThreshold:
      rule.Threshold,\n\t\t\t\t\t\tSeverity:  severity,\n\t\t\t\t\t\tNode:      node.Name,\n\t\t\t\t\t\tMetric:
      \   rule.Metric,\n\t\t\t\t\t\tTimestamp: now,\n\t\t\t\t\t\tResolved:  false,\n\t\t\t\t\t})\n\t\t\t\t\tlog.Printf(\"Alert
      triggered: %s (severity: %s)\", message, severity)\n\t\t\t\t}\n\t\t\t} else
      {\n\t\t\t\t// Check if we should resolve an existing alert\n\t\t\t\tfor i, ta
      := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID && !ta.Resolved
      && ta.Node == node.Name {\n\t\t\t\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\t\t\t\ttriggeredAlerts[i].ResolvedAt
      = now\n\t\t\t\t\t\tlog.Printf(\"Alert resolved: %s on %s\", rule.Name, node.Name)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Clean up old resolved alerts (keep for 24 hours)\n\tcutoff := now.Add(-24 *
      time.Hour)\n\tvar activeAlerts []TriggeredAlert\n\tfor _, alert := range triggeredAlerts
      {\n\t\tif !alert.Resolved || alert.ResolvedAt.After(cutoff) {\n\t\t\tactiveAlerts
      = append(activeAlerts, alert)\n\t\t}\n\t}\n\ttriggeredAlerts = activeAlerts\n}\n\n//
      HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"healthy\"})\n}\n\nfunc handleNodes(w http.ResponseWriter, r *http.Request)
      {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w
      http.ResponseWriter, r *http.Request) {\n\tpods, err := fetchPodMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\t//
      Filter by namespace if provided\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tif
      namespace != \"\" {\n\t\tvar filtered []PodMetrics\n\t\tfor _, pod := range
      pods {\n\t\t\tif pod.Namespace == namespace {\n\t\t\t\tfiltered = append(filtered,
      pod)\n\t\t\t}\n\t\t}\n\t\tpods = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleDeployments(w
      http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tnamespace
      := r.URL.Query().Get(\"namespace\")\n\tif namespace != \"\" {\n\t\tvar filtered
      []DeploymentMetrics\n\t\tfor _, deploy := range deployments {\n\t\t\tif deploy.Namespace
      == namespace {\n\t\t\t\tfiltered = append(filtered, deploy)\n\t\t\t}\n\t\t}\n\t\tdeployments
      = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(deployments)\n}\n\nfunc
      handleClusterSummary(w http.ResponseWriter, r *http.Request) {\n\tsummary, err
      := fetchClusterSummary()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(),
      http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(summary)\n}\n\nfunc handleHistory(w
      http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam
      := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\n\tif
      rangeParam == \"\" {\n\t\trangeParam = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch
      rangeParam {\n\tcase \"1h\":\n\t\tduration = time.Hour\n\tcase \"6h\":\n\t\tduration
      = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration
      = 7 * 24 * time.Hour\n\tcase \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration
      = time.Hour\n\t}\n\n\tcutoff := time.Now().Add(-duration)\n\n\t// Try Prometheus
      first for longer ranges\n\tif duration > time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric,
      node, duration)\n\t\tif err == nil && len(promData) > 0 {\n\t\t\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(promData)\n\t\t\treturn\n\t\t}\n\t}\n\n\t//
      Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar
      key string\n\tif node != \"\" && node != \"*\" {\n\t\tkey = metric + \"_\" +
      node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar result []MetricPoint\n\tif
      points, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range points {\n\t\t\tif
      p.Timestamp.After(cutoff) {\n\t\t\t\tresult = append(result, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(result)\n}\n\nfunc getPrometheusHistory(metric,
      node string, duration time.Duration) ([]MetricPoint, error) {\n\tend := time.Now()\n\tstart
      := end.Add(-duration)\n\n\tvar step string\n\tswitch {\n\tcase duration <= time.Hour:\n\t\tstep
      = \"15s\"\n\tcase duration <= 6*time.Hour:\n\t\tstep = \"1m\"\n\tcase duration
      <= 24*time.Hour:\n\t\tstep = \"5m\"\n\tcase duration <= 7*24*time.Hour:\n\t\tstep
      = \"30m\"\n\tdefault:\n\t\tstep = \"2h\"\n\t}\n\n\tvar query string\n\tswitch
      metric {\n\tcase \"cluster_cpu\":\n\t\tquery = \"avg(100 - (avg by (instance)
      (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m])) * 100))\"\n\tcase \"cluster_mem\":\n\t\tquery
      = \"avg((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
      * 100)\"\n\tcase \"node_cpu\":\n\t\tif node != \"\" {\n\t\t\tquery = fmt.Sprintf(\"100
      - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\", instance=~\\\"%s.*\\\"}[5m]))
      * 100)\", node)\n\t\t} else {\n\t\t\tquery = \"100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m]))
      * 100)\"\n\t\t}\n\tcase \"node_mem\":\n\t\tif node != \"\" {\n\t\t\tquery =
      fmt.Sprintf(\"(1 - (node_memory_MemAvailable_bytes{instance=~\\\"%s.*\\\"} /
      node_memory_MemTotal_bytes{instance=~\\\"%s.*\\\"})) * 100\", node, node)\n\t\t}
      else {\n\t\t\tquery = \"(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
      * 100\"\n\t\t}\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown metric: %s\",
      metric)\n\t}\n\n\tresp, err := queryPrometheus(query, start, end, step)\n\tif
      err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar result []MetricPoint\n\tfor
      _, series := range resp.Data.Result {\n\t\tnodeName := series.Metric[\"instance\"]\n\t\tfor
      _, val := range series.Values {\n\t\t\tts, _ := val[0].(float64)\n\t\t\tvalStr,
      _ := val[1].(string)\n\t\t\tvalue, _ := strconv.ParseFloat(valStr, 64)\n\t\t\tresult
      = append(result, MetricPoint{\n\t\t\t\tTimestamp: time.Unix(int64(ts), 0),\n\t\t\t\tValue:
      \    value,\n\t\t\t\tNode:      nodeName,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn
      result, nil\n}\n\nfunc handleAlertRules(w http.ResponseWriter, r *http.Request)
      {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(alertRules)\n}\n\nfunc handleCreateAlertRule(w
      http.ResponseWriter, r *http.Request) {\n\tvar rule AlertRule\n\tif err := json.NewDecoder(r.Body).Decode(&rule);
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\trule.ID
      = fmt.Sprintf(\"rule-%d\", time.Now().UnixNano())\n\trule.Created = time.Now()\n\tif
      rule.Node == \"\" {\n\t\trule.Node = \"*\"\n\t}\n\n\talertMutex.Lock()\n\talertRules
      = append(alertRules, rule)\n\talertMutex.Unlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(rule)\n}\n\nfunc handleDeleteAlertRule(w
      http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, rule := range alertRules {\n\t\tif rule.ID ==
      id {\n\t\t\talertRules = append(alertRules[:i], alertRules[i+1:]...)\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"rule not found\", http.StatusNotFound)\n}\n\nfunc handleTriggeredAlerts(w
      http.ResponseWriter, r *http.Request) {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(triggeredAlerts)\n}\n\nfunc
      handleResolveAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID
      == id {\n\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"alert not found\", http.StatusNotFound)\n}\n\n// Fetch comprehensive cluster-wide
      metrics\nfunc fetchClusterMetrics() (*ClusterMetrics, error) {\n\tsummary, err
      := fetchClusterSummary()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tnodes,
      err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tpods,
      err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Get top pods by CPU\n\tsortedByCPU := make([]PodMetrics, len(pods))\n\tcopy(sortedByCPU,
      pods)\n\tsort.Slice(sortedByCPU, func(i, j int) bool {\n\t\treturn sortedByCPU[i].CPUm
      > sortedByCPU[j].CPUm\n\t})\n\ttopCPU := sortedByCPU\n\tif len(topCPU) > 10
      {\n\t\ttopCPU = topCPU[:10]\n\t}\n\n\t// Get top pods by memory\n\tsortedByMem
      := make([]PodMetrics, len(pods))\n\tcopy(sortedByMem, pods)\n\tsort.Slice(sortedByMem,
      func(i, j int) bool {\n\t\treturn sortedByMem[i].MemoryMB > sortedByMem[j].MemoryMB\n\t})\n\ttopMem
      := sortedByMem\n\tif len(topMem) > 10 {\n\t\ttopMem = topMem[:10]\n\t}\n\n\t//
      Aggregate by namespace\n\tnsMetrics := make(map[string]*NamespaceMetrics)\n\tfor
      _, pod := range pods {\n\t\tif _, ok := nsMetrics[pod.Namespace]; !ok {\n\t\t\tnsMetrics[pod.Namespace]
      = &NamespaceMetrics{Name: pod.Namespace}\n\t\t}\n\t\tnsMetrics[pod.Namespace].PodCount++\n\t\tnsMetrics[pod.Namespace].CPUUsage
      += pod.CPUm\n\t\tnsMetrics[pod.Namespace].MemoryUsage += pod.MemoryMB\n\t}\n\n\tvar
      namespaces []NamespaceMetrics\n\tfor _, ns := range nsMetrics {\n\t\tif summary.UsedCPUCores
      > 0 {\n\t\t\tns.CPUPct = (ns.CPUUsage / summary.UsedCPUCores) * 100\n\t\t}\n\t\tif
      summary.UsedMemoryGB > 0 {\n\t\t\tns.MemoryPct = (ns.MemoryUsage / (summary.UsedMemoryGB
      * 1024)) * 100\n\t\t}\n\t\tnamespaces = append(namespaces, *ns)\n\t}\n\tsort.Slice(namespaces,
      func(i, j int) bool {\n\t\treturn namespaces[i].CPUUsage > namespaces[j].CPUUsage\n\t})\n\n\t//
      Get alerts summary\n\talertMutex.RLock()\n\talertsSummary := AlertsSummary{}\n\tfor
      _, alert := range triggeredAlerts {\n\t\talertsSummary.Total++\n\t\tif alert.Resolved
      {\n\t\t\talertsSummary.Resolved++\n\t\t} else {\n\t\t\talertsSummary.Active++\n\t\t\tswitch
      alert.Severity {\n\t\t\tcase \"critical\":\n\t\t\t\talertsSummary.Critical++\n\t\t\tcase
      \"warning\":\n\t\t\t\talertsSummary.Warning++\n\t\t\tcase \"info\":\n\t\t\t\talertsSummary.Info++\n\t\t\t}\n\t\t}\n\t}\n\talertMutex.RUnlock()\n\n\treturn
      &ClusterMetrics{\n\t\tTimestamp:    time.Now(),\n\t\tSummary:      *summary,\n\t\tNodeMetrics:
      \ nodes,\n\t\tTopPodsByCPU: topCPU,\n\t\tTopPodsByMem: topMem,\n\t\tNamespaces:
      \  namespaces,\n\t\tAlerts:       alertsSummary,\n\t}, nil\n}\n\n// Fetch detailed
      metrics for a specific node\nfunc fetchNodeDetailedMetrics(nodeName string)
      (*NodeDetailedMetrics, error) {\n\t// Get node info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes/\"
      + nodeName)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node:
      %v\", err)\n\t}\n\n\tvar node K8sNode\n\tif err := json.Unmarshal(nodeData,
      &node); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get node metrics\n\tmetricsData,
      err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes/\" + nodeName)\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node metrics: %v\",
      err)\n\t}\n\n\tvar nodeMetric K8sNodeMetric\n\tif err := json.Unmarshal(metricsData,
      &nodeMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pods on this
      node\n\tallPods, err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil,
      err\n\t}\n\n\tvar nodePods []PodMetrics\n\tfor _, pod := range allPods {\n\t\tif
      pod.Node == nodeName {\n\t\t\tnodePods = append(nodePods, pod)\n\t\t}\n\t}\n\n\t//
      Calculate metrics\n\tallocatableCPU := parseCPU(node.Status.Allocatable.CPU)\n\tallocatableMem
      := parseMemory(node.Status.Allocatable.Memory)\n\tcpuUsed := parseCPU(nodeMetric.Usage.CPU)\n\tmemUsed
      := parseMemory(nodeMetric.Usage.Memory)\n\n\tcpuPct := 0.0\n\tif allocatableCPU
      > 0 {\n\t\tcpuPct = (cpuUsed / allocatableCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif
      allocatableMem > 0 {\n\t\tmemPct = (memUsed / allocatableMem) * 100\n\t}\n\n\t//
      Get status\n\tstatus := \"NotReady\"\n\tvar conditions []NodeCondition\n\tfor
      _, cond := range node.Status.Conditions {\n\t\tconditions = append(conditions,
      NodeCondition{\n\t\t\tType:    cond.Type,\n\t\t\tStatus:  cond.Status,\n\t\t\tMessage:
      cond.Message,\n\t\t})\n\t\tif cond.Type == \"Ready\" && cond.Status == \"True\"
      {\n\t\t\tstatus = \"Ready\"\n\t\t}\n\t}\n\n\t// Get taints\n\tvar taints []string\n\tfor
      _, taint := range node.Spec.Taints {\n\t\ttaints = append(taints, fmt.Sprintf(\"%s=%s:%s\",
      taint.Key, taint.Value, taint.Effect))\n\t}\n\n\t// Get history from memory\n\thistoryMutex.RLock()\n\tcpuHistory
      := metricsHistory[\"node_cpu_\"+nodeName]\n\tmemHistory := metricsHistory[\"node_mem_\"+nodeName]\n\thistoryMutex.RUnlock()\n\n\t//
      Parse capacity values\n\tallocPods, _ := strconv.Atoi(node.Status.Allocatable.Pods)\n\tcapPods,
      _ := strconv.Atoi(node.Status.Capacity.Pods)\n\tallocStorage := parseMemory(node.Status.Allocatable.Storage)
      / 1024 // to GB\n\tcapStorage := parseMemory(node.Status.Capacity.Storage) /
      1024\n\n\treturn &NodeDetailedMetrics{\n\t\tNodeMetrics: NodeMetrics{\n\t\t\tName:
      \     nodeName,\n\t\t\tCPUCores:  cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:
      \ memUsed,\n\t\t\tMemoryPct: memPct,\n\t\t\tPods:      len(nodePods),\n\t\t\tStatus:
      \   status,\n\t\t},\n\t\tAllocatable: ResourceCapacity{\n\t\t\tCPU:     allocatableCPU,\n\t\t\tMemory:
      \ allocatableMem,\n\t\t\tPods:    allocPods,\n\t\t\tStorage: allocStorage,\n\t\t},\n\t\tCapacity:
      ResourceCapacity{\n\t\t\tCPU:     parseCPU(node.Status.Capacity.CPU),\n\t\t\tMemory:
      \ parseMemory(node.Status.Capacity.Memory),\n\t\t\tPods:    capPods,\n\t\t\tStorage:
      capStorage,\n\t\t},\n\t\tConditions:    conditions,\n\t\tPods:          nodePods,\n\t\tCPUHistory:
      \   cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        node.Metadata.Labels,\n\t\tTaints:
      \       taints,\n\t}, nil\n}\n\n// Fetch detailed metrics for a specific pod\nfunc
      fetchPodDetailedMetrics(namespace, podName string) (*PodDetailedMetrics, error)
      {\n\t// Get pod info\n\tpodData, err := k8sAPIRequest(fmt.Sprintf(\"/api/v1/namespaces/%s/pods/%s\",
      namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to get pod: %v\", err)\n\t}\n\n\tvar pod K8sPod\n\tif err := json.Unmarshal(podData,
      &pod); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod metrics\n\tmetricsData,
      err := k8sAPIRequest(fmt.Sprintf(\"/apis/metrics.k8s.io/v1beta1/namespaces/%s/pods/%s\",
      namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to get pod metrics: %v\", err)\n\t}\n\n\tvar podMetric K8sPodMetric\n\tif err
      := json.Unmarshal(metricsData, &podMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Build container metrics\n\tvar containers []ContainerMetrics\n\tvar totalCPU,
      totalMem float64\n\ttotalRestarts := 0\n\n\tcontainerUsage := make(map[string]struct{
      cpu, mem float64 })\n\tfor _, c := range podMetric.Containers {\n\t\tcpu :=
      parseCPU(c.Usage.CPU)\n\t\tmem := parseMemory(c.Usage.Memory)\n\t\tcontainerUsage[c.Name]
      = struct{ cpu, mem float64 }{cpu, mem}\n\t\ttotalCPU += cpu\n\t\ttotalMem +=
      mem\n\t}\n\n\tfor _, cs := range pod.Status.ContainerStatuses {\n\t\tusage :=
      containerUsage[cs.Name]\n\t\tstate := \"unknown\"\n\t\tif cs.State.Running !=
      nil {\n\t\t\tstate = \"running\"\n\t\t} else if cs.State.Waiting != nil {\n\t\t\tstate
      = \"waiting: \" + cs.State.Waiting.Reason\n\t\t} else if cs.State.Terminated
      != nil {\n\t\t\tstate = \"terminated: \" + cs.State.Terminated.Reason\n\t\t}\n\n\t\tcontainers
      = append(containers, ContainerMetrics{\n\t\t\tName:         cs.Name,\n\t\t\tCPUm:
      \        usage.cpu,\n\t\t\tMemoryMB:     usage.mem,\n\t\t\tRestartCount: cs.RestartCount,\n\t\t\tReady:
      \       cs.Ready,\n\t\t\tState:        state,\n\t\t})\n\t\ttotalRestarts +=
      cs.RestartCount\n\t}\n\n\t// Get deployment name\n\tdeployment := \"\"\n\tfor
      _, owner := range pod.Metadata.OwnerReferences {\n\t\tif owner.Kind == \"ReplicaSet\"
      {\n\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\tif len(parts) > 1
      {\n\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1], \"-\")\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Parse start time\n\tstartTime, _ := time.Parse(time.RFC3339, pod.Status.StartTime)\n\n\t//
      Get history from memory (if we stored pod-level history)\n\thistoryMutex.RLock()\n\tcpuKey
      := fmt.Sprintf(\"pod_cpu_%s_%s\", namespace, podName)\n\tmemKey := fmt.Sprintf(\"pod_mem_%s_%s\",
      namespace, podName)\n\tcpuHistory := metricsHistory[cpuKey]\n\tmemHistory :=
      metricsHistory[memKey]\n\thistoryMutex.RUnlock()\n\n\treturn &PodDetailedMetrics{\n\t\tPodMetrics:
      PodMetrics{\n\t\t\tName:       podName,\n\t\t\tNamespace:  namespace,\n\t\t\tNode:
      \      pod.Spec.NodeName,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:
      \    pod.Status.Phase,\n\t\t\tDeployment: deployment,\n\t\t},\n\t\tContainers:
      \   containers,\n\t\tRestartCount:  totalRestarts,\n\t\tStartTime:     startTime,\n\t\tCPUHistory:
      \   cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        pod.Metadata.Labels,\n\t},
      nil\n}\n\n// HTTP Handlers for new endpoints\n\nfunc handleClusterMetrics(w
      http.ResponseWriter, r *http.Request) {\n\tmetrics, err := fetchClusterMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(metrics)\n}\n\nfunc handleNodeDetails(w
      http.ResponseWriter, r *http.Request) {\n\t// Extract node name from path\n\tpath
      := strings.TrimPrefix(r.URL.Path, \"/api/nodes/\")\n\tnodeName := strings.Split(path,
      \"/\")[0]\n\n\tif nodeName == \"\" {\n\t\t// List all nodes\n\t\thandleNodes(w,
      r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchNodeDetailedMetrics(nodeName)\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handlePodDetails(w
      http.ResponseWriter, r *http.Request) {\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tpodName
      := r.URL.Query().Get(\"name\")\n\n\t// Also support path-based: /api/pods/namespace/name\n\tpath
      := strings.TrimPrefix(r.URL.Path, \"/api/pods/\")\n\tparts := strings.Split(path,
      \"/\")\n\tif len(parts) >= 2 && namespace == \"\" {\n\t\tnamespace = parts[0]\n\t\tpodName
      = parts[1]\n\t}\n\n\tif namespace == \"\" || podName == \"\" {\n\t\t// List
      all pods\n\t\thandlePods(w, r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchPodDetailedMetrics(namespace,
      podName)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handleUnifiedAlerts(w
      http.ResponseWriter, r *http.Request) {\n\tswitch r.Method {\n\tcase \"GET\":\n\t\talertMutex.RLock()\n\t\tdefer
      alertMutex.RUnlock()\n\n\t\tsummary := AlertsSummary{}\n\t\tfor _, alert :=
      range triggeredAlerts {\n\t\t\tsummary.Total++\n\t\t\tif alert.Resolved {\n\t\t\t\tsummary.Resolved++\n\t\t\t}
      else {\n\t\t\t\tsummary.Active++\n\t\t\t\tswitch alert.Severity {\n\t\t\t\tcase
      \"critical\":\n\t\t\t\t\tsummary.Critical++\n\t\t\t\tcase \"warning\":\n\t\t\t\t\tsummary.Warning++\n\t\t\t\tcase
      \"info\":\n\t\t\t\t\tsummary.Info++\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tresponse
      := AlertsResponse{\n\t\t\tRules:     alertRules,\n\t\t\tTriggered: triggeredAlerts,\n\t\t\tSummary:
      \  summary,\n\t\t}\n\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(response)\n\n\tcase
      \"POST\":\n\t\thandleCreateAlertRule(w, r)\n\n\tcase \"DELETE\":\n\t\thandleDeleteAlertRule(w,
      r)\n\n\tdefault:\n\t\thttp.Error(w, \"method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\nfunc
      handleAcknowledgeAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif
      id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer
      alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID
      == id {\n\t\t\ttriggeredAlerts[i].Acknowledged = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w,
      \"alert not found\", http.StatusNotFound)\n}\n\nfunc handleHistoryExtended(w
      http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam
      := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\tnamespace
      := r.URL.Query().Get(\"namespace\")\n\tpod := r.URL.Query().Get(\"pod\")\n\tresolution
      := r.URL.Query().Get(\"resolution\")\n\n\tif rangeParam == \"\" {\n\t\trangeParam
      = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch rangeParam {\n\tcase
      \"5m\":\n\t\tduration = 5 * time.Minute\n\tcase \"15m\":\n\t\tduration = 15
      * time.Minute\n\tcase \"30m\":\n\t\tduration = 30 * time.Minute\n\tcase \"1h\":\n\t\tduration
      = time.Hour\n\tcase \"6h\":\n\t\tduration = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration
      = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration = 7 * 24 * time.Hour\n\tcase
      \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration = time.Hour\n\t}\n\n\tcutoff
      := time.Now().Add(-duration)\n\tend := time.Now()\n\n\t// Determine resolution
      if not specified\n\tif resolution == \"\" {\n\t\tswitch {\n\t\tcase duration
      <= 30*time.Minute:\n\t\t\tresolution = \"10s\"\n\t\tcase duration <= time.Hour:\n\t\t\tresolution
      = \"30s\"\n\t\tcase duration <= 6*time.Hour:\n\t\t\tresolution = \"1m\"\n\t\tcase
      duration <= 24*time.Hour:\n\t\t\tresolution = \"5m\"\n\t\tdefault:\n\t\t\tresolution
      = \"15m\"\n\t\t}\n\t}\n\n\t// Try Prometheus first for longer ranges\n\tif duration
      > time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric, node, duration)\n\t\tif
      err == nil && len(promData) > 0 {\n\t\t\tresponse := HistoricalData{\n\t\t\t\tMetric:
      \    metric,\n\t\t\t\tNode:       node,\n\t\t\t\tNamespace:  namespace,\n\t\t\t\tPod:
      \       pod,\n\t\t\t\tResolution: resolution,\n\t\t\t\tStart:      cutoff,\n\t\t\t\tEnd:
      \       end,\n\t\t\t\tPoints:     promData,\n\t\t\t}\n\t\t\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(response)\n\t\t\treturn\n\t\t}\n\t}\n\n\t//
      Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar
      key string\n\tif pod != \"\" && namespace != \"\" {\n\t\tkey = fmt.Sprintf(\"pod_%s_%s_%s\",
      metric, namespace, pod)\n\t} else if node != \"\" && node != \"*\" {\n\t\tkey
      = metric + \"_\" + node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar points []MetricPoint\n\tif
      history, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range history {\n\t\t\tif
      p.Timestamp.After(cutoff) {\n\t\t\t\tpoints = append(points, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tresponse
      := HistoricalData{\n\t\tMetric:     metric,\n\t\tNode:       node,\n\t\tNamespace:
      \ namespace,\n\t\tPod:        pod,\n\t\tResolution: resolution,\n\t\tStart:
      \     cutoff,\n\t\tEnd:        end,\n\t\tPoints:     points,\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\n// Legacy
      API compatibility\nfunc handleLegacyMetrics(w http.ResponseWriter, r *http.Request)
      {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar cpuPoints,
      memPoints, reqPoints []map[string]interface{}\n\tnow := time.Now()\n\n\t// Generate
      some historical-looking data points\n\tfor i := 0; i < 20; i++ {\n\t\tts :=
      now.Add(time.Duration(-i*5) * time.Second)\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor
      _, node := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\t\t}\n\t\tavgCPU
      := totalCPU / float64(len(nodes))\n\t\tavgMem := totalMem / float64(len(nodes))\n\n\t\tcpuPoints
      = append([]map[string]interface{}{{\n\t\t\t\"name\":      \"cpu_usage\",\n\t\t\t\"value\":
      \    avgCPU,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}},
      cpuPoints...)\n\n\t\tmemPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":
      \     \"memory_usage\",\n\t\t\t\"value\":     avgMem,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\":
      ts.Format(time.RFC3339Nano),\n\t\t}}, memPoints...)\n\n\t\treqPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":
      \     \"requests\",\n\t\t\t\"value\":     float64(100 + i*5),\n\t\t\t\"unit\":
      \     \"req/s\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}},
      reqPoints...)\n\t}\n\n\tresponse := map[string]interface{}{\n\t\t\"cpu\":      cpuPoints,\n\t\t\"memory\":
      \  memPoints,\n\t\t\"requests\": reqPoints,\n\t}\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\nfunc handleLegacyServices(w
      http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif
      err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar
      services []map[string]string\n\tfor _, deploy := range deployments {\n\t\tif
      deploy.Namespace != \"holm\" {\n\t\t\tcontinue\n\t\t}\n\t\tstatus := \"healthy\"\n\t\tif
      deploy.Ready < deploy.Replicas {\n\t\t\tstatus = \"unhealthy\"\n\t\t}\n\t\tservices
      = append(services, map[string]string{\n\t\t\t\"name\":      deploy.Name,\n\t\t\t\"namespace\":
      deploy.Namespace,\n\t\t\t\"status\":    status,\n\t\t\t\"endpoint\":  fmt.Sprintf(\"http://%s:8080\",
      deploy.Name),\n\t\t})\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(services)\n}\n\nfunc
      main() {\n\t// Start metrics collection\n\tgo recordMetrics()\n\n\t// Initialize
      default alert rules\n\talertRules = []AlertRule{\n\t\t{ID: \"default-1\", Name:
      \"Critical CPU\", Metric: \"cpu\", Condition: \">\", Threshold: 95, Node: \"*\",
      Severity: \"critical\", Duration: 60, Enabled: true, Created: time.Now()},\n\t\t{ID:
      \"default-2\", Name: \"High CPU\", Metric: \"cpu\", Condition: \">\", Threshold:
      85, Node: \"*\", Severity: \"warning\", Duration: 120, Enabled: true, Created:
      time.Now()},\n\t\t{ID: \"default-3\", Name: \"Critical Memory\", Metric: \"memory\",
      Condition: \">\", Threshold: 95, Node: \"*\", Severity: \"critical\", Duration:
      60, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-4\", Name: \"High
      Memory\", Metric: \"memory\", Condition: \">\", Threshold: 85, Node: \"*\",
      Severity: \"warning\", Duration: 120, Enabled: true, Created: time.Now()},\n\t\t{ID:
      \"default-5\", Name: \"Node Not Ready\", Metric: \"cpu\", Condition: \"<\",
      Threshold: 0, Node: \"*\", Severity: \"critical\", Duration: 30, Enabled: false,
      Created: time.Now()},\n\t}\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t//
      API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\n\t// Cluster-wide
      metrics (new comprehensive endpoint)\n\tmux.HandleFunc(\"/api/metrics\", handleClusterMetrics)\n\n\t//
      Node endpoints with detail support\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/nodes/\",
      handleNodeDetails) // /api/nodes/{name} for details\n\n\t// Pod endpoints with
      detail support\n\tmux.HandleFunc(\"/api/pods\", handlePods)\n\tmux.HandleFunc(\"/api/pods/\",
      handlePodDetails) // /api/pods/{namespace}/{name} for details\n\n\t// Deployments\n\tmux.HandleFunc(\"/api/deployments\",
      handleDeployments)\n\n\t// Cluster summary\n\tmux.HandleFunc(\"/api/cluster\",
      handleClusterSummary)\n\n\t// Historical data (enhanced)\n\tmux.HandleFunc(\"/api/history\",
      handleHistoryExtended)\n\n\t// Unified alerts endpoint\n\tmux.HandleFunc(\"/api/alerts\",
      handleUnifiedAlerts)\n\n\t// Alert management endpoints\n\tmux.HandleFunc(\"/api/alerts/rules\",
      func(w http.ResponseWriter, r *http.Request) {\n\t\tswitch r.Method {\n\t\tcase
      \"GET\":\n\t\t\thandleAlertRules(w, r)\n\t\tcase \"POST\":\n\t\t\thandleCreateAlertRule(w,
      r)\n\t\tcase \"DELETE\":\n\t\t\thandleDeleteAlertRule(w, r)\n\t\tdefault:\n\t\t\thttp.Error(w,
      \"method not allowed\", http.StatusMethodNotAllowed)\n\t\t}\n\t})\n\tmux.HandleFunc(\"/api/alerts/triggered\",
      handleTriggeredAlerts)\n\tmux.HandleFunc(\"/api/alerts/resolve\", handleResolveAlert)\n\tmux.HandleFunc(\"/api/alerts/acknowledge\",
      handleAcknowledgeAlert)\n\n\t// Legacy API for backward compatibility\n\tmux.HandleFunc(\"/api/metrics/legacy\",
      handleLegacyMetrics)\n\tmux.HandleFunc(\"/api/services\", handleLegacyServices)\n\n\t//
      Serve dashboard\n\tmux.HandleFunc(\"/\", serveDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif
      port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tlog.Printf(\"Starting Metrics
      Dashboard on port %s\", port)\n\tlog.Fatal(http.ListenAndServe(\":\"+port, mux))\n}\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM public.ecr.aws/docker/library/golang:1.21-alpine AS builder\n\nWORKDIR /app\n\n# Copy go mod file\nCOPY go.mod ./\n\n# Copy source files\nCOPY *.go ./\n\n# Build the binary\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags=\"-s -w\" -o metrics-dashboard .\n\n# Final image\nFROM public.ecr.aws/docker/library/alpine:3.19\n\nRUN apk --no-cache add ca-certificates\n\nWORKDIR /app\n\nCOPY --from=builder /app/metrics-dashboard .\n\nEXPOSE 8080\n\nCMD [\"./metrics-dashboard\"]\n","dashboard.go":"package main\n\nimport (\n\t\"net/http\"\n)\n\nfunc serveDashboard(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write([]byte(dashboardHTML))\n}\n\nconst dashboardHTML = `\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u003ctitle\u003eMetrics Dashboard - HolmOS Cluster\u003c/title\u003e\n    \u003cscript src=\"https://cdn.jsdelivr.net/npm/chart.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js\"\u003e\u003c/script\u003e\n    \u003cstyle\u003e\n        :root {\n            --bg-primary: #0f0f1a;\n            --bg-secondary: #1a1a2e;\n            --bg-card: #16213e;\n            --bg-hover: #1f3460;\n            --text-primary: #e4e4e7;\n            --text-secondary: #a1a1aa;\n            --accent-blue: #3b82f6;\n            --accent-green: #10b981;\n            --accent-yellow: #f59e0b;\n            --accent-red: #ef4444;\n            --accent-purple: #8b5cf6;\n            --accent-cyan: #06b6d4;\n            --border-color: #2d3748;\n        }\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }\n        .app-container { display: flex; min-height: 100vh; }\n        .sidebar { width: 240px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 100; }\n        .logo { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 12px; }\n        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }\n        .logo h1 { font-size: 1.1rem; font-weight: 600; }\n        .logo span { color: var(--text-secondary); font-size: 0.75rem; }\n        .nav-menu { flex: 1; padding: 16px 0; }\n        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; }\n        .nav-item:hover, .nav-item.active { background: var(--bg-hover); color: var(--text-primary); border-left-color: var(--accent-blue); }\n        .nav-item svg { width: 20px; height: 20px; }\n        .main-content { flex: 1; margin-left: 240px; padding: 24px; }\n        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }\n        .header h2 { font-size: 1.5rem; font-weight: 600; }\n        .time-range-selector { display: flex; gap: 8px; background: var(--bg-secondary); padding: 4px; border-radius: 8px; }\n        .time-btn { padding: 8px 16px; border: none; background: transparent; color: var(--text-secondary); border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 0.875rem; }\n        .time-btn:hover { color: var(--text-primary); }\n        .time-btn.active { background: var(--accent-blue); color: white; }\n        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }\n        .summary-card { background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); }\n        .summary-card .label { color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }\n        .summary-card .value { font-size: 2rem; font-weight: 700; }\n        .summary-card .sub { color: var(--text-secondary); font-size: 0.8rem; margin-top: 4px; }\n        .summary-card.cpu .value { color: var(--accent-cyan); }\n        .summary-card.memory .value { color: var(--accent-green); }\n        .summary-card.nodes .value { color: var(--accent-yellow); }\n        .summary-card.pods .value { color: var(--accent-purple); }\n        .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }\n        .chart-card { background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); }\n        .chart-card h3 { font-size: 1rem; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }\n        .chart-card h3::before { content: ''; width: 10px; height: 10px; border-radius: 50%; }\n        .chart-card.cpu h3::before { background: var(--accent-cyan); }\n        .chart-card.memory h3::before { background: var(--accent-green); }\n        .chart-card.network h3::before { background: var(--accent-yellow); }\n        .chart-card.disk h3::before { background: var(--accent-purple); }\n        .chart-container { height: 200px; position: relative; }\n        .section-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }\n        .nodes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 24px; }\n        .node-card { background: var(--bg-card); border-radius: 10px; padding: 16px; border: 1px solid var(--border-color); transition: all 0.2s; cursor: pointer; }\n        .node-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); }\n        .node-card .node-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }\n        .node-card .node-name { font-weight: 600; font-size: 0.95rem; }\n        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }\n        .status-badge.ready { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }\n        .status-badge.notready { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }\n        .node-metrics { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }\n        .metric-item { display: flex; flex-direction: column; gap: 4px; }\n        .metric-item .metric-label { font-size: 0.75rem; color: var(--text-secondary); }\n        .metric-item .metric-bar { height: 6px; background: var(--bg-primary); border-radius: 3px; overflow: hidden; }\n        .metric-item .metric-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }\n        .metric-item .metric-bar-fill.cpu { background: var(--accent-cyan); }\n        .metric-item .metric-bar-fill.memory { background: var(--accent-green); }\n        .metric-item .metric-value { font-size: 0.85rem; font-weight: 600; }\n        .table-container { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color); overflow: hidden; margin-bottom: 24px; }\n        .table-header { padding: 16px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }\n        .table-header h3 { font-size: 1rem; }\n        .search-input { background: var(--bg-primary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; color: var(--text-primary); width: 200px; }\n        .search-input:focus { outline: none; border-color: var(--accent-blue); }\n        table { width: 100%; border-collapse: collapse; }\n        th, td { padding: 12px 20px; text-align: left; border-bottom: 1px solid var(--border-color); }\n        th { background: var(--bg-secondary); color: var(--text-secondary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }\n        tr:hover { background: var(--bg-hover); }\n        .deployment-name { font-weight: 600; }\n        .replica-badge { display: inline-flex; align-items: center; gap: 4px; }\n        .replica-badge.healthy { color: var(--accent-green); }\n        .replica-badge.degraded { color: var(--accent-yellow); }\n        .alerts-container { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }\n        .alert-rules-card, .triggered-alerts-card { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color); }\n        .alert-card-header { padding: 16px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }\n        .alert-card-header h3 { font-size: 1rem; }\n        .btn-add { background: var(--accent-blue); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; }\n        .btn-add:hover { background: #2563eb; }\n        .alert-list { max-height: 300px; overflow-y: auto; }\n        .alert-item { padding: 12px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }\n        .alert-item:last-child { border-bottom: none; }\n        .alert-info { display: flex; flex-direction: column; gap: 4px; }\n        .alert-name { font-weight: 600; font-size: 0.9rem; }\n        .alert-condition { color: var(--text-secondary); font-size: 0.8rem; }\n        .alert-actions { display: flex; gap: 8px; }\n        .btn-icon { background: transparent; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; }\n        .btn-icon:hover { color: var(--text-primary); }\n        .btn-icon.delete:hover { color: var(--accent-red); }\n        .triggered-alert { padding: 12px 20px; border-bottom: 1px solid var(--border-color); background: rgba(239, 68, 68, 0.1); }\n        .triggered-alert.resolved { background: transparent; opacity: 0.6; }\n        .triggered-alert .alert-message { font-weight: 600; color: var(--accent-red); margin-bottom: 4px; }\n        .triggered-alert.resolved .alert-message { color: var(--accent-green); }\n        .triggered-alert .alert-time { font-size: 0.75rem; color: var(--text-secondary); }\n        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }\n        .modal-overlay.active { display: flex; }\n        .modal { background: var(--bg-card); border-radius: 12px; width: 400px; max-width: 90%; }\n        .modal-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }\n        .modal-header h3 { font-size: 1.1rem; }\n        .modal-body { padding: 20px; }\n        .form-group { margin-bottom: 16px; }\n        .form-group label { display: block; margin-bottom: 6px; font-size: 0.875rem; color: var(--text-secondary); }\n        .form-group input, .form-group select { width: 100%; padding: 10px 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 0.9rem; }\n        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--accent-blue); }\n        .modal-footer { padding: 16px 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }\n        .btn-cancel { background: transparent; border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 6px; color: var(--text-secondary); cursor: pointer; }\n        .btn-cancel:hover { color: var(--text-primary); }\n        .btn-save { background: var(--accent-blue); border: none; padding: 8px 16px; border-radius: 6px; color: white; cursor: pointer; }\n        .btn-save:hover { background: #2563eb; }\n        .view-content { display: none; }\n        .view-content.active { display: block; }\n        @media (max-width: 1200px) { .summary-grid { grid-template-columns: repeat(2, 1fr); } .charts-grid { grid-template-columns: 1fr; } .alerts-container { grid-template-columns: 1fr; } }\n        @media (max-width: 768px) { .sidebar { width: 60px; } .sidebar .logo h1, .sidebar .logo span, .sidebar .nav-item span { display: none; } .main-content { margin-left: 60px; } .summary-grid { grid-template-columns: 1fr; } }\n        ::-webkit-scrollbar { width: 8px; height: 8px; }\n        ::-webkit-scrollbar-track { background: var(--bg-primary); }\n        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }\n        ::-webkit-scrollbar-thumb:hover { background: #4a5568; }\n        .empty-state { padding: 40px; text-align: center; color: var(--text-secondary); }\n        .loading { display: flex; align-items: center; justify-content: center; padding: 40px; }\n        .spinner { width: 40px; height: 40px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }\n        @keyframes spin { to { transform: rotate(360deg); } }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003cdiv class=\"app-container\"\u003e\n        \u003cnav class=\"sidebar\"\u003e\n            \u003cdiv class=\"logo\"\u003e\n                \u003cdiv class=\"logo-icon\"\u003eM\u003c/div\u003e\n                \u003cdiv\u003e\n                    \u003ch1\u003eMetrics\u003c/h1\u003e\n                    \u003cspan\u003eHolmOS Cluster\u003c/span\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"nav-menu\"\u003e\n                \u003cdiv class=\"nav-item active\" data-view=\"overview\"\u003e\n                    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" /\u003e\u003c/svg\u003e\n                    \u003cspan\u003eOverview\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"nav-item\" data-view=\"nodes\"\u003e\n                    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\" /\u003e\u003c/svg\u003e\n                    \u003cspan\u003eNodes\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"nav-item\" data-view=\"deployments\"\u003e\n                    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" /\u003e\u003c/svg\u003e\n                    \u003cspan\u003eDeployments\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"nav-item\" data-view=\"alerts\"\u003e\n                    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" /\u003e\u003c/svg\u003e\n                    \u003cspan\u003eAlerts\u003c/span\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/nav\u003e\n        \u003cmain class=\"main-content\"\u003e\n            \u003cdiv id=\"overview-view\" class=\"view-content active\"\u003e\n                \u003cdiv class=\"header\"\u003e\n                    \u003ch2\u003eCluster Overview\u003c/h2\u003e\n                    \u003cdiv class=\"time-range-selector\"\u003e\n                        \u003cbutton class=\"time-btn active\" data-range=\"1h\"\u003e1H\u003c/button\u003e\n                        \u003cbutton class=\"time-btn\" data-range=\"6h\"\u003e6H\u003c/button\u003e\n                        \u003cbutton class=\"time-btn\" data-range=\"24h\"\u003e24H\u003c/button\u003e\n                        \u003cbutton class=\"time-btn\" data-range=\"7d\"\u003e7D\u003c/button\u003e\n                        \u003cbutton class=\"time-btn\" data-range=\"30d\"\u003e30D\u003c/button\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"summary-grid\"\u003e\n                    \u003cdiv class=\"summary-card cpu\"\u003e\u003cdiv class=\"label\"\u003eCPU Usage\u003c/div\u003e\u003cdiv class=\"value\" id=\"cluster-cpu\"\u003e--\u003c/div\u003e\u003cdiv class=\"sub\" id=\"cluster-cpu-detail\"\u003e-- cores used of -- cores\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"summary-card memory\"\u003e\u003cdiv class=\"label\"\u003eMemory Usage\u003c/div\u003e\u003cdiv class=\"value\" id=\"cluster-memory\"\u003e--\u003c/div\u003e\u003cdiv class=\"sub\" id=\"cluster-memory-detail\"\u003e-- GB used of -- GB\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"summary-card nodes\"\u003e\u003cdiv class=\"label\"\u003eNodes\u003c/div\u003e\u003cdiv class=\"value\" id=\"cluster-nodes\"\u003e--\u003c/div\u003e\u003cdiv class=\"sub\" id=\"cluster-nodes-detail\"\u003e-- ready\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"summary-card pods\"\u003e\u003cdiv class=\"label\"\u003ePods\u003c/div\u003e\u003cdiv class=\"value\" id=\"cluster-pods\"\u003e--\u003c/div\u003e\u003cdiv class=\"sub\" id=\"cluster-deployments\"\u003e-- deployments\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"charts-grid\"\u003e\n                    \u003cdiv class=\"chart-card cpu\"\u003e\u003ch3\u003eCluster CPU\u003c/h3\u003e\u003cdiv class=\"chart-container\"\u003e\u003ccanvas id=\"cluster-cpu-chart\"\u003e\u003c/canvas\u003e\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"chart-card memory\"\u003e\u003ch3\u003eCluster Memory\u003c/h3\u003e\u003cdiv class=\"chart-container\"\u003e\u003ccanvas id=\"cluster-memory-chart\"\u003e\u003c/canvas\u003e\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"chart-card network\"\u003e\u003ch3\u003eNode CPU Comparison\u003c/h3\u003e\u003cdiv class=\"chart-container\"\u003e\u003ccanvas id=\"node-cpu-chart\"\u003e\u003c/canvas\u003e\u003c/div\u003e\u003c/div\u003e\n                    \u003cdiv class=\"chart-card disk\"\u003e\u003ch3\u003eNode Memory Comparison\u003c/h3\u003e\u003cdiv class=\"chart-container\"\u003e\u003ccanvas id=\"node-memory-chart\"\u003e\u003c/canvas\u003e\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id=\"nodes-view\" class=\"view-content\"\u003e\n                \u003cdiv class=\"header\"\u003e\u003ch2\u003eCluster Nodes\u003c/h2\u003e\u003c/div\u003e\n                \u003cdiv class=\"nodes-grid\" id=\"nodes-grid\"\u003e\u003cdiv class=\"loading\"\u003e\u003cdiv class=\"spinner\"\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id=\"deployments-view\" class=\"view-content\"\u003e\n                \u003cdiv class=\"header\"\u003e\u003ch2\u003eDeployments\u003c/h2\u003e\u003c/div\u003e\n                \u003cdiv class=\"table-container\"\u003e\n                    \u003cdiv class=\"table-header\"\u003e\u003ch3\u003eAll Deployments\u003c/h3\u003e\u003cinput type=\"text\" class=\"search-input\" placeholder=\"Search deployments...\" id=\"deployment-search\"\u003e\u003c/div\u003e\n                    \u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eName\u003c/th\u003e\u003cth\u003eNamespace\u003c/th\u003e\u003cth\u003eReplicas\u003c/th\u003e\u003cth\u003eCPU\u003c/th\u003e\u003cth\u003eMemory\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody id=\"deployments-table\"\u003e\u003c/tbody\u003e\u003c/table\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv id=\"alerts-view\" class=\"view-content\"\u003e\n                \u003cdiv class=\"header\"\u003e\u003ch2\u003eAlert Management\u003c/h2\u003e\u003c/div\u003e\n                \u003cdiv class=\"alerts-container\"\u003e\n                    \u003cdiv class=\"alert-rules-card\"\u003e\n                        \u003cdiv class=\"alert-card-header\"\u003e\u003ch3\u003eAlert Rules\u003c/h3\u003e\u003cbutton class=\"btn-add\" onclick=\"openAlertModal()\"\u003e\u003csvg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/\u003e\u003c/svg\u003eAdd Rule\u003c/button\u003e\u003c/div\u003e\n                        \u003cdiv class=\"alert-list\" id=\"alert-rules-list\"\u003e\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"triggered-alerts-card\"\u003e\n                        \u003cdiv class=\"alert-card-header\"\u003e\u003ch3\u003eTriggered Alerts\u003c/h3\u003e\u003c/div\u003e\n                        \u003cdiv class=\"alert-list\" id=\"triggered-alerts-list\"\u003e\u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/main\u003e\n    \u003c/div\u003e\n    \u003cdiv class=\"modal-overlay\" id=\"alert-modal\"\u003e\n        \u003cdiv class=\"modal\"\u003e\n            \u003cdiv class=\"modal-header\"\u003e\u003ch3\u003eCreate Alert Rule\u003c/h3\u003e\u003cbutton class=\"btn-icon\" onclick=\"closeAlertModal()\"\u003e\u003csvg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/\u003e\u003c/svg\u003e\u003c/button\u003e\u003c/div\u003e\n            \u003cdiv class=\"modal-body\"\u003e\n                \u003cdiv class=\"form-group\"\u003e\u003clabel\u003eRule Name\u003c/label\u003e\u003cinput type=\"text\" id=\"alert-name\" placeholder=\"High CPU Alert\"\u003e\u003c/div\u003e\n                \u003cdiv class=\"form-group\"\u003e\u003clabel\u003eMetric\u003c/label\u003e\u003cselect id=\"alert-metric\"\u003e\u003coption value=\"cpu\"\u003eCPU Usage (%)\u003c/option\u003e\u003coption value=\"memory\"\u003eMemory Usage (%)\u003c/option\u003e\u003c/select\u003e\u003c/div\u003e\n                \u003cdiv class=\"form-group\"\u003e\u003clabel\u003eCondition\u003c/label\u003e\u003cselect id=\"alert-condition\"\u003e\u003coption value=\"\u003e\"\u003e\u003e Greater than\u003c/option\u003e\u003coption value=\"\u003e=\"\u003e\u003e= Greater than or equal\u003c/option\u003e\u003coption value=\"\u003c\"\u003e\u003c Less than\u003c/option\u003e\u003coption value=\"\u003c=\"\u003e\u003c= Less than or equal\u003c/option\u003e\u003c/select\u003e\u003c/div\u003e\n                \u003cdiv class=\"form-group\"\u003e\u003clabel\u003eThreshold (%)\u003c/label\u003e\u003cinput type=\"number\" id=\"alert-threshold\" placeholder=\"90\" min=\"0\" max=\"100\"\u003e\u003c/div\u003e\n                \u003cdiv class=\"form-group\"\u003e\u003clabel\u003eNode (leave empty for all)\u003c/label\u003e\u003cselect id=\"alert-node\"\u003e\u003coption value=\"*\"\u003eAll Nodes\u003c/option\u003e\u003c/select\u003e\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"modal-footer\"\u003e\u003cbutton class=\"btn-cancel\" onclick=\"closeAlertModal()\"\u003eCancel\u003c/button\u003e\u003cbutton class=\"btn-save\" onclick=\"saveAlertRule()\"\u003eCreate Rule\u003c/button\u003e\u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cscript\u003e\n        let currentTimeRange = '1h';\n        let clusterCPUChart, clusterMemoryChart, nodeCPUChart, nodeMemoryChart;\n        let nodes = [];\n        let deployments = [];\n        let alertRules = [];\n        let triggeredAlerts = [];\n        const chartConfig = {\n            responsive: true, maintainAspectRatio: false,\n            interaction: { intersect: false, mode: 'index' },\n            scales: {\n                x: { type: 'time', time: { unit: 'minute' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a1a1aa' } },\n                y: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a1a1aa', callback: (v) =\u003e v + '%' } }\n            },\n            plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748', borderWidth: 1, titleColor: '#e4e4e7', bodyColor: '#a1a1aa', callbacks: { label: (ctx) =\u003e ctx.parsed.y.toFixed(1) + '%' } } },\n            elements: { point: { radius: 0 }, line: { tension: 0.3, borderWidth: 2 } }\n        };\n        const barChartConfig = {\n            responsive: true, maintainAspectRatio: false, indexAxis: 'y',\n            scales: { x: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a1a1aa', callback: (v) =\u003e v + '%' } }, y: { grid: { display: false }, ticks: { color: '#a1a1aa' } } },\n            plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1a1a2e', borderColor: '#2d3748', borderWidth: 1, callbacks: { label: (ctx) =\u003e ctx.parsed.x.toFixed(1) + '%' } } }\n        };\n        function initCharts() {\n            clusterCPUChart = new Chart(document.getElementById('cluster-cpu-chart').getContext('2d'), { type: 'line', data: { datasets: [{ label: 'CPU', data: [], borderColor: '#06b6d4', backgroundColor: 'rgba(6, 182, 212, 0.1)', fill: true }] }, options: chartConfig });\n            clusterMemoryChart = new Chart(document.getElementById('cluster-memory-chart').getContext('2d'), { type: 'line', data: { datasets: [{ label: 'Memory', data: [], borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true }] }, options: chartConfig });\n            nodeCPUChart = new Chart(document.getElementById('node-cpu-chart').getContext('2d'), { type: 'bar', data: { labels: [], datasets: [{ label: 'CPU %', data: [], backgroundColor: '#06b6d4' }] }, options: barChartConfig });\n            nodeMemoryChart = new Chart(document.getElementById('node-memory-chart').getContext('2d'), { type: 'bar', data: { labels: [], datasets: [{ label: 'Memory %', data: [], backgroundColor: '#10b981' }] }, options: barChartConfig });\n        }\n        async function fetchClusterSummary() {\n            try {\n                const r = await fetch('/api/cluster'); const d = await r.json();\n                document.getElementById('cluster-cpu').textContent = d.cpu_pct.toFixed(1) + '%';\n                document.getElementById('cluster-cpu-detail').textContent = (d.used_cpu_cores/1000).toFixed(1) + ' cores of ' + (d.total_cpu_cores/1000).toFixed(1) + ' cores';\n                document.getElementById('cluster-memory').textContent = d.memory_pct.toFixed(1) + '%';\n                document.getElementById('cluster-memory-detail').textContent = d.used_memory_gb.toFixed(1) + ' GB of ' + d.total_memory_gb.toFixed(1) + ' GB';\n                document.getElementById('cluster-nodes').textContent = d.total_nodes;\n                document.getElementById('cluster-nodes-detail').textContent = d.ready_nodes + ' ready';\n                document.getElementById('cluster-pods').textContent = d.total_pods;\n                document.getElementById('cluster-deployments').textContent = d.total_deployments + ' deployments';\n            } catch (e) { console.error('Failed to fetch cluster summary:', e); }\n        }\n        async function fetchNodes() {\n            try { const r = await fetch('/api/nodes'); nodes = await r.json(); updateNodesGrid(); updateNodeCharts(); updateAlertNodeSelector(); } catch (e) { console.error('Failed to fetch nodes:', e); }\n        }\n        async function fetchDeployments() {\n            try { const r = await fetch('/api/deployments?namespace=holm'); deployments = await r.json(); updateDeploymentsTable(); } catch (e) { console.error('Failed to fetch deployments:', e); }\n        }\n        async function fetchHistory() {\n            try {\n                const cpuR = await fetch('/api/history?metric=cluster_cpu\u0026range=' + currentTimeRange); const cpuD = await cpuR.json();\n                const memR = await fetch('/api/history?metric=cluster_mem\u0026range=' + currentTimeRange); const memD = await memR.json();\n                if (cpuD \u0026\u0026 cpuD.length \u003e 0) { clusterCPUChart.data.datasets[0].data = cpuD.map(p =\u003e ({ x: new Date(p.timestamp), y: p.value })); clusterCPUChart.update('none'); }\n                if (memD \u0026\u0026 memD.length \u003e 0) { clusterMemoryChart.data.datasets[0].data = memD.map(p =\u003e ({ x: new Date(p.timestamp), y: p.value })); clusterMemoryChart.update('none'); }\n            } catch (e) { console.error('Failed to fetch history:', e); }\n        }\n        async function fetchAlertRules() { try { const r = await fetch('/api/alerts/rules'); alertRules = await r.json(); updateAlertRulesList(); } catch (e) { console.error('Failed to fetch alert rules:', e); } }\n        async function fetchTriggeredAlerts() { try { const r = await fetch('/api/alerts/triggered'); triggeredAlerts = await r.json(); updateTriggeredAlertsList(); } catch (e) { console.error('Failed to fetch triggered alerts:', e); } }\n        function updateNodesGrid() {\n            const g = document.getElementById('nodes-grid');\n            if (!nodes || nodes.length === 0) { g.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo nodes found\u003c/div\u003e'; return; }\n            g.innerHTML = nodes.map(n =\u003e '\u003cdiv class=\"node-card\" onclick=\"showNodeDetails(\\'' + n.name + '\\')\"\u003e\u003cdiv class=\"node-header\"\u003e\u003cspan class=\"node-name\"\u003e' + n.name + '\u003c/span\u003e\u003cspan class=\"status-badge ' + (n.status === 'Ready' ? 'ready' : 'notready') + '\"\u003e' + n.status + '\u003c/span\u003e\u003c/div\u003e\u003cdiv class=\"node-metrics\"\u003e\u003cdiv class=\"metric-item\"\u003e\u003cspan class=\"metric-label\"\u003eCPU\u003c/span\u003e\u003cdiv class=\"metric-bar\"\u003e\u003cdiv class=\"metric-bar-fill cpu\" style=\"width: ' + Math.min(100, n.cpu_pct) + '%\"\u003e\u003c/div\u003e\u003c/div\u003e\u003cspan class=\"metric-value\"\u003e' + n.cpu_pct.toFixed(1) + '%\u003c/span\u003e\u003c/div\u003e\u003cdiv class=\"metric-item\"\u003e\u003cspan class=\"metric-label\"\u003eMemory\u003c/span\u003e\u003cdiv class=\"metric-bar\"\u003e\u003cdiv class=\"metric-bar-fill memory\" style=\"width: ' + Math.min(100, n.memory_pct) + '%\"\u003e\u003c/div\u003e\u003c/div\u003e\u003cspan class=\"metric-value\"\u003e' + n.memory_pct.toFixed(1) + '%\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv style=\"margin-top: 12px; color: var(--text-secondary); font-size: 0.8rem;\"\u003e' + n.pods + ' pods | ' + (n.cpu_cores/1000).toFixed(2) + ' CPU | ' + (n.memory_mb/1024).toFixed(1) + ' GB RAM\u003c/div\u003e\u003c/div\u003e').join('');\n        }\n        function updateNodeCharts() {\n            if (!nodes || nodes.length === 0) return;\n            nodeCPUChart.data.labels = nodes.map(n =\u003e n.name);\n            nodeCPUChart.data.datasets[0].data = nodes.map(n =\u003e n.cpu_pct);\n            nodeCPUChart.data.datasets[0].backgroundColor = nodes.map(n =\u003e n.cpu_pct \u003e 80 ? '#ef4444' : n.cpu_pct \u003e 60 ? '#f59e0b' : '#06b6d4');\n            nodeCPUChart.update('none');\n            nodeMemoryChart.data.labels = nodes.map(n =\u003e n.name);\n            nodeMemoryChart.data.datasets[0].data = nodes.map(n =\u003e n.memory_pct);\n            nodeMemoryChart.data.datasets[0].backgroundColor = nodes.map(n =\u003e n.memory_pct \u003e 80 ? '#ef4444' : n.memory_pct \u003e 60 ? '#f59e0b' : '#10b981');\n            nodeMemoryChart.update('none');\n        }\n        function updateDeploymentsTable() {\n            const t = document.getElementById('deployments-table'); const s = document.getElementById('deployment-search').value.toLowerCase();\n            const f = deployments.filter(d =\u003e d.name.toLowerCase().includes(s) || d.namespace.toLowerCase().includes(s));\n            if (f.length === 0) { t.innerHTML = '\u003ctr\u003e\u003ctd colspan=\"5\" class=\"empty-state\"\u003eNo deployments found\u003c/td\u003e\u003c/tr\u003e'; return; }\n            t.innerHTML = f.map(d =\u003e '\u003ctr\u003e\u003ctd class=\"deployment-name\"\u003e' + d.name + '\u003c/td\u003e\u003ctd\u003e' + d.namespace + '\u003c/td\u003e\u003ctd\u003e\u003cspan class=\"replica-badge ' + (d.ready \u003e= d.replicas ? 'healthy' : 'degraded') + '\"\u003e' + d.ready + '/' + d.replicas + '\u003c/span\u003e\u003c/td\u003e\u003ctd\u003e' + d.cpu_total.toFixed(0) + 'm\u003c/td\u003e\u003ctd\u003e' + d.memory_mb.toFixed(0) + ' MB\u003c/td\u003e\u003c/tr\u003e').join('');\n        }\n        function updateAlertRulesList() {\n            const l = document.getElementById('alert-rules-list');\n            if (!alertRules || alertRules.length === 0) { l.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo alert rules configured\u003c/div\u003e'; return; }\n            l.innerHTML = alertRules.map(r =\u003e '\u003cdiv class=\"alert-item\"\u003e\u003cdiv class=\"alert-info\"\u003e\u003cspan class=\"alert-name\"\u003e' + r.name + '\u003c/span\u003e\u003cspan class=\"alert-condition\"\u003e' + r.metric.toUpperCase() + ' ' + r.condition + ' ' + r.threshold + '% on ' + (r.node === '*' ? 'all nodes' : r.node) + '\u003c/span\u003e\u003c/div\u003e\u003cdiv class=\"alert-actions\"\u003e\u003cbutton class=\"btn-icon delete\" onclick=\"deleteAlertRule(\\'' + r.id + '\\')\" title=\"Delete\"\u003e\u003csvg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"\u003e\u003cpath stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/\u003e\u003c/svg\u003e\u003c/button\u003e\u003c/div\u003e\u003c/div\u003e').join('');\n        }\n        function updateTriggeredAlertsList() {\n            const l = document.getElementById('triggered-alerts-list');\n            if (!triggeredAlerts || triggeredAlerts.length === 0) { l.innerHTML = '\u003cdiv class=\"empty-state\"\u003eNo alerts triggered\u003c/div\u003e'; return; }\n            const sorted = [...triggeredAlerts].sort((a, b) =\u003e new Date(b.timestamp) - new Date(a.timestamp));\n            l.innerHTML = sorted.map(a =\u003e '\u003cdiv class=\"triggered-alert ' + (a.resolved ? 'resolved' : '') + '\"\u003e\u003cdiv class=\"alert-message\"\u003e' + a.message + '\u003c/div\u003e\u003cdiv class=\"alert-condition\"\u003eValue: ' + a.value.toFixed(1) + '% (threshold: ' + a.threshold + '%)\u003c/div\u003e\u003cdiv class=\"alert-time\"\u003e' + new Date(a.timestamp).toLocaleString() + '\u003c/div\u003e' + (!a.resolved ? '\u003cbutton class=\"btn-icon\" onclick=\"resolveAlert(\\'' + a.id + '\\')\" style=\"margin-top: 8px;\"\u003eMark Resolved\u003c/button\u003e' : '') + '\u003c/div\u003e').join('');\n        }\n        function updateAlertNodeSelector() { const s = document.getElementById('alert-node'); s.innerHTML = '\u003coption value=\"*\"\u003eAll Nodes\u003c/option\u003e'; nodes.forEach(n =\u003e { s.innerHTML += '\u003coption value=\"' + n.name + '\"\u003e' + n.name + '\u003c/option\u003e'; }); }\n        function openAlertModal() { document.getElementById('alert-modal').classList.add('active'); }\n        function closeAlertModal() { document.getElementById('alert-modal').classList.remove('active'); document.getElementById('alert-name').value = ''; document.getElementById('alert-threshold').value = ''; }\n        async function saveAlertRule() {\n            const r = { name: document.getElementById('alert-name').value, metric: document.getElementById('alert-metric').value, condition: document.getElementById('alert-condition').value, threshold: parseFloat(document.getElementById('alert-threshold').value), node: document.getElementById('alert-node').value, enabled: true };\n            if (!r.name || isNaN(r.threshold)) { alert('Please fill in all required fields'); return; }\n            try { await fetch('/api/alerts/rules', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(r) }); closeAlertModal(); fetchAlertRules(); } catch (e) { console.error('Failed to create alert rule:', e); }\n        }\n        async function deleteAlertRule(id) { if (!confirm('Delete this alert rule?')) return; try { await fetch('/api/alerts/rules?id=' + id, { method: 'DELETE' }); fetchAlertRules(); } catch (e) { console.error('Failed to delete alert rule:', e); } }\n        async function resolveAlert(id) { try { await fetch('/api/alerts/resolve?id=' + id, { method: 'POST' }); fetchTriggeredAlerts(); } catch (e) { console.error('Failed to resolve alert:', e); } }\n        function showNodeDetails(nodeName) { console.log('Show details for:', nodeName); }\n        document.querySelectorAll('.nav-item').forEach(i =\u003e { i.addEventListener('click', () =\u003e { document.querySelectorAll('.nav-item').forEach(j =\u003e j.classList.remove('active')); i.classList.add('active'); const v = i.dataset.view; document.querySelectorAll('.view-content').forEach(c =\u003e c.classList.remove('active')); document.getElementById(v + '-view').classList.add('active'); }); });\n        document.querySelectorAll('.time-btn').forEach(b =\u003e { b.addEventListener('click', () =\u003e { document.querySelectorAll('.time-btn').forEach(c =\u003e c.classList.remove('active')); b.classList.add('active'); currentTimeRange = b.dataset.range; let u = 'minute'; if (currentTimeRange === '7d' || currentTimeRange === '30d') u = 'day'; else if (currentTimeRange === '24h') u = 'hour'; clusterCPUChart.options.scales.x.time.unit = u; clusterMemoryChart.options.scales.x.time.unit = u; fetchHistory(); }); });\n        document.getElementById('deployment-search').addEventListener('input', updateDeploymentsTable);\n        function init() { initCharts(); fetchClusterSummary(); fetchNodes(); fetchDeployments(); fetchHistory(); fetchAlertRules(); fetchTriggeredAlerts(); setInterval(() =\u003e { fetchClusterSummary(); fetchNodes(); fetchHistory(); fetchTriggeredAlerts(); }, 10000); setInterval(fetchDeployments, 30000); }\n        init();\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e`\n","go.mod":"module settings-web\n\ngo 1.21\n","main.go":"package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"net/url\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n)\n\n// Metrics storage\nvar (\n\tmetricsHistory   = make(map[string][]MetricPoint)\n\talertRules       = []AlertRule{}\n\ttriggeredAlerts  = []TriggeredAlert{}\n\thistoryMutex     = sync.RWMutex{}\n\talertMutex       = sync.RWMutex{}\n\tmaxHistoryPoints = 8640 // 24 hours at 10-second intervals or 30 days at 5-min intervals\n)\n\n// Data structures\ntype MetricPoint struct {\n\tTimestamp time.Time `json:\"timestamp\"`\n\tValue     float64   `json:\"value\"`\n\tNode      string    `json:\"node,omitempty\"`\n}\n\ntype NodeMetrics struct {\n\tName      string  `json:\"name\"`\n\tCPUCores  float64 `json:\"cpu_cores\"`\n\tCPUPct    float64 `json:\"cpu_pct\"`\n\tMemoryMB  float64 `json:\"memory_mb\"`\n\tMemoryPct float64 `json:\"memory_pct\"`\n\tPods      int     `json:\"pods\"`\n\tStatus    string  `json:\"status\"`\n}\n\ntype PodMetrics struct {\n\tName       string  `json:\"name\"`\n\tNamespace  string  `json:\"namespace\"`\n\tNode       string  `json:\"node\"`\n\tCPUm       float64 `json:\"cpu_m\"`\n\tMemoryMB   float64 `json:\"memory_mb\"`\n\tStatus     string  `json:\"status\"`\n\tDeployment string  `json:\"deployment\"`\n}\n\ntype DeploymentMetrics struct {\n\tName       string       `json:\"name\"`\n\tNamespace  string       `json:\"namespace\"`\n\tReplicas   int          `json:\"replicas\"`\n\tReady      int          `json:\"ready\"`\n\tCPUTotal   float64      `json:\"cpu_total\"`\n\tMemoryMB   float64      `json:\"memory_mb\"`\n\tPodMetrics []PodMetrics `json:\"pods\"`\n}\n\ntype ClusterSummary struct {\n\tTotalNodes       int     `json:\"total_nodes\"`\n\tReadyNodes       int     `json:\"ready_nodes\"`\n\tTotalPods        int     `json:\"total_pods\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tTotalCPUCores    float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores     float64 `json:\"used_cpu_cores\"`\n\tTotalMemoryGB    float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tCPUPct           float64 `json:\"cpu_pct\"`\n\tMemoryPct        float64 `json:\"memory_pct\"`\n}\n\ntype AlertRule struct {\n\tID          string    `json:\"id\"`\n\tName        string    `json:\"name\"`\n\tMetric      string    `json:\"metric\"`\n\tCondition   string    `json:\"condition\"`\n\tThreshold   float64   `json:\"threshold\"`\n\tNode        string    `json:\"node\"`\n\tNamespace   string    `json:\"namespace,omitempty\"`\n\tPod         string    `json:\"pod,omitempty\"`\n\tSeverity    string    `json:\"severity\"` // critical, warning, info\n\tDuration    int       `json:\"duration\"` // seconds threshold must be exceeded\n\tEnabled     bool      `json:\"enabled\"`\n\tCreated     time.Time `json:\"created\"`\n\tLastChecked time.Time `json:\"last_checked,omitempty\"`\n}\n\ntype TriggeredAlert struct {\n\tID           string    `json:\"id\"`\n\tRuleID       string    `json:\"rule_id\"`\n\tRuleName     string    `json:\"rule_name\"`\n\tMessage      string    `json:\"message\"`\n\tValue        float64   `json:\"value\"`\n\tThreshold    float64   `json:\"threshold\"`\n\tSeverity     string    `json:\"severity\"`\n\tNode         string    `json:\"node,omitempty\"`\n\tNamespace    string    `json:\"namespace,omitempty\"`\n\tPod          string    `json:\"pod,omitempty\"`\n\tMetric       string    `json:\"metric\"`\n\tTimestamp    time.Time `json:\"timestamp\"`\n\tResolvedAt   time.Time `json:\"resolved_at,omitempty\"`\n\tResolved     bool      `json:\"resolved\"`\n\tAcknowledged bool      `json:\"acknowledged\"`\n}\n\n// ClusterMetrics represents comprehensive cluster-wide metrics\ntype ClusterMetrics struct {\n\tTimestamp      time.Time              `json:\"timestamp\"`\n\tSummary        ClusterSummary         `json:\"summary\"`\n\tNodeMetrics    []NodeMetrics          `json:\"node_metrics\"`\n\tTopPodsByCPU   []PodMetrics           `json:\"top_pods_by_cpu\"`\n\tTopPodsByMem   []PodMetrics           `json:\"top_pods_by_memory\"`\n\tNamespaces     []NamespaceMetrics     `json:\"namespaces\"`\n\tResourceQuotas []ResourceQuotaStatus  `json:\"resource_quotas,omitempty\"`\n\tAlerts         AlertsSummary          `json:\"alerts\"`\n}\n\n// NamespaceMetrics contains metrics aggregated by namespace\ntype NamespaceMetrics struct {\n\tName        string  `json:\"name\"`\n\tPodCount    int     `json:\"pod_count\"`\n\tCPUUsage    float64 `json:\"cpu_usage_m\"`\n\tMemoryUsage float64 `json:\"memory_usage_mb\"`\n\tCPUPct      float64 `json:\"cpu_pct\"`\n\tMemoryPct   float64 `json:\"memory_pct\"`\n}\n\n// ResourceQuotaStatus represents quota usage\ntype ResourceQuotaStatus struct {\n\tNamespace  string  `json:\"namespace\"`\n\tCPUUsed    float64 `json:\"cpu_used\"`\n\tCPULimit   float64 `json:\"cpu_limit\"`\n\tMemUsed    float64 `json:\"mem_used_mb\"`\n\tMemLimit   float64 `json:\"mem_limit_mb\"`\n\tPodsUsed   int     `json:\"pods_used\"`\n\tPodsLimit  int     `json:\"pods_limit\"`\n}\n\n// AlertsSummary provides alert statistics\ntype AlertsSummary struct {\n\tTotal      int `json:\"total\"`\n\tCritical   int `json:\"critical\"`\n\tWarning    int `json:\"warning\"`\n\tInfo       int `json:\"info\"`\n\tActive     int `json:\"active\"`\n\tResolved   int `json:\"resolved\"`\n}\n\n// NodeDetailedMetrics provides in-depth metrics for a single node\ntype NodeDetailedMetrics struct {\n\tNodeMetrics\n\tAllocatable   ResourceCapacity  `json:\"allocatable\"`\n\tCapacity      ResourceCapacity  `json:\"capacity\"`\n\tConditions    []NodeCondition   `json:\"conditions\"`\n\tPods          []PodMetrics      `json:\"pods\"`\n\tCPUHistory    []MetricPoint     `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint     `json:\"memory_history\"`\n\tLabels        map[string]string `json:\"labels,omitempty\"`\n\tTaints        []string          `json:\"taints,omitempty\"`\n}\n\n// ResourceCapacity represents node resource capacity\ntype ResourceCapacity struct {\n\tCPU     float64 `json:\"cpu_cores\"`\n\tMemory  float64 `json:\"memory_mb\"`\n\tPods    int     `json:\"pods\"`\n\tStorage float64 `json:\"storage_gb,omitempty\"`\n}\n\n// NodeCondition represents node status conditions\ntype NodeCondition struct {\n\tType    string `json:\"type\"`\n\tStatus  string `json:\"status\"`\n\tMessage string `json:\"message,omitempty\"`\n}\n\n// PodDetailedMetrics provides in-depth metrics for a single pod\ntype PodDetailedMetrics struct {\n\tPodMetrics\n\tContainers    []ContainerMetrics `json:\"containers\"`\n\tRestartCount  int                `json:\"restart_count\"`\n\tStartTime     time.Time          `json:\"start_time\"`\n\tCPUHistory    []MetricPoint      `json:\"cpu_history\"`\n\tMemoryHistory []MetricPoint      `json:\"memory_history\"`\n\tEvents        []PodEvent         `json:\"events,omitempty\"`\n\tLabels        map[string]string  `json:\"labels,omitempty\"`\n}\n\n// ContainerMetrics represents metrics for individual containers\ntype ContainerMetrics struct {\n\tName         string  `json:\"name\"`\n\tCPUm         float64 `json:\"cpu_m\"`\n\tMemoryMB     float64 `json:\"memory_mb\"`\n\tRestartCount int     `json:\"restart_count\"`\n\tReady        bool    `json:\"ready\"`\n\tState        string  `json:\"state\"`\n}\n\n// PodEvent represents a Kubernetes event\ntype PodEvent struct {\n\tType      string    `json:\"type\"`\n\tReason    string    `json:\"reason\"`\n\tMessage   string    `json:\"message\"`\n\tCount     int       `json:\"count\"`\n\tTimestamp time.Time `json:\"timestamp\"`\n}\n\n// HistoricalData represents a time-series response\ntype HistoricalData struct {\n\tMetric     string        `json:\"metric\"`\n\tNode       string        `json:\"node,omitempty\"`\n\tNamespace  string        `json:\"namespace,omitempty\"`\n\tPod        string        `json:\"pod,omitempty\"`\n\tResolution string        `json:\"resolution\"`\n\tStart      time.Time     `json:\"start\"`\n\tEnd        time.Time     `json:\"end\"`\n\tPoints     []MetricPoint `json:\"points\"`\n}\n\n// AlertsResponse provides unified alerts API response\ntype AlertsResponse struct {\n\tRules     []AlertRule      `json:\"rules\"`\n\tTriggered []TriggeredAlert `json:\"triggered\"`\n\tSummary   AlertsSummary    `json:\"summary\"`\n}\n\n// K8s API response structures\ntype K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric `json:\"items\"`\n}\n\ntype K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t} `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string `json:\"cpu\"`\n\t\tMemory string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t} `json:\"containers\"`\n}\n\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype K8sNode struct {\n\tMetadata struct {\n\t\tName   string            `json:\"name\"`\n\t\tLabels map[string]string `json:\"labels\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tTaints []struct {\n\t\t\tKey    string `json:\"key\"`\n\t\t\tValue  string `json:\"value\"`\n\t\t\tEffect string `json:\"effect\"`\n\t\t} `json:\"taints\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType    string `json:\"type\"`\n\t\t\tStatus  string `json:\"status\"`\n\t\t\tMessage string `json:\"message\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity struct {\n\t\t\tCPU     string `json:\"cpu\"`\n\t\t\tMemory  string `json:\"memory\"`\n\t\t\tPods    string `json:\"pods\"`\n\t\t\tStorage string `json:\"ephemeral-storage\"`\n\t\t} `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU     string `json:\"cpu\"`\n\t\t\tMemory  string `json:\"memory\"`\n\t\t\tPods    string `json:\"pods\"`\n\t\t\tStorage string `json:\"ephemeral-storage\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype K8sPodList struct {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct {\n\tMetadata struct {\n\t\tName              string            `json:\"name\"`\n\t\tNamespace         string            `json:\"namespace\"`\n\t\tLabels            map[string]string `json:\"labels\"`\n\t\tCreationTimestamp string            `json:\"creationTimestamp\"`\n\t\tOwnerReferences   []struct {\n\t\t\tKind string `json:\"kind\"`\n\t\t\tName string `json:\"name\"`\n\t\t} `json:\"ownerReferences\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName   string `json:\"nodeName\"`\n\t\tContainers []struct {\n\t\t\tName      string `json:\"name\"`\n\t\t\tResources struct {\n\t\t\t\tRequests struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t} `json:\"requests\"`\n\t\t\t\tLimits struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t} `json:\"limits\"`\n\t\t\t} `json:\"resources\"`\n\t\t} `json:\"containers\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string    `json:\"phase\"`\n\t\tStartTime         string    `json:\"startTime\"`\n\t\tContainerStatuses []struct {\n\t\t\tName         string `json:\"name\"`\n\t\t\tReady        bool   `json:\"ready\"`\n\t\t\tRestartCount int    `json:\"restartCount\"`\n\t\t\tState        struct {\n\t\t\t\tRunning    *struct{} `json:\"running\"`\n\t\t\t\tWaiting    *struct{ Reason string `json:\"reason\"` } `json:\"waiting\"`\n\t\t\t\tTerminated *struct{ Reason string `json:\"reason\"` } `json:\"terminated\"`\n\t\t\t} `json:\"state\"`\n\t\t} `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype K8sDeploymentList struct {\n\tItems []K8sDeployment `json:\"items\"`\n}\n\ntype K8sDeployment struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas int `json:\"replicas\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tReplicas      int `json:\"replicas\"`\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t} `json:\"status\"`\n}\n\n// PrometheusResponse for historical queries\ntype PrometheusResponse struct {\n\tStatus string `json:\"status\"`\n\tData   struct {\n\t\tResultType string `json:\"resultType\"`\n\t\tResult     []struct {\n\t\t\tMetric map[string]string `json:\"metric\"`\n\t\t\tValues [][]interface{}   `json:\"values\"`\n\t\t} `json:\"result\"`\n\t} `json:\"data\"`\n}\n\n// K8s API client\nfunc k8sAPIRequest(path string) ([]byte, error) {\n\ttoken, err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token: %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\", apiServer, apiPort, path)\n\n\ttransport := \u0026http.Transport{\n\t\tTLSClientConfig: \u0026tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := \u0026http.Client{\n\t\tTransport: transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\", apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\", \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n// Prometheus query helper\nfunc queryPrometheus(query string, start, end time.Time, step string) (*PrometheusResponse, error) {\n\tpromURL := os.Getenv(\"PROMETHEUS_URL\")\n\tif promURL == \"\" {\n\t\tpromURL = \"http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\"\n\t}\n\n\tparams := url.Values{}\n\tparams.Set(\"query\", query)\n\tparams.Set(\"start\", strconv.FormatInt(start.Unix(), 10))\n\tparams.Set(\"end\", strconv.FormatInt(end.Unix(), 10))\n\tparams.Set(\"step\", step)\n\n\tresp, err := http.Get(fmt.Sprintf(\"%s/api/v1/query_range?%s\", promURL, params.Encode()))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tvar result PrometheusResponse\n\tif err := json.NewDecoder(resp.Body).Decode(\u0026result); err != nil {\n\t\treturn nil, err\n\t}\n\treturn \u0026result, nil\n}\n\n// Parse K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s, \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s, \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\") {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s, \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch all metrics from K8s\nfunc fetchNodeMetrics() ([]NodeMetrics, error) {\n\t// Get node metrics\n\tmetricsData, err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeMetricsList K8sNodeMetricsList\n\tif err := json.Unmarshal(metricsData, \u0026nodeMetricsList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get node info for capacity\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err := json.Unmarshal(nodeData, \u0026nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod counts per node\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err := json.Unmarshal(podData, \u0026podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tpodCounts := make(map[string]int)\n\tfor _, pod := range podList.Items {\n\t\tif pod.Status.Phase == \"Running\" {\n\t\t\tpodCounts[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t// Build node capacity map\n\ttype nodeCapInfo struct {\n\t\tCPUCores float64\n\t\tMemoryMB float64\n\t\tStatus   string\n\t}\n\tnodeCapacity := make(map[string]nodeCapInfo)\n\n\tfor _, node := range nodeList.Items {\n\t\tstatus := \"NotReady\"\n\t\tfor _, cond := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" \u0026\u0026 cond.Status == \"True\" {\n\t\t\t\tstatus = \"Ready\"\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tnodeCapacity[node.Metadata.Name] = nodeCapInfo{\n\t\t\tCPUCores: parseCPU(node.Status.Allocatable.CPU),\n\t\t\tMemoryMB: parseMemory(node.Status.Allocatable.Memory),\n\t\t\tStatus:   status,\n\t\t}\n\t}\n\n\t// Build result\n\tvar result []NodeMetrics\n\tfor _, nm := range nodeMetricsList.Items {\n\t\tcap := nodeCapacity[nm.Metadata.Name]\n\t\tcpuUsed := parseCPU(nm.Usage.CPU)\n\t\tmemUsed := parseMemory(nm.Usage.Memory)\n\n\t\tcpuPct := 0.0\n\t\tif cap.CPUCores \u003e 0 {\n\t\t\tcpuPct = (cpuUsed / cap.CPUCores) * 100\n\t\t}\n\t\tmemPct := 0.0\n\t\tif cap.MemoryMB \u003e 0 {\n\t\t\tmemPct = (memUsed / cap.MemoryMB) * 100\n\t\t}\n\n\t\tresult = append(result, NodeMetrics{\n\t\t\tName:      nm.Metadata.Name,\n\t\t\tCPUCores:  cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:  memUsed,\n\t\t\tMemoryPct: memPct,\n\t\t\tPods:      podCounts[nm.Metadata.Name],\n\t\t\tStatus:    cap.Status,\n\t\t})\n\t}\n\n\tsort.Slice(result, func(i, j int) bool {\n\t\treturn result[i].Name \u003c result[j].Name\n\t})\n\n\treturn result, nil\n}\n\nfunc fetchPodMetrics() ([]PodMetrics, error) {\n\tmetricsData, err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podMetricsList K8sPodMetricsList\n\tif err := json.Unmarshal(metricsData, \u0026podMetricsList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod info for node and status\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar podList K8sPodList\n\tif err := json.Unmarshal(podData, \u0026podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\ttype podInfo struct {\n\t\tNode       string\n\t\tStatus     string\n\t\tDeployment string\n\t}\n\tpodInfoMap := make(map[string]podInfo)\n\n\tfor _, pod := range podList.Items {\n\t\tkey := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\t\tdeployment := \"\"\n\t\tfor _, owner := range pod.Metadata.OwnerReferences {\n\t\t\tif owner.Kind == \"ReplicaSet\" {\n\t\t\t\t// Extract deployment name from replicaset name (remove hash suffix)\n\t\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\t\tif len(parts) \u003e 1 {\n\t\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1], \"-\")\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tpodInfoMap[key] = podInfo{\n\t\t\tNode:       pod.Spec.NodeName,\n\t\t\tStatus:     pod.Status.Phase,\n\t\t\tDeployment: deployment,\n\t\t}\n\t}\n\n\tvar result []PodMetrics\n\tfor _, pm := range podMetricsList.Items {\n\t\tkey := pm.Metadata.Namespace + \"/\" + pm.Metadata.Name\n\t\tinfo := podInfoMap[key]\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, container := range pm.Containers {\n\t\t\ttotalCPU += parseCPU(container.Usage.CPU)\n\t\t\ttotalMem += parseMemory(container.Usage.Memory)\n\t\t}\n\n\t\tresult = append(result, PodMetrics{\n\t\t\tName:       pm.Metadata.Name,\n\t\t\tNamespace:  pm.Metadata.Namespace,\n\t\t\tNode:       info.Node,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:     info.Status,\n\t\t\tDeployment: info.Deployment,\n\t\t})\n\t}\n\n\treturn result, nil\n}\n\nfunc fetchDeploymentMetrics() ([]DeploymentMetrics, error) {\n\t// Get deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tif err := json.Unmarshal(deployData, \u0026deployList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod metrics\n\tpods, err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Group pods by deployment\n\tdeployPods := make(map[string][]PodMetrics)\n\tfor _, pod := range pods {\n\t\tif pod.Deployment != \"\" {\n\t\t\tkey := pod.Namespace + \"/\" + pod.Deployment\n\t\t\tdeployPods[key] = append(deployPods[key], pod)\n\t\t}\n\t}\n\n\tvar result []DeploymentMetrics\n\tfor _, deploy := range deployList.Items {\n\t\tkey := deploy.Metadata.Namespace + \"/\" + deploy.Metadata.Name\n\t\tpods := deployPods[key]\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, pod := range pods {\n\t\t\ttotalCPU += pod.CPUm\n\t\t\ttotalMem += pod.MemoryMB\n\t\t}\n\n\t\tresult = append(result, DeploymentMetrics{\n\t\t\tName:       deploy.Metadata.Name,\n\t\t\tNamespace:  deploy.Metadata.Namespace,\n\t\t\tReplicas:   deploy.Status.Replicas,\n\t\t\tReady:      deploy.Status.ReadyReplicas,\n\t\t\tCPUTotal:   totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tPodMetrics: pods,\n\t\t})\n\t}\n\n\tsort.Slice(result, func(i, j int) bool {\n\t\treturn result[i].CPUTotal \u003e result[j].CPUTotal\n\t})\n\n\treturn result, nil\n}\n\nfunc fetchClusterSummary() (*ClusterSummary, error) {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get node capacity info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err := json.Unmarshal(nodeData, \u0026nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar totalCPU, totalMem float64\n\treadyNodes := 0\n\tfor _, node := range nodeList.Items {\n\t\ttotalCPU += parseCPU(node.Status.Allocatable.CPU)\n\t\ttotalMem += parseMemory(node.Status.Allocatable.Memory)\n\t\tfor _, cond := range node.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" \u0026\u0026 cond.Status == \"True\" {\n\t\t\t\treadyNodes++\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tvar usedCPU, usedMem float64\n\ttotalPods := 0\n\tfor _, node := range nodes {\n\t\tusedCPU += node.CPUCores\n\t\tusedMem += node.MemoryMB\n\t\ttotalPods += node.Pods\n\t}\n\n\t// Count deployments\n\tdeployData, err := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar deployList K8sDeploymentList\n\tjson.Unmarshal(deployData, \u0026deployList)\n\n\tcpuPct := 0.0\n\tif totalCPU \u003e 0 {\n\t\tcpuPct = (usedCPU / totalCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif totalMem \u003e 0 {\n\t\tmemPct = (usedMem / totalMem) * 100\n\t}\n\n\treturn \u0026ClusterSummary{\n\t\tTotalNodes:       len(nodeList.Items),\n\t\tReadyNodes:       readyNodes,\n\t\tTotalPods:        totalPods,\n\t\tTotalDeployments: len(deployList.Items),\n\t\tTotalCPUCores:    totalCPU,\n\t\tUsedCPUCores:     usedCPU,\n\t\tTotalMemoryGB:    totalMem / 1024,\n\t\tUsedMemoryGB:     usedMem / 1024,\n\t\tCPUPct:           cpuPct,\n\t\tMemoryPct:        memPct,\n\t}, nil\n}\n\n// Record metrics for history\nfunc recordMetrics() {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor range ticker.C {\n\t\tnodes, err := fetchNodeMetrics()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error fetching metrics: %v\", err)\n\t\t\tcontinue\n\t\t}\n\n\t\tnow := time.Now()\n\t\thistoryMutex.Lock()\n\n\t\t// Record per-node metrics\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, node := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\n\t\t\tcpuKey := \"node_cpu_\" + node.Name\n\t\t\tmemKey := \"node_mem_\" + node.Name\n\n\t\t\tmetricsHistory[cpuKey] = append(metricsHistory[cpuKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:     node.CPUPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\t\t\tmetricsHistory[memKey] = append(metricsHistory[memKey], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:     node.MemoryPct,\n\t\t\t\tNode:      node.Name,\n\t\t\t})\n\n\t\t\t// Trim history\n\t\t\tif len(metricsHistory[cpuKey]) \u003e maxHistoryPoints {\n\t\t\t\tmetricsHistory[cpuKey] = metricsHistory[cpuKey][len(metricsHistory[cpuKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif len(metricsHistory[memKey]) \u003e maxHistoryPoints {\n\t\t\t\tmetricsHistory[memKey] = metricsHistory[memKey][len(metricsHistory[memKey])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\t// Record cluster-wide averages\n\t\tif len(nodes) \u003e 0 {\n\t\t\tmetricsHistory[\"cluster_cpu\"] = append(metricsHistory[\"cluster_cpu\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:     totalCPU / float64(len(nodes)),\n\t\t\t})\n\t\t\tmetricsHistory[\"cluster_mem\"] = append(metricsHistory[\"cluster_mem\"], MetricPoint{\n\t\t\t\tTimestamp: now,\n\t\t\t\tValue:     totalMem / float64(len(nodes)),\n\t\t\t})\n\n\t\t\tif len(metricsHistory[\"cluster_cpu\"]) \u003e maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_cpu\"] = metricsHistory[\"cluster_cpu\"][len(metricsHistory[\"cluster_cpu\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t\tif len(metricsHistory[\"cluster_mem\"]) \u003e maxHistoryPoints {\n\t\t\t\tmetricsHistory[\"cluster_mem\"] = metricsHistory[\"cluster_mem\"][len(metricsHistory[\"cluster_mem\"])-maxHistoryPoints:]\n\t\t\t}\n\t\t}\n\n\t\thistoryMutex.Unlock()\n\n\t\t// Check alert rules\n\t\tcheckAlerts(nodes)\n\t}\n}\n\nfunc checkAlerts(nodes []NodeMetrics) {\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tnow := time.Now()\n\n\tfor i := range alertRules {\n\t\trule := \u0026alertRules[i]\n\t\tif !rule.Enabled {\n\t\t\tcontinue\n\t\t}\n\t\trule.LastChecked = now\n\n\t\tfor _, node := range nodes {\n\t\t\tif rule.Node != \"\" \u0026\u0026 rule.Node != \"*\" \u0026\u0026 rule.Node != node.Name {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tvar value float64\n\t\t\tvar metricName string\n\t\t\tswitch rule.Metric {\n\t\t\tcase \"cpu\":\n\t\t\t\tvalue = node.CPUPct\n\t\t\t\tmetricName = \"CPU\"\n\t\t\tcase \"memory\":\n\t\t\t\tvalue = node.MemoryPct\n\t\t\t\tmetricName = \"Memory\"\n\t\t\tcase \"pods\":\n\t\t\t\tvalue = float64(node.Pods)\n\t\t\t\tmetricName = \"Pods\"\n\t\t\tdefault:\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\ttriggered := false\n\t\t\tswitch rule.Condition {\n\t\t\tcase \"\u003e\":\n\t\t\t\ttriggered = value \u003e rule.Threshold\n\t\t\tcase \"\u003e=\":\n\t\t\t\ttriggered = value \u003e= rule.Threshold\n\t\t\tcase \"\u003c\":\n\t\t\t\ttriggered = value \u003c rule.Threshold\n\t\t\tcase \"\u003c=\":\n\t\t\t\ttriggered = value \u003c= rule.Threshold\n\t\t\tcase \"==\":\n\t\t\t\ttriggered = value == rule.Threshold\n\t\t\tcase \"!=\":\n\t\t\t\ttriggered = value != rule.Threshold\n\t\t\t}\n\n\t\t\talertKey := fmt.Sprintf(\"%s-%s\", rule.ID, node.Name)\n\n\t\t\tif triggered {\n\t\t\t\t// Check if this alert is already triggered\n\t\t\t\talreadyTriggered := false\n\t\t\t\tfor _, ta := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID \u0026\u0026 !ta.Resolved \u0026\u0026 ta.Node == node.Name {\n\t\t\t\t\t\talreadyTriggered = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif !alreadyTriggered {\n\t\t\t\t\tseverity := rule.Severity\n\t\t\t\t\tif severity == \"\" {\n\t\t\t\t\t\tseverity = \"warning\"\n\t\t\t\t\t}\n\n\t\t\t\t\tmessage := fmt.Sprintf(\"%s %s %.1f%% %s %.1f%% on node %s\",\n\t\t\t\t\t\tmetricName, rule.Condition, rule.Threshold, \"- Current:\", value, node.Name)\n\n\t\t\t\t\ttriggeredAlerts = append(triggeredAlerts, TriggeredAlert{\n\t\t\t\t\t\tID:        fmt.Sprintf(\"alert-%d-%s\", now.UnixNano(), alertKey),\n\t\t\t\t\t\tRuleID:    rule.ID,\n\t\t\t\t\t\tRuleName:  rule.Name,\n\t\t\t\t\t\tMessage:   message,\n\t\t\t\t\t\tValue:     value,\n\t\t\t\t\t\tThreshold: rule.Threshold,\n\t\t\t\t\t\tSeverity:  severity,\n\t\t\t\t\t\tNode:      node.Name,\n\t\t\t\t\t\tMetric:    rule.Metric,\n\t\t\t\t\t\tTimestamp: now,\n\t\t\t\t\t\tResolved:  false,\n\t\t\t\t\t})\n\t\t\t\t\tlog.Printf(\"Alert triggered: %s (severity: %s)\", message, severity)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Check if we should resolve an existing alert\n\t\t\t\tfor i, ta := range triggeredAlerts {\n\t\t\t\t\tif ta.RuleID == rule.ID \u0026\u0026 !ta.Resolved \u0026\u0026 ta.Node == node.Name {\n\t\t\t\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\t\t\t\ttriggeredAlerts[i].ResolvedAt = now\n\t\t\t\t\t\tlog.Printf(\"Alert resolved: %s on %s\", rule.Name, node.Name)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Clean up old resolved alerts (keep for 24 hours)\n\tcutoff := now.Add(-24 * time.Hour)\n\tvar activeAlerts []TriggeredAlert\n\tfor _, alert := range triggeredAlerts {\n\t\tif !alert.Resolved || alert.ResolvedAt.After(cutoff) {\n\t\t\tactiveAlerts = append(activeAlerts, alert)\n\t\t}\n\t}\n\ttriggeredAlerts = activeAlerts\n}\n\n// HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\"status\": \"healthy\"})\n}\n\nfunc handleNodes(w http.ResponseWriter, r *http.Request) {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w http.ResponseWriter, r *http.Request) {\n\tpods, err := fetchPodMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\t// Filter by namespace if provided\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tif namespace != \"\" {\n\t\tvar filtered []PodMetrics\n\t\tfor _, pod := range pods {\n\t\t\tif pod.Namespace == namespace {\n\t\t\t\tfiltered = append(filtered, pod)\n\t\t\t}\n\t\t}\n\t\tpods = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleDeployments(w http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tif namespace != \"\" {\n\t\tvar filtered []DeploymentMetrics\n\t\tfor _, deploy := range deployments {\n\t\t\tif deploy.Namespace == namespace {\n\t\t\t\tfiltered = append(filtered, deploy)\n\t\t\t}\n\t\t}\n\t\tdeployments = filtered\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(deployments)\n}\n\nfunc handleClusterSummary(w http.ResponseWriter, r *http.Request) {\n\tsummary, err := fetchClusterSummary()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(summary)\n}\n\nfunc handleHistory(w http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\n\tif rangeParam == \"\" {\n\t\trangeParam = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch rangeParam {\n\tcase \"1h\":\n\t\tduration = time.Hour\n\tcase \"6h\":\n\t\tduration = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration = 7 * 24 * time.Hour\n\tcase \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration = time.Hour\n\t}\n\n\tcutoff := time.Now().Add(-duration)\n\n\t// Try Prometheus first for longer ranges\n\tif duration \u003e time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric, node, duration)\n\t\tif err == nil \u0026\u0026 len(promData) \u003e 0 {\n\t\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(promData)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar key string\n\tif node != \"\" \u0026\u0026 node != \"*\" {\n\t\tkey = metric + \"_\" + node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar result []MetricPoint\n\tif points, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range points {\n\t\t\tif p.Timestamp.After(cutoff) {\n\t\t\t\tresult = append(result, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(result)\n}\n\nfunc getPrometheusHistory(metric, node string, duration time.Duration) ([]MetricPoint, error) {\n\tend := time.Now()\n\tstart := end.Add(-duration)\n\n\tvar step string\n\tswitch {\n\tcase duration \u003c= time.Hour:\n\t\tstep = \"15s\"\n\tcase duration \u003c= 6*time.Hour:\n\t\tstep = \"1m\"\n\tcase duration \u003c= 24*time.Hour:\n\t\tstep = \"5m\"\n\tcase duration \u003c= 7*24*time.Hour:\n\t\tstep = \"30m\"\n\tdefault:\n\t\tstep = \"2h\"\n\t}\n\n\tvar query string\n\tswitch metric {\n\tcase \"cluster_cpu\":\n\t\tquery = \"avg(100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m])) * 100))\"\n\tcase \"cluster_mem\":\n\t\tquery = \"avg((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100)\"\n\tcase \"node_cpu\":\n\t\tif node != \"\" {\n\t\t\tquery = fmt.Sprintf(\"100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\", instance=~\\\"%s.*\\\"}[5m])) * 100)\", node)\n\t\t} else {\n\t\t\tquery = \"100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\\\"idle\\\"}[5m])) * 100)\"\n\t\t}\n\tcase \"node_mem\":\n\t\tif node != \"\" {\n\t\t\tquery = fmt.Sprintf(\"(1 - (node_memory_MemAvailable_bytes{instance=~\\\"%s.*\\\"} / node_memory_MemTotal_bytes{instance=~\\\"%s.*\\\"})) * 100\", node, node)\n\t\t} else {\n\t\t\tquery = \"(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100\"\n\t\t}\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown metric: %s\", metric)\n\t}\n\n\tresp, err := queryPrometheus(query, start, end, step)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar result []MetricPoint\n\tfor _, series := range resp.Data.Result {\n\t\tnodeName := series.Metric[\"instance\"]\n\t\tfor _, val := range series.Values {\n\t\t\tts, _ := val[0].(float64)\n\t\t\tvalStr, _ := val[1].(string)\n\t\t\tvalue, _ := strconv.ParseFloat(valStr, 64)\n\t\t\tresult = append(result, MetricPoint{\n\t\t\t\tTimestamp: time.Unix(int64(ts), 0),\n\t\t\t\tValue:     value,\n\t\t\t\tNode:      nodeName,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn result, nil\n}\n\nfunc handleAlertRules(w http.ResponseWriter, r *http.Request) {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(alertRules)\n}\n\nfunc handleCreateAlertRule(w http.ResponseWriter, r *http.Request) {\n\tvar rule AlertRule\n\tif err := json.NewDecoder(r.Body).Decode(\u0026rule); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\n\trule.ID = fmt.Sprintf(\"rule-%d\", time.Now().UnixNano())\n\trule.Created = time.Now()\n\tif rule.Node == \"\" {\n\t\trule.Node = \"*\"\n\t}\n\n\talertMutex.Lock()\n\talertRules = append(alertRules, rule)\n\talertMutex.Unlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(rule)\n}\n\nfunc handleDeleteAlertRule(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tfor i, rule := range alertRules {\n\t\tif rule.ID == id {\n\t\t\talertRules = append(alertRules[:i], alertRules[i+1:]...)\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w, \"rule not found\", http.StatusNotFound)\n}\n\nfunc handleTriggeredAlerts(w http.ResponseWriter, r *http.Request) {\n\talertMutex.RLock()\n\tdefer alertMutex.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(triggeredAlerts)\n}\n\nfunc handleResolveAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID == id {\n\t\t\ttriggeredAlerts[i].Resolved = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w, \"alert not found\", http.StatusNotFound)\n}\n\n// Fetch comprehensive cluster-wide metrics\nfunc fetchClusterMetrics() (*ClusterMetrics, error) {\n\tsummary, err := fetchClusterSummary()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tpods, err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get top pods by CPU\n\tsortedByCPU := make([]PodMetrics, len(pods))\n\tcopy(sortedByCPU, pods)\n\tsort.Slice(sortedByCPU, func(i, j int) bool {\n\t\treturn sortedByCPU[i].CPUm \u003e sortedByCPU[j].CPUm\n\t})\n\ttopCPU := sortedByCPU\n\tif len(topCPU) \u003e 10 {\n\t\ttopCPU = topCPU[:10]\n\t}\n\n\t// Get top pods by memory\n\tsortedByMem := make([]PodMetrics, len(pods))\n\tcopy(sortedByMem, pods)\n\tsort.Slice(sortedByMem, func(i, j int) bool {\n\t\treturn sortedByMem[i].MemoryMB \u003e sortedByMem[j].MemoryMB\n\t})\n\ttopMem := sortedByMem\n\tif len(topMem) \u003e 10 {\n\t\ttopMem = topMem[:10]\n\t}\n\n\t// Aggregate by namespace\n\tnsMetrics := make(map[string]*NamespaceMetrics)\n\tfor _, pod := range pods {\n\t\tif _, ok := nsMetrics[pod.Namespace]; !ok {\n\t\t\tnsMetrics[pod.Namespace] = \u0026NamespaceMetrics{Name: pod.Namespace}\n\t\t}\n\t\tnsMetrics[pod.Namespace].PodCount++\n\t\tnsMetrics[pod.Namespace].CPUUsage += pod.CPUm\n\t\tnsMetrics[pod.Namespace].MemoryUsage += pod.MemoryMB\n\t}\n\n\tvar namespaces []NamespaceMetrics\n\tfor _, ns := range nsMetrics {\n\t\tif summary.UsedCPUCores \u003e 0 {\n\t\t\tns.CPUPct = (ns.CPUUsage / summary.UsedCPUCores) * 100\n\t\t}\n\t\tif summary.UsedMemoryGB \u003e 0 {\n\t\t\tns.MemoryPct = (ns.MemoryUsage / (summary.UsedMemoryGB * 1024)) * 100\n\t\t}\n\t\tnamespaces = append(namespaces, *ns)\n\t}\n\tsort.Slice(namespaces, func(i, j int) bool {\n\t\treturn namespaces[i].CPUUsage \u003e namespaces[j].CPUUsage\n\t})\n\n\t// Get alerts summary\n\talertMutex.RLock()\n\talertsSummary := AlertsSummary{}\n\tfor _, alert := range triggeredAlerts {\n\t\talertsSummary.Total++\n\t\tif alert.Resolved {\n\t\t\talertsSummary.Resolved++\n\t\t} else {\n\t\t\talertsSummary.Active++\n\t\t\tswitch alert.Severity {\n\t\t\tcase \"critical\":\n\t\t\t\talertsSummary.Critical++\n\t\t\tcase \"warning\":\n\t\t\t\talertsSummary.Warning++\n\t\t\tcase \"info\":\n\t\t\t\talertsSummary.Info++\n\t\t\t}\n\t\t}\n\t}\n\talertMutex.RUnlock()\n\n\treturn \u0026ClusterMetrics{\n\t\tTimestamp:    time.Now(),\n\t\tSummary:      *summary,\n\t\tNodeMetrics:  nodes,\n\t\tTopPodsByCPU: topCPU,\n\t\tTopPodsByMem: topMem,\n\t\tNamespaces:   namespaces,\n\t\tAlerts:       alertsSummary,\n\t}, nil\n}\n\n// Fetch detailed metrics for a specific node\nfunc fetchNodeDetailedMetrics(nodeName string) (*NodeDetailedMetrics, error) {\n\t// Get node info\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes/\" + nodeName)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node: %v\", err)\n\t}\n\n\tvar node K8sNode\n\tif err := json.Unmarshal(nodeData, \u0026node); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get node metrics\n\tmetricsData, err := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes/\" + nodeName)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get node metrics: %v\", err)\n\t}\n\n\tvar nodeMetric K8sNodeMetric\n\tif err := json.Unmarshal(metricsData, \u0026nodeMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pods on this node\n\tallPods, err := fetchPodMetrics()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tvar nodePods []PodMetrics\n\tfor _, pod := range allPods {\n\t\tif pod.Node == nodeName {\n\t\t\tnodePods = append(nodePods, pod)\n\t\t}\n\t}\n\n\t// Calculate metrics\n\tallocatableCPU := parseCPU(node.Status.Allocatable.CPU)\n\tallocatableMem := parseMemory(node.Status.Allocatable.Memory)\n\tcpuUsed := parseCPU(nodeMetric.Usage.CPU)\n\tmemUsed := parseMemory(nodeMetric.Usage.Memory)\n\n\tcpuPct := 0.0\n\tif allocatableCPU \u003e 0 {\n\t\tcpuPct = (cpuUsed / allocatableCPU) * 100\n\t}\n\tmemPct := 0.0\n\tif allocatableMem \u003e 0 {\n\t\tmemPct = (memUsed / allocatableMem) * 100\n\t}\n\n\t// Get status\n\tstatus := \"NotReady\"\n\tvar conditions []NodeCondition\n\tfor _, cond := range node.Status.Conditions {\n\t\tconditions = append(conditions, NodeCondition{\n\t\t\tType:    cond.Type,\n\t\t\tStatus:  cond.Status,\n\t\t\tMessage: cond.Message,\n\t\t})\n\t\tif cond.Type == \"Ready\" \u0026\u0026 cond.Status == \"True\" {\n\t\t\tstatus = \"Ready\"\n\t\t}\n\t}\n\n\t// Get taints\n\tvar taints []string\n\tfor _, taint := range node.Spec.Taints {\n\t\ttaints = append(taints, fmt.Sprintf(\"%s=%s:%s\", taint.Key, taint.Value, taint.Effect))\n\t}\n\n\t// Get history from memory\n\thistoryMutex.RLock()\n\tcpuHistory := metricsHistory[\"node_cpu_\"+nodeName]\n\tmemHistory := metricsHistory[\"node_mem_\"+nodeName]\n\thistoryMutex.RUnlock()\n\n\t// Parse capacity values\n\tallocPods, _ := strconv.Atoi(node.Status.Allocatable.Pods)\n\tcapPods, _ := strconv.Atoi(node.Status.Capacity.Pods)\n\tallocStorage := parseMemory(node.Status.Allocatable.Storage) / 1024 // to GB\n\tcapStorage := parseMemory(node.Status.Capacity.Storage) / 1024\n\n\treturn \u0026NodeDetailedMetrics{\n\t\tNodeMetrics: NodeMetrics{\n\t\t\tName:      nodeName,\n\t\t\tCPUCores:  cpuUsed,\n\t\t\tCPUPct:    cpuPct,\n\t\t\tMemoryMB:  memUsed,\n\t\t\tMemoryPct: memPct,\n\t\t\tPods:      len(nodePods),\n\t\t\tStatus:    status,\n\t\t},\n\t\tAllocatable: ResourceCapacity{\n\t\t\tCPU:     allocatableCPU,\n\t\t\tMemory:  allocatableMem,\n\t\t\tPods:    allocPods,\n\t\t\tStorage: allocStorage,\n\t\t},\n\t\tCapacity: ResourceCapacity{\n\t\t\tCPU:     parseCPU(node.Status.Capacity.CPU),\n\t\t\tMemory:  parseMemory(node.Status.Capacity.Memory),\n\t\t\tPods:    capPods,\n\t\t\tStorage: capStorage,\n\t\t},\n\t\tConditions:    conditions,\n\t\tPods:          nodePods,\n\t\tCPUHistory:    cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        node.Metadata.Labels,\n\t\tTaints:        taints,\n\t}, nil\n}\n\n// Fetch detailed metrics for a specific pod\nfunc fetchPodDetailedMetrics(namespace, podName string) (*PodDetailedMetrics, error) {\n\t// Get pod info\n\tpodData, err := k8sAPIRequest(fmt.Sprintf(\"/api/v1/namespaces/%s/pods/%s\", namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get pod: %v\", err)\n\t}\n\n\tvar pod K8sPod\n\tif err := json.Unmarshal(podData, \u0026pod); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Get pod metrics\n\tmetricsData, err := k8sAPIRequest(fmt.Sprintf(\"/apis/metrics.k8s.io/v1beta1/namespaces/%s/pods/%s\", namespace, podName))\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get pod metrics: %v\", err)\n\t}\n\n\tvar podMetric K8sPodMetric\n\tif err := json.Unmarshal(metricsData, \u0026podMetric); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Build container metrics\n\tvar containers []ContainerMetrics\n\tvar totalCPU, totalMem float64\n\ttotalRestarts := 0\n\n\tcontainerUsage := make(map[string]struct{ cpu, mem float64 })\n\tfor _, c := range podMetric.Containers {\n\t\tcpu := parseCPU(c.Usage.CPU)\n\t\tmem := parseMemory(c.Usage.Memory)\n\t\tcontainerUsage[c.Name] = struct{ cpu, mem float64 }{cpu, mem}\n\t\ttotalCPU += cpu\n\t\ttotalMem += mem\n\t}\n\n\tfor _, cs := range pod.Status.ContainerStatuses {\n\t\tusage := containerUsage[cs.Name]\n\t\tstate := \"unknown\"\n\t\tif cs.State.Running != nil {\n\t\t\tstate = \"running\"\n\t\t} else if cs.State.Waiting != nil {\n\t\t\tstate = \"waiting: \" + cs.State.Waiting.Reason\n\t\t} else if cs.State.Terminated != nil {\n\t\t\tstate = \"terminated: \" + cs.State.Terminated.Reason\n\t\t}\n\n\t\tcontainers = append(containers, ContainerMetrics{\n\t\t\tName:         cs.Name,\n\t\t\tCPUm:         usage.cpu,\n\t\t\tMemoryMB:     usage.mem,\n\t\t\tRestartCount: cs.RestartCount,\n\t\t\tReady:        cs.Ready,\n\t\t\tState:        state,\n\t\t})\n\t\ttotalRestarts += cs.RestartCount\n\t}\n\n\t// Get deployment name\n\tdeployment := \"\"\n\tfor _, owner := range pod.Metadata.OwnerReferences {\n\t\tif owner.Kind == \"ReplicaSet\" {\n\t\t\tparts := strings.Split(owner.Name, \"-\")\n\t\t\tif len(parts) \u003e 1 {\n\t\t\t\tdeployment = strings.Join(parts[:len(parts)-1], \"-\")\n\t\t\t}\n\t\t}\n\t}\n\n\t// Parse start time\n\tstartTime, _ := time.Parse(time.RFC3339, pod.Status.StartTime)\n\n\t// Get history from memory (if we stored pod-level history)\n\thistoryMutex.RLock()\n\tcpuKey := fmt.Sprintf(\"pod_cpu_%s_%s\", namespace, podName)\n\tmemKey := fmt.Sprintf(\"pod_mem_%s_%s\", namespace, podName)\n\tcpuHistory := metricsHistory[cpuKey]\n\tmemHistory := metricsHistory[memKey]\n\thistoryMutex.RUnlock()\n\n\treturn \u0026PodDetailedMetrics{\n\t\tPodMetrics: PodMetrics{\n\t\t\tName:       podName,\n\t\t\tNamespace:  namespace,\n\t\t\tNode:       pod.Spec.NodeName,\n\t\t\tCPUm:       totalCPU,\n\t\t\tMemoryMB:   totalMem,\n\t\t\tStatus:     pod.Status.Phase,\n\t\t\tDeployment: deployment,\n\t\t},\n\t\tContainers:    containers,\n\t\tRestartCount:  totalRestarts,\n\t\tStartTime:     startTime,\n\t\tCPUHistory:    cpuHistory,\n\t\tMemoryHistory: memHistory,\n\t\tLabels:        pod.Metadata.Labels,\n\t}, nil\n}\n\n// HTTP Handlers for new endpoints\n\nfunc handleClusterMetrics(w http.ResponseWriter, r *http.Request) {\n\tmetrics, err := fetchClusterMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(metrics)\n}\n\nfunc handleNodeDetails(w http.ResponseWriter, r *http.Request) {\n\t// Extract node name from path\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/nodes/\")\n\tnodeName := strings.Split(path, \"/\")[0]\n\n\tif nodeName == \"\" {\n\t\t// List all nodes\n\t\thandleNodes(w, r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchNodeDetailedMetrics(nodeName)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handlePodDetails(w http.ResponseWriter, r *http.Request) {\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tpodName := r.URL.Query().Get(\"name\")\n\n\t// Also support path-based: /api/pods/namespace/name\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/pods/\")\n\tparts := strings.Split(path, \"/\")\n\tif len(parts) \u003e= 2 \u0026\u0026 namespace == \"\" {\n\t\tnamespace = parts[0]\n\t\tpodName = parts[1]\n\t}\n\n\tif namespace == \"\" || podName == \"\" {\n\t\t// List all pods\n\t\thandlePods(w, r)\n\t\treturn\n\t}\n\n\tdetails, err := fetchPodDetailedMetrics(namespace, podName)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(details)\n}\n\nfunc handleUnifiedAlerts(w http.ResponseWriter, r *http.Request) {\n\tswitch r.Method {\n\tcase \"GET\":\n\t\talertMutex.RLock()\n\t\tdefer alertMutex.RUnlock()\n\n\t\tsummary := AlertsSummary{}\n\t\tfor _, alert := range triggeredAlerts {\n\t\t\tsummary.Total++\n\t\t\tif alert.Resolved {\n\t\t\t\tsummary.Resolved++\n\t\t\t} else {\n\t\t\t\tsummary.Active++\n\t\t\t\tswitch alert.Severity {\n\t\t\t\tcase \"critical\":\n\t\t\t\t\tsummary.Critical++\n\t\t\t\tcase \"warning\":\n\t\t\t\t\tsummary.Warning++\n\t\t\t\tcase \"info\":\n\t\t\t\t\tsummary.Info++\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tresponse := AlertsResponse{\n\t\t\tRules:     alertRules,\n\t\t\tTriggered: triggeredAlerts,\n\t\t\tSummary:   summary,\n\t\t}\n\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(response)\n\n\tcase \"POST\":\n\t\thandleCreateAlertRule(w, r)\n\n\tcase \"DELETE\":\n\t\thandleDeleteAlertRule(w, r)\n\n\tdefault:\n\t\thttp.Error(w, \"method not allowed\", http.StatusMethodNotAllowed)\n\t}\n}\n\nfunc handleAcknowledgeAlert(w http.ResponseWriter, r *http.Request) {\n\tid := r.URL.Query().Get(\"id\")\n\tif id == \"\" {\n\t\thttp.Error(w, \"missing id parameter\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\talertMutex.Lock()\n\tdefer alertMutex.Unlock()\n\n\tfor i, alert := range triggeredAlerts {\n\t\tif alert.ID == id {\n\t\t\ttriggeredAlerts[i].Acknowledged = true\n\t\t\tw.WriteHeader(http.StatusNoContent)\n\t\t\treturn\n\t\t}\n\t}\n\n\thttp.Error(w, \"alert not found\", http.StatusNotFound)\n}\n\nfunc handleHistoryExtended(w http.ResponseWriter, r *http.Request) {\n\tmetric := r.URL.Query().Get(\"metric\")\n\trangeParam := r.URL.Query().Get(\"range\")\n\tnode := r.URL.Query().Get(\"node\")\n\tnamespace := r.URL.Query().Get(\"namespace\")\n\tpod := r.URL.Query().Get(\"pod\")\n\tresolution := r.URL.Query().Get(\"resolution\")\n\n\tif rangeParam == \"\" {\n\t\trangeParam = \"1h\"\n\t}\n\n\tvar duration time.Duration\n\tswitch rangeParam {\n\tcase \"5m\":\n\t\tduration = 5 * time.Minute\n\tcase \"15m\":\n\t\tduration = 15 * time.Minute\n\tcase \"30m\":\n\t\tduration = 30 * time.Minute\n\tcase \"1h\":\n\t\tduration = time.Hour\n\tcase \"6h\":\n\t\tduration = 6 * time.Hour\n\tcase \"24h\":\n\t\tduration = 24 * time.Hour\n\tcase \"7d\":\n\t\tduration = 7 * 24 * time.Hour\n\tcase \"30d\":\n\t\tduration = 30 * 24 * time.Hour\n\tdefault:\n\t\tduration = time.Hour\n\t}\n\n\tcutoff := time.Now().Add(-duration)\n\tend := time.Now()\n\n\t// Determine resolution if not specified\n\tif resolution == \"\" {\n\t\tswitch {\n\t\tcase duration \u003c= 30*time.Minute:\n\t\t\tresolution = \"10s\"\n\t\tcase duration \u003c= time.Hour:\n\t\t\tresolution = \"30s\"\n\t\tcase duration \u003c= 6*time.Hour:\n\t\t\tresolution = \"1m\"\n\t\tcase duration \u003c= 24*time.Hour:\n\t\t\tresolution = \"5m\"\n\t\tdefault:\n\t\t\tresolution = \"15m\"\n\t\t}\n\t}\n\n\t// Try Prometheus first for longer ranges\n\tif duration \u003e time.Hour {\n\t\tpromData, err := getPrometheusHistory(metric, node, duration)\n\t\tif err == nil \u0026\u0026 len(promData) \u003e 0 {\n\t\t\tresponse := HistoricalData{\n\t\t\t\tMetric:     metric,\n\t\t\t\tNode:       node,\n\t\t\t\tNamespace:  namespace,\n\t\t\t\tPod:        pod,\n\t\t\t\tResolution: resolution,\n\t\t\t\tStart:      cutoff,\n\t\t\t\tEnd:        end,\n\t\t\t\tPoints:     promData,\n\t\t\t}\n\t\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\t\tjson.NewEncoder(w).Encode(response)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// Fall back to in-memory history\n\thistoryMutex.RLock()\n\tdefer historyMutex.RUnlock()\n\n\tvar key string\n\tif pod != \"\" \u0026\u0026 namespace != \"\" {\n\t\tkey = fmt.Sprintf(\"pod_%s_%s_%s\", metric, namespace, pod)\n\t} else if node != \"\" \u0026\u0026 node != \"*\" {\n\t\tkey = metric + \"_\" + node\n\t} else {\n\t\tkey = metric\n\t}\n\n\tvar points []MetricPoint\n\tif history, ok := metricsHistory[key]; ok {\n\t\tfor _, p := range history {\n\t\t\tif p.Timestamp.After(cutoff) {\n\t\t\t\tpoints = append(points, p)\n\t\t\t}\n\t\t}\n\t}\n\n\tresponse := HistoricalData{\n\t\tMetric:     metric,\n\t\tNode:       node,\n\t\tNamespace:  namespace,\n\t\tPod:        pod,\n\t\tResolution: resolution,\n\t\tStart:      cutoff,\n\t\tEnd:        end,\n\t\tPoints:     points,\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\n// Legacy API compatibility\nfunc handleLegacyMetrics(w http.ResponseWriter, r *http.Request) {\n\tnodes, err := fetchNodeMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar cpuPoints, memPoints, reqPoints []map[string]interface{}\n\tnow := time.Now()\n\n\t// Generate some historical-looking data points\n\tfor i := 0; i \u003c 20; i++ {\n\t\tts := now.Add(time.Duration(-i*5) * time.Second)\n\n\t\tvar totalCPU, totalMem float64\n\t\tfor _, node := range nodes {\n\t\t\ttotalCPU += node.CPUPct\n\t\t\ttotalMem += node.MemoryPct\n\t\t}\n\t\tavgCPU := totalCPU / float64(len(nodes))\n\t\tavgMem := totalMem / float64(len(nodes))\n\n\t\tcpuPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":      \"cpu_usage\",\n\t\t\t\"value\":     avgCPU,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}}, cpuPoints...)\n\n\t\tmemPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":      \"memory_usage\",\n\t\t\t\"value\":     avgMem,\n\t\t\t\"unit\":      \"percent\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}}, memPoints...)\n\n\t\treqPoints = append([]map[string]interface{}{{\n\t\t\t\"name\":      \"requests\",\n\t\t\t\"value\":     float64(100 + i*5),\n\t\t\t\"unit\":      \"req/s\",\n\t\t\t\"timestamp\": ts.Format(time.RFC3339Nano),\n\t\t}}, reqPoints...)\n\t}\n\n\tresponse := map[string]interface{}{\n\t\t\"cpu\":      cpuPoints,\n\t\t\"memory\":   memPoints,\n\t\t\"requests\": reqPoints,\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(response)\n}\n\nfunc handleLegacyServices(w http.ResponseWriter, r *http.Request) {\n\tdeployments, err := fetchDeploymentMetrics()\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar services []map[string]string\n\tfor _, deploy := range deployments {\n\t\tif deploy.Namespace != \"holm\" {\n\t\t\tcontinue\n\t\t}\n\t\tstatus := \"healthy\"\n\t\tif deploy.Ready \u003c deploy.Replicas {\n\t\t\tstatus = \"unhealthy\"\n\t\t}\n\t\tservices = append(services, map[string]string{\n\t\t\t\"name\":      deploy.Name,\n\t\t\t\"namespace\": deploy.Namespace,\n\t\t\t\"status\":    status,\n\t\t\t\"endpoint\":  fmt.Sprintf(\"http://%s:8080\", deploy.Name),\n\t\t})\n\t}\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(services)\n}\n\nfunc main() {\n\t// Start metrics collection\n\tgo recordMetrics()\n\n\t// Initialize default alert rules\n\talertRules = []AlertRule{\n\t\t{ID: \"default-1\", Name: \"Critical CPU\", Metric: \"cpu\", Condition: \"\u003e\", Threshold: 95, Node: \"*\", Severity: \"critical\", Duration: 60, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-2\", Name: \"High CPU\", Metric: \"cpu\", Condition: \"\u003e\", Threshold: 85, Node: \"*\", Severity: \"warning\", Duration: 120, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-3\", Name: \"Critical Memory\", Metric: \"memory\", Condition: \"\u003e\", Threshold: 95, Node: \"*\", Severity: \"critical\", Duration: 60, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-4\", Name: \"High Memory\", Metric: \"memory\", Condition: \"\u003e\", Threshold: 85, Node: \"*\", Severity: \"warning\", Duration: 120, Enabled: true, Created: time.Now()},\n\t\t{ID: \"default-5\", Name: \"Node Not Ready\", Metric: \"cpu\", Condition: \"\u003c\", Threshold: 0, Node: \"*\", Severity: \"critical\", Duration: 30, Enabled: false, Created: time.Now()},\n\t}\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t// API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\n\t// Cluster-wide metrics (new comprehensive endpoint)\n\tmux.HandleFunc(\"/api/metrics\", handleClusterMetrics)\n\n\t// Node endpoints with detail support\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/nodes/\", handleNodeDetails) // /api/nodes/{name} for details\n\n\t// Pod endpoints with detail support\n\tmux.HandleFunc(\"/api/pods\", handlePods)\n\tmux.HandleFunc(\"/api/pods/\", handlePodDetails) // /api/pods/{namespace}/{name} for details\n\n\t// Deployments\n\tmux.HandleFunc(\"/api/deployments\", handleDeployments)\n\n\t// Cluster summary\n\tmux.HandleFunc(\"/api/cluster\", handleClusterSummary)\n\n\t// Historical data (enhanced)\n\tmux.HandleFunc(\"/api/history\", handleHistoryExtended)\n\n\t// Unified alerts endpoint\n\tmux.HandleFunc(\"/api/alerts\", handleUnifiedAlerts)\n\n\t// Alert management endpoints\n\tmux.HandleFunc(\"/api/alerts/rules\", func(w http.ResponseWriter, r *http.Request) {\n\t\tswitch r.Method {\n\t\tcase \"GET\":\n\t\t\thandleAlertRules(w, r)\n\t\tcase \"POST\":\n\t\t\thandleCreateAlertRule(w, r)\n\t\tcase \"DELETE\":\n\t\t\thandleDeleteAlertRule(w, r)\n\t\tdefault:\n\t\t\thttp.Error(w, \"method not allowed\", http.StatusMethodNotAllowed)\n\t\t}\n\t})\n\tmux.HandleFunc(\"/api/alerts/triggered\", handleTriggeredAlerts)\n\tmux.HandleFunc(\"/api/alerts/resolve\", handleResolveAlert)\n\tmux.HandleFunc(\"/api/alerts/acknowledge\", handleAcknowledgeAlert)\n\n\t// Legacy API for backward compatibility\n\tmux.HandleFunc(\"/api/metrics/legacy\", handleLegacyMetrics)\n\tmux.HandleFunc(\"/api/services\", handleLegacyServices)\n\n\t// Serve dashboard\n\tmux.HandleFunc(\"/\", serveDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tlog.Printf(\"Starting Metrics Dashboard on port %s\", port)\n\tlog.Fatal(http.ListenAndServe(\":\"+port, mux))\n}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"metrics-dashboard-src","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:06:55Z"
    name: metrics-dashboard-src
    namespace: holm
    resourceVersion: "751"
    uid: 54484714-226a-4d08-a681-b4ac009d5ac5
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder

      WORKDIR /app

      # Copy go mod files
      COPY go.mod go.sum ./

      # Download dependencies
      RUN go mod download

      # Copy source files
      COPY *.go ./

      # Build the binary for ARM64
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o pulse .

      # Final image
      FROM alpine:3.19

      RUN apk --no-cache add ca-certificates tzdata

      WORKDIR /app

      COPY --from=builder /app/pulse .

      EXPOSE 8080

      # Health check
      HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
          CMD wget --no-verbose --tries=1 --spider http://localhost:8080/health || exit 1

      CMD ["./pulse"]
    dashboard.go: "package main\n\nfunc getDashboardHTML() string {\n\treturn `<!DOCTYPE
      html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"
      content=\"width=device-width, initial-scale=1.0\">\n    <title>Pulse - Cluster
      Health Monitor</title>\n    <style>\n        /* Catppuccin Mocha Theme */\n
      \       :root {\n            --ctp-rosewater: #f5e0dc;\n            --ctp-flamingo:
      #f2cdcd;\n            --ctp-pink: #f5c2e7;\n            --ctp-mauve: #cba6f7;\n
      \           --ctp-red: #f38ba8;\n            --ctp-maroon: #eba0ac;\n            --ctp-peach:
      #fab387;\n            --ctp-yellow: #f9e2af;\n            --ctp-green: #a6e3a1;\n
      \           --ctp-teal: #94e2d5;\n            --ctp-sky: #89dceb;\n            --ctp-sapphire:
      #74c7ec;\n            --ctp-blue: #89b4fa;\n            --ctp-lavender: #b4befe;\n
      \           --ctp-text: #cdd6f4;\n            --ctp-subtext1: #bac2de;\n            --ctp-subtext0:
      #a6adc8;\n            --ctp-overlay2: #9399b2;\n            --ctp-overlay1:
      #7f849c;\n            --ctp-overlay0: #6c7086;\n            --ctp-surface2:
      #585b70;\n            --ctp-surface1: #45475a;\n            --ctp-surface0:
      #313244;\n            --ctp-base: #1e1e2e;\n            --ctp-mantle: #181825;\n
      \           --ctp-crust: #11111b;\n        }\n\n        * {\n            margin:
      0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n
      \       body {\n            font-family: -apple-system, BlinkMacSystemFont,
      'Segoe UI', Roboto, 'Inter', sans-serif;\n            background: var(--ctp-base);\n
      \           color: var(--ctp-text);\n            min-height: 100vh;\n            line-height:
      1.5;\n        }\n\n        /* Header */\n        .header {\n            background:
      var(--ctp-mantle);\n            border-bottom: 1px solid var(--ctp-surface0);\n
      \           padding: 16px 24px;\n            position: sticky;\n            top:
      0;\n            z-index: 100;\n        }\n\n        .header-content {\n            max-width:
      1600px;\n            margin: 0 auto;\n            display: flex;\n            justify-content:
      space-between;\n            align-items: center;\n        }\n\n        .header-left
      {\n            display: flex;\n            align-items: center;\n            gap:
      16px;\n        }\n\n        .logo {\n            width: 40px;\n            height:
      40px;\n            background: linear-gradient(135deg, var(--ctp-red) 0%, var(--ctp-pink)
      100%);\n            border-radius: 12px;\n            display: flex;\n            align-items:
      center;\n            justify-content: center;\n            font-size: 20px;\n
      \           animation: pulse-glow 2s ease-in-out infinite;\n        }\n\n        @keyframes
      pulse-glow {\n            0%, 100% { box-shadow: 0 0 20px rgba(243, 139, 168,
      0.3); }\n            50% { box-shadow: 0 0 30px rgba(243, 139, 168, 0.5); }\n
      \       }\n\n        .header-title h1 {\n            font-size: 20px;\n            font-weight:
      600;\n            color: var(--ctp-text);\n        }\n\n        .header-title
      p {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .header-right {\n            display: flex;\n            align-items:
      center;\n            gap: 16px;\n        }\n\n        .status-indicator {\n
      \           display: flex;\n            align-items: center;\n            gap:
      8px;\n            padding: 8px 16px;\n            background: var(--ctp-surface0);\n
      \           border-radius: 20px;\n            font-size: 13px;\n            font-weight:
      500;\n        }\n\n        .status-dot {\n            width: 10px;\n            height:
      10px;\n            border-radius: 50%;\n            animation: pulse-dot 2s
      ease-in-out infinite;\n        }\n\n        .status-dot.healthy { background:
      var(--ctp-green); }\n        .status-dot.warning { background: var(--ctp-yellow);
      }\n        .status-dot.degraded { background: var(--ctp-peach); }\n        .status-dot.critical
      { background: var(--ctp-red); }\n        .status-dot.unknown { background: var(--ctp-overlay0);
      }\n\n        @keyframes pulse-dot {\n            0%, 100% { opacity: 1; transform:
      scale(1); }\n            50% { opacity: 0.7; transform: scale(1.1); }\n        }\n\n
      \       .connection-status {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n            display: flex;\n            align-items: center;\n
      \           gap: 6px;\n        }\n\n        .connection-status.connected { color:
      var(--ctp-green); }\n        .connection-status.disconnected { color: var(--ctp-red);
      }\n\n        /* Main Content */\n        .main {\n            max-width: 1600px;\n
      \           margin: 0 auto;\n            padding: 24px;\n        }\n\n        /*
      Health Score Card */\n        .health-score-card {\n            background:
      linear-gradient(135deg, var(--ctp-mantle) 0%, var(--ctp-surface0) 100%);\n            border-radius:
      20px;\n            padding: 32px;\n            margin-bottom: 24px;\n            border:
      1px solid var(--ctp-surface1);\n            display: flex;\n            justify-content:
      space-between;\n            align-items: center;\n            flex-wrap: wrap;\n
      \           gap: 24px;\n        }\n\n        .health-score-main {\n            display:
      flex;\n            align-items: center;\n            gap: 24px;\n        }\n\n
      \       .score-circle {\n            width: 120px;\n            height: 120px;\n
      \           position: relative;\n        }\n\n        .score-circle svg {\n
      \           width: 100%;\n            height: 100%;\n            transform:
      rotate(-90deg);\n        }\n\n        .score-circle .bg {\n            stroke:
      var(--ctp-surface1);\n        }\n\n        .score-circle .progress {\n            stroke-linecap:
      round;\n            transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;\n
      \       }\n\n        .score-circle .progress.healthy { stroke: var(--ctp-green);
      }\n        .score-circle .progress.warning { stroke: var(--ctp-yellow); }\n
      \       .score-circle .progress.degraded { stroke: var(--ctp-peach); }\n        .score-circle
      .progress.critical { stroke: var(--ctp-red); }\n\n        .score-value {\n            position:
      absolute;\n            top: 50%;\n            left: 50%;\n            transform:
      translate(-50%, -50%);\n            font-size: 32px;\n            font-weight:
      700;\n        }\n\n        .health-info h2 {\n            font-size: 28px;\n
      \           font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n
      \       .health-info p {\n            font-size: 15px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .health-info .message {\n            color: var(--ctp-green);\n
      \           font-weight: 500;\n            margin-top: 8px;\n        }\n\n        .health-info
      .message.warning { color: var(--ctp-yellow); }\n        .health-info .message.degraded
      { color: var(--ctp-peach); }\n        .health-info .message.critical { color:
      var(--ctp-red); }\n\n        .vital-signs {\n            display: flex;\n            gap:
      12px;\n            flex-wrap: wrap;\n        }\n\n        .vital-sign {\n            background:
      var(--ctp-surface0);\n            padding: 12px 16px;\n            border-radius:
      12px;\n            display: flex;\n            align-items: center;\n            gap:
      8px;\n            font-size: 13px;\n        }\n\n        .vital-sign .icon {
      font-size: 16px; }\n        .vital-sign.healthy .status { color: var(--ctp-green);
      }\n        .vital-sign.unhealthy .status { color: var(--ctp-red); }\n\n        /*
      Grid Layout */\n        .dashboard-grid {\n            display: grid;\n            grid-template-columns:
      repeat(auto-fit, minmax(400px, 1fr));\n            gap: 20px;\n            margin-bottom:
      24px;\n        }\n\n        @media (max-width: 900px) {\n            .dashboard-grid
      {\n                grid-template-columns: 1fr;\n            }\n        }\n\n
      \       /* Cards */\n        .card {\n            background: var(--ctp-mantle);\n
      \           border-radius: 16px;\n            border: 1px solid var(--ctp-surface0);\n
      \           overflow: hidden;\n        }\n\n        .card-header {\n            padding:
      16px 20px;\n            border-bottom: 1px solid var(--ctp-surface0);\n            display:
      flex;\n            justify-content: space-between;\n            align-items:
      center;\n        }\n\n        .card-title {\n            font-size: 15px;\n
      \           font-weight: 600;\n            display: flex;\n            align-items:
      center;\n            gap: 10px;\n        }\n\n        .card-title .icon {\n
      \           width: 28px;\n            height: 28px;\n            border-radius:
      8px;\n            display: flex;\n            align-items: center;\n            justify-content:
      center;\n            font-size: 14px;\n        }\n\n        .card-title .icon.nodes
      { background: var(--ctp-blue); color: var(--ctp-crust); }\n        .card-title
      .icon.resources { background: var(--ctp-green); color: var(--ctp-crust); }\n
      \       .card-title .icon.pods { background: var(--ctp-mauve); color: var(--ctp-crust);
      }\n        .card-title .icon.alerts { background: var(--ctp-red); color: var(--ctp-crust);
      }\n\n        .card-content {\n            padding: 16px 20px;\n        }\n\n
      \       /* Stats Grid */\n        .stats-grid {\n            display: grid;\n
      \           grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n
      \           margin-bottom: 24px;\n        }\n\n        @media (max-width: 1200px)
      {\n            .stats-grid {\n                grid-template-columns: repeat(2,
      1fr);\n            }\n        }\n\n        .stat-card {\n            background:
      var(--ctp-mantle);\n            border-radius: 16px;\n            padding: 20px;\n
      \           border: 1px solid var(--ctp-surface0);\n        }\n\n        .stat-card-header
      {\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            margin-bottom: 12px;\n        }\n\n
      \       .stat-label {\n            font-size: 13px;\n            color: var(--ctp-subtext0);\n
      \           text-transform: uppercase;\n            letter-spacing: 0.5px;\n
      \       }\n\n        .stat-icon {\n            width: 32px;\n            height:
      32px;\n            border-radius: 10px;\n            display: flex;\n            align-items:
      center;\n            justify-content: center;\n            font-size: 16px;\n
      \       }\n\n        .stat-icon.blue { background: rgba(137, 180, 250, 0.2);
      color: var(--ctp-blue); }\n        .stat-icon.green { background: rgba(166,
      227, 161, 0.2); color: var(--ctp-green); }\n        .stat-icon.mauve { background:
      rgba(203, 166, 247, 0.2); color: var(--ctp-mauve); }\n        .stat-icon.peach
      { background: rgba(250, 179, 135, 0.2); color: var(--ctp-peach); }\n\n        .stat-value
      {\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom:
      4px;\n        }\n\n        .stat-detail {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        /* Node List */\n        .node-list
      {\n            display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .node-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 12px;\n            padding: 14px 16px;\n            display:
      flex;\n            align-items: center;\n            justify-content: space-between;\n
      \           transition: background 0.2s;\n        }\n\n        .node-item:hover
      {\n            background: var(--ctp-surface1);\n        }\n\n        .node-info
      {\n            display: flex;\n            align-items: center;\n            gap:
      12px;\n        }\n\n        .node-status-dot {\n            width: 10px;\n            height:
      10px;\n            border-radius: 50%;\n        }\n\n        .node-status-dot.ready
      { background: var(--ctp-green); }\n        .node-status-dot.not-ready { background:
      var(--ctp-red); }\n        .node-status-dot.not-joined { background: var(--ctp-overlay0);
      }\n\n        .node-item.not-joined {\n            opacity: 0.7;\n            background:
      var(--ctp-surface0);\n            border: 1px dashed var(--ctp-overlay0);\n
      \       }\n\n        .node-status-badge {\n            font-size: 10px;\n            padding:
      2px 6px;\n            border-radius: 4px;\n            margin-left: 8px;\n            text-transform:
      uppercase;\n            font-weight: 600;\n        }\n\n        .node-status-badge.not-joined
      {\n            background: rgba(108, 112, 134, 0.2);\n            color: var(--ctp-overlay0);\n
      \       }\n\n        .node-name {\n            font-weight: 500;\n            font-size:
      14px;\n        }\n\n        .node-pods {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        .node-metrics {\n            display:
      flex;\n            gap: 16px;\n        }\n\n        .node-metric {\n            text-align:
      right;\n        }\n\n        .node-metric-value {\n            font-size: 13px;\n
      \           font-weight: 600;\n        }\n\n        .node-metric-label {\n            font-size:
      10px;\n            color: var(--ctp-subtext0);\n            text-transform:
      uppercase;\n        }\n\n        /* Resource Bars */\n        .resource-section
      {\n            margin-bottom: 20px;\n        }\n\n        .resource-section:last-child
      {\n            margin-bottom: 0;\n        }\n\n        .resource-header {\n
      \           display: flex;\n            justify-content: space-between;\n            align-items:
      center;\n            margin-bottom: 8px;\n        }\n\n        .resource-label
      {\n            font-size: 13px;\n            font-weight: 500;\n            display:
      flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n
      \       .resource-value {\n            font-size: 13px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        .resource-bar {\n            height:
      8px;\n            background: var(--ctp-surface0);\n            border-radius:
      4px;\n            overflow: hidden;\n        }\n\n        .resource-bar-fill
      {\n            height: 100%;\n            border-radius: 4px;\n            transition:
      width 0.5s ease;\n        }\n\n        .resource-bar-fill.cpu { background:
      linear-gradient(90deg, var(--ctp-blue), var(--ctp-sapphire)); }\n        .resource-bar-fill.memory
      { background: linear-gradient(90deg, var(--ctp-green), var(--ctp-teal)); }\n
      \       .resource-bar-fill.warning { background: linear-gradient(90deg, var(--ctp-yellow),
      var(--ctp-peach)); }\n        .resource-bar-fill.critical { background: linear-gradient(90deg,
      var(--ctp-red), var(--ctp-maroon)); }\n\n        /* Pod Issues */\n        .pod-list
      {\n            display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .pod-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 10px;\n            padding: 12px 14px;\n            display:
      flex;\n            align-items: center;\n            justify-content: space-between;\n
      \       }\n\n        .pod-info {\n            display: flex;\n            align-items:
      center;\n            gap: 10px;\n        }\n\n        .pod-phase {\n            padding:
      3px 8px;\n            border-radius: 6px;\n            font-size: 10px;\n            font-weight:
      600;\n            text-transform: uppercase;\n        }\n\n        .pod-phase.running
      { background: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .pod-phase.pending
      { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .pod-phase.failed
      { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .pod-name
      {\n            font-size: 13px;\n            font-weight: 500;\n        }\n\n
      \       .pod-namespace {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .pod-restarts {\n            font-size: 12px;\n            color:
      var(--ctp-peach);\n        }\n\n        /* Alerts */\n        .alert-list {\n
      \           display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .alert-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 10px;\n            padding: 12px 14px;\n            border-left:
      3px solid;\n        }\n\n        .alert-item.warning { border-color: var(--ctp-yellow);
      }\n        .alert-item.critical { border-color: var(--ctp-red); }\n\n        .alert-header
      {\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            margin-bottom: 4px;\n        }\n\n
      \       .alert-severity {\n            font-size: 10px;\n            font-weight:
      600;\n            text-transform: uppercase;\n            padding: 2px 6px;\n
      \           border-radius: 4px;\n        }\n\n        .alert-severity.warning
      { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .alert-severity.critical
      { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .alert-time
      {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n        }\n\n
      \       .alert-message {\n            font-size: 13px;\n        }\n\n        .alert-node
      {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n            margin-top:
      4px;\n        }\n\n        /* Empty States */\n        .empty-state {\n            text-align:
      center;\n            padding: 32px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .empty-state .icon {\n            font-size: 32px;\n            margin-bottom:
      12px;\n            opacity: 0.5;\n        }\n\n        .empty-state p {\n            font-size:
      14px;\n        }\n\n        /* Last Updated */\n        .last-updated {\n            text-align:
      center;\n            padding: 16px;\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        /* Loading */\n        .loading {\n
      \           display: flex;\n            align-items: center;\n            justify-content:
      center;\n            padding: 48px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .loading-spinner {\n            width: 32px;\n            height:
      32px;\n            border: 3px solid var(--ctp-surface1);\n            border-top-color:
      var(--ctp-mauve);\n            border-radius: 50%;\n            animation: spin
      1s linear infinite;\n            margin-right: 12px;\n        }\n\n        @keyframes
      spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n
      \   <header class=\"header\">\n        <div class=\"header-content\">\n            <div
      class=\"header-left\">\n                <div class=\"logo\">&#128147;</div>\n
      \               <div class=\"header-title\">\n                    <h1>Pulse</h1>\n
      \                   <p>Cluster Health Monitor</p>\n                </div>\n
      \           </div>\n            <div class=\"header-right\">\n                <div
      class=\"status-indicator\">\n                    <span class=\"status-dot\"
      id=\"statusDot\"></span>\n                    <span id=\"statusText\">Connecting...</span>\n
      \               </div>\n                <div class=\"connection-status\" id=\"connectionStatus\">\n
      \                   <span>&#9679;</span>\n                    <span>Connecting...</span>\n
      \               </div>\n            </div>\n        </div>\n    </header>\n\n
      \   <main class=\"main\">\n        <!-- Health Score Card -->\n        <div
      class=\"health-score-card\">\n            <div class=\"health-score-main\">\n
      \               <div class=\"score-circle\">\n                    <svg viewBox=\"0
      0 100 100\">\n                        <circle class=\"bg\" cx=\"50\" cy=\"50\"
      r=\"45\" fill=\"none\" stroke-width=\"8\"/>\n                        <circle
      class=\"progress\" id=\"scoreProgress\" cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\"
      stroke-width=\"8\"\n                            stroke-dasharray=\"283\" stroke-dashoffset=\"283\"/>\n
      \                   </svg>\n                    <div class=\"score-value\" id=\"scoreValue\">--</div>\n
      \               </div>\n                <div class=\"health-info\">\n                    <h2>Health
      Score</h2>\n                    <p>Overall cluster health status</p>\n                    <p
      class=\"message\" id=\"healthMessage\">Loading...</p>\n                </div>\n
      \           </div>\n            <div class=\"vital-signs\" id=\"vitalSigns\">\n
      \               <!-- Vital signs will be populated -->\n            </div>\n
      \       </div>\n\n        <!-- Stats Grid -->\n        <div class=\"stats-grid\">\n
      \           <div class=\"stat-card\">\n                <div class=\"stat-card-header\">\n
      \                   <span class=\"stat-label\">Nodes</span>\n                    <div
      class=\"stat-icon blue\">&#128421;</div>\n                </div>\n                <div
      class=\"stat-value\" id=\"nodeCount\">--</div>\n                <div class=\"stat-detail\"
      id=\"nodeDetail\">-- ready</div>\n            </div>\n            <div class=\"stat-card\">\n
      \               <div class=\"stat-card-header\">\n                    <span
      class=\"stat-label\">Pods</span>\n                    <div class=\"stat-icon
      mauve\">&#128230;</div>\n                </div>\n                <div class=\"stat-value\"
      id=\"podCount\">--</div>\n                <div class=\"stat-detail\" id=\"podDetail\">--
      running</div>\n            </div>\n            <div class=\"stat-card\">\n                <div
      class=\"stat-card-header\">\n                    <span class=\"stat-label\">CPU</span>\n
      \                   <div class=\"stat-icon green\">&#9889;</div>\n                </div>\n
      \               <div class=\"stat-value\" id=\"cpuUsage\">--%</div>\n                <div
      class=\"stat-detail\" id=\"cpuDetail\">-- / -- cores</div>\n            </div>\n
      \           <div class=\"stat-card\">\n                <div class=\"stat-card-header\">\n
      \                   <span class=\"stat-label\">Memory</span>\n                    <div
      class=\"stat-icon peach\">&#128200;</div>\n                </div>\n                <div
      class=\"stat-value\" id=\"memUsage\">--%</div>\n                <div class=\"stat-detail\"
      id=\"memDetail\">-- / -- GB</div>\n            </div>\n        </div>\n\n        <!--
      Dashboard Grid -->\n        <div class=\"dashboard-grid\">\n            <!--
      Nodes Card -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n
      \                   <div class=\"card-title\">\n                        <div
      class=\"icon nodes\">&#128421;</div>\n                        Node Status\n
      \                   </div>\n                </div>\n                <div class=\"card-content\">\n
      \                   <div class=\"node-list\" id=\"nodeList\">\n                        <div
      class=\"loading\">\n                            <div class=\"loading-spinner\"></div>\n
      \                           Loading nodes...\n                        </div>\n
      \                   </div>\n                </div>\n            </div>\n\n            <!--
      Resources Card -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n
      \                   <div class=\"card-title\">\n                        <div
      class=\"icon resources\">&#128200;</div>\n                        Resource Usage\n
      \                   </div>\n                </div>\n                <div class=\"card-content\">\n
      \                   <div class=\"resource-section\">\n                        <div
      class=\"resource-header\">\n                            <span class=\"resource-label\">&#9889;
      CPU Usage</span>\n                            <span class=\"resource-value\"
      id=\"cpuResourceValue\">--%</span>\n                        </div>\n                        <div
      class=\"resource-bar\">\n                            <div class=\"resource-bar-fill
      cpu\" id=\"cpuBar\" style=\"width: 0%\"></div>\n                        </div>\n
      \                   </div>\n                    <div class=\"resource-section\">\n
      \                       <div class=\"resource-header\">\n                            <span
      class=\"resource-label\">&#128190; Memory Usage</span>\n                            <span
      class=\"resource-value\" id=\"memResourceValue\">--%</span>\n                        </div>\n
      \                       <div class=\"resource-bar\">\n                            <div
      class=\"resource-bar-fill memory\" id=\"memBar\" style=\"width: 0%\"></div>\n
      \                       </div>\n                    </div>\n                    <div
      id=\"nodeResources\" style=\"margin-top: 20px;\">\n                        <!--
      Per-node resources will be populated -->\n                    </div>\n                </div>\n
      \           </div>\n\n            <!-- Pod Issues Card -->\n            <div
      class=\"card\">\n                <div class=\"card-header\">\n                    <div
      class=\"card-title\">\n                        <div class=\"icon pods\">&#128230;</div>\n
      \                       Pod Issues\n                    </div>\n                </div>\n
      \               <div class=\"card-content\">\n                    <div class=\"pod-list\"
      id=\"podList\">\n                        <div class=\"empty-state\">\n                            <div
      class=\"icon\">&#10004;</div>\n                            <p>All pods healthy</p>\n
      \                       </div>\n                    </div>\n                </div>\n
      \           </div>\n\n            <!-- Alerts Card -->\n            <div class=\"card\">\n
      \               <div class=\"card-header\">\n                    <div class=\"card-title\">\n
      \                       <div class=\"icon alerts\">&#9888;</div>\n                        Active
      Alerts\n                    </div>\n                </div>\n                <div
      class=\"card-content\">\n                    <div class=\"alert-list\" id=\"alertList\">\n
      \                       <div class=\"empty-state\">\n                            <div
      class=\"icon\">&#10004;</div>\n                            <p>No active alerts</p>\n
      \                       </div>\n                    </div>\n                </div>\n
      \           </div>\n        </div>\n\n        <div class=\"last-updated\">\n
      \           Last updated: <span id=\"lastUpdated\">--</span>\n        </div>\n
      \   </main>\n\n    <script>\n        let ws = null;\n        let reconnectAttempts
      = 0;\n        const maxReconnectAttempts = 10;\n\n        function connectWebSocket()
      {\n            const protocol = window.location.protocol === 'https:' ? 'wss:'
      : 'ws:';\n            const wsUrl = protocol + '//' + window.location.host +
      '/ws';\n\n            ws = new WebSocket(wsUrl);\n\n            // Connection
      timeout - if not connected within 10 seconds, show error\n            const
      connectionTimeout = setTimeout(function() {\n                if (ws.readyState
      !== WebSocket.OPEN) {\n                    console.log('WebSocket connection
      timeout');\n                    ws.close();\n                    showErrorState(new
      Error('WebSocket connection timed out after 10 seconds'));\n                }\n
      \           }, 10000);\n\n            ws.onopen = function() {\n                clearTimeout(connectionTimeout);\n
      \               console.log('WebSocket connected');\n                reconnectAttempts
      = 0;\n                updateConnectionStatus(true);\n            };\n\n            ws.onmessage
      = function(event) {\n                const data = JSON.parse(event.data);\n
      \               if (data.type === 'health_update') {\n                    updateDashboard(data.data);\n
      \               }\n            };\n\n            ws.onclose = function() {\n
      \               clearTimeout(connectionTimeout);\n                console.log('WebSocket
      disconnected');\n                updateConnectionStatus(false);\n                scheduleReconnect();\n
      \           };\n\n            ws.onerror = function(error) {\n                clearTimeout(connectionTimeout);\n
      \               console.error('WebSocket error:', error);\n                showErrorState(new
      Error('WebSocket connection failed'));\n            };\n        }\n\n        function
      scheduleReconnect() {\n            if (reconnectAttempts < maxReconnectAttempts)
      {\n                reconnectAttempts++;\n                const delay = Math.min(1000
      * Math.pow(2, reconnectAttempts), 30000);\n                console.log('Reconnecting
      in ' + delay + 'ms...');\n                setTimeout(connectWebSocket, delay);\n
      \           }\n        }\n\n        function updateConnectionStatus(connected)
      {\n            const el = document.getElementById('connectionStatus');\n            if
      (connected) {\n                el.className = 'connection-status connected';\n
      \               el.innerHTML = '<span>&#9679;</span><span>Live</span>';\n            }
      else {\n                el.className = 'connection-status disconnected';\n                el.innerHTML
      = '<span>&#9679;</span><span>Disconnected</span>';\n            }\n        }\n\n
      \       function updateDashboard(health) {\n            // Update status indicator\n
      \           const statusDot = document.getElementById('statusDot');\n            const
      statusText = document.getElementById('statusText');\n            statusDot.className
      = 'status-dot ' + health.status;\n            statusText.textContent = health.status.charAt(0).toUpperCase()
      + health.status.slice(1);\n\n            // Update health score\n            const
      score = health.health_score || 0;\n            const scoreValue = document.getElementById('scoreValue');\n
      \           const scoreProgress = document.getElementById('scoreProgress');\n
      \           const healthMessage = document.getElementById('healthMessage');\n\n
      \           scoreValue.textContent = score;\n            const circumference
      = 2 * Math.PI * 45;\n            const offset = circumference - (score / 100)
      * circumference;\n            scoreProgress.style.strokeDashoffset = offset;\n
      \           scoreProgress.className = 'progress ' + health.status;\n\n            healthMessage.textContent
      = health.message || 'Loading...';\n            healthMessage.className = 'message
      ' + health.status;\n\n            // Update vital signs\n            const vitalSigns
      = document.getElementById('vitalSigns');\n            if (health.vital_signs)
      {\n                const vitals = health.vital_signs;\n                vitalSigns.innerHTML
      = '' +\n                    createVitalSign('&#128147;', 'Heartbeat', vitals.heartbeat
      || 'unknown') +\n                    createVitalSign('&#9881;', 'API Server',
      vitals.api_server_status || 'unknown') +\n                    createVitalSign('&#128190;',
      'etcd', vitals.etcd_status || 'unknown') +\n                    createVitalSign('&#128197;',
      'Scheduler', vitals.scheduler_status || 'unknown') +\n                    createVitalSign('&#127760;',
      'DNS', vitals.dns_status || 'unknown');\n            }\n\n            // Update
      stats\n            const ch = health.cluster_health || {};\n            document.getElementById('nodeCount').textContent
      = ch.total_nodes || 0;\n            document.getElementById('nodeDetail').textContent
      = (ch.ready_nodes || 0) + ' ready';\n            document.getElementById('podCount').textContent
      = ch.total_pods || 0;\n            document.getElementById('podDetail').textContent
      = (ch.running_pods || 0) + ' running, ' + (ch.pending_pods || 0) + ' pending';\n\n
      \           const cpuPct = Math.round(ch.cpu_percent || 0);\n            document.getElementById('cpuUsage').textContent
      = cpuPct + '%';\n            document.getElementById('cpuDetail').textContent
      = ((ch.used_cpu_cores || 0) / 1000).toFixed(1) + ' / ' + ((ch.total_cpu_cores
      || 0) / 1000).toFixed(1) + ' cores';\n\n            const memPct = Math.round(ch.memory_percent
      || 0);\n            document.getElementById('memUsage').textContent = memPct
      + '%';\n            document.getElementById('memDetail').textContent = (ch.used_memory_gb
      || 0).toFixed(1) + ' / ' + (ch.total_memory_gb || 0).toFixed(1) + ' GB';\n\n
      \           // Update resource bars\n            document.getElementById('cpuResourceValue').textContent
      = cpuPct + '%';\n            document.getElementById('cpuBar').style.width =
      cpuPct + '%';\n            updateBarColor('cpuBar', cpuPct);\n\n            document.getElementById('memResourceValue').textContent
      = memPct + '%';\n            document.getElementById('memBar').style.width =
      memPct + '%';\n            updateBarColor('memBar', memPct);\n\n            //
      Update node list\n            const nodeList = document.getElementById('nodeList');\n
      \           if (health.node_statuses && health.node_statuses.length > 0) {\n
      \               nodeList.innerHTML = health.node_statuses.map(node => {\n                    const
      isNotJoined = node.status === 'NotJoined';\n                    const statusClass
      = node.ready ? 'ready' : (isNotJoined ? 'not-joined' : 'not-ready');\n                    const
      itemClass = isNotJoined ? 'node-item not-joined' : 'node-item';\n                    const
      statusBadge = isNotJoined ? '<span class=\"node-status-badge not-joined\">Not
      Joined</span>' : '';\n                    const metricsDisplay = isNotJoined
      ? '--' : Math.round(node.cpu_percent) + '%';\n                    const memDisplay
      = isNotJoined ? '--' : Math.round(node.memory_percent) + '%';\n                    return
      '<div class=\"' + itemClass + '\">' +\n                        '<div class=\"node-info\">'
      +\n                            '<div class=\"node-status-dot ' + statusClass
      + '\"></div>' +\n                            '<div>' +\n                                '<div
      class=\"node-name\">' + node.name + statusBadge + '</div>' +\n                                '<div
      class=\"node-pods\">' + (isNotJoined ? 'Not in cluster' : node.pod_count + '
      pods') + '</div>' +\n                            '</div>' +\n                        '</div>'
      +\n                        '<div class=\"node-metrics\">' +\n                            '<div
      class=\"node-metric\">' +\n                                '<div class=\"node-metric-value\">'
      + metricsDisplay + '</div>' +\n                                '<div class=\"node-metric-label\">CPU</div>'
      +\n                            '</div>' +\n                            '<div
      class=\"node-metric\">' +\n                                '<div class=\"node-metric-value\">'
      + memDisplay + '</div>' +\n                                '<div class=\"node-metric-label\">Memory</div>'
      +\n                            '</div>' +\n                        '</div>'
      +\n                    '</div>';\n                }).join('');\n\n                //
      Update per-node resources\n                const nodeResources = document.getElementById('nodeResources');\n
      \               nodeResources.innerHTML = health.node_statuses.map(node => {\n
      \                   const isNotJoined = node.status === 'NotJoined';\n                    if
      (isNotJoined) {\n                        return '<div class=\"resource-section\"
      style=\"opacity: 0.5;\">' +\n                            '<div class=\"resource-header\">'
      +\n                                '<span class=\"resource-label\">' + node.name
      + '</span>' +\n                                '<span class=\"resource-value\"
      style=\"color: var(--ctp-overlay0);\">Not Joined</span>' +\n                            '</div>'
      +\n                            '<div style=\"display: flex; gap: 8px;\">' +\n
      \                               '<div class=\"resource-bar\" style=\"flex: 1;
      border: 1px dashed var(--ctp-overlay0);\">' +\n                                '</div>'
      +\n                                '<div class=\"resource-bar\" style=\"flex:
      1; border: 1px dashed var(--ctp-overlay0);\">' +\n                                '</div>'
      +\n                            '</div>' +\n                        '</div>';\n
      \                   }\n                    const cpuClass = getResourceClass(node.cpu_percent);\n
      \                   const memClass = getResourceClass(node.memory_percent);\n
      \                   return '<div class=\"resource-section\">' +\n                        '<div
      class=\"resource-header\">' +\n                            '<span class=\"resource-label\">'
      + node.name + '</span>' +\n                            '<span class=\"resource-value\">'
      + Math.round(node.cpu_percent) + '% / ' + Math.round(node.memory_percent) +
      '%</span>' +\n                        '</div>' +\n                        '<div
      style=\"display: flex; gap: 8px;\">' +\n                            '<div class=\"resource-bar\"
      style=\"flex: 1;\">' +\n                                '<div class=\"resource-bar-fill
      ' + cpuClass + '\" style=\"width: ' + node.cpu_percent + '%\"></div>' +\n                            '</div>'
      +\n                            '<div class=\"resource-bar\" style=\"flex: 1;\">'
      +\n                                '<div class=\"resource-bar-fill ' + memClass
      + '\" style=\"width: ' + node.memory_percent + '%\"></div>' +\n                            '</div>'
      +\n                        '</div>' +\n                    '</div>';\n                }).join('');\n
      \           } else {\n                nodeList.innerHTML = '<div class=\"empty-state\"><div
      class=\"icon\">&#128421;</div><p>No nodes found</p></div>';\n            }\n\n
      \           // Update pod issues\n            const podList = document.getElementById('podList');\n
      \           if (health.pod_statuses && health.pod_statuses.length > 0) {\n                podList.innerHTML
      = health.pod_statuses.slice(0, 10).map(pod => {\n                    const phaseClass
      = pod.phase.toLowerCase();\n                    return '<div class=\"pod-item\">'
      +\n                        '<div class=\"pod-info\">' +\n                            '<span
      class=\"pod-phase ' + phaseClass + '\">' + pod.phase + '</span>' +\n                            '<div>'
      +\n                                '<div class=\"pod-name\">' + pod.name + '</div>'
      +\n                                '<div class=\"pod-namespace\">' + pod.namespace
      + '</div>' +\n                            '</div>' +\n                        '</div>'
      +\n                        (pod.restarts > 0 ? '<span class=\"pod-restarts\">'
      + pod.restarts + ' restarts</span>' : '') +\n                    '</div>';\n
      \               }).join('');\n            } else {\n                podList.innerHTML
      = '<div class=\"empty-state\"><div class=\"icon\">&#10004;</div><p>All pods
      healthy</p></div>';\n            }\n\n            // Update alerts\n            const
      alertList = document.getElementById('alertList');\n            if (health.resource_alerts
      && health.resource_alerts.length > 0) {\n                alertList.innerHTML
      = health.resource_alerts.slice(0, 10).map(alert => {\n                    const
      time = new Date(alert.timestamp).toLocaleTimeString();\n                    return
      '<div class=\"alert-item ' + alert.severity + '\">' +\n                        '<div
      class=\"alert-header\">' +\n                            '<span class=\"alert-severity
      ' + alert.severity + '\">' + alert.severity + '</span>' +\n                            '<span
      class=\"alert-time\">' + time + '</span>' +\n                        '</div>'
      +\n                        '<div class=\"alert-message\">' + alert.message +
      '</div>' +\n                        '<div class=\"alert-node\">' + alert.resource
      + ': ' + Math.round(alert.value) + '% (threshold: ' + alert.threshold + '%)</div>'
      +\n                    '</div>';\n                }).join('');\n            }
      else {\n                alertList.innerHTML = '<div class=\"empty-state\"><div
      class=\"icon\">&#10004;</div><p>No active alerts</p></div>';\n            }\n\n
      \           // Update timestamp\n            document.getElementById('lastUpdated').textContent
      = new Date(health.timestamp).toLocaleString();\n        }\n\n        function
      createVitalSign(icon, name, status) {\n            const statusClass = status
      === 'healthy' || status === 'normal' ? 'healthy' : 'unhealthy';\n            return
      '<div class=\"vital-sign ' + statusClass + '\">' +\n                '<span class=\"icon\">'
      + icon + '</span>' +\n                '<span>' + name + '</span>' +\n                '<span
      class=\"status\">' + (status === 'healthy' || status === 'normal' ? '&#10004;'
      : '&#10008;') + '</span>' +\n            '</div>';\n        }\n\n        function
      updateBarColor(id, value) {\n            const bar = document.getElementById(id);\n
      \           bar.classList.remove('cpu', 'memory', 'warning', 'critical');\n
      \           if (value > 90) {\n                bar.classList.add('critical');\n
      \           } else if (value > 80) {\n                bar.classList.add('warning');\n
      \           } else if (id === 'cpuBar') {\n                bar.classList.add('cpu');\n
      \           } else {\n                bar.classList.add('memory');\n            }\n
      \       }\n\n        function getResourceClass(value) {\n            if (value
      > 90) return 'critical';\n            if (value > 80) return 'warning';\n            if
      (value > 50) return 'memory';\n            return 'cpu';\n        }\n\n        //
      Initial loading timeout - show error if nothing loads within 10 seconds\n        const
      initialLoadTimeout = setTimeout(function() {\n            const nodeList = document.getElementById('nodeList');\n
      \           if (nodeList.innerHTML.includes('Loading nodes')) {\n                showErrorState(new
      Error('Initial load timed out - Kubernetes API may be unavailable'));\n            }\n
      \       }, 10000);\n\n        // Clear timeout when data loads\n        const
      originalUpdateDashboard = updateDashboard;\n        updateDashboard = function(health)
      {\n            clearTimeout(initialLoadTimeout);\n            originalUpdateDashboard(health);\n
      \       };\n\n        // Initial connection\n        connectWebSocket();\n\n
      \       // Fallback to polling if WebSocket fails\n        setInterval(function()
      {\n            if (!ws || ws.readyState !== WebSocket.OPEN) {\n                fetchStatusWithTimeout();\n
      \           }\n        }, 15000);\n\n        // Fetch status with timeout\n
      \       async function fetchStatusWithTimeout() {\n            const controller
      = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(),
      10000);\n\n            try {\n                const res = await fetch('/api/status',
      { signal: controller.signal });\n                clearTimeout(timeoutId);\n\n
      \               if (!res.ok) {\n                    throw new Error('HTTP '
      + res.status + ': ' + res.statusText);\n                }\n\n                const
      data = await res.json();\n                updateDashboard(data);\n            }
      catch (err) {\n                clearTimeout(timeoutId);\n                console.error('Polling
      error:', err);\n                showErrorState(err);\n            }\n        }\n\n
      \       // Show error state in the dashboard\n        function showErrorState(err)
      {\n            let errorMsg = err.message;\n            if (err.name === 'AbortError')
      {\n                errorMsg = 'Request timed out after 10 seconds';\n            }\n\n
      \           const nodeList = document.getElementById('nodeList');\n            nodeList.innerHTML
      = '<div style=\"padding:24px;text-align:center;background:rgba(243,139,168,0.1);border-radius:10px;border:1px
      solid var(--ctp-red);\">' +\n                '<div style=\"font-size:24px;margin-bottom:12px;\">&#9888;</div>'
      +\n                '<div style=\"color:var(--ctp-red);font-weight:600;margin-bottom:8px;\">Failed
      to Load Nodes</div>' +\n                '<div style=\"color:var(--ctp-subtext0);font-size:13px;margin-bottom:12px;\">'
      + errorMsg + '</div>' +\n                '<div style=\"color:var(--ctp-overlay0);font-size:11px;\">Endpoint:
      /api/status</div>' +\n            '</div>';\n\n            document.getElementById('statusDot').className
      = 'status-dot unknown';\n            document.getElementById('statusText').textContent
      = 'Error';\n            document.getElementById('healthMessage').textContent
      = errorMsg;\n            document.getElementById('healthMessage').className
      = 'message critical';\n        }\n\n        // Initial fetch with timeout\n
      \       fetchStatusWithTimeout();\n    </script>\n</body>\n</html>`\n}\n"
    go.mod: |
      module pulse

      go 1.21

      require github.com/gorilla/websocket v1.5.1

      require golang.org/x/net v0.17.0 // indirect
    go.sum: |
      github.com/gorilla/websocket v1.5.1 h1:gmztn0JnHVt9JZquRuzLw3g4wouNVzKL15iLr/zn/QY=
      github.com/gorilla/websocket v1.5.1/go.mod h1:x3kM2JMyaluk02fnUJpQuwD2dCS5NDG2ZHL0uE0tcaY=
      golang.org/x/net v0.17.0 h1:pVaXccu2ozPjCXewfr1S7xza/zcXTity9cCdXQYSjIM=
      golang.org/x/net v0.17.0/go.mod h1:NxSsAGuq816PNPmqtQdLE42eU2Fs7NoRIZrHJAlaCOE=
    main.go: "package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/gorilla/websocket\"\n)\n\n//
      WebSocket upgrader\nvar upgrader = websocket.Upgrader{\n\tCheckOrigin: func(r
      *http.Request) bool {\n\t\treturn true\n\t},\n\tReadBufferSize:  1024,\n\tWriteBufferSize:
      1024,\n}\n\n// WebSocket clients\nvar (\n\tclients     = make(map[*websocket.Conn]bool)\n\tclientsMux
      \ sync.RWMutex\n\tbroadcast   = make(chan HealthUpdate, 100)\n)\n\n// Health
      state\nvar (\n\tcurrentHealth HealthStatus\n\thealthMux     sync.RWMutex\n\talertHistory
      \ []Alert\n\talertMux      sync.RWMutex\n)\n\n// Data structures\ntype HealthStatus
      struct {\n\tStatus           string          `json:\"status\"`\n\tMessage          string
      \         `json:\"message\"`\n\tTimestamp        time.Time       `json:\"timestamp\"`\n\tClusterHealth
      \   ClusterHealth   `json:\"cluster_health\"`\n\tNodeStatuses     []NodeStatus
      \   `json:\"node_statuses\"`\n\tPodStatuses      []PodStatus     `json:\"pod_statuses\"`\n\tResourceAlerts
      \  []ResourceAlert `json:\"resource_alerts\"`\n\tHealthScore      int             `json:\"health_score\"`\n\tVitalSigns
      \      VitalSigns      `json:\"vital_signs\"`\n}\n\ntype ClusterHealth struct
      {\n\tTotalNodes       int     `json:\"total_nodes\"`\n\tReadyNodes       int
      \    `json:\"ready_nodes\"`\n\tTotalPods        int     `json:\"total_pods\"`\n\tRunningPods
      \     int     `json:\"running_pods\"`\n\tPendingPods      int     `json:\"pending_pods\"`\n\tFailedPods
      \      int     `json:\"failed_pods\"`\n\tTotalCPUCores    float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores
      \    float64 `json:\"used_cpu_cores\"`\n\tCPUPercent       float64 `json:\"cpu_percent\"`\n\tTotalMemoryGB
      \   float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tMemoryPercent
      \   float64 `json:\"memory_percent\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tHealthyDeploys
      \  int     `json:\"healthy_deployments\"`\n}\n\ntype NodeStatus struct {\n\tName
      \        string    `json:\"name\"`\n\tStatus       string    `json:\"status\"`\n\tReady
      \       bool      `json:\"ready\"`\n\tCPUPercent   float64   `json:\"cpu_percent\"`\n\tMemoryPercent
      float64  `json:\"memory_percent\"`\n\tPodCount     int       `json:\"pod_count\"`\n\tConditions
      \  []string  `json:\"conditions\"`\n\tLastChecked  time.Time `json:\"last_checked\"`\n}\n\ntype
      PodStatus struct {\n\tName       string `json:\"name\"`\n\tNamespace  string
      `json:\"namespace\"`\n\tNode       string `json:\"node\"`\n\tPhase      string
      `json:\"phase\"`\n\tReady      bool   `json:\"ready\"`\n\tRestarts   int    `json:\"restarts\"`\n\tCPUm
      \      float64 `json:\"cpu_m\"`\n\tMemoryMB   float64 `json:\"memory_mb\"`\n}\n\ntype
      ResourceAlert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string
      \   `json:\"severity\"`\n\tResource  string    `json:\"resource\"`\n\tNode      string
      \   `json:\"node\"`\n\tMessage   string    `json:\"message\"`\n\tValue     float64
      \  `json:\"value\"`\n\tThreshold float64   `json:\"threshold\"`\n\tTimestamp
      time.Time `json:\"timestamp\"`\n}\n\ntype VitalSigns struct {\n\tHeartbeat       string
      `json:\"heartbeat\"`\n\tAPIServerStatus string `json:\"api_server_status\"`\n\tETCDStatus
      \     string `json:\"etcd_status\"`\n\tSchedulerStatus string `json:\"scheduler_status\"`\n\tControllerStatus
      string `json:\"controller_status\"`\n\tDNSStatus       string `json:\"dns_status\"`\n}\n\ntype
      Alert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string    `json:\"severity\"`\n\tTitle
      \    string    `json:\"title\"`\n\tMessage   string    `json:\"message\"`\n\tResource
      \ string    `json:\"resource\"`\n\tTimestamp time.Time `json:\"timestamp\"`\n\tResolved
      \ bool      `json:\"resolved\"`\n}\n\ntype HealthUpdate struct {\n\tType   string
      \     `json:\"type\"`\n\tData   interface{} `json:\"data\"`\n}\n\n// K8s API
      structures\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype
      K8sNode struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t}
      `json:\"metadata\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType
      \  string `json:\"type\"`\n\t\t\tStatus string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity
      struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t}
      `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory
      string `json:\"memory\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric `json:\"items\"`\n}\n\ntype
      K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t}
      `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string `json:\"cpu\"`\n\t\tMemory
      string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype K8sPodList struct
      {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct {\n\tMetadata
      struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t}
      `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName string `json:\"nodeName\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string `json:\"phase\"`\n\t\tContainerStatuses
      []struct {\n\t\t\tReady        bool `json:\"ready\"`\n\t\t\tRestartCount int
      \ `json:\"restartCount\"`\n\t\t} `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype
      K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct
      {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string
      `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t}
      `json:\"containers\"`\n}\n\ntype K8sDeploymentList struct {\n\tItems []K8sDeployment
      `json:\"items\"`\n}\n\ntype K8sDeployment struct {\n\tMetadata struct {\n\t\tName
      \     string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t}
      `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas int `json:\"replicas\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t\tReplicas
      \     int `json:\"replicas\"`\n\t} `json:\"status\"`\n}\n\ntype K8sComponentStatusList
      struct {\n\tItems []struct {\n\t\tMetadata struct {\n\t\t\tName string `json:\"name\"`\n\t\t}
      `json:\"metadata\"`\n\t\tConditions []struct {\n\t\t\tType   string `json:\"type\"`\n\t\t\tStatus
      string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t} `json:\"items\"`\n}\n\n//
      All 13 cluster nodes - hardcoded list\nvar allClusterNodes = []string{\n\t\"rpi-1\",
      \"rpi-2\", \"rpi-3\", \"rpi-4\", \"rpi-5\", \"rpi-6\",\n\t\"rpi-7\", \"rpi-8\",
      \"rpi-9\", \"rpi-10\", \"rpi-11\", \"rpi-12\",\n\t\"openmediavault\",\n}\n\n//
      K8s API client\nfunc k8sAPIRequest(path string) ([]byte, error) {\n\ttoken,
      err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token:
      %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort
      := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer
      = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\",
      apiServer, apiPort, path)\n\n\ttransport := &http.Transport{\n\t\tTLSClientConfig:
      &tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := &http.Client{\n\t\tTransport:
      transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\",
      apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\",
      \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n//
      Parse K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif
      strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif
      strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn
      val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts
      = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\")
      {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if
      strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier
      = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s,
      \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s,
      64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch
      cluster health\nfunc fetchClusterHealth() (*HealthStatus, error) {\n\tstatus
      := &HealthStatus{\n\t\tTimestamp: time.Now(),\n\t}\n\n\t// Fetch nodes\n\tnodeData,
      err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif err != nil {\n\t\treturn nil,
      fmt.Errorf(\"failed to fetch nodes: %v\", err)\n\t}\n\n\tvar nodeList K8sNodeList\n\tif
      err := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Fetch node metrics\n\tnodeMetricsData, _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tvar
      nodeMetricsList K8sNodeMetricsList\n\tjson.Unmarshal(nodeMetricsData, &nodeMetricsList)\n\n\tmetricsMap
      := make(map[string]K8sNodeMetric)\n\tfor _, m := range nodeMetricsList.Items
      {\n\t\tmetricsMap[m.Metadata.Name] = m\n\t}\n\n\t// Fetch pods\n\tpodData, err
      := k8sAPIRequest(\"/api/v1/pods\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to fetch pods: %v\", err)\n\t}\n\n\tvar podList K8sPodList\n\tif err := json.Unmarshal(podData,
      &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Fetch pod metrics\n\tpodMetricsData,
      _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tvar podMetricsList
      K8sPodMetricsList\n\tjson.Unmarshal(podMetricsData, &podMetricsList)\n\n\tpodMetricsMap
      := make(map[string]K8sPodMetric)\n\tfor _, m := range podMetricsList.Items {\n\t\tkey
      := m.Metadata.Namespace + \"/\" + m.Metadata.Name\n\t\tpodMetricsMap[key] =
      m\n\t}\n\n\t// Fetch deployments\n\tdeployData, _ := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tvar
      deployList K8sDeploymentList\n\tjson.Unmarshal(deployData, &deployList)\n\n\t//
      Build node statuses\n\tvar totalCPUCores, usedCPUCores, totalMemMB, usedMemMB
      float64\n\tpodCountByNode := make(map[string]int)\n\n\tfor _, pod := range podList.Items
      {\n\t\tif pod.Status.Phase == \"Running\" {\n\t\t\tpodCountByNode[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t//
      Build a map of k8s nodes for quick lookup\n\tk8sNodeMap := make(map[string]K8sNode)\n\tfor
      _, node := range nodeList.Items {\n\t\tk8sNodeMap[node.Metadata.Name] = node\n\t}\n\n\t//
      Include ALL 13 predefined cluster nodes, even if not in k8s\n\tfor _, nodeName
      := range allClusterNodes {\n\t\tnodeStatus := NodeStatus{\n\t\t\tName:        nodeName,\n\t\t\tLastChecked:
      time.Now(),\n\t\t}\n\n\t\t// Check if node exists in Kubernetes\n\t\tif node,
      exists := k8sNodeMap[nodeName]; exists {\n\t\t\t// Node is in k8s - get its
      real status\n\t\t\tfor _, cond := range node.Status.Conditions {\n\t\t\t\tif
      cond.Type == \"Ready\" {\n\t\t\t\t\tnodeStatus.Ready = cond.Status == \"True\"\n\t\t\t\t\tif
      nodeStatus.Ready {\n\t\t\t\t\t\tnodeStatus.Status = \"Ready\"\n\t\t\t\t\t} else
      {\n\t\t\t\t\t\tnodeStatus.Status = \"NotReady\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif
      cond.Status == \"True\" && cond.Type != \"Ready\" {\n\t\t\t\t\tnodeStatus.Conditions
      = append(nodeStatus.Conditions, cond.Type)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get
      resource usage\n\t\t\tallocCPU := parseCPU(node.Status.Allocatable.CPU)\n\t\t\tallocMem
      := parseMemory(node.Status.Allocatable.Memory)\n\t\t\ttotalCPUCores += allocCPU\n\t\t\ttotalMemMB
      += allocMem\n\n\t\t\tif metrics, ok := metricsMap[nodeName]; ok {\n\t\t\t\tusedCPU
      := parseCPU(metrics.Usage.CPU)\n\t\t\t\tusedMem := parseMemory(metrics.Usage.Memory)\n\t\t\t\tusedCPUCores
      += usedCPU\n\t\t\t\tusedMemMB += usedMem\n\n\t\t\t\tif allocCPU > 0 {\n\t\t\t\t\tnodeStatus.CPUPercent
      = (usedCPU / allocCPU) * 100\n\t\t\t\t}\n\t\t\t\tif allocMem > 0 {\n\t\t\t\t\tnodeStatus.MemoryPercent
      = (usedMem / allocMem) * 100\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Node
      is NOT in k8s yet - show as unknown/not joined\n\t\t\tnodeStatus.Status = \"NotJoined\"\n\t\t\tnodeStatus.Ready
      = false\n\t\t\tnodeStatus.Conditions = []string{\"Not in Kubernetes cluster\"}\n\t\t}\n\n\t\tnodeStatus.PodCount
      = podCountByNode[nodeName]\n\t\tstatus.NodeStatuses = append(status.NodeStatuses,
      nodeStatus)\n\t}\n\n\t// Sort nodes: rpi-1 through rpi-12 numerically, then
      openmediavault\n\tsort.Slice(status.NodeStatuses, func(i, j int) bool {\n\t\tnameI
      := status.NodeStatuses[i].Name\n\t\tnameJ := status.NodeStatuses[j].Name\n\n\t\t//
      Extract numeric part for rpi-N nodes\n\t\tgetNodeOrder := func(name string)
      int {\n\t\t\tif name == \"openmediavault\" {\n\t\t\t\treturn 100 // Always last\n\t\t\t}\n\t\t\tif
      strings.HasPrefix(name, \"rpi-\") {\n\t\t\t\tnumStr := strings.TrimPrefix(name,
      \"rpi-\")\n\t\t\t\tnum, err := strconv.Atoi(numStr)\n\t\t\t\tif err == nil {\n\t\t\t\t\treturn
      num\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 50 // Unknown nodes in the middle\n\t\t}\n\n\t\treturn
      getNodeOrder(nameI) < getNodeOrder(nameJ)\n\t})\n\n\t// Build pod statuses (focus
      on non-running or high restart pods)\n\tfor _, pod := range podList.Items {\n\t\tkey
      := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\n\t\tpodStatus := PodStatus{\n\t\t\tName:
      \     pod.Metadata.Name,\n\t\t\tNamespace: pod.Metadata.Namespace,\n\t\t\tNode:
      \     pod.Spec.NodeName,\n\t\t\tPhase:     pod.Status.Phase,\n\t\t}\n\n\t\t//
      Check container statuses\n\t\tfor _, cs := range pod.Status.ContainerStatuses
      {\n\t\t\tif cs.Ready {\n\t\t\t\tpodStatus.Ready = true\n\t\t\t}\n\t\t\tpodStatus.Restarts
      += cs.RestartCount\n\t\t}\n\n\t\t// Get pod metrics\n\t\tif metrics, ok := podMetricsMap[key];
      ok {\n\t\t\tfor _, container := range metrics.Containers {\n\t\t\t\tpodStatus.CPUm
      += parseCPU(container.Usage.CPU)\n\t\t\t\tpodStatus.MemoryMB += parseMemory(container.Usage.Memory)\n\t\t\t}\n\t\t}\n\n\t\t//
      Only include problematic pods or sample of running pods\n\t\tif pod.Status.Phase
      != \"Running\" || podStatus.Restarts > 5 || !podStatus.Ready {\n\t\t\tstatus.PodStatuses
      = append(status.PodStatuses, podStatus)\n\t\t}\n\t}\n\n\t// Count pod phases\n\tvar
      runningPods, pendingPods, failedPods int\n\tfor _, pod := range podList.Items
      {\n\t\tswitch pod.Status.Phase {\n\t\tcase \"Running\":\n\t\t\trunningPods++\n\t\tcase
      \"Pending\":\n\t\t\tpendingPods++\n\t\tcase \"Failed\":\n\t\t\tfailedPods++\n\t\t}\n\t}\n\n\t//
      Count deployments\n\thealthyDeploys := 0\n\tfor _, deploy := range deployList.Items
      {\n\t\tif deploy.Status.ReadyReplicas >= deploy.Spec.Replicas {\n\t\t\thealthyDeploys++\n\t\t}\n\t}\n\n\t//
      Build cluster health\n\treadyNodes := 0\n\tfor _, ns := range status.NodeStatuses
      {\n\t\tif ns.Ready {\n\t\t\treadyNodes++\n\t\t}\n\t}\n\n\tstatus.ClusterHealth
      = ClusterHealth{\n\t\tTotalNodes:       len(allClusterNodes), // Always show
      all 13 nodes\n\t\tReadyNodes:       readyNodes,\n\t\tTotalPods:        len(podList.Items),\n\t\tRunningPods:
      \     runningPods,\n\t\tPendingPods:      pendingPods,\n\t\tFailedPods:       failedPods,\n\t\tTotalCPUCores:
      \   totalCPUCores,\n\t\tUsedCPUCores:     usedCPUCores,\n\t\tTotalMemoryGB:
      \   totalMemMB / 1024,\n\t\tUsedMemoryGB:     usedMemMB / 1024,\n\t\tTotalDeployments:
      len(deployList.Items),\n\t\tHealthyDeploys:   healthyDeploys,\n\t}\n\n\tif totalCPUCores
      > 0 {\n\t\tstatus.ClusterHealth.CPUPercent = (usedCPUCores / totalCPUCores)
      * 100\n\t}\n\tif totalMemMB > 0 {\n\t\tstatus.ClusterHealth.MemoryPercent =
      (usedMemMB / totalMemMB) * 100\n\t}\n\n\t// Generate resource alerts\n\tfor
      _, ns := range status.NodeStatuses {\n\t\tif ns.CPUPercent > 90 {\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-high-%s\",
      ns.Name),\n\t\t\t\tSeverity:  \"critical\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage critical on %s\",
      ns.Name),\n\t\t\t\tValue:     ns.CPUPercent,\n\t\t\t\tThreshold: 90,\n\t\t\t\tTimestamp:
      time.Now(),\n\t\t\t})\n\t\t} else if ns.CPUPercent > 80 {\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-warn-%s\",
      ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage high on %s\", ns.Name),\n\t\t\t\tValue:
      \    ns.CPUPercent,\n\t\t\t\tThreshold: 80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif
      ns.MemoryPercent > 90 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts,
      ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"mem-high-%s\", ns.Name),\n\t\t\t\tSeverity:
      \ \"critical\",\n\t\t\t\tResource:  \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:
      \  fmt.Sprintf(\"Memory usage critical on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold:
      90,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t} else if ns.MemoryPercent
      > 80 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:
      \       fmt.Sprintf(\"mem-warn-%s\", ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:
      \ \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"Memory
      usage high on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold:
      80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif !ns.Ready {\n\t\t\tvar
      msg string\n\t\t\tvar severity string\n\t\t\tif ns.Status == \"NotJoined\" {\n\t\t\t\tmsg
      = fmt.Sprintf(\"Node %s has not joined the cluster\", ns.Name)\n\t\t\t\tseverity
      = \"warning\" // Not joined is warning, not critical\n\t\t\t} else {\n\t\t\t\tmsg
      = fmt.Sprintf(\"Node %s is not ready\", ns.Name)\n\t\t\t\tseverity = \"critical\"\n\t\t\t}\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"node-notready-%s\",
      ns.Name),\n\t\t\t\tSeverity:  severity,\n\t\t\t\tResource:  \"node\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   msg,\n\t\t\t\tValue:     0,\n\t\t\t\tThreshold:
      0,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\t}\n\n\t// Check vital
      signs\n\tstatus.VitalSigns = VitalSigns{\n\t\tHeartbeat:       \"normal\",\n\t\tAPIServerStatus:
      \"healthy\",\n\t}\n\n\t// Try to get component statuses\n\tcompData, err :=
      k8sAPIRequest(\"/api/v1/componentstatuses\")\n\tif err == nil {\n\t\tvar compList
      K8sComponentStatusList\n\t\tif json.Unmarshal(compData, &compList) == nil {\n\t\t\tfor
      _, comp := range compList.Items {\n\t\t\t\thealthy := false\n\t\t\t\tfor _,
      cond := range comp.Conditions {\n\t\t\t\t\tif cond.Type == \"Healthy\" && cond.Status
      == \"True\" {\n\t\t\t\t\t\thealthy = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tswitch
      comp.Metadata.Name {\n\t\t\t\tcase \"etcd-0\", \"etcd\":\n\t\t\t\t\tif healthy
      {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"healthy\"\n\t\t\t\t\t} else
      {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase
      \"scheduler\":\n\t\t\t\t\tif healthy {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus
      = \"healthy\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus
      = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase \"controller-manager\":\n\t\t\t\t\tif
      healthy {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"healthy\"\n\t\t\t\t\t}
      else {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Check CoreDNS\n\tfor _, deploy := range deployList.Items {\n\t\tif deploy.Metadata.Name
      == \"coredns\" && deploy.Metadata.Namespace == \"kube-system\" {\n\t\t\tif deploy.Status.ReadyReplicas
      > 0 {\n\t\t\t\tstatus.VitalSigns.DNSStatus = \"healthy\"\n\t\t\t} else {\n\t\t\t\tstatus.VitalSigns.DNSStatus
      = \"unhealthy\"\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t}\n\n\t// Calculate health score\n\tscore
      := 100\n\tif status.ClusterHealth.ReadyNodes < status.ClusterHealth.TotalNodes
      {\n\t\tscore -= (status.ClusterHealth.TotalNodes - status.ClusterHealth.ReadyNodes)
      * 15\n\t}\n\tif status.ClusterHealth.FailedPods > 0 {\n\t\tscore -= status.ClusterHealth.FailedPods
      * 5\n\t}\n\tif status.ClusterHealth.PendingPods > 5 {\n\t\tscore -= 10\n\t}\n\tif
      status.ClusterHealth.CPUPercent > 90 {\n\t\tscore -= 15\n\t} else if status.ClusterHealth.CPUPercent
      > 80 {\n\t\tscore -= 5\n\t}\n\tif status.ClusterHealth.MemoryPercent > 90 {\n\t\tscore
      -= 15\n\t} else if status.ClusterHealth.MemoryPercent > 80 {\n\t\tscore -= 5\n\t}\n\tif
      len(status.ResourceAlerts) > 0 {\n\t\tfor _, alert := range status.ResourceAlerts
      {\n\t\t\tif alert.Severity == \"critical\" {\n\t\t\t\tscore -= 10\n\t\t\t} else
      {\n\t\t\t\tscore -= 5\n\t\t\t}\n\t\t}\n\t}\n\tif score < 0 {\n\t\tscore = 0\n\t}\n\tstatus.HealthScore
      = score\n\n\t// Determine overall status and message\n\tif score >= 90 {\n\t\tstatus.Status
      = \"healthy\"\n\t\tstatus.Message = \"Vital signs are looking good\"\n\t} else
      if score >= 70 {\n\t\tstatus.Status = \"warning\"\n\t\tstatus.Message = \"Some
      vital signs need attention\"\n\t} else if score >= 50 {\n\t\tstatus.Status =
      \"degraded\"\n\t\tstatus.Message = \"Cluster health is degraded\"\n\t} else
      {\n\t\tstatus.Status = \"critical\"\n\t\tstatus.Message = \"Critical issues
      detected\"\n\t}\n\n\treturn status, nil\n}\n\n// Health monitor loop\nfunc healthMonitor()
      {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor
      {\n\t\thealth, err := fetchClusterHealth()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error
      fetching health: %v\", err)\n\t\t\thealth = &HealthStatus{\n\t\t\t\tStatus:
      \   \"unknown\",\n\t\t\t\tMessage:   \"Unable to fetch cluster health\",\n\t\t\t\tTimestamp:
      time.Now(),\n\t\t\t}\n\t\t}\n\n\t\thealthMux.Lock()\n\t\tcurrentHealth = *health\n\t\thealthMux.Unlock()\n\n\t\t//
      Broadcast to WebSocket clients\n\t\tbroadcast <- HealthUpdate{\n\t\t\tType:
      \"health_update\",\n\t\t\tData: health,\n\t\t}\n\n\t\t<-ticker.C\n\t}\n}\n\n//
      WebSocket broadcaster\nfunc handleBroadcast() {\n\tfor update := range broadcast
      {\n\t\tclientsMux.RLock()\n\t\tfor client := range clients {\n\t\t\terr := client.WriteJSON(update)\n\t\t\tif
      err != nil {\n\t\t\t\tlog.Printf(\"WebSocket write error: %v\", err)\n\t\t\t\tclient.Close()\n\t\t\t\tclientsMux.RUnlock()\n\t\t\t\tclientsMux.Lock()\n\t\t\t\tdelete(clients,
      client)\n\t\t\t\tclientsMux.Unlock()\n\t\t\t\tclientsMux.RLock()\n\t\t\t}\n\t\t}\n\t\tclientsMux.RUnlock()\n\t}\n}\n\n//
      HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":
      \ \"healthy\",\n\t\t\"service\": \"pulse\",\n\t\t\"message\": \"Vital signs
      are looking good\",\n\t})\n}\n\nfunc handleStatus(w http.ResponseWriter, r *http.Request)
      {\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(health)\n}\n\nfunc handleNodes(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tnodes := currentHealth.NodeStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tpods := currentHealth.PodStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleAlerts(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\talerts := currentHealth.ResourceAlerts\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(alerts)\n}\n\nfunc handleVitals(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tvitals := currentHealth.VitalSigns\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(vitals)\n}\n\nfunc handleWebSocket(w
      http.ResponseWriter, r *http.Request) {\n\tconn, err := upgrader.Upgrade(w,
      r, nil)\n\tif err != nil {\n\t\tlog.Printf(\"WebSocket upgrade error: %v\",
      err)\n\t\treturn\n\t}\n\n\tclientsMux.Lock()\n\tclients[conn] = true\n\tclientsMux.Unlock()\n\n\t//
      Send current health immediately\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tconn.WriteJSON(HealthUpdate{\n\t\tType:
      \"health_update\",\n\t\tData: health,\n\t})\n\n\t// Keep connection alive and
      handle disconnection\n\tfor {\n\t\t_, _, err := conn.ReadMessage()\n\t\tif err
      != nil {\n\t\t\tclientsMux.Lock()\n\t\t\tdelete(clients, conn)\n\t\t\tclientsMux.Unlock()\n\t\t\tconn.Close()\n\t\t\tbreak\n\t\t}\n\t}\n}\n\nfunc
      handleDashboard(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"text/html\")\n\tw.Write([]byte(getDashboardHTML()))\n}\n\nfunc main() {\n\t//
      Initialize health status\n\tcurrentHealth = HealthStatus{\n\t\tStatus:    \"initializing\",\n\t\tMessage:
      \  \"Starting health monitor...\",\n\t\tTimestamp: time.Now(),\n\t}\n\n\t//
      Start health monitor\n\tgo healthMonitor()\n\n\t// Start WebSocket broadcaster\n\tgo
      handleBroadcast()\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t//
      API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\tmux.HandleFunc(\"/api/status\",
      handleStatus)\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/pods\",
      handlePods)\n\tmux.HandleFunc(\"/api/alerts\", handleAlerts)\n\tmux.HandleFunc(\"/api/vitals\",
      handleVitals)\n\tmux.HandleFunc(\"/ws\", handleWebSocket)\n\n\t// Dashboard\n\tmux.HandleFunc(\"/\",
      handleDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport
      = \"8080\"\n\t}\n\n\tlog.Printf(\"Pulse health monitor starting on port %s\",
      port)\n\tlog.Printf(\"Vital signs are looking good\")\n\tlog.Fatal(http.ListenAndServe(\":\"+port,
      mux))\n}\n"
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T03:13:19Z"
    name: pulse-source
    namespace: holm
    resourceVersion: "752"
    uid: bbcbedb5-a5b8-4bb0-b075-2b2fadef11f6
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder

      WORKDIR /app

      # Copy go mod files
      COPY go.mod go.sum ./

      # Download dependencies
      RUN go mod download

      # Copy source files
      COPY *.go ./

      # Build the binary for ARM64
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o pulse .

      # Final image
      FROM alpine:3.19

      RUN apk --no-cache add ca-certificates tzdata

      WORKDIR /app

      COPY --from=builder /app/pulse .

      EXPOSE 8080

      # Health check
      HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
          CMD wget --no-verbose --tries=1 --spider http://localhost:8080/health || exit 1

      CMD ["./pulse"]
    dashboard.go: "package main\n\nfunc getDashboardHTML() string {\n\treturn `<!DOCTYPE
      html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"
      content=\"width=device-width, initial-scale=1.0\">\n    <title>Pulse - Cluster
      Health Monitor</title>\n    <style>\n        /* Catppuccin Mocha Theme */\n
      \       :root {\n            --ctp-rosewater: #f5e0dc;\n            --ctp-flamingo:
      #f2cdcd;\n            --ctp-pink: #f5c2e7;\n            --ctp-mauve: #cba6f7;\n
      \           --ctp-red: #f38ba8;\n            --ctp-maroon: #eba0ac;\n            --ctp-peach:
      #fab387;\n            --ctp-yellow: #f9e2af;\n            --ctp-green: #a6e3a1;\n
      \           --ctp-teal: #94e2d5;\n            --ctp-sky: #89dceb;\n            --ctp-sapphire:
      #74c7ec;\n            --ctp-blue: #89b4fa;\n            --ctp-lavender: #b4befe;\n
      \           --ctp-text: #cdd6f4;\n            --ctp-subtext1: #bac2de;\n            --ctp-subtext0:
      #a6adc8;\n            --ctp-overlay2: #9399b2;\n            --ctp-overlay1:
      #7f849c;\n            --ctp-overlay0: #6c7086;\n            --ctp-surface2:
      #585b70;\n            --ctp-surface1: #45475a;\n            --ctp-surface0:
      #313244;\n            --ctp-base: #1e1e2e;\n            --ctp-mantle: #181825;\n
      \           --ctp-crust: #11111b;\n        }\n\n        * {\n            margin:
      0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n
      \       body {\n            font-family: -apple-system, BlinkMacSystemFont,
      'Segoe UI', Roboto, 'Inter', sans-serif;\n            background: var(--ctp-base);\n
      \           color: var(--ctp-text);\n            min-height: 100vh;\n            line-height:
      1.5;\n        }\n\n        /* Header */\n        .header {\n            background:
      var(--ctp-mantle);\n            border-bottom: 1px solid var(--ctp-surface0);\n
      \           padding: 16px 24px;\n            position: sticky;\n            top:
      0;\n            z-index: 100;\n        }\n\n        .header-content {\n            max-width:
      1600px;\n            margin: 0 auto;\n            display: flex;\n            justify-content:
      space-between;\n            align-items: center;\n        }\n\n        .header-left
      {\n            display: flex;\n            align-items: center;\n            gap:
      16px;\n        }\n\n        .logo {\n            width: 40px;\n            height:
      40px;\n            background: linear-gradient(135deg, var(--ctp-red) 0%, var(--ctp-pink)
      100%);\n            border-radius: 12px;\n            display: flex;\n            align-items:
      center;\n            justify-content: center;\n            font-size: 20px;\n
      \           animation: pulse-glow 2s ease-in-out infinite;\n        }\n\n        @keyframes
      pulse-glow {\n            0%, 100% { box-shadow: 0 0 20px rgba(243, 139, 168,
      0.3); }\n            50% { box-shadow: 0 0 30px rgba(243, 139, 168, 0.5); }\n
      \       }\n\n        .header-title h1 {\n            font-size: 20px;\n            font-weight:
      600;\n            color: var(--ctp-text);\n        }\n\n        .header-title
      p {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .header-right {\n            display: flex;\n            align-items:
      center;\n            gap: 16px;\n        }\n\n        .status-indicator {\n
      \           display: flex;\n            align-items: center;\n            gap:
      8px;\n            padding: 8px 16px;\n            background: var(--ctp-surface0);\n
      \           border-radius: 20px;\n            font-size: 13px;\n            font-weight:
      500;\n        }\n\n        .status-dot {\n            width: 10px;\n            height:
      10px;\n            border-radius: 50%;\n            animation: pulse-dot 2s
      ease-in-out infinite;\n        }\n\n        .status-dot.healthy { background:
      var(--ctp-green); }\n        .status-dot.warning { background: var(--ctp-yellow);
      }\n        .status-dot.degraded { background: var(--ctp-peach); }\n        .status-dot.critical
      { background: var(--ctp-red); }\n        .status-dot.unknown { background: var(--ctp-overlay0);
      }\n\n        @keyframes pulse-dot {\n            0%, 100% { opacity: 1; transform:
      scale(1); }\n            50% { opacity: 0.7; transform: scale(1.1); }\n        }\n\n
      \       .connection-status {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n            display: flex;\n            align-items: center;\n
      \           gap: 6px;\n        }\n\n        .connection-status.connected { color:
      var(--ctp-green); }\n        .connection-status.disconnected { color: var(--ctp-red);
      }\n\n        /* Main Content */\n        .main {\n            max-width: 1600px;\n
      \           margin: 0 auto;\n            padding: 24px;\n        }\n\n        /*
      Health Score Card */\n        .health-score-card {\n            background:
      linear-gradient(135deg, var(--ctp-mantle) 0%, var(--ctp-surface0) 100%);\n            border-radius:
      20px;\n            padding: 32px;\n            margin-bottom: 24px;\n            border:
      1px solid var(--ctp-surface1);\n            display: flex;\n            justify-content:
      space-between;\n            align-items: center;\n            flex-wrap: wrap;\n
      \           gap: 24px;\n        }\n\n        .health-score-main {\n            display:
      flex;\n            align-items: center;\n            gap: 24px;\n        }\n\n
      \       .score-circle {\n            width: 120px;\n            height: 120px;\n
      \           position: relative;\n        }\n\n        .score-circle svg {\n
      \           width: 100%;\n            height: 100%;\n            transform:
      rotate(-90deg);\n        }\n\n        .score-circle .bg {\n            stroke:
      var(--ctp-surface1);\n        }\n\n        .score-circle .progress {\n            stroke-linecap:
      round;\n            transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;\n
      \       }\n\n        .score-circle .progress.healthy { stroke: var(--ctp-green);
      }\n        .score-circle .progress.warning { stroke: var(--ctp-yellow); }\n
      \       .score-circle .progress.degraded { stroke: var(--ctp-peach); }\n        .score-circle
      .progress.critical { stroke: var(--ctp-red); }\n\n        .score-value {\n            position:
      absolute;\n            top: 50%;\n            left: 50%;\n            transform:
      translate(-50%, -50%);\n            font-size: 32px;\n            font-weight:
      700;\n        }\n\n        .health-info h2 {\n            font-size: 28px;\n
      \           font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n
      \       .health-info p {\n            font-size: 15px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .health-info .message {\n            color: var(--ctp-green);\n
      \           font-weight: 500;\n            margin-top: 8px;\n        }\n\n        .health-info
      .message.warning { color: var(--ctp-yellow); }\n        .health-info .message.degraded
      { color: var(--ctp-peach); }\n        .health-info .message.critical { color:
      var(--ctp-red); }\n\n        .vital-signs {\n            display: flex;\n            gap:
      12px;\n            flex-wrap: wrap;\n        }\n\n        .vital-sign {\n            background:
      var(--ctp-surface0);\n            padding: 12px 16px;\n            border-radius:
      12px;\n            display: flex;\n            align-items: center;\n            gap:
      8px;\n            font-size: 13px;\n        }\n\n        .vital-sign .icon {
      font-size: 16px; }\n        .vital-sign.healthy .status { color: var(--ctp-green);
      }\n        .vital-sign.unhealthy .status { color: var(--ctp-red); }\n\n        /*
      Grid Layout */\n        .dashboard-grid {\n            display: grid;\n            grid-template-columns:
      repeat(auto-fit, minmax(400px, 1fr));\n            gap: 20px;\n            margin-bottom:
      24px;\n        }\n\n        @media (max-width: 900px) {\n            .dashboard-grid
      {\n                grid-template-columns: 1fr;\n            }\n        }\n\n
      \       /* Cards */\n        .card {\n            background: var(--ctp-mantle);\n
      \           border-radius: 16px;\n            border: 1px solid var(--ctp-surface0);\n
      \           overflow: hidden;\n        }\n\n        .card-header {\n            padding:
      16px 20px;\n            border-bottom: 1px solid var(--ctp-surface0);\n            display:
      flex;\n            justify-content: space-between;\n            align-items:
      center;\n        }\n\n        .card-title {\n            font-size: 15px;\n
      \           font-weight: 600;\n            display: flex;\n            align-items:
      center;\n            gap: 10px;\n        }\n\n        .card-title .icon {\n
      \           width: 28px;\n            height: 28px;\n            border-radius:
      8px;\n            display: flex;\n            align-items: center;\n            justify-content:
      center;\n            font-size: 14px;\n        }\n\n        .card-title .icon.nodes
      { background: var(--ctp-blue); color: var(--ctp-crust); }\n        .card-title
      .icon.resources { background: var(--ctp-green); color: var(--ctp-crust); }\n
      \       .card-title .icon.pods { background: var(--ctp-mauve); color: var(--ctp-crust);
      }\n        .card-title .icon.alerts { background: var(--ctp-red); color: var(--ctp-crust);
      }\n\n        .card-content {\n            padding: 16px 20px;\n        }\n\n
      \       /* Stats Grid */\n        .stats-grid {\n            display: grid;\n
      \           grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n
      \           margin-bottom: 24px;\n        }\n\n        @media (max-width: 1200px)
      {\n            .stats-grid {\n                grid-template-columns: repeat(2,
      1fr);\n            }\n        }\n\n        .stat-card {\n            background:
      var(--ctp-mantle);\n            border-radius: 16px;\n            padding: 20px;\n
      \           border: 1px solid var(--ctp-surface0);\n        }\n\n        .stat-card-header
      {\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            margin-bottom: 12px;\n        }\n\n
      \       .stat-label {\n            font-size: 13px;\n            color: var(--ctp-subtext0);\n
      \           text-transform: uppercase;\n            letter-spacing: 0.5px;\n
      \       }\n\n        .stat-icon {\n            width: 32px;\n            height:
      32px;\n            border-radius: 10px;\n            display: flex;\n            align-items:
      center;\n            justify-content: center;\n            font-size: 16px;\n
      \       }\n\n        .stat-icon.blue { background: rgba(137, 180, 250, 0.2);
      color: var(--ctp-blue); }\n        .stat-icon.green { background: rgba(166,
      227, 161, 0.2); color: var(--ctp-green); }\n        .stat-icon.mauve { background:
      rgba(203, 166, 247, 0.2); color: var(--ctp-mauve); }\n        .stat-icon.peach
      { background: rgba(250, 179, 135, 0.2); color: var(--ctp-peach); }\n\n        .stat-value
      {\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom:
      4px;\n        }\n\n        .stat-detail {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        /* Node List */\n        .node-list
      {\n            display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .node-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 12px;\n            padding: 14px 16px;\n            display:
      flex;\n            align-items: center;\n            justify-content: space-between;\n
      \           transition: background 0.2s;\n        }\n\n        .node-item:hover
      {\n            background: var(--ctp-surface1);\n        }\n\n        .node-info
      {\n            display: flex;\n            align-items: center;\n            gap:
      12px;\n        }\n\n        .node-status-dot {\n            width: 10px;\n            height:
      10px;\n            border-radius: 50%;\n        }\n\n        .node-status-dot.ready
      { background: var(--ctp-green); }\n        .node-status-dot.not-ready { background:
      var(--ctp-red); }\n        .node-status-dot.not-joined { background: var(--ctp-overlay0);
      }\n\n        .node-item.not-joined {\n            opacity: 0.7;\n            background:
      var(--ctp-surface0);\n            border: 1px dashed var(--ctp-overlay0);\n
      \       }\n\n        .node-status-badge {\n            font-size: 10px;\n            padding:
      2px 6px;\n            border-radius: 4px;\n            margin-left: 8px;\n            text-transform:
      uppercase;\n            font-weight: 600;\n        }\n\n        .node-status-badge.not-joined
      {\n            background: rgba(108, 112, 134, 0.2);\n            color: var(--ctp-overlay0);\n
      \       }\n\n        .node-name {\n            font-weight: 500;\n            font-size:
      14px;\n        }\n\n        .node-pods {\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        .node-metrics {\n            display:
      flex;\n            gap: 16px;\n        }\n\n        .node-metric {\n            text-align:
      right;\n        }\n\n        .node-metric-value {\n            font-size: 13px;\n
      \           font-weight: 600;\n        }\n\n        .node-metric-label {\n            font-size:
      10px;\n            color: var(--ctp-subtext0);\n            text-transform:
      uppercase;\n        }\n\n        /* Resource Bars */\n        .resource-section
      {\n            margin-bottom: 20px;\n        }\n\n        .resource-section:last-child
      {\n            margin-bottom: 0;\n        }\n\n        .resource-header {\n
      \           display: flex;\n            justify-content: space-between;\n            align-items:
      center;\n            margin-bottom: 8px;\n        }\n\n        .resource-label
      {\n            font-size: 13px;\n            font-weight: 500;\n            display:
      flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n
      \       .resource-value {\n            font-size: 13px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        .resource-bar {\n            height:
      8px;\n            background: var(--ctp-surface0);\n            border-radius:
      4px;\n            overflow: hidden;\n        }\n\n        .resource-bar-fill
      {\n            height: 100%;\n            border-radius: 4px;\n            transition:
      width 0.5s ease;\n        }\n\n        .resource-bar-fill.cpu { background:
      linear-gradient(90deg, var(--ctp-blue), var(--ctp-sapphire)); }\n        .resource-bar-fill.memory
      { background: linear-gradient(90deg, var(--ctp-green), var(--ctp-teal)); }\n
      \       .resource-bar-fill.warning { background: linear-gradient(90deg, var(--ctp-yellow),
      var(--ctp-peach)); }\n        .resource-bar-fill.critical { background: linear-gradient(90deg,
      var(--ctp-red), var(--ctp-maroon)); }\n\n        /* Pod Issues */\n        .pod-list
      {\n            display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .pod-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 10px;\n            padding: 12px 14px;\n            display:
      flex;\n            align-items: center;\n            justify-content: space-between;\n
      \       }\n\n        .pod-info {\n            display: flex;\n            align-items:
      center;\n            gap: 10px;\n        }\n\n        .pod-phase {\n            padding:
      3px 8px;\n            border-radius: 6px;\n            font-size: 10px;\n            font-weight:
      600;\n            text-transform: uppercase;\n        }\n\n        .pod-phase.running
      { background: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .pod-phase.pending
      { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .pod-phase.failed
      { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .pod-name
      {\n            font-size: 13px;\n            font-weight: 500;\n        }\n\n
      \       .pod-namespace {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .pod-restarts {\n            font-size: 12px;\n            color:
      var(--ctp-peach);\n        }\n\n        /* Alerts */\n        .alert-list {\n
      \           display: flex;\n            flex-direction: column;\n            gap:
      8px;\n        }\n\n        .alert-item {\n            background: var(--ctp-surface0);\n
      \           border-radius: 10px;\n            padding: 12px 14px;\n            border-left:
      3px solid;\n        }\n\n        .alert-item.warning { border-color: var(--ctp-yellow);
      }\n        .alert-item.critical { border-color: var(--ctp-red); }\n\n        .alert-header
      {\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            margin-bottom: 4px;\n        }\n\n
      \       .alert-severity {\n            font-size: 10px;\n            font-weight:
      600;\n            text-transform: uppercase;\n            padding: 2px 6px;\n
      \           border-radius: 4px;\n        }\n\n        .alert-severity.warning
      { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .alert-severity.critical
      { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .alert-time
      {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n        }\n\n
      \       .alert-message {\n            font-size: 13px;\n        }\n\n        .alert-node
      {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n            margin-top:
      4px;\n        }\n\n        /* Empty States */\n        .empty-state {\n            text-align:
      center;\n            padding: 32px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .empty-state .icon {\n            font-size: 32px;\n            margin-bottom:
      12px;\n            opacity: 0.5;\n        }\n\n        .empty-state p {\n            font-size:
      14px;\n        }\n\n        /* Last Updated */\n        .last-updated {\n            text-align:
      center;\n            padding: 16px;\n            font-size: 12px;\n            color:
      var(--ctp-subtext0);\n        }\n\n        /* Loading */\n        .loading {\n
      \           display: flex;\n            align-items: center;\n            justify-content:
      center;\n            padding: 48px;\n            color: var(--ctp-subtext0);\n
      \       }\n\n        .loading-spinner {\n            width: 32px;\n            height:
      32px;\n            border: 3px solid var(--ctp-surface1);\n            border-top-color:
      var(--ctp-mauve);\n            border-radius: 50%;\n            animation: spin
      1s linear infinite;\n            margin-right: 12px;\n        }\n\n        @keyframes
      spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n
      \   <header class=\"header\">\n        <div class=\"header-content\">\n            <div
      class=\"header-left\">\n                <div class=\"logo\">&#128147;</div>\n
      \               <div class=\"header-title\">\n                    <h1>Pulse</h1>\n
      \                   <p>Cluster Health Monitor</p>\n                </div>\n
      \           </div>\n            <div class=\"header-right\">\n                <div
      class=\"status-indicator\">\n                    <span class=\"status-dot\"
      id=\"statusDot\"></span>\n                    <span id=\"statusText\">Connecting...</span>\n
      \               </div>\n                <div class=\"connection-status\" id=\"connectionStatus\">\n
      \                   <span>&#9679;</span>\n                    <span>Connecting...</span>\n
      \               </div>\n            </div>\n        </div>\n    </header>\n\n
      \   <main class=\"main\">\n        <!-- Health Score Card -->\n        <div
      class=\"health-score-card\">\n            <div class=\"health-score-main\">\n
      \               <div class=\"score-circle\">\n                    <svg viewBox=\"0
      0 100 100\">\n                        <circle class=\"bg\" cx=\"50\" cy=\"50\"
      r=\"45\" fill=\"none\" stroke-width=\"8\"/>\n                        <circle
      class=\"progress\" id=\"scoreProgress\" cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\"
      stroke-width=\"8\"\n                            stroke-dasharray=\"283\" stroke-dashoffset=\"283\"/>\n
      \                   </svg>\n                    <div class=\"score-value\" id=\"scoreValue\">--</div>\n
      \               </div>\n                <div class=\"health-info\">\n                    <h2>Health
      Score</h2>\n                    <p>Overall cluster health status</p>\n                    <p
      class=\"message\" id=\"healthMessage\">Loading...</p>\n                </div>\n
      \           </div>\n            <div class=\"vital-signs\" id=\"vitalSigns\">\n
      \               <!-- Vital signs will be populated -->\n            </div>\n
      \       </div>\n\n        <!-- Stats Grid -->\n        <div class=\"stats-grid\">\n
      \           <div class=\"stat-card\">\n                <div class=\"stat-card-header\">\n
      \                   <span class=\"stat-label\">Nodes</span>\n                    <div
      class=\"stat-icon blue\">&#128421;</div>\n                </div>\n                <div
      class=\"stat-value\" id=\"nodeCount\">--</div>\n                <div class=\"stat-detail\"
      id=\"nodeDetail\">-- ready</div>\n            </div>\n            <div class=\"stat-card\">\n
      \               <div class=\"stat-card-header\">\n                    <span
      class=\"stat-label\">Pods</span>\n                    <div class=\"stat-icon
      mauve\">&#128230;</div>\n                </div>\n                <div class=\"stat-value\"
      id=\"podCount\">--</div>\n                <div class=\"stat-detail\" id=\"podDetail\">--
      running</div>\n            </div>\n            <div class=\"stat-card\">\n                <div
      class=\"stat-card-header\">\n                    <span class=\"stat-label\">CPU</span>\n
      \                   <div class=\"stat-icon green\">&#9889;</div>\n                </div>\n
      \               <div class=\"stat-value\" id=\"cpuUsage\">--%</div>\n                <div
      class=\"stat-detail\" id=\"cpuDetail\">-- / -- cores</div>\n            </div>\n
      \           <div class=\"stat-card\">\n                <div class=\"stat-card-header\">\n
      \                   <span class=\"stat-label\">Memory</span>\n                    <div
      class=\"stat-icon peach\">&#128200;</div>\n                </div>\n                <div
      class=\"stat-value\" id=\"memUsage\">--%</div>\n                <div class=\"stat-detail\"
      id=\"memDetail\">-- / -- GB</div>\n            </div>\n        </div>\n\n        <!--
      Dashboard Grid -->\n        <div class=\"dashboard-grid\">\n            <!--
      Nodes Card -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n
      \                   <div class=\"card-title\">\n                        <div
      class=\"icon nodes\">&#128421;</div>\n                        Node Status\n
      \                   </div>\n                </div>\n                <div class=\"card-content\">\n
      \                   <div class=\"node-list\" id=\"nodeList\">\n                        <div
      class=\"loading\">\n                            <div class=\"loading-spinner\"></div>\n
      \                           Loading nodes...\n                        </div>\n
      \                   </div>\n                </div>\n            </div>\n\n            <!--
      Resources Card -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n
      \                   <div class=\"card-title\">\n                        <div
      class=\"icon resources\">&#128200;</div>\n                        Resource Usage\n
      \                   </div>\n                </div>\n                <div class=\"card-content\">\n
      \                   <div class=\"resource-section\">\n                        <div
      class=\"resource-header\">\n                            <span class=\"resource-label\">&#9889;
      CPU Usage</span>\n                            <span class=\"resource-value\"
      id=\"cpuResourceValue\">--%</span>\n                        </div>\n                        <div
      class=\"resource-bar\">\n                            <div class=\"resource-bar-fill
      cpu\" id=\"cpuBar\" style=\"width: 0%\"></div>\n                        </div>\n
      \                   </div>\n                    <div class=\"resource-section\">\n
      \                       <div class=\"resource-header\">\n                            <span
      class=\"resource-label\">&#128190; Memory Usage</span>\n                            <span
      class=\"resource-value\" id=\"memResourceValue\">--%</span>\n                        </div>\n
      \                       <div class=\"resource-bar\">\n                            <div
      class=\"resource-bar-fill memory\" id=\"memBar\" style=\"width: 0%\"></div>\n
      \                       </div>\n                    </div>\n                    <div
      id=\"nodeResources\" style=\"margin-top: 20px;\">\n                        <!--
      Per-node resources will be populated -->\n                    </div>\n                </div>\n
      \           </div>\n\n            <!-- Pod Issues Card -->\n            <div
      class=\"card\">\n                <div class=\"card-header\">\n                    <div
      class=\"card-title\">\n                        <div class=\"icon pods\">&#128230;</div>\n
      \                       Pod Issues\n                    </div>\n                </div>\n
      \               <div class=\"card-content\">\n                    <div class=\"pod-list\"
      id=\"podList\">\n                        <div class=\"empty-state\">\n                            <div
      class=\"icon\">&#10004;</div>\n                            <p>All pods healthy</p>\n
      \                       </div>\n                    </div>\n                </div>\n
      \           </div>\n\n            <!-- Alerts Card -->\n            <div class=\"card\">\n
      \               <div class=\"card-header\">\n                    <div class=\"card-title\">\n
      \                       <div class=\"icon alerts\">&#9888;</div>\n                        Active
      Alerts\n                    </div>\n                </div>\n                <div
      class=\"card-content\">\n                    <div class=\"alert-list\" id=\"alertList\">\n
      \                       <div class=\"empty-state\">\n                            <div
      class=\"icon\">&#10004;</div>\n                            <p>No active alerts</p>\n
      \                       </div>\n                    </div>\n                </div>\n
      \           </div>\n        </div>\n\n        <div class=\"last-updated\">\n
      \           Last updated: <span id=\"lastUpdated\">--</span>\n        </div>\n
      \   </main>\n\n    <script>\n        let ws = null;\n        let reconnectAttempts
      = 0;\n        const maxReconnectAttempts = 10;\n\n        function connectWebSocket()
      {\n            const protocol = window.location.protocol === 'https:' ? 'wss:'
      : 'ws:';\n            const wsUrl = protocol + '//' + window.location.host +
      '/ws';\n\n            ws = new WebSocket(wsUrl);\n\n            // Connection
      timeout - if not connected within 10 seconds, show error\n            const
      connectionTimeout = setTimeout(function() {\n                if (ws.readyState
      !== WebSocket.OPEN) {\n                    console.log('WebSocket connection
      timeout');\n                    ws.close();\n                    showErrorState(new
      Error('WebSocket connection timed out after 10 seconds'));\n                }\n
      \           }, 10000);\n\n            ws.onopen = function() {\n                clearTimeout(connectionTimeout);\n
      \               console.log('WebSocket connected');\n                reconnectAttempts
      = 0;\n                updateConnectionStatus(true);\n            };\n\n            ws.onmessage
      = function(event) {\n                const data = JSON.parse(event.data);\n
      \               if (data.type === 'health_update') {\n                    updateDashboard(data.data);\n
      \               }\n            };\n\n            ws.onclose = function() {\n
      \               clearTimeout(connectionTimeout);\n                console.log('WebSocket
      disconnected');\n                updateConnectionStatus(false);\n                scheduleReconnect();\n
      \           };\n\n            ws.onerror = function(error) {\n                clearTimeout(connectionTimeout);\n
      \               console.error('WebSocket error:', error);\n                showErrorState(new
      Error('WebSocket connection failed'));\n            };\n        }\n\n        function
      scheduleReconnect() {\n            if (reconnectAttempts < maxReconnectAttempts)
      {\n                reconnectAttempts++;\n                const delay = Math.min(1000
      * Math.pow(2, reconnectAttempts), 30000);\n                console.log('Reconnecting
      in ' + delay + 'ms...');\n                setTimeout(connectWebSocket, delay);\n
      \           }\n        }\n\n        function updateConnectionStatus(connected)
      {\n            const el = document.getElementById('connectionStatus');\n            if
      (connected) {\n                el.className = 'connection-status connected';\n
      \               el.innerHTML = '<span>&#9679;</span><span>Live</span>';\n            }
      else {\n                el.className = 'connection-status disconnected';\n                el.innerHTML
      = '<span>&#9679;</span><span>Disconnected</span>';\n            }\n        }\n\n
      \       function updateDashboard(health) {\n            // Update status indicator\n
      \           const statusDot = document.getElementById('statusDot');\n            const
      statusText = document.getElementById('statusText');\n            statusDot.className
      = 'status-dot ' + health.status;\n            statusText.textContent = health.status.charAt(0).toUpperCase()
      + health.status.slice(1);\n\n            // Update health score\n            const
      score = health.health_score || 0;\n            const scoreValue = document.getElementById('scoreValue');\n
      \           const scoreProgress = document.getElementById('scoreProgress');\n
      \           const healthMessage = document.getElementById('healthMessage');\n\n
      \           scoreValue.textContent = score;\n            const circumference
      = 2 * Math.PI * 45;\n            const offset = circumference - (score / 100)
      * circumference;\n            scoreProgress.style.strokeDashoffset = offset;\n
      \           scoreProgress.className = 'progress ' + health.status;\n\n            healthMessage.textContent
      = health.message || 'Loading...';\n            healthMessage.className = 'message
      ' + health.status;\n\n            // Update vital signs\n            const vitalSigns
      = document.getElementById('vitalSigns');\n            if (health.vital_signs)
      {\n                const vitals = health.vital_signs;\n                vitalSigns.innerHTML
      = '' +\n                    createVitalSign('&#128147;', 'Heartbeat', vitals.heartbeat
      || 'unknown') +\n                    createVitalSign('&#9881;', 'API Server',
      vitals.api_server_status || 'unknown') +\n                    createVitalSign('&#128190;',
      'etcd', vitals.etcd_status || 'unknown') +\n                    createVitalSign('&#128197;',
      'Scheduler', vitals.scheduler_status || 'unknown') +\n                    createVitalSign('&#127760;',
      'DNS', vitals.dns_status || 'unknown');\n            }\n\n            // Update
      stats\n            const ch = health.cluster_health || {};\n            document.getElementById('nodeCount').textContent
      = ch.total_nodes || 0;\n            document.getElementById('nodeDetail').textContent
      = (ch.ready_nodes || 0) + ' ready';\n            document.getElementById('podCount').textContent
      = ch.total_pods || 0;\n            document.getElementById('podDetail').textContent
      = (ch.running_pods || 0) + ' running, ' + (ch.pending_pods || 0) + ' pending';\n\n
      \           const cpuPct = Math.round(ch.cpu_percent || 0);\n            document.getElementById('cpuUsage').textContent
      = cpuPct + '%';\n            document.getElementById('cpuDetail').textContent
      = ((ch.used_cpu_cores || 0) / 1000).toFixed(1) + ' / ' + ((ch.total_cpu_cores
      || 0) / 1000).toFixed(1) + ' cores';\n\n            const memPct = Math.round(ch.memory_percent
      || 0);\n            document.getElementById('memUsage').textContent = memPct
      + '%';\n            document.getElementById('memDetail').textContent = (ch.used_memory_gb
      || 0).toFixed(1) + ' / ' + (ch.total_memory_gb || 0).toFixed(1) + ' GB';\n\n
      \           // Update resource bars\n            document.getElementById('cpuResourceValue').textContent
      = cpuPct + '%';\n            document.getElementById('cpuBar').style.width =
      cpuPct + '%';\n            updateBarColor('cpuBar', cpuPct);\n\n            document.getElementById('memResourceValue').textContent
      = memPct + '%';\n            document.getElementById('memBar').style.width =
      memPct + '%';\n            updateBarColor('memBar', memPct);\n\n            //
      Update node list\n            const nodeList = document.getElementById('nodeList');\n
      \           if (health.node_statuses && health.node_statuses.length > 0) {\n
      \               nodeList.innerHTML = health.node_statuses.map(node => {\n                    const
      isNotJoined = node.status === 'NotJoined';\n                    const statusClass
      = node.ready ? 'ready' : (isNotJoined ? 'not-joined' : 'not-ready');\n                    const
      itemClass = isNotJoined ? 'node-item not-joined' : 'node-item';\n                    const
      statusBadge = isNotJoined ? '<span class=\"node-status-badge not-joined\">Not
      Joined</span>' : '';\n                    const metricsDisplay = isNotJoined
      ? '--' : Math.round(node.cpu_percent) + '%';\n                    const memDisplay
      = isNotJoined ? '--' : Math.round(node.memory_percent) + '%';\n                    return
      '<div class=\"' + itemClass + '\">' +\n                        '<div class=\"node-info\">'
      +\n                            '<div class=\"node-status-dot ' + statusClass
      + '\"></div>' +\n                            '<div>' +\n                                '<div
      class=\"node-name\">' + node.name + statusBadge + '</div>' +\n                                '<div
      class=\"node-pods\">' + (isNotJoined ? 'Not in cluster' : node.pod_count + '
      pods') + '</div>' +\n                            '</div>' +\n                        '</div>'
      +\n                        '<div class=\"node-metrics\">' +\n                            '<div
      class=\"node-metric\">' +\n                                '<div class=\"node-metric-value\">'
      + metricsDisplay + '</div>' +\n                                '<div class=\"node-metric-label\">CPU</div>'
      +\n                            '</div>' +\n                            '<div
      class=\"node-metric\">' +\n                                '<div class=\"node-metric-value\">'
      + memDisplay + '</div>' +\n                                '<div class=\"node-metric-label\">Memory</div>'
      +\n                            '</div>' +\n                        '</div>'
      +\n                    '</div>';\n                }).join('');\n\n                //
      Update per-node resources\n                const nodeResources = document.getElementById('nodeResources');\n
      \               nodeResources.innerHTML = health.node_statuses.map(node => {\n
      \                   const isNotJoined = node.status === 'NotJoined';\n                    if
      (isNotJoined) {\n                        return '<div class=\"resource-section\"
      style=\"opacity: 0.5;\">' +\n                            '<div class=\"resource-header\">'
      +\n                                '<span class=\"resource-label\">' + node.name
      + '</span>' +\n                                '<span class=\"resource-value\"
      style=\"color: var(--ctp-overlay0);\">Not Joined</span>' +\n                            '</div>'
      +\n                            '<div style=\"display: flex; gap: 8px;\">' +\n
      \                               '<div class=\"resource-bar\" style=\"flex: 1;
      border: 1px dashed var(--ctp-overlay0);\">' +\n                                '</div>'
      +\n                                '<div class=\"resource-bar\" style=\"flex:
      1; border: 1px dashed var(--ctp-overlay0);\">' +\n                                '</div>'
      +\n                            '</div>' +\n                        '</div>';\n
      \                   }\n                    const cpuClass = getResourceClass(node.cpu_percent);\n
      \                   const memClass = getResourceClass(node.memory_percent);\n
      \                   return '<div class=\"resource-section\">' +\n                        '<div
      class=\"resource-header\">' +\n                            '<span class=\"resource-label\">'
      + node.name + '</span>' +\n                            '<span class=\"resource-value\">'
      + Math.round(node.cpu_percent) + '% / ' + Math.round(node.memory_percent) +
      '%</span>' +\n                        '</div>' +\n                        '<div
      style=\"display: flex; gap: 8px;\">' +\n                            '<div class=\"resource-bar\"
      style=\"flex: 1;\">' +\n                                '<div class=\"resource-bar-fill
      ' + cpuClass + '\" style=\"width: ' + node.cpu_percent + '%\"></div>' +\n                            '</div>'
      +\n                            '<div class=\"resource-bar\" style=\"flex: 1;\">'
      +\n                                '<div class=\"resource-bar-fill ' + memClass
      + '\" style=\"width: ' + node.memory_percent + '%\"></div>' +\n                            '</div>'
      +\n                        '</div>' +\n                    '</div>';\n                }).join('');\n
      \           } else {\n                nodeList.innerHTML = '<div class=\"empty-state\"><div
      class=\"icon\">&#128421;</div><p>No nodes found</p></div>';\n            }\n\n
      \           // Update pod issues\n            const podList = document.getElementById('podList');\n
      \           if (health.pod_statuses && health.pod_statuses.length > 0) {\n                podList.innerHTML
      = health.pod_statuses.slice(0, 10).map(pod => {\n                    const phaseClass
      = pod.phase.toLowerCase();\n                    return '<div class=\"pod-item\">'
      +\n                        '<div class=\"pod-info\">' +\n                            '<span
      class=\"pod-phase ' + phaseClass + '\">' + pod.phase + '</span>' +\n                            '<div>'
      +\n                                '<div class=\"pod-name\">' + pod.name + '</div>'
      +\n                                '<div class=\"pod-namespace\">' + pod.namespace
      + '</div>' +\n                            '</div>' +\n                        '</div>'
      +\n                        (pod.restarts > 0 ? '<span class=\"pod-restarts\">'
      + pod.restarts + ' restarts</span>' : '') +\n                    '</div>';\n
      \               }).join('');\n            } else {\n                podList.innerHTML
      = '<div class=\"empty-state\"><div class=\"icon\">&#10004;</div><p>All pods
      healthy</p></div>';\n            }\n\n            // Update alerts\n            const
      alertList = document.getElementById('alertList');\n            if (health.resource_alerts
      && health.resource_alerts.length > 0) {\n                alertList.innerHTML
      = health.resource_alerts.slice(0, 10).map(alert => {\n                    const
      time = new Date(alert.timestamp).toLocaleTimeString();\n                    return
      '<div class=\"alert-item ' + alert.severity + '\">' +\n                        '<div
      class=\"alert-header\">' +\n                            '<span class=\"alert-severity
      ' + alert.severity + '\">' + alert.severity + '</span>' +\n                            '<span
      class=\"alert-time\">' + time + '</span>' +\n                        '</div>'
      +\n                        '<div class=\"alert-message\">' + alert.message +
      '</div>' +\n                        '<div class=\"alert-node\">' + alert.resource
      + ': ' + Math.round(alert.value) + '% (threshold: ' + alert.threshold + '%)</div>'
      +\n                    '</div>';\n                }).join('');\n            }
      else {\n                alertList.innerHTML = '<div class=\"empty-state\"><div
      class=\"icon\">&#10004;</div><p>No active alerts</p></div>';\n            }\n\n
      \           // Update timestamp\n            document.getElementById('lastUpdated').textContent
      = new Date(health.timestamp).toLocaleString();\n        }\n\n        function
      createVitalSign(icon, name, status) {\n            const statusClass = status
      === 'healthy' || status === 'normal' ? 'healthy' : 'unhealthy';\n            return
      '<div class=\"vital-sign ' + statusClass + '\">' +\n                '<span class=\"icon\">'
      + icon + '</span>' +\n                '<span>' + name + '</span>' +\n                '<span
      class=\"status\">' + (status === 'healthy' || status === 'normal' ? '&#10004;'
      : '&#10008;') + '</span>' +\n            '</div>';\n        }\n\n        function
      updateBarColor(id, value) {\n            const bar = document.getElementById(id);\n
      \           bar.classList.remove('cpu', 'memory', 'warning', 'critical');\n
      \           if (value > 90) {\n                bar.classList.add('critical');\n
      \           } else if (value > 80) {\n                bar.classList.add('warning');\n
      \           } else if (id === 'cpuBar') {\n                bar.classList.add('cpu');\n
      \           } else {\n                bar.classList.add('memory');\n            }\n
      \       }\n\n        function getResourceClass(value) {\n            if (value
      > 90) return 'critical';\n            if (value > 80) return 'warning';\n            if
      (value > 50) return 'memory';\n            return 'cpu';\n        }\n\n        //
      Initial loading timeout - show error if nothing loads within 10 seconds\n        const
      initialLoadTimeout = setTimeout(function() {\n            const nodeList = document.getElementById('nodeList');\n
      \           if (nodeList.innerHTML.includes('Loading nodes')) {\n                showErrorState(new
      Error('Initial load timed out - Kubernetes API may be unavailable'));\n            }\n
      \       }, 10000);\n\n        // Clear timeout when data loads\n        const
      originalUpdateDashboard = updateDashboard;\n        updateDashboard = function(health)
      {\n            clearTimeout(initialLoadTimeout);\n            originalUpdateDashboard(health);\n
      \       };\n\n        // Initial connection\n        connectWebSocket();\n\n
      \       // Fallback to polling if WebSocket fails\n        setInterval(function()
      {\n            if (!ws || ws.readyState !== WebSocket.OPEN) {\n                fetchStatusWithTimeout();\n
      \           }\n        }, 15000);\n\n        // Fetch status with timeout\n
      \       async function fetchStatusWithTimeout() {\n            const controller
      = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(),
      10000);\n\n            try {\n                const res = await fetch('/api/status',
      { signal: controller.signal });\n                clearTimeout(timeoutId);\n\n
      \               if (!res.ok) {\n                    throw new Error('HTTP '
      + res.status + ': ' + res.statusText);\n                }\n\n                const
      data = await res.json();\n                updateDashboard(data);\n            }
      catch (err) {\n                clearTimeout(timeoutId);\n                console.error('Polling
      error:', err);\n                showErrorState(err);\n            }\n        }\n\n
      \       // Show error state in the dashboard\n        function showErrorState(err)
      {\n            let errorMsg = err.message;\n            if (err.name === 'AbortError')
      {\n                errorMsg = 'Request timed out after 10 seconds';\n            }\n\n
      \           const nodeList = document.getElementById('nodeList');\n            nodeList.innerHTML
      = '<div style=\"padding:24px;text-align:center;background:rgba(243,139,168,0.1);border-radius:10px;border:1px
      solid var(--ctp-red);\">' +\n                '<div style=\"font-size:24px;margin-bottom:12px;\">&#9888;</div>'
      +\n                '<div style=\"color:var(--ctp-red);font-weight:600;margin-bottom:8px;\">Failed
      to Load Nodes</div>' +\n                '<div style=\"color:var(--ctp-subtext0);font-size:13px;margin-bottom:12px;\">'
      + errorMsg + '</div>' +\n                '<div style=\"color:var(--ctp-overlay0);font-size:11px;\">Endpoint:
      /api/status</div>' +\n            '</div>';\n\n            document.getElementById('statusDot').className
      = 'status-dot unknown';\n            document.getElementById('statusText').textContent
      = 'Error';\n            document.getElementById('healthMessage').textContent
      = errorMsg;\n            document.getElementById('healthMessage').className
      = 'message critical';\n        }\n\n        // Initial fetch with timeout\n
      \       fetchStatusWithTimeout();\n    </script>\n</body>\n</html>`\n}\n"
    go.mod: |
      module pulse

      go 1.21

      require github.com/gorilla/websocket v1.5.1

      require golang.org/x/net v0.17.0 // indirect
    go.sum: |
      github.com/gorilla/websocket v1.5.1 h1:gmztn0JnHVt9JZquRuzLw3g4wouNVzKL15iLr/zn/QY=
      github.com/gorilla/websocket v1.5.1/go.mod h1:x3kM2JMyaluk02fnUJpQuwD2dCS5NDG2ZHL0uE0tcaY=
      golang.org/x/net v0.17.0 h1:pVaXccu2ozPjCXewfr1S7xza/zcXTity9cCdXQYSjIM=
      golang.org/x/net v0.17.0/go.mod h1:NxSsAGuq816PNPmqtQdLE42eU2Fs7NoRIZrHJAlaCOE=
    main.go: "package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/gorilla/websocket\"\n)\n\n//
      WebSocket upgrader\nvar upgrader = websocket.Upgrader{\n\tCheckOrigin: func(r
      *http.Request) bool {\n\t\treturn true\n\t},\n\tReadBufferSize:  1024,\n\tWriteBufferSize:
      1024,\n}\n\n// WebSocket clients\nvar (\n\tclients     = make(map[*websocket.Conn]bool)\n\tclientsMux
      \ sync.RWMutex\n\tbroadcast   = make(chan HealthUpdate, 100)\n)\n\n// Health
      state\nvar (\n\tcurrentHealth HealthStatus\n\thealthMux     sync.RWMutex\n\talertHistory
      \ []Alert\n\talertMux      sync.RWMutex\n)\n\n// Data structures\ntype HealthStatus
      struct {\n\tStatus           string          `json:\"status\"`\n\tMessage          string
      \         `json:\"message\"`\n\tTimestamp        time.Time       `json:\"timestamp\"`\n\tClusterHealth
      \   ClusterHealth   `json:\"cluster_health\"`\n\tNodeStatuses     []NodeStatus
      \   `json:\"node_statuses\"`\n\tPodStatuses      []PodStatus     `json:\"pod_statuses\"`\n\tResourceAlerts
      \  []ResourceAlert `json:\"resource_alerts\"`\n\tHealthScore      int             `json:\"health_score\"`\n\tVitalSigns
      \      VitalSigns      `json:\"vital_signs\"`\n}\n\ntype ClusterHealth struct
      {\n\tTotalNodes       int     `json:\"total_nodes\"`\n\tReadyNodes       int
      \    `json:\"ready_nodes\"`\n\tTotalPods        int     `json:\"total_pods\"`\n\tRunningPods
      \     int     `json:\"running_pods\"`\n\tPendingPods      int     `json:\"pending_pods\"`\n\tFailedPods
      \      int     `json:\"failed_pods\"`\n\tTotalCPUCores    float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores
      \    float64 `json:\"used_cpu_cores\"`\n\tCPUPercent       float64 `json:\"cpu_percent\"`\n\tTotalMemoryGB
      \   float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tMemoryPercent
      \   float64 `json:\"memory_percent\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tHealthyDeploys
      \  int     `json:\"healthy_deployments\"`\n}\n\ntype NodeStatus struct {\n\tName
      \        string    `json:\"name\"`\n\tStatus       string    `json:\"status\"`\n\tReady
      \       bool      `json:\"ready\"`\n\tCPUPercent   float64   `json:\"cpu_percent\"`\n\tMemoryPercent
      float64  `json:\"memory_percent\"`\n\tPodCount     int       `json:\"pod_count\"`\n\tConditions
      \  []string  `json:\"conditions\"`\n\tLastChecked  time.Time `json:\"last_checked\"`\n}\n\ntype
      PodStatus struct {\n\tName       string `json:\"name\"`\n\tNamespace  string
      `json:\"namespace\"`\n\tNode       string `json:\"node\"`\n\tPhase      string
      `json:\"phase\"`\n\tReady      bool   `json:\"ready\"`\n\tRestarts   int    `json:\"restarts\"`\n\tCPUm
      \      float64 `json:\"cpu_m\"`\n\tMemoryMB   float64 `json:\"memory_mb\"`\n}\n\ntype
      ResourceAlert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string
      \   `json:\"severity\"`\n\tResource  string    `json:\"resource\"`\n\tNode      string
      \   `json:\"node\"`\n\tMessage   string    `json:\"message\"`\n\tValue     float64
      \  `json:\"value\"`\n\tThreshold float64   `json:\"threshold\"`\n\tTimestamp
      time.Time `json:\"timestamp\"`\n}\n\ntype VitalSigns struct {\n\tHeartbeat       string
      `json:\"heartbeat\"`\n\tAPIServerStatus string `json:\"api_server_status\"`\n\tETCDStatus
      \     string `json:\"etcd_status\"`\n\tSchedulerStatus string `json:\"scheduler_status\"`\n\tControllerStatus
      string `json:\"controller_status\"`\n\tDNSStatus       string `json:\"dns_status\"`\n}\n\ntype
      Alert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string    `json:\"severity\"`\n\tTitle
      \    string    `json:\"title\"`\n\tMessage   string    `json:\"message\"`\n\tResource
      \ string    `json:\"resource\"`\n\tTimestamp time.Time `json:\"timestamp\"`\n\tResolved
      \ bool      `json:\"resolved\"`\n}\n\ntype HealthUpdate struct {\n\tType   string
      \     `json:\"type\"`\n\tData   interface{} `json:\"data\"`\n}\n\n// K8s API
      structures\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype
      K8sNode struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t}
      `json:\"metadata\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType
      \  string `json:\"type\"`\n\t\t\tStatus string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity
      struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t}
      `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory
      string `json:\"memory\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric `json:\"items\"`\n}\n\ntype
      K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t}
      `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string `json:\"cpu\"`\n\t\tMemory
      string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype K8sPodList struct
      {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct {\n\tMetadata
      struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t}
      `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName string `json:\"nodeName\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string `json:\"phase\"`\n\t\tContainerStatuses
      []struct {\n\t\t\tReady        bool `json:\"ready\"`\n\t\t\tRestartCount int
      \ `json:\"restartCount\"`\n\t\t} `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype
      K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype
      K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace
      string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct
      {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string
      `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t}
      `json:\"containers\"`\n}\n\ntype K8sDeploymentList struct {\n\tItems []K8sDeployment
      `json:\"items\"`\n}\n\ntype K8sDeployment struct {\n\tMetadata struct {\n\t\tName
      \     string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t}
      `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas int `json:\"replicas\"`\n\t}
      `json:\"spec\"`\n\tStatus struct {\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t\tReplicas
      \     int `json:\"replicas\"`\n\t} `json:\"status\"`\n}\n\ntype K8sComponentStatusList
      struct {\n\tItems []struct {\n\t\tMetadata struct {\n\t\t\tName string `json:\"name\"`\n\t\t}
      `json:\"metadata\"`\n\t\tConditions []struct {\n\t\t\tType   string `json:\"type\"`\n\t\t\tStatus
      string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t} `json:\"items\"`\n}\n\n//
      All 13 cluster nodes - hardcoded list\nvar allClusterNodes = []string{\n\t\"rpi-1\",
      \"rpi-2\", \"rpi-3\", \"rpi-4\", \"rpi-5\", \"rpi-6\",\n\t\"rpi-7\", \"rpi-8\",
      \"rpi-9\", \"rpi-10\", \"rpi-11\", \"rpi-12\",\n\t\"openmediavault\",\n}\n\n//
      K8s API client\nfunc k8sAPIRequest(path string) ([]byte, error) {\n\ttoken,
      err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token:
      %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort
      := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer
      = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\",
      apiServer, apiPort, path)\n\n\ttransport := &http.Transport{\n\t\tTLSClientConfig:
      &tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := &http.Client{\n\t\tTransport:
      transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\",
      apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\",
      \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil
      {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n//
      Parse K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif
      strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif
      strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s,
      \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn
      val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts
      = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\")
      {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if
      strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier
      = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s,
      \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s,
      64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch
      cluster health\nfunc fetchClusterHealth() (*HealthStatus, error) {\n\tstatus
      := &HealthStatus{\n\t\tTimestamp: time.Now(),\n\t}\n\n\t// Fetch nodes\n\tnodeData,
      err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif err != nil {\n\t\treturn nil,
      fmt.Errorf(\"failed to fetch nodes: %v\", err)\n\t}\n\n\tvar nodeList K8sNodeList\n\tif
      err := json.Unmarshal(nodeData, &nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t//
      Fetch node metrics\n\tnodeMetricsData, _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tvar
      nodeMetricsList K8sNodeMetricsList\n\tjson.Unmarshal(nodeMetricsData, &nodeMetricsList)\n\n\tmetricsMap
      := make(map[string]K8sNodeMetric)\n\tfor _, m := range nodeMetricsList.Items
      {\n\t\tmetricsMap[m.Metadata.Name] = m\n\t}\n\n\t// Fetch pods\n\tpodData, err
      := k8sAPIRequest(\"/api/v1/pods\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed
      to fetch pods: %v\", err)\n\t}\n\n\tvar podList K8sPodList\n\tif err := json.Unmarshal(podData,
      &podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Fetch pod metrics\n\tpodMetricsData,
      _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tvar podMetricsList
      K8sPodMetricsList\n\tjson.Unmarshal(podMetricsData, &podMetricsList)\n\n\tpodMetricsMap
      := make(map[string]K8sPodMetric)\n\tfor _, m := range podMetricsList.Items {\n\t\tkey
      := m.Metadata.Namespace + \"/\" + m.Metadata.Name\n\t\tpodMetricsMap[key] =
      m\n\t}\n\n\t// Fetch deployments\n\tdeployData, _ := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tvar
      deployList K8sDeploymentList\n\tjson.Unmarshal(deployData, &deployList)\n\n\t//
      Build node statuses\n\tvar totalCPUCores, usedCPUCores, totalMemMB, usedMemMB
      float64\n\tpodCountByNode := make(map[string]int)\n\n\tfor _, pod := range podList.Items
      {\n\t\tif pod.Status.Phase == \"Running\" {\n\t\t\tpodCountByNode[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t//
      Build a map of k8s nodes for quick lookup\n\tk8sNodeMap := make(map[string]K8sNode)\n\tfor
      _, node := range nodeList.Items {\n\t\tk8sNodeMap[node.Metadata.Name] = node\n\t}\n\n\t//
      Include ALL 13 predefined cluster nodes, even if not in k8s\n\tfor _, nodeName
      := range allClusterNodes {\n\t\tnodeStatus := NodeStatus{\n\t\t\tName:        nodeName,\n\t\t\tLastChecked:
      time.Now(),\n\t\t}\n\n\t\t// Check if node exists in Kubernetes\n\t\tif node,
      exists := k8sNodeMap[nodeName]; exists {\n\t\t\t// Node is in k8s - get its
      real status\n\t\t\tfor _, cond := range node.Status.Conditions {\n\t\t\t\tif
      cond.Type == \"Ready\" {\n\t\t\t\t\tnodeStatus.Ready = cond.Status == \"True\"\n\t\t\t\t\tif
      nodeStatus.Ready {\n\t\t\t\t\t\tnodeStatus.Status = \"Ready\"\n\t\t\t\t\t} else
      {\n\t\t\t\t\t\tnodeStatus.Status = \"NotReady\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif
      cond.Status == \"True\" && cond.Type != \"Ready\" {\n\t\t\t\t\tnodeStatus.Conditions
      = append(nodeStatus.Conditions, cond.Type)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get
      resource usage\n\t\t\tallocCPU := parseCPU(node.Status.Allocatable.CPU)\n\t\t\tallocMem
      := parseMemory(node.Status.Allocatable.Memory)\n\t\t\ttotalCPUCores += allocCPU\n\t\t\ttotalMemMB
      += allocMem\n\n\t\t\tif metrics, ok := metricsMap[nodeName]; ok {\n\t\t\t\tusedCPU
      := parseCPU(metrics.Usage.CPU)\n\t\t\t\tusedMem := parseMemory(metrics.Usage.Memory)\n\t\t\t\tusedCPUCores
      += usedCPU\n\t\t\t\tusedMemMB += usedMem\n\n\t\t\t\tif allocCPU > 0 {\n\t\t\t\t\tnodeStatus.CPUPercent
      = (usedCPU / allocCPU) * 100\n\t\t\t\t}\n\t\t\t\tif allocMem > 0 {\n\t\t\t\t\tnodeStatus.MemoryPercent
      = (usedMem / allocMem) * 100\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Node
      is NOT in k8s yet - show as unknown/not joined\n\t\t\tnodeStatus.Status = \"NotJoined\"\n\t\t\tnodeStatus.Ready
      = false\n\t\t\tnodeStatus.Conditions = []string{\"Not in Kubernetes cluster\"}\n\t\t}\n\n\t\tnodeStatus.PodCount
      = podCountByNode[nodeName]\n\t\tstatus.NodeStatuses = append(status.NodeStatuses,
      nodeStatus)\n\t}\n\n\t// Sort nodes: rpi-1 through rpi-12 numerically, then
      openmediavault\n\tsort.Slice(status.NodeStatuses, func(i, j int) bool {\n\t\tnameI
      := status.NodeStatuses[i].Name\n\t\tnameJ := status.NodeStatuses[j].Name\n\n\t\t//
      Extract numeric part for rpi-N nodes\n\t\tgetNodeOrder := func(name string)
      int {\n\t\t\tif name == \"openmediavault\" {\n\t\t\t\treturn 100 // Always last\n\t\t\t}\n\t\t\tif
      strings.HasPrefix(name, \"rpi-\") {\n\t\t\t\tnumStr := strings.TrimPrefix(name,
      \"rpi-\")\n\t\t\t\tnum, err := strconv.Atoi(numStr)\n\t\t\t\tif err == nil {\n\t\t\t\t\treturn
      num\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 50 // Unknown nodes in the middle\n\t\t}\n\n\t\treturn
      getNodeOrder(nameI) < getNodeOrder(nameJ)\n\t})\n\n\t// Build pod statuses (focus
      on non-running or high restart pods)\n\tfor _, pod := range podList.Items {\n\t\tkey
      := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\n\t\tpodStatus := PodStatus{\n\t\t\tName:
      \     pod.Metadata.Name,\n\t\t\tNamespace: pod.Metadata.Namespace,\n\t\t\tNode:
      \     pod.Spec.NodeName,\n\t\t\tPhase:     pod.Status.Phase,\n\t\t}\n\n\t\t//
      Check container statuses\n\t\tfor _, cs := range pod.Status.ContainerStatuses
      {\n\t\t\tif cs.Ready {\n\t\t\t\tpodStatus.Ready = true\n\t\t\t}\n\t\t\tpodStatus.Restarts
      += cs.RestartCount\n\t\t}\n\n\t\t// Get pod metrics\n\t\tif metrics, ok := podMetricsMap[key];
      ok {\n\t\t\tfor _, container := range metrics.Containers {\n\t\t\t\tpodStatus.CPUm
      += parseCPU(container.Usage.CPU)\n\t\t\t\tpodStatus.MemoryMB += parseMemory(container.Usage.Memory)\n\t\t\t}\n\t\t}\n\n\t\t//
      Only include problematic pods or sample of running pods\n\t\tif pod.Status.Phase
      != \"Running\" || podStatus.Restarts > 5 || !podStatus.Ready {\n\t\t\tstatus.PodStatuses
      = append(status.PodStatuses, podStatus)\n\t\t}\n\t}\n\n\t// Count pod phases\n\tvar
      runningPods, pendingPods, failedPods int\n\tfor _, pod := range podList.Items
      {\n\t\tswitch pod.Status.Phase {\n\t\tcase \"Running\":\n\t\t\trunningPods++\n\t\tcase
      \"Pending\":\n\t\t\tpendingPods++\n\t\tcase \"Failed\":\n\t\t\tfailedPods++\n\t\t}\n\t}\n\n\t//
      Count deployments\n\thealthyDeploys := 0\n\tfor _, deploy := range deployList.Items
      {\n\t\tif deploy.Status.ReadyReplicas >= deploy.Spec.Replicas {\n\t\t\thealthyDeploys++\n\t\t}\n\t}\n\n\t//
      Build cluster health\n\treadyNodes := 0\n\tfor _, ns := range status.NodeStatuses
      {\n\t\tif ns.Ready {\n\t\t\treadyNodes++\n\t\t}\n\t}\n\n\tstatus.ClusterHealth
      = ClusterHealth{\n\t\tTotalNodes:       len(allClusterNodes), // Always show
      all 13 nodes\n\t\tReadyNodes:       readyNodes,\n\t\tTotalPods:        len(podList.Items),\n\t\tRunningPods:
      \     runningPods,\n\t\tPendingPods:      pendingPods,\n\t\tFailedPods:       failedPods,\n\t\tTotalCPUCores:
      \   totalCPUCores,\n\t\tUsedCPUCores:     usedCPUCores,\n\t\tTotalMemoryGB:
      \   totalMemMB / 1024,\n\t\tUsedMemoryGB:     usedMemMB / 1024,\n\t\tTotalDeployments:
      len(deployList.Items),\n\t\tHealthyDeploys:   healthyDeploys,\n\t}\n\n\tif totalCPUCores
      > 0 {\n\t\tstatus.ClusterHealth.CPUPercent = (usedCPUCores / totalCPUCores)
      * 100\n\t}\n\tif totalMemMB > 0 {\n\t\tstatus.ClusterHealth.MemoryPercent =
      (usedMemMB / totalMemMB) * 100\n\t}\n\n\t// Generate resource alerts\n\tfor
      _, ns := range status.NodeStatuses {\n\t\tif ns.CPUPercent > 90 {\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-high-%s\",
      ns.Name),\n\t\t\t\tSeverity:  \"critical\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage critical on %s\",
      ns.Name),\n\t\t\t\tValue:     ns.CPUPercent,\n\t\t\t\tThreshold: 90,\n\t\t\t\tTimestamp:
      time.Now(),\n\t\t\t})\n\t\t} else if ns.CPUPercent > 80 {\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-warn-%s\",
      ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage high on %s\", ns.Name),\n\t\t\t\tValue:
      \    ns.CPUPercent,\n\t\t\t\tThreshold: 80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif
      ns.MemoryPercent > 90 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts,
      ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"mem-high-%s\", ns.Name),\n\t\t\t\tSeverity:
      \ \"critical\",\n\t\t\t\tResource:  \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:
      \  fmt.Sprintf(\"Memory usage critical on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold:
      90,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t} else if ns.MemoryPercent
      > 80 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:
      \       fmt.Sprintf(\"mem-warn-%s\", ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:
      \ \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"Memory
      usage high on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold:
      80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif !ns.Ready {\n\t\t\tvar
      msg string\n\t\t\tvar severity string\n\t\t\tif ns.Status == \"NotJoined\" {\n\t\t\t\tmsg
      = fmt.Sprintf(\"Node %s has not joined the cluster\", ns.Name)\n\t\t\t\tseverity
      = \"warning\" // Not joined is warning, not critical\n\t\t\t} else {\n\t\t\t\tmsg
      = fmt.Sprintf(\"Node %s is not ready\", ns.Name)\n\t\t\t\tseverity = \"critical\"\n\t\t\t}\n\t\t\tstatus.ResourceAlerts
      = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"node-notready-%s\",
      ns.Name),\n\t\t\t\tSeverity:  severity,\n\t\t\t\tResource:  \"node\",\n\t\t\t\tNode:
      \     ns.Name,\n\t\t\t\tMessage:   msg,\n\t\t\t\tValue:     0,\n\t\t\t\tThreshold:
      0,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\t}\n\n\t// Check vital
      signs\n\tstatus.VitalSigns = VitalSigns{\n\t\tHeartbeat:       \"normal\",\n\t\tAPIServerStatus:
      \"healthy\",\n\t}\n\n\t// Try to get component statuses\n\tcompData, err :=
      k8sAPIRequest(\"/api/v1/componentstatuses\")\n\tif err == nil {\n\t\tvar compList
      K8sComponentStatusList\n\t\tif json.Unmarshal(compData, &compList) == nil {\n\t\t\tfor
      _, comp := range compList.Items {\n\t\t\t\thealthy := false\n\t\t\t\tfor _,
      cond := range comp.Conditions {\n\t\t\t\t\tif cond.Type == \"Healthy\" && cond.Status
      == \"True\" {\n\t\t\t\t\t\thealthy = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tswitch
      comp.Metadata.Name {\n\t\t\t\tcase \"etcd-0\", \"etcd\":\n\t\t\t\t\tif healthy
      {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"healthy\"\n\t\t\t\t\t} else
      {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase
      \"scheduler\":\n\t\t\t\t\tif healthy {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus
      = \"healthy\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus
      = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase \"controller-manager\":\n\t\t\t\t\tif
      healthy {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"healthy\"\n\t\t\t\t\t}
      else {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//
      Check CoreDNS\n\tfor _, deploy := range deployList.Items {\n\t\tif deploy.Metadata.Name
      == \"coredns\" && deploy.Metadata.Namespace == \"kube-system\" {\n\t\t\tif deploy.Status.ReadyReplicas
      > 0 {\n\t\t\t\tstatus.VitalSigns.DNSStatus = \"healthy\"\n\t\t\t} else {\n\t\t\t\tstatus.VitalSigns.DNSStatus
      = \"unhealthy\"\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t}\n\n\t// Calculate health score\n\tscore
      := 100\n\tif status.ClusterHealth.ReadyNodes < status.ClusterHealth.TotalNodes
      {\n\t\tscore -= (status.ClusterHealth.TotalNodes - status.ClusterHealth.ReadyNodes)
      * 15\n\t}\n\tif status.ClusterHealth.FailedPods > 0 {\n\t\tscore -= status.ClusterHealth.FailedPods
      * 5\n\t}\n\tif status.ClusterHealth.PendingPods > 5 {\n\t\tscore -= 10\n\t}\n\tif
      status.ClusterHealth.CPUPercent > 90 {\n\t\tscore -= 15\n\t} else if status.ClusterHealth.CPUPercent
      > 80 {\n\t\tscore -= 5\n\t}\n\tif status.ClusterHealth.MemoryPercent > 90 {\n\t\tscore
      -= 15\n\t} else if status.ClusterHealth.MemoryPercent > 80 {\n\t\tscore -= 5\n\t}\n\tif
      len(status.ResourceAlerts) > 0 {\n\t\tfor _, alert := range status.ResourceAlerts
      {\n\t\t\tif alert.Severity == \"critical\" {\n\t\t\t\tscore -= 10\n\t\t\t} else
      {\n\t\t\t\tscore -= 5\n\t\t\t}\n\t\t}\n\t}\n\tif score < 0 {\n\t\tscore = 0\n\t}\n\tstatus.HealthScore
      = score\n\n\t// Determine overall status and message\n\tif score >= 90 {\n\t\tstatus.Status
      = \"healthy\"\n\t\tstatus.Message = \"Vital signs are looking good\"\n\t} else
      if score >= 70 {\n\t\tstatus.Status = \"warning\"\n\t\tstatus.Message = \"Some
      vital signs need attention\"\n\t} else if score >= 50 {\n\t\tstatus.Status =
      \"degraded\"\n\t\tstatus.Message = \"Cluster health is degraded\"\n\t} else
      {\n\t\tstatus.Status = \"critical\"\n\t\tstatus.Message = \"Critical issues
      detected\"\n\t}\n\n\treturn status, nil\n}\n\n// Health monitor loop\nfunc healthMonitor()
      {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor
      {\n\t\thealth, err := fetchClusterHealth()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error
      fetching health: %v\", err)\n\t\t\thealth = &HealthStatus{\n\t\t\t\tStatus:
      \   \"unknown\",\n\t\t\t\tMessage:   \"Unable to fetch cluster health\",\n\t\t\t\tTimestamp:
      time.Now(),\n\t\t\t}\n\t\t}\n\n\t\thealthMux.Lock()\n\t\tcurrentHealth = *health\n\t\thealthMux.Unlock()\n\n\t\t//
      Broadcast to WebSocket clients\n\t\tbroadcast <- HealthUpdate{\n\t\t\tType:
      \"health_update\",\n\t\t\tData: health,\n\t\t}\n\n\t\t<-ticker.C\n\t}\n}\n\n//
      WebSocket broadcaster\nfunc handleBroadcast() {\n\tfor update := range broadcast
      {\n\t\tclientsMux.RLock()\n\t\tfor client := range clients {\n\t\t\terr := client.WriteJSON(update)\n\t\t\tif
      err != nil {\n\t\t\t\tlog.Printf(\"WebSocket write error: %v\", err)\n\t\t\t\tclient.Close()\n\t\t\t\tclientsMux.RUnlock()\n\t\t\t\tclientsMux.Lock()\n\t\t\t\tdelete(clients,
      client)\n\t\t\t\tclientsMux.Unlock()\n\t\t\t\tclientsMux.RLock()\n\t\t\t}\n\t\t}\n\t\tclientsMux.RUnlock()\n\t}\n}\n\n//
      HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":
      \ \"healthy\",\n\t\t\"service\": \"pulse\",\n\t\t\"message\": \"Vital signs
      are looking good\",\n\t})\n}\n\nfunc handleStatus(w http.ResponseWriter, r *http.Request)
      {\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(health)\n}\n\nfunc handleNodes(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tnodes := currentHealth.NodeStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tpods := currentHealth.PodStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleAlerts(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\talerts := currentHealth.ResourceAlerts\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(alerts)\n}\n\nfunc handleVitals(w
      http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tvitals := currentHealth.VitalSigns\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(vitals)\n}\n\nfunc handleWebSocket(w
      http.ResponseWriter, r *http.Request) {\n\tconn, err := upgrader.Upgrade(w,
      r, nil)\n\tif err != nil {\n\t\tlog.Printf(\"WebSocket upgrade error: %v\",
      err)\n\t\treturn\n\t}\n\n\tclientsMux.Lock()\n\tclients[conn] = true\n\tclientsMux.Unlock()\n\n\t//
      Send current health immediately\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tconn.WriteJSON(HealthUpdate{\n\t\tType:
      \"health_update\",\n\t\tData: health,\n\t})\n\n\t// Keep connection alive and
      handle disconnection\n\tfor {\n\t\t_, _, err := conn.ReadMessage()\n\t\tif err
      != nil {\n\t\t\tclientsMux.Lock()\n\t\t\tdelete(clients, conn)\n\t\t\tclientsMux.Unlock()\n\t\t\tconn.Close()\n\t\t\tbreak\n\t\t}\n\t}\n}\n\nfunc
      handleDashboard(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"text/html\")\n\tw.Write([]byte(getDashboardHTML()))\n}\n\nfunc main() {\n\t//
      Initialize health status\n\tcurrentHealth = HealthStatus{\n\t\tStatus:    \"initializing\",\n\t\tMessage:
      \  \"Starting health monitor...\",\n\t\tTimestamp: time.Now(),\n\t}\n\n\t//
      Start health monitor\n\tgo healthMonitor()\n\n\t// Start WebSocket broadcaster\n\tgo
      handleBroadcast()\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t//
      API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\tmux.HandleFunc(\"/api/status\",
      handleStatus)\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/pods\",
      handlePods)\n\tmux.HandleFunc(\"/api/alerts\", handleAlerts)\n\tmux.HandleFunc(\"/api/vitals\",
      handleVitals)\n\tmux.HandleFunc(\"/ws\", handleWebSocket)\n\n\t// Dashboard\n\tmux.HandleFunc(\"/\",
      handleDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport
      = \"8080\"\n\t}\n\n\tlog.Printf(\"Pulse health monitor starting on port %s\",
      port)\n\tlog.Printf(\"Vital signs are looking good\")\n\tlog.Fatal(http.ListenAndServe(\":\"+port,
      mux))\n}\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM golang:1.21-alpine AS builder\n\nWORKDIR /app\n\n# Copy go mod files\nCOPY go.mod go.sum ./\n\n# Download dependencies\nRUN go mod download\n\n# Copy source files\nCOPY *.go ./\n\n# Build the binary for ARM64\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags=\"-s -w\" -o pulse .\n\n# Final image\nFROM alpine:3.19\n\nRUN apk --no-cache add ca-certificates tzdata\n\nWORKDIR /app\n\nCOPY --from=builder /app/pulse .\n\nEXPOSE 8080\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD wget --no-verbose --tries=1 --spider http://localhost:8080/health || exit 1\n\nCMD [\"./pulse\"]\n","dashboard.go":"package main\n\nfunc getDashboardHTML() string {\n\treturn `\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u003ctitle\u003ePulse - Cluster Health Monitor\u003c/title\u003e\n    \u003cstyle\u003e\n        /* Catppuccin Mocha Theme */\n        :root {\n            --ctp-rosewater: #f5e0dc;\n            --ctp-flamingo: #f2cdcd;\n            --ctp-pink: #f5c2e7;\n            --ctp-mauve: #cba6f7;\n            --ctp-red: #f38ba8;\n            --ctp-maroon: #eba0ac;\n            --ctp-peach: #fab387;\n            --ctp-yellow: #f9e2af;\n            --ctp-green: #a6e3a1;\n            --ctp-teal: #94e2d5;\n            --ctp-sky: #89dceb;\n            --ctp-sapphire: #74c7ec;\n            --ctp-blue: #89b4fa;\n            --ctp-lavender: #b4befe;\n            --ctp-text: #cdd6f4;\n            --ctp-subtext1: #bac2de;\n            --ctp-subtext0: #a6adc8;\n            --ctp-overlay2: #9399b2;\n            --ctp-overlay1: #7f849c;\n            --ctp-overlay0: #6c7086;\n            --ctp-surface2: #585b70;\n            --ctp-surface1: #45475a;\n            --ctp-surface0: #313244;\n            --ctp-base: #1e1e2e;\n            --ctp-mantle: #181825;\n            --ctp-crust: #11111b;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;\n            background: var(--ctp-base);\n            color: var(--ctp-text);\n            min-height: 100vh;\n            line-height: 1.5;\n        }\n\n        /* Header */\n        .header {\n            background: var(--ctp-mantle);\n            border-bottom: 1px solid var(--ctp-surface0);\n            padding: 16px 24px;\n            position: sticky;\n            top: 0;\n            z-index: 100;\n        }\n\n        .header-content {\n            max-width: 1600px;\n            margin: 0 auto;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .logo {\n            width: 40px;\n            height: 40px;\n            background: linear-gradient(135deg, var(--ctp-red) 0%, var(--ctp-pink) 100%);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 20px;\n            animation: pulse-glow 2s ease-in-out infinite;\n        }\n\n        @keyframes pulse-glow {\n            0%, 100% { box-shadow: 0 0 20px rgba(243, 139, 168, 0.3); }\n            50% { box-shadow: 0 0 30px rgba(243, 139, 168, 0.5); }\n        }\n\n        .header-title h1 {\n            font-size: 20px;\n            font-weight: 600;\n            color: var(--ctp-text);\n        }\n\n        .header-title p {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n        }\n\n        .header-right {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .status-indicator {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            padding: 8px 16px;\n            background: var(--ctp-surface0);\n            border-radius: 20px;\n            font-size: 13px;\n            font-weight: 500;\n        }\n\n        .status-dot {\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n            animation: pulse-dot 2s ease-in-out infinite;\n        }\n\n        .status-dot.healthy { background: var(--ctp-green); }\n        .status-dot.warning { background: var(--ctp-yellow); }\n        .status-dot.degraded { background: var(--ctp-peach); }\n        .status-dot.critical { background: var(--ctp-red); }\n        .status-dot.unknown { background: var(--ctp-overlay0); }\n\n        @keyframes pulse-dot {\n            0%, 100% { opacity: 1; transform: scale(1); }\n            50% { opacity: 0.7; transform: scale(1.1); }\n        }\n\n        .connection-status {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .connection-status.connected { color: var(--ctp-green); }\n        .connection-status.disconnected { color: var(--ctp-red); }\n\n        /* Main Content */\n        .main {\n            max-width: 1600px;\n            margin: 0 auto;\n            padding: 24px;\n        }\n\n        /* Health Score Card */\n        .health-score-card {\n            background: linear-gradient(135deg, var(--ctp-mantle) 0%, var(--ctp-surface0) 100%);\n            border-radius: 20px;\n            padding: 32px;\n            margin-bottom: 24px;\n            border: 1px solid var(--ctp-surface1);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            flex-wrap: wrap;\n            gap: 24px;\n        }\n\n        .health-score-main {\n            display: flex;\n            align-items: center;\n            gap: 24px;\n        }\n\n        .score-circle {\n            width: 120px;\n            height: 120px;\n            position: relative;\n        }\n\n        .score-circle svg {\n            width: 100%;\n            height: 100%;\n            transform: rotate(-90deg);\n        }\n\n        .score-circle .bg {\n            stroke: var(--ctp-surface1);\n        }\n\n        .score-circle .progress {\n            stroke-linecap: round;\n            transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;\n        }\n\n        .score-circle .progress.healthy { stroke: var(--ctp-green); }\n        .score-circle .progress.warning { stroke: var(--ctp-yellow); }\n        .score-circle .progress.degraded { stroke: var(--ctp-peach); }\n        .score-circle .progress.critical { stroke: var(--ctp-red); }\n\n        .score-value {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            font-size: 32px;\n            font-weight: 700;\n        }\n\n        .health-info h2 {\n            font-size: 28px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .health-info p {\n            font-size: 15px;\n            color: var(--ctp-subtext0);\n        }\n\n        .health-info .message {\n            color: var(--ctp-green);\n            font-weight: 500;\n            margin-top: 8px;\n        }\n\n        .health-info .message.warning { color: var(--ctp-yellow); }\n        .health-info .message.degraded { color: var(--ctp-peach); }\n        .health-info .message.critical { color: var(--ctp-red); }\n\n        .vital-signs {\n            display: flex;\n            gap: 12px;\n            flex-wrap: wrap;\n        }\n\n        .vital-sign {\n            background: var(--ctp-surface0);\n            padding: 12px 16px;\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 13px;\n        }\n\n        .vital-sign .icon { font-size: 16px; }\n        .vital-sign.healthy .status { color: var(--ctp-green); }\n        .vital-sign.unhealthy .status { color: var(--ctp-red); }\n\n        /* Grid Layout */\n        .dashboard-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n            gap: 20px;\n            margin-bottom: 24px;\n        }\n\n        @media (max-width: 900px) {\n            .dashboard-grid {\n                grid-template-columns: 1fr;\n            }\n        }\n\n        /* Cards */\n        .card {\n            background: var(--ctp-mantle);\n            border-radius: 16px;\n            border: 1px solid var(--ctp-surface0);\n            overflow: hidden;\n        }\n\n        .card-header {\n            padding: 16px 20px;\n            border-bottom: 1px solid var(--ctp-surface0);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .card-title {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .card-title .icon {\n            width: 28px;\n            height: 28px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n        }\n\n        .card-title .icon.nodes { background: var(--ctp-blue); color: var(--ctp-crust); }\n        .card-title .icon.resources { background: var(--ctp-green); color: var(--ctp-crust); }\n        .card-title .icon.pods { background: var(--ctp-mauve); color: var(--ctp-crust); }\n        .card-title .icon.alerts { background: var(--ctp-red); color: var(--ctp-crust); }\n\n        .card-content {\n            padding: 16px 20px;\n        }\n\n        /* Stats Grid */\n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        @media (max-width: 1200px) {\n            .stats-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n\n        .stat-card {\n            background: var(--ctp-mantle);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--ctp-surface0);\n        }\n\n        .stat-card-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .stat-label {\n            font-size: 13px;\n            color: var(--ctp-subtext0);\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .stat-icon {\n            width: 32px;\n            height: 32px;\n            border-radius: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n\n        .stat-icon.blue { background: rgba(137, 180, 250, 0.2); color: var(--ctp-blue); }\n        .stat-icon.green { background: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .stat-icon.mauve { background: rgba(203, 166, 247, 0.2); color: var(--ctp-mauve); }\n        .stat-icon.peach { background: rgba(250, 179, 135, 0.2); color: var(--ctp-peach); }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom: 4px;\n        }\n\n        .stat-detail {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n        }\n\n        /* Node List */\n        .node-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n\n        .node-item {\n            background: var(--ctp-surface0);\n            border-radius: 12px;\n            padding: 14px 16px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            transition: background 0.2s;\n        }\n\n        .node-item:hover {\n            background: var(--ctp-surface1);\n        }\n\n        .node-info {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .node-status-dot {\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n        }\n\n        .node-status-dot.ready { background: var(--ctp-green); }\n        .node-status-dot.not-ready { background: var(--ctp-red); }\n        .node-status-dot.not-joined { background: var(--ctp-overlay0); }\n\n        .node-item.not-joined {\n            opacity: 0.7;\n            background: var(--ctp-surface0);\n            border: 1px dashed var(--ctp-overlay0);\n        }\n\n        .node-status-badge {\n            font-size: 10px;\n            padding: 2px 6px;\n            border-radius: 4px;\n            margin-left: 8px;\n            text-transform: uppercase;\n            font-weight: 600;\n        }\n\n        .node-status-badge.not-joined {\n            background: rgba(108, 112, 134, 0.2);\n            color: var(--ctp-overlay0);\n        }\n\n        .node-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .node-pods {\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n        }\n\n        .node-metrics {\n            display: flex;\n            gap: 16px;\n        }\n\n        .node-metric {\n            text-align: right;\n        }\n\n        .node-metric-value {\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .node-metric-label {\n            font-size: 10px;\n            color: var(--ctp-subtext0);\n            text-transform: uppercase;\n        }\n\n        /* Resource Bars */\n        .resource-section {\n            margin-bottom: 20px;\n        }\n\n        .resource-section:last-child {\n            margin-bottom: 0;\n        }\n\n        .resource-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .resource-label {\n            font-size: 13px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .resource-value {\n            font-size: 13px;\n            color: var(--ctp-subtext0);\n        }\n\n        .resource-bar {\n            height: 8px;\n            background: var(--ctp-surface0);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .resource-bar-fill {\n            height: 100%;\n            border-radius: 4px;\n            transition: width 0.5s ease;\n        }\n\n        .resource-bar-fill.cpu { background: linear-gradient(90deg, var(--ctp-blue), var(--ctp-sapphire)); }\n        .resource-bar-fill.memory { background: linear-gradient(90deg, var(--ctp-green), var(--ctp-teal)); }\n        .resource-bar-fill.warning { background: linear-gradient(90deg, var(--ctp-yellow), var(--ctp-peach)); }\n        .resource-bar-fill.critical { background: linear-gradient(90deg, var(--ctp-red), var(--ctp-maroon)); }\n\n        /* Pod Issues */\n        .pod-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n\n        .pod-item {\n            background: var(--ctp-surface0);\n            border-radius: 10px;\n            padding: 12px 14px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .pod-info {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .pod-phase {\n            padding: 3px 8px;\n            border-radius: 6px;\n            font-size: 10px;\n            font-weight: 600;\n            text-transform: uppercase;\n        }\n\n        .pod-phase.running { background: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .pod-phase.pending { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .pod-phase.failed { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .pod-name {\n            font-size: 13px;\n            font-weight: 500;\n        }\n\n        .pod-namespace {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n        }\n\n        .pod-restarts {\n            font-size: 12px;\n            color: var(--ctp-peach);\n        }\n\n        /* Alerts */\n        .alert-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n\n        .alert-item {\n            background: var(--ctp-surface0);\n            border-radius: 10px;\n            padding: 12px 14px;\n            border-left: 3px solid;\n        }\n\n        .alert-item.warning { border-color: var(--ctp-yellow); }\n        .alert-item.critical { border-color: var(--ctp-red); }\n\n        .alert-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 4px;\n        }\n\n        .alert-severity {\n            font-size: 10px;\n            font-weight: 600;\n            text-transform: uppercase;\n            padding: 2px 6px;\n            border-radius: 4px;\n        }\n\n        .alert-severity.warning { background: rgba(249, 226, 175, 0.2); color: var(--ctp-yellow); }\n        .alert-severity.critical { background: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .alert-time {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n        }\n\n        .alert-message {\n            font-size: 13px;\n        }\n\n        .alert-node {\n            font-size: 11px;\n            color: var(--ctp-subtext0);\n            margin-top: 4px;\n        }\n\n        /* Empty States */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--ctp-subtext0);\n        }\n\n        .empty-state .icon {\n            font-size: 32px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n\n        .empty-state p {\n            font-size: 14px;\n        }\n\n        /* Last Updated */\n        .last-updated {\n            text-align: center;\n            padding: 16px;\n            font-size: 12px;\n            color: var(--ctp-subtext0);\n        }\n\n        /* Loading */\n        .loading {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 48px;\n            color: var(--ctp-subtext0);\n        }\n\n        .loading-spinner {\n            width: 32px;\n            height: 32px;\n            border: 3px solid var(--ctp-surface1);\n            border-top-color: var(--ctp-mauve);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin-right: 12px;\n        }\n\n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003cheader class=\"header\"\u003e\n        \u003cdiv class=\"header-content\"\u003e\n            \u003cdiv class=\"header-left\"\u003e\n                \u003cdiv class=\"logo\"\u003e\u0026#128147;\u003c/div\u003e\n                \u003cdiv class=\"header-title\"\u003e\n                    \u003ch1\u003ePulse\u003c/h1\u003e\n                    \u003cp\u003eCluster Health Monitor\u003c/p\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"header-right\"\u003e\n                \u003cdiv class=\"status-indicator\"\u003e\n                    \u003cspan class=\"status-dot\" id=\"statusDot\"\u003e\u003c/span\u003e\n                    \u003cspan id=\"statusText\"\u003eConnecting...\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"connection-status\" id=\"connectionStatus\"\u003e\n                    \u003cspan\u003e\u0026#9679;\u003c/span\u003e\n                    \u003cspan\u003eConnecting...\u003c/span\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/header\u003e\n\n    \u003cmain class=\"main\"\u003e\n        \u003c!-- Health Score Card --\u003e\n        \u003cdiv class=\"health-score-card\"\u003e\n            \u003cdiv class=\"health-score-main\"\u003e\n                \u003cdiv class=\"score-circle\"\u003e\n                    \u003csvg viewBox=\"0 0 100 100\"\u003e\n                        \u003ccircle class=\"bg\" cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\" stroke-width=\"8\"/\u003e\n                        \u003ccircle class=\"progress\" id=\"scoreProgress\" cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\" stroke-width=\"8\"\n                            stroke-dasharray=\"283\" stroke-dashoffset=\"283\"/\u003e\n                    \u003c/svg\u003e\n                    \u003cdiv class=\"score-value\" id=\"scoreValue\"\u003e--\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"health-info\"\u003e\n                    \u003ch2\u003eHealth Score\u003c/h2\u003e\n                    \u003cp\u003eOverall cluster health status\u003c/p\u003e\n                    \u003cp class=\"message\" id=\"healthMessage\"\u003eLoading...\u003c/p\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"vital-signs\" id=\"vitalSigns\"\u003e\n                \u003c!-- Vital signs will be populated --\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Stats Grid --\u003e\n        \u003cdiv class=\"stats-grid\"\u003e\n            \u003cdiv class=\"stat-card\"\u003e\n                \u003cdiv class=\"stat-card-header\"\u003e\n                    \u003cspan class=\"stat-label\"\u003eNodes\u003c/span\u003e\n                    \u003cdiv class=\"stat-icon blue\"\u003e\u0026#128421;\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat-value\" id=\"nodeCount\"\u003e--\u003c/div\u003e\n                \u003cdiv class=\"stat-detail\" id=\"nodeDetail\"\u003e-- ready\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"stat-card\"\u003e\n                \u003cdiv class=\"stat-card-header\"\u003e\n                    \u003cspan class=\"stat-label\"\u003ePods\u003c/span\u003e\n                    \u003cdiv class=\"stat-icon mauve\"\u003e\u0026#128230;\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat-value\" id=\"podCount\"\u003e--\u003c/div\u003e\n                \u003cdiv class=\"stat-detail\" id=\"podDetail\"\u003e-- running\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"stat-card\"\u003e\n                \u003cdiv class=\"stat-card-header\"\u003e\n                    \u003cspan class=\"stat-label\"\u003eCPU\u003c/span\u003e\n                    \u003cdiv class=\"stat-icon green\"\u003e\u0026#9889;\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat-value\" id=\"cpuUsage\"\u003e--%\u003c/div\u003e\n                \u003cdiv class=\"stat-detail\" id=\"cpuDetail\"\u003e-- / -- cores\u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class=\"stat-card\"\u003e\n                \u003cdiv class=\"stat-card-header\"\u003e\n                    \u003cspan class=\"stat-label\"\u003eMemory\u003c/span\u003e\n                    \u003cdiv class=\"stat-icon peach\"\u003e\u0026#128200;\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"stat-value\" id=\"memUsage\"\u003e--%\u003c/div\u003e\n                \u003cdiv class=\"stat-detail\" id=\"memDetail\"\u003e-- / -- GB\u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003c!-- Dashboard Grid --\u003e\n        \u003cdiv class=\"dashboard-grid\"\u003e\n            \u003c!-- Nodes Card --\u003e\n            \u003cdiv class=\"card\"\u003e\n                \u003cdiv class=\"card-header\"\u003e\n                    \u003cdiv class=\"card-title\"\u003e\n                        \u003cdiv class=\"icon nodes\"\u003e\u0026#128421;\u003c/div\u003e\n                        Node Status\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"card-content\"\u003e\n                    \u003cdiv class=\"node-list\" id=\"nodeList\"\u003e\n                        \u003cdiv class=\"loading\"\u003e\n                            \u003cdiv class=\"loading-spinner\"\u003e\u003c/div\u003e\n                            Loading nodes...\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003c!-- Resources Card --\u003e\n            \u003cdiv class=\"card\"\u003e\n                \u003cdiv class=\"card-header\"\u003e\n                    \u003cdiv class=\"card-title\"\u003e\n                        \u003cdiv class=\"icon resources\"\u003e\u0026#128200;\u003c/div\u003e\n                        Resource Usage\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"card-content\"\u003e\n                    \u003cdiv class=\"resource-section\"\u003e\n                        \u003cdiv class=\"resource-header\"\u003e\n                            \u003cspan class=\"resource-label\"\u003e\u0026#9889; CPU Usage\u003c/span\u003e\n                            \u003cspan class=\"resource-value\" id=\"cpuResourceValue\"\u003e--%\u003c/span\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"resource-bar\"\u003e\n                            \u003cdiv class=\"resource-bar-fill cpu\" id=\"cpuBar\" style=\"width: 0%\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"resource-section\"\u003e\n                        \u003cdiv class=\"resource-header\"\u003e\n                            \u003cspan class=\"resource-label\"\u003e\u0026#128190; Memory Usage\u003c/span\u003e\n                            \u003cspan class=\"resource-value\" id=\"memResourceValue\"\u003e--%\u003c/span\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"resource-bar\"\u003e\n                            \u003cdiv class=\"resource-bar-fill memory\" id=\"memBar\" style=\"width: 0%\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv id=\"nodeResources\" style=\"margin-top: 20px;\"\u003e\n                        \u003c!-- Per-node resources will be populated --\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003c!-- Pod Issues Card --\u003e\n            \u003cdiv class=\"card\"\u003e\n                \u003cdiv class=\"card-header\"\u003e\n                    \u003cdiv class=\"card-title\"\u003e\n                        \u003cdiv class=\"icon pods\"\u003e\u0026#128230;\u003c/div\u003e\n                        Pod Issues\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"card-content\"\u003e\n                    \u003cdiv class=\"pod-list\" id=\"podList\"\u003e\n                        \u003cdiv class=\"empty-state\"\u003e\n                            \u003cdiv class=\"icon\"\u003e\u0026#10004;\u003c/div\u003e\n                            \u003cp\u003eAll pods healthy\u003c/p\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003c!-- Alerts Card --\u003e\n            \u003cdiv class=\"card\"\u003e\n                \u003cdiv class=\"card-header\"\u003e\n                    \u003cdiv class=\"card-title\"\u003e\n                        \u003cdiv class=\"icon alerts\"\u003e\u0026#9888;\u003c/div\u003e\n                        Active Alerts\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"card-content\"\u003e\n                    \u003cdiv class=\"alert-list\" id=\"alertList\"\u003e\n                        \u003cdiv class=\"empty-state\"\u003e\n                            \u003cdiv class=\"icon\"\u003e\u0026#10004;\u003c/div\u003e\n                            \u003cp\u003eNo active alerts\u003c/p\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class=\"last-updated\"\u003e\n            Last updated: \u003cspan id=\"lastUpdated\"\u003e--\u003c/span\u003e\n        \u003c/div\u003e\n    \u003c/main\u003e\n\n    \u003cscript\u003e\n        let ws = null;\n        let reconnectAttempts = 0;\n        const maxReconnectAttempts = 10;\n\n        function connectWebSocket() {\n            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n            const wsUrl = protocol + '//' + window.location.host + '/ws';\n\n            ws = new WebSocket(wsUrl);\n\n            // Connection timeout - if not connected within 10 seconds, show error\n            const connectionTimeout = setTimeout(function() {\n                if (ws.readyState !== WebSocket.OPEN) {\n                    console.log('WebSocket connection timeout');\n                    ws.close();\n                    showErrorState(new Error('WebSocket connection timed out after 10 seconds'));\n                }\n            }, 10000);\n\n            ws.onopen = function() {\n                clearTimeout(connectionTimeout);\n                console.log('WebSocket connected');\n                reconnectAttempts = 0;\n                updateConnectionStatus(true);\n            };\n\n            ws.onmessage = function(event) {\n                const data = JSON.parse(event.data);\n                if (data.type === 'health_update') {\n                    updateDashboard(data.data);\n                }\n            };\n\n            ws.onclose = function() {\n                clearTimeout(connectionTimeout);\n                console.log('WebSocket disconnected');\n                updateConnectionStatus(false);\n                scheduleReconnect();\n            };\n\n            ws.onerror = function(error) {\n                clearTimeout(connectionTimeout);\n                console.error('WebSocket error:', error);\n                showErrorState(new Error('WebSocket connection failed'));\n            };\n        }\n\n        function scheduleReconnect() {\n            if (reconnectAttempts \u003c maxReconnectAttempts) {\n                reconnectAttempts++;\n                const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);\n                console.log('Reconnecting in ' + delay + 'ms...');\n                setTimeout(connectWebSocket, delay);\n            }\n        }\n\n        function updateConnectionStatus(connected) {\n            const el = document.getElementById('connectionStatus');\n            if (connected) {\n                el.className = 'connection-status connected';\n                el.innerHTML = '\u003cspan\u003e\u0026#9679;\u003c/span\u003e\u003cspan\u003eLive\u003c/span\u003e';\n            } else {\n                el.className = 'connection-status disconnected';\n                el.innerHTML = '\u003cspan\u003e\u0026#9679;\u003c/span\u003e\u003cspan\u003eDisconnected\u003c/span\u003e';\n            }\n        }\n\n        function updateDashboard(health) {\n            // Update status indicator\n            const statusDot = document.getElementById('statusDot');\n            const statusText = document.getElementById('statusText');\n            statusDot.className = 'status-dot ' + health.status;\n            statusText.textContent = health.status.charAt(0).toUpperCase() + health.status.slice(1);\n\n            // Update health score\n            const score = health.health_score || 0;\n            const scoreValue = document.getElementById('scoreValue');\n            const scoreProgress = document.getElementById('scoreProgress');\n            const healthMessage = document.getElementById('healthMessage');\n\n            scoreValue.textContent = score;\n            const circumference = 2 * Math.PI * 45;\n            const offset = circumference - (score / 100) * circumference;\n            scoreProgress.style.strokeDashoffset = offset;\n            scoreProgress.className = 'progress ' + health.status;\n\n            healthMessage.textContent = health.message || 'Loading...';\n            healthMessage.className = 'message ' + health.status;\n\n            // Update vital signs\n            const vitalSigns = document.getElementById('vitalSigns');\n            if (health.vital_signs) {\n                const vitals = health.vital_signs;\n                vitalSigns.innerHTML = '' +\n                    createVitalSign('\u0026#128147;', 'Heartbeat', vitals.heartbeat || 'unknown') +\n                    createVitalSign('\u0026#9881;', 'API Server', vitals.api_server_status || 'unknown') +\n                    createVitalSign('\u0026#128190;', 'etcd', vitals.etcd_status || 'unknown') +\n                    createVitalSign('\u0026#128197;', 'Scheduler', vitals.scheduler_status || 'unknown') +\n                    createVitalSign('\u0026#127760;', 'DNS', vitals.dns_status || 'unknown');\n            }\n\n            // Update stats\n            const ch = health.cluster_health || {};\n            document.getElementById('nodeCount').textContent = ch.total_nodes || 0;\n            document.getElementById('nodeDetail').textContent = (ch.ready_nodes || 0) + ' ready';\n            document.getElementById('podCount').textContent = ch.total_pods || 0;\n            document.getElementById('podDetail').textContent = (ch.running_pods || 0) + ' running, ' + (ch.pending_pods || 0) + ' pending';\n\n            const cpuPct = Math.round(ch.cpu_percent || 0);\n            document.getElementById('cpuUsage').textContent = cpuPct + '%';\n            document.getElementById('cpuDetail').textContent = ((ch.used_cpu_cores || 0) / 1000).toFixed(1) + ' / ' + ((ch.total_cpu_cores || 0) / 1000).toFixed(1) + ' cores';\n\n            const memPct = Math.round(ch.memory_percent || 0);\n            document.getElementById('memUsage').textContent = memPct + '%';\n            document.getElementById('memDetail').textContent = (ch.used_memory_gb || 0).toFixed(1) + ' / ' + (ch.total_memory_gb || 0).toFixed(1) + ' GB';\n\n            // Update resource bars\n            document.getElementById('cpuResourceValue').textContent = cpuPct + '%';\n            document.getElementById('cpuBar').style.width = cpuPct + '%';\n            updateBarColor('cpuBar', cpuPct);\n\n            document.getElementById('memResourceValue').textContent = memPct + '%';\n            document.getElementById('memBar').style.width = memPct + '%';\n            updateBarColor('memBar', memPct);\n\n            // Update node list\n            const nodeList = document.getElementById('nodeList');\n            if (health.node_statuses \u0026\u0026 health.node_statuses.length \u003e 0) {\n                nodeList.innerHTML = health.node_statuses.map(node =\u003e {\n                    const isNotJoined = node.status === 'NotJoined';\n                    const statusClass = node.ready ? 'ready' : (isNotJoined ? 'not-joined' : 'not-ready');\n                    const itemClass = isNotJoined ? 'node-item not-joined' : 'node-item';\n                    const statusBadge = isNotJoined ? '\u003cspan class=\"node-status-badge not-joined\"\u003eNot Joined\u003c/span\u003e' : '';\n                    const metricsDisplay = isNotJoined ? '--' : Math.round(node.cpu_percent) + '%';\n                    const memDisplay = isNotJoined ? '--' : Math.round(node.memory_percent) + '%';\n                    return '\u003cdiv class=\"' + itemClass + '\"\u003e' +\n                        '\u003cdiv class=\"node-info\"\u003e' +\n                            '\u003cdiv class=\"node-status-dot ' + statusClass + '\"\u003e\u003c/div\u003e' +\n                            '\u003cdiv\u003e' +\n                                '\u003cdiv class=\"node-name\"\u003e' + node.name + statusBadge + '\u003c/div\u003e' +\n                                '\u003cdiv class=\"node-pods\"\u003e' + (isNotJoined ? 'Not in cluster' : node.pod_count + ' pods') + '\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                        '\u003c/div\u003e' +\n                        '\u003cdiv class=\"node-metrics\"\u003e' +\n                            '\u003cdiv class=\"node-metric\"\u003e' +\n                                '\u003cdiv class=\"node-metric-value\"\u003e' + metricsDisplay + '\u003c/div\u003e' +\n                                '\u003cdiv class=\"node-metric-label\"\u003eCPU\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                            '\u003cdiv class=\"node-metric\"\u003e' +\n                                '\u003cdiv class=\"node-metric-value\"\u003e' + memDisplay + '\u003c/div\u003e' +\n                                '\u003cdiv class=\"node-metric-label\"\u003eMemory\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                        '\u003c/div\u003e' +\n                    '\u003c/div\u003e';\n                }).join('');\n\n                // Update per-node resources\n                const nodeResources = document.getElementById('nodeResources');\n                nodeResources.innerHTML = health.node_statuses.map(node =\u003e {\n                    const isNotJoined = node.status === 'NotJoined';\n                    if (isNotJoined) {\n                        return '\u003cdiv class=\"resource-section\" style=\"opacity: 0.5;\"\u003e' +\n                            '\u003cdiv class=\"resource-header\"\u003e' +\n                                '\u003cspan class=\"resource-label\"\u003e' + node.name + '\u003c/span\u003e' +\n                                '\u003cspan class=\"resource-value\" style=\"color: var(--ctp-overlay0);\"\u003eNot Joined\u003c/span\u003e' +\n                            '\u003c/div\u003e' +\n                            '\u003cdiv style=\"display: flex; gap: 8px;\"\u003e' +\n                                '\u003cdiv class=\"resource-bar\" style=\"flex: 1; border: 1px dashed var(--ctp-overlay0);\"\u003e' +\n                                '\u003c/div\u003e' +\n                                '\u003cdiv class=\"resource-bar\" style=\"flex: 1; border: 1px dashed var(--ctp-overlay0);\"\u003e' +\n                                '\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                        '\u003c/div\u003e';\n                    }\n                    const cpuClass = getResourceClass(node.cpu_percent);\n                    const memClass = getResourceClass(node.memory_percent);\n                    return '\u003cdiv class=\"resource-section\"\u003e' +\n                        '\u003cdiv class=\"resource-header\"\u003e' +\n                            '\u003cspan class=\"resource-label\"\u003e' + node.name + '\u003c/span\u003e' +\n                            '\u003cspan class=\"resource-value\"\u003e' + Math.round(node.cpu_percent) + '% / ' + Math.round(node.memory_percent) + '%\u003c/span\u003e' +\n                        '\u003c/div\u003e' +\n                        '\u003cdiv style=\"display: flex; gap: 8px;\"\u003e' +\n                            '\u003cdiv class=\"resource-bar\" style=\"flex: 1;\"\u003e' +\n                                '\u003cdiv class=\"resource-bar-fill ' + cpuClass + '\" style=\"width: ' + node.cpu_percent + '%\"\u003e\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                            '\u003cdiv class=\"resource-bar\" style=\"flex: 1;\"\u003e' +\n                                '\u003cdiv class=\"resource-bar-fill ' + memClass + '\" style=\"width: ' + node.memory_percent + '%\"\u003e\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                        '\u003c/div\u003e' +\n                    '\u003c/div\u003e';\n                }).join('');\n            } else {\n                nodeList.innerHTML = '\u003cdiv class=\"empty-state\"\u003e\u003cdiv class=\"icon\"\u003e\u0026#128421;\u003c/div\u003e\u003cp\u003eNo nodes found\u003c/p\u003e\u003c/div\u003e';\n            }\n\n            // Update pod issues\n            const podList = document.getElementById('podList');\n            if (health.pod_statuses \u0026\u0026 health.pod_statuses.length \u003e 0) {\n                podList.innerHTML = health.pod_statuses.slice(0, 10).map(pod =\u003e {\n                    const phaseClass = pod.phase.toLowerCase();\n                    return '\u003cdiv class=\"pod-item\"\u003e' +\n                        '\u003cdiv class=\"pod-info\"\u003e' +\n                            '\u003cspan class=\"pod-phase ' + phaseClass + '\"\u003e' + pod.phase + '\u003c/span\u003e' +\n                            '\u003cdiv\u003e' +\n                                '\u003cdiv class=\"pod-name\"\u003e' + pod.name + '\u003c/div\u003e' +\n                                '\u003cdiv class=\"pod-namespace\"\u003e' + pod.namespace + '\u003c/div\u003e' +\n                            '\u003c/div\u003e' +\n                        '\u003c/div\u003e' +\n                        (pod.restarts \u003e 0 ? '\u003cspan class=\"pod-restarts\"\u003e' + pod.restarts + ' restarts\u003c/span\u003e' : '') +\n                    '\u003c/div\u003e';\n                }).join('');\n            } else {\n                podList.innerHTML = '\u003cdiv class=\"empty-state\"\u003e\u003cdiv class=\"icon\"\u003e\u0026#10004;\u003c/div\u003e\u003cp\u003eAll pods healthy\u003c/p\u003e\u003c/div\u003e';\n            }\n\n            // Update alerts\n            const alertList = document.getElementById('alertList');\n            if (health.resource_alerts \u0026\u0026 health.resource_alerts.length \u003e 0) {\n                alertList.innerHTML = health.resource_alerts.slice(0, 10).map(alert =\u003e {\n                    const time = new Date(alert.timestamp).toLocaleTimeString();\n                    return '\u003cdiv class=\"alert-item ' + alert.severity + '\"\u003e' +\n                        '\u003cdiv class=\"alert-header\"\u003e' +\n                            '\u003cspan class=\"alert-severity ' + alert.severity + '\"\u003e' + alert.severity + '\u003c/span\u003e' +\n                            '\u003cspan class=\"alert-time\"\u003e' + time + '\u003c/span\u003e' +\n                        '\u003c/div\u003e' +\n                        '\u003cdiv class=\"alert-message\"\u003e' + alert.message + '\u003c/div\u003e' +\n                        '\u003cdiv class=\"alert-node\"\u003e' + alert.resource + ': ' + Math.round(alert.value) + '% (threshold: ' + alert.threshold + '%)\u003c/div\u003e' +\n                    '\u003c/div\u003e';\n                }).join('');\n            } else {\n                alertList.innerHTML = '\u003cdiv class=\"empty-state\"\u003e\u003cdiv class=\"icon\"\u003e\u0026#10004;\u003c/div\u003e\u003cp\u003eNo active alerts\u003c/p\u003e\u003c/div\u003e';\n            }\n\n            // Update timestamp\n            document.getElementById('lastUpdated').textContent = new Date(health.timestamp).toLocaleString();\n        }\n\n        function createVitalSign(icon, name, status) {\n            const statusClass = status === 'healthy' || status === 'normal' ? 'healthy' : 'unhealthy';\n            return '\u003cdiv class=\"vital-sign ' + statusClass + '\"\u003e' +\n                '\u003cspan class=\"icon\"\u003e' + icon + '\u003c/span\u003e' +\n                '\u003cspan\u003e' + name + '\u003c/span\u003e' +\n                '\u003cspan class=\"status\"\u003e' + (status === 'healthy' || status === 'normal' ? '\u0026#10004;' : '\u0026#10008;') + '\u003c/span\u003e' +\n            '\u003c/div\u003e';\n        }\n\n        function updateBarColor(id, value) {\n            const bar = document.getElementById(id);\n            bar.classList.remove('cpu', 'memory', 'warning', 'critical');\n            if (value \u003e 90) {\n                bar.classList.add('critical');\n            } else if (value \u003e 80) {\n                bar.classList.add('warning');\n            } else if (id === 'cpuBar') {\n                bar.classList.add('cpu');\n            } else {\n                bar.classList.add('memory');\n            }\n        }\n\n        function getResourceClass(value) {\n            if (value \u003e 90) return 'critical';\n            if (value \u003e 80) return 'warning';\n            if (value \u003e 50) return 'memory';\n            return 'cpu';\n        }\n\n        // Initial loading timeout - show error if nothing loads within 10 seconds\n        const initialLoadTimeout = setTimeout(function() {\n            const nodeList = document.getElementById('nodeList');\n            if (nodeList.innerHTML.includes('Loading nodes')) {\n                showErrorState(new Error('Initial load timed out - Kubernetes API may be unavailable'));\n            }\n        }, 10000);\n\n        // Clear timeout when data loads\n        const originalUpdateDashboard = updateDashboard;\n        updateDashboard = function(health) {\n            clearTimeout(initialLoadTimeout);\n            originalUpdateDashboard(health);\n        };\n\n        // Initial connection\n        connectWebSocket();\n\n        // Fallback to polling if WebSocket fails\n        setInterval(function() {\n            if (!ws || ws.readyState !== WebSocket.OPEN) {\n                fetchStatusWithTimeout();\n            }\n        }, 15000);\n\n        // Fetch status with timeout\n        async function fetchStatusWithTimeout() {\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() =\u003e controller.abort(), 10000);\n\n            try {\n                const res = await fetch('/api/status', { signal: controller.signal });\n                clearTimeout(timeoutId);\n\n                if (!res.ok) {\n                    throw new Error('HTTP ' + res.status + ': ' + res.statusText);\n                }\n\n                const data = await res.json();\n                updateDashboard(data);\n            } catch (err) {\n                clearTimeout(timeoutId);\n                console.error('Polling error:', err);\n                showErrorState(err);\n            }\n        }\n\n        // Show error state in the dashboard\n        function showErrorState(err) {\n            let errorMsg = err.message;\n            if (err.name === 'AbortError') {\n                errorMsg = 'Request timed out after 10 seconds';\n            }\n\n            const nodeList = document.getElementById('nodeList');\n            nodeList.innerHTML = '\u003cdiv style=\"padding:24px;text-align:center;background:rgba(243,139,168,0.1);border-radius:10px;border:1px solid var(--ctp-red);\"\u003e' +\n                '\u003cdiv style=\"font-size:24px;margin-bottom:12px;\"\u003e\u0026#9888;\u003c/div\u003e' +\n                '\u003cdiv style=\"color:var(--ctp-red);font-weight:600;margin-bottom:8px;\"\u003eFailed to Load Nodes\u003c/div\u003e' +\n                '\u003cdiv style=\"color:var(--ctp-subtext0);font-size:13px;margin-bottom:12px;\"\u003e' + errorMsg + '\u003c/div\u003e' +\n                '\u003cdiv style=\"color:var(--ctp-overlay0);font-size:11px;\"\u003eEndpoint: /api/status\u003c/div\u003e' +\n            '\u003c/div\u003e';\n\n            document.getElementById('statusDot').className = 'status-dot unknown';\n            document.getElementById('statusText').textContent = 'Error';\n            document.getElementById('healthMessage').textContent = errorMsg;\n            document.getElementById('healthMessage').className = 'message critical';\n        }\n\n        // Initial fetch with timeout\n        fetchStatusWithTimeout();\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e`\n}\n","go.mod":"module pulse\n\ngo 1.21\n\nrequire github.com/gorilla/websocket v1.5.1\n\nrequire golang.org/x/net v0.17.0 // indirect\n","go.sum":"github.com/gorilla/websocket v1.5.1 h1:gmztn0JnHVt9JZquRuzLw3g4wouNVzKL15iLr/zn/QY=\ngithub.com/gorilla/websocket v1.5.1/go.mod h1:x3kM2JMyaluk02fnUJpQuwD2dCS5NDG2ZHL0uE0tcaY=\ngolang.org/x/net v0.17.0 h1:pVaXccu2ozPjCXewfr1S7xza/zcXTity9cCdXQYSjIM=\ngolang.org/x/net v0.17.0/go.mod h1:NxSsAGuq816PNPmqtQdLE42eU2Fs7NoRIZrHJAlaCOE=\n","main.go":"package main\n\nimport (\n\t\"crypto/tls\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strconv\"\n\t\"strings\"\n\t\"sync\"\n\t\"time\"\n\n\t\"github.com/gorilla/websocket\"\n)\n\n// WebSocket upgrader\nvar upgrader = websocket.Upgrader{\n\tCheckOrigin: func(r *http.Request) bool {\n\t\treturn true\n\t},\n\tReadBufferSize:  1024,\n\tWriteBufferSize: 1024,\n}\n\n// WebSocket clients\nvar (\n\tclients     = make(map[*websocket.Conn]bool)\n\tclientsMux  sync.RWMutex\n\tbroadcast   = make(chan HealthUpdate, 100)\n)\n\n// Health state\nvar (\n\tcurrentHealth HealthStatus\n\thealthMux     sync.RWMutex\n\talertHistory  []Alert\n\talertMux      sync.RWMutex\n)\n\n// Data structures\ntype HealthStatus struct {\n\tStatus           string          `json:\"status\"`\n\tMessage          string          `json:\"message\"`\n\tTimestamp        time.Time       `json:\"timestamp\"`\n\tClusterHealth    ClusterHealth   `json:\"cluster_health\"`\n\tNodeStatuses     []NodeStatus    `json:\"node_statuses\"`\n\tPodStatuses      []PodStatus     `json:\"pod_statuses\"`\n\tResourceAlerts   []ResourceAlert `json:\"resource_alerts\"`\n\tHealthScore      int             `json:\"health_score\"`\n\tVitalSigns       VitalSigns      `json:\"vital_signs\"`\n}\n\ntype ClusterHealth struct {\n\tTotalNodes       int     `json:\"total_nodes\"`\n\tReadyNodes       int     `json:\"ready_nodes\"`\n\tTotalPods        int     `json:\"total_pods\"`\n\tRunningPods      int     `json:\"running_pods\"`\n\tPendingPods      int     `json:\"pending_pods\"`\n\tFailedPods       int     `json:\"failed_pods\"`\n\tTotalCPUCores    float64 `json:\"total_cpu_cores\"`\n\tUsedCPUCores     float64 `json:\"used_cpu_cores\"`\n\tCPUPercent       float64 `json:\"cpu_percent\"`\n\tTotalMemoryGB    float64 `json:\"total_memory_gb\"`\n\tUsedMemoryGB     float64 `json:\"used_memory_gb\"`\n\tMemoryPercent    float64 `json:\"memory_percent\"`\n\tTotalDeployments int     `json:\"total_deployments\"`\n\tHealthyDeploys   int     `json:\"healthy_deployments\"`\n}\n\ntype NodeStatus struct {\n\tName         string    `json:\"name\"`\n\tStatus       string    `json:\"status\"`\n\tReady        bool      `json:\"ready\"`\n\tCPUPercent   float64   `json:\"cpu_percent\"`\n\tMemoryPercent float64  `json:\"memory_percent\"`\n\tPodCount     int       `json:\"pod_count\"`\n\tConditions   []string  `json:\"conditions\"`\n\tLastChecked  time.Time `json:\"last_checked\"`\n}\n\ntype PodStatus struct {\n\tName       string `json:\"name\"`\n\tNamespace  string `json:\"namespace\"`\n\tNode       string `json:\"node\"`\n\tPhase      string `json:\"phase\"`\n\tReady      bool   `json:\"ready\"`\n\tRestarts   int    `json:\"restarts\"`\n\tCPUm       float64 `json:\"cpu_m\"`\n\tMemoryMB   float64 `json:\"memory_mb\"`\n}\n\ntype ResourceAlert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string    `json:\"severity\"`\n\tResource  string    `json:\"resource\"`\n\tNode      string    `json:\"node\"`\n\tMessage   string    `json:\"message\"`\n\tValue     float64   `json:\"value\"`\n\tThreshold float64   `json:\"threshold\"`\n\tTimestamp time.Time `json:\"timestamp\"`\n}\n\ntype VitalSigns struct {\n\tHeartbeat       string `json:\"heartbeat\"`\n\tAPIServerStatus string `json:\"api_server_status\"`\n\tETCDStatus      string `json:\"etcd_status\"`\n\tSchedulerStatus string `json:\"scheduler_status\"`\n\tControllerStatus string `json:\"controller_status\"`\n\tDNSStatus       string `json:\"dns_status\"`\n}\n\ntype Alert struct {\n\tID        string    `json:\"id\"`\n\tSeverity  string    `json:\"severity\"`\n\tTitle     string    `json:\"title\"`\n\tMessage   string    `json:\"message\"`\n\tResource  string    `json:\"resource\"`\n\tTimestamp time.Time `json:\"timestamp\"`\n\tResolved  bool      `json:\"resolved\"`\n}\n\ntype HealthUpdate struct {\n\tType   string      `json:\"type\"`\n\tData   interface{} `json:\"data\"`\n}\n\n// K8s API structures\ntype K8sNodeList struct {\n\tItems []K8sNode `json:\"items\"`\n}\n\ntype K8sNode struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t} `json:\"metadata\"`\n\tStatus struct {\n\t\tConditions []struct {\n\t\t\tType   string `json:\"type\"`\n\t\t\tStatus string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t\tCapacity struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"capacity\"`\n\t\tAllocatable struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"allocatable\"`\n\t} `json:\"status\"`\n}\n\ntype K8sNodeMetricsList struct {\n\tItems []K8sNodeMetric `json:\"items\"`\n}\n\ntype K8sNodeMetric struct {\n\tMetadata struct {\n\t\tName string `json:\"name\"`\n\t} `json:\"metadata\"`\n\tUsage struct {\n\t\tCPU    string `json:\"cpu\"`\n\t\tMemory string `json:\"memory\"`\n\t} `json:\"usage\"`\n}\n\ntype K8sPodList struct {\n\tItems []K8sPod `json:\"items\"`\n}\n\ntype K8sPod struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tNodeName string `json:\"nodeName\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tPhase             string `json:\"phase\"`\n\t\tContainerStatuses []struct {\n\t\t\tReady        bool `json:\"ready\"`\n\t\t\tRestartCount int  `json:\"restartCount\"`\n\t\t} `json:\"containerStatuses\"`\n\t} `json:\"status\"`\n}\n\ntype K8sPodMetricsList struct {\n\tItems []K8sPodMetric `json:\"items\"`\n}\n\ntype K8sPodMetric struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tContainers []struct {\n\t\tName  string `json:\"name\"`\n\t\tUsage struct {\n\t\t\tCPU    string `json:\"cpu\"`\n\t\t\tMemory string `json:\"memory\"`\n\t\t} `json:\"usage\"`\n\t} `json:\"containers\"`\n}\n\ntype K8sDeploymentList struct {\n\tItems []K8sDeployment `json:\"items\"`\n}\n\ntype K8sDeployment struct {\n\tMetadata struct {\n\t\tName      string `json:\"name\"`\n\t\tNamespace string `json:\"namespace\"`\n\t} `json:\"metadata\"`\n\tSpec struct {\n\t\tReplicas int `json:\"replicas\"`\n\t} `json:\"spec\"`\n\tStatus struct {\n\t\tReadyReplicas int `json:\"readyReplicas\"`\n\t\tReplicas      int `json:\"replicas\"`\n\t} `json:\"status\"`\n}\n\ntype K8sComponentStatusList struct {\n\tItems []struct {\n\t\tMetadata struct {\n\t\t\tName string `json:\"name\"`\n\t\t} `json:\"metadata\"`\n\t\tConditions []struct {\n\t\t\tType   string `json:\"type\"`\n\t\t\tStatus string `json:\"status\"`\n\t\t} `json:\"conditions\"`\n\t} `json:\"items\"`\n}\n\n// All 13 cluster nodes - hardcoded list\nvar allClusterNodes = []string{\n\t\"rpi-1\", \"rpi-2\", \"rpi-3\", \"rpi-4\", \"rpi-5\", \"rpi-6\",\n\t\"rpi-7\", \"rpi-8\", \"rpi-9\", \"rpi-10\", \"rpi-11\", \"rpi-12\",\n\t\"openmediavault\",\n}\n\n// K8s API client\nfunc k8sAPIRequest(path string) ([]byte, error) {\n\ttoken, err := os.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/token\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to read service account token: %v\", err)\n\t}\n\n\tapiServer := os.Getenv(\"KUBERNETES_SERVICE_HOST\")\n\tapiPort := os.Getenv(\"KUBERNETES_SERVICE_PORT\")\n\tif apiServer == \"\" {\n\t\tapiServer = \"kubernetes.default.svc\"\n\t\tapiPort = \"443\"\n\t}\n\n\tapiURL := fmt.Sprintf(\"https://%s:%s%s\", apiServer, apiPort, path)\n\n\ttransport := \u0026http.Transport{\n\t\tTLSClientConfig: \u0026tls.Config{InsecureSkipVerify: true},\n\t}\n\tclient := \u0026http.Client{\n\t\tTransport: transport,\n\t\tTimeout:   10 * time.Second,\n\t}\n\n\treq, err := http.NewRequest(\"GET\", apiURL, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treq.Header.Set(\"Authorization\", \"Bearer \"+string(token))\n\n\tresp, err := client.Do(req)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\treturn io.ReadAll(resp.Body)\n}\n\n// Parse K8s resource values\nfunc parseCPU(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tif strings.HasSuffix(s, \"n\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s, \"n\"), 64)\n\t\treturn val / 1e9 * 1000 // Convert to millicores\n\t}\n\tif strings.HasSuffix(s, \"m\") {\n\t\tval, _ := strconv.ParseFloat(strings.TrimSuffix(s, \"m\"), 64)\n\t\treturn val\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn val * 1000 // Cores to millicores\n}\n\nfunc parseMemory(s string) float64 {\n\ts = strings.TrimSpace(s)\n\tmultiplier := 1.0\n\tif strings.HasSuffix(s, \"Ki\") {\n\t\ts = strings.TrimSuffix(s, \"Ki\")\n\t\tmultiplier = 1024\n\t} else if strings.HasSuffix(s, \"Mi\") {\n\t\ts = strings.TrimSuffix(s, \"Mi\")\n\t\tmultiplier = 1024 * 1024\n\t} else if strings.HasSuffix(s, \"Gi\") {\n\t\ts = strings.TrimSuffix(s, \"Gi\")\n\t\tmultiplier = 1024 * 1024 * 1024\n\t}\n\tval, _ := strconv.ParseFloat(s, 64)\n\treturn val * multiplier / (1024 * 1024) // Return in MB\n}\n\n// Fetch cluster health\nfunc fetchClusterHealth() (*HealthStatus, error) {\n\tstatus := \u0026HealthStatus{\n\t\tTimestamp: time.Now(),\n\t}\n\n\t// Fetch nodes\n\tnodeData, err := k8sAPIRequest(\"/api/v1/nodes\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to fetch nodes: %v\", err)\n\t}\n\n\tvar nodeList K8sNodeList\n\tif err := json.Unmarshal(nodeData, \u0026nodeList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Fetch node metrics\n\tnodeMetricsData, _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/nodes\")\n\tvar nodeMetricsList K8sNodeMetricsList\n\tjson.Unmarshal(nodeMetricsData, \u0026nodeMetricsList)\n\n\tmetricsMap := make(map[string]K8sNodeMetric)\n\tfor _, m := range nodeMetricsList.Items {\n\t\tmetricsMap[m.Metadata.Name] = m\n\t}\n\n\t// Fetch pods\n\tpodData, err := k8sAPIRequest(\"/api/v1/pods\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to fetch pods: %v\", err)\n\t}\n\n\tvar podList K8sPodList\n\tif err := json.Unmarshal(podData, \u0026podList); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Fetch pod metrics\n\tpodMetricsData, _ := k8sAPIRequest(\"/apis/metrics.k8s.io/v1beta1/pods\")\n\tvar podMetricsList K8sPodMetricsList\n\tjson.Unmarshal(podMetricsData, \u0026podMetricsList)\n\n\tpodMetricsMap := make(map[string]K8sPodMetric)\n\tfor _, m := range podMetricsList.Items {\n\t\tkey := m.Metadata.Namespace + \"/\" + m.Metadata.Name\n\t\tpodMetricsMap[key] = m\n\t}\n\n\t// Fetch deployments\n\tdeployData, _ := k8sAPIRequest(\"/apis/apps/v1/deployments\")\n\tvar deployList K8sDeploymentList\n\tjson.Unmarshal(deployData, \u0026deployList)\n\n\t// Build node statuses\n\tvar totalCPUCores, usedCPUCores, totalMemMB, usedMemMB float64\n\tpodCountByNode := make(map[string]int)\n\n\tfor _, pod := range podList.Items {\n\t\tif pod.Status.Phase == \"Running\" {\n\t\t\tpodCountByNode[pod.Spec.NodeName]++\n\t\t}\n\t}\n\n\t// Build a map of k8s nodes for quick lookup\n\tk8sNodeMap := make(map[string]K8sNode)\n\tfor _, node := range nodeList.Items {\n\t\tk8sNodeMap[node.Metadata.Name] = node\n\t}\n\n\t// Include ALL 13 predefined cluster nodes, even if not in k8s\n\tfor _, nodeName := range allClusterNodes {\n\t\tnodeStatus := NodeStatus{\n\t\t\tName:        nodeName,\n\t\t\tLastChecked: time.Now(),\n\t\t}\n\n\t\t// Check if node exists in Kubernetes\n\t\tif node, exists := k8sNodeMap[nodeName]; exists {\n\t\t\t// Node is in k8s - get its real status\n\t\t\tfor _, cond := range node.Status.Conditions {\n\t\t\t\tif cond.Type == \"Ready\" {\n\t\t\t\t\tnodeStatus.Ready = cond.Status == \"True\"\n\t\t\t\t\tif nodeStatus.Ready {\n\t\t\t\t\t\tnodeStatus.Status = \"Ready\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnodeStatus.Status = \"NotReady\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif cond.Status == \"True\" \u0026\u0026 cond.Type != \"Ready\" {\n\t\t\t\t\tnodeStatus.Conditions = append(nodeStatus.Conditions, cond.Type)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get resource usage\n\t\t\tallocCPU := parseCPU(node.Status.Allocatable.CPU)\n\t\t\tallocMem := parseMemory(node.Status.Allocatable.Memory)\n\t\t\ttotalCPUCores += allocCPU\n\t\t\ttotalMemMB += allocMem\n\n\t\t\tif metrics, ok := metricsMap[nodeName]; ok {\n\t\t\t\tusedCPU := parseCPU(metrics.Usage.CPU)\n\t\t\t\tusedMem := parseMemory(metrics.Usage.Memory)\n\t\t\t\tusedCPUCores += usedCPU\n\t\t\t\tusedMemMB += usedMem\n\n\t\t\t\tif allocCPU \u003e 0 {\n\t\t\t\t\tnodeStatus.CPUPercent = (usedCPU / allocCPU) * 100\n\t\t\t\t}\n\t\t\t\tif allocMem \u003e 0 {\n\t\t\t\t\tnodeStatus.MemoryPercent = (usedMem / allocMem) * 100\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Node is NOT in k8s yet - show as unknown/not joined\n\t\t\tnodeStatus.Status = \"NotJoined\"\n\t\t\tnodeStatus.Ready = false\n\t\t\tnodeStatus.Conditions = []string{\"Not in Kubernetes cluster\"}\n\t\t}\n\n\t\tnodeStatus.PodCount = podCountByNode[nodeName]\n\t\tstatus.NodeStatuses = append(status.NodeStatuses, nodeStatus)\n\t}\n\n\t// Sort nodes: rpi-1 through rpi-12 numerically, then openmediavault\n\tsort.Slice(status.NodeStatuses, func(i, j int) bool {\n\t\tnameI := status.NodeStatuses[i].Name\n\t\tnameJ := status.NodeStatuses[j].Name\n\n\t\t// Extract numeric part for rpi-N nodes\n\t\tgetNodeOrder := func(name string) int {\n\t\t\tif name == \"openmediavault\" {\n\t\t\t\treturn 100 // Always last\n\t\t\t}\n\t\t\tif strings.HasPrefix(name, \"rpi-\") {\n\t\t\t\tnumStr := strings.TrimPrefix(name, \"rpi-\")\n\t\t\t\tnum, err := strconv.Atoi(numStr)\n\t\t\t\tif err == nil {\n\t\t\t\t\treturn num\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 50 // Unknown nodes in the middle\n\t\t}\n\n\t\treturn getNodeOrder(nameI) \u003c getNodeOrder(nameJ)\n\t})\n\n\t// Build pod statuses (focus on non-running or high restart pods)\n\tfor _, pod := range podList.Items {\n\t\tkey := pod.Metadata.Namespace + \"/\" + pod.Metadata.Name\n\n\t\tpodStatus := PodStatus{\n\t\t\tName:      pod.Metadata.Name,\n\t\t\tNamespace: pod.Metadata.Namespace,\n\t\t\tNode:      pod.Spec.NodeName,\n\t\t\tPhase:     pod.Status.Phase,\n\t\t}\n\n\t\t// Check container statuses\n\t\tfor _, cs := range pod.Status.ContainerStatuses {\n\t\t\tif cs.Ready {\n\t\t\t\tpodStatus.Ready = true\n\t\t\t}\n\t\t\tpodStatus.Restarts += cs.RestartCount\n\t\t}\n\n\t\t// Get pod metrics\n\t\tif metrics, ok := podMetricsMap[key]; ok {\n\t\t\tfor _, container := range metrics.Containers {\n\t\t\t\tpodStatus.CPUm += parseCPU(container.Usage.CPU)\n\t\t\t\tpodStatus.MemoryMB += parseMemory(container.Usage.Memory)\n\t\t\t}\n\t\t}\n\n\t\t// Only include problematic pods or sample of running pods\n\t\tif pod.Status.Phase != \"Running\" || podStatus.Restarts \u003e 5 || !podStatus.Ready {\n\t\t\tstatus.PodStatuses = append(status.PodStatuses, podStatus)\n\t\t}\n\t}\n\n\t// Count pod phases\n\tvar runningPods, pendingPods, failedPods int\n\tfor _, pod := range podList.Items {\n\t\tswitch pod.Status.Phase {\n\t\tcase \"Running\":\n\t\t\trunningPods++\n\t\tcase \"Pending\":\n\t\t\tpendingPods++\n\t\tcase \"Failed\":\n\t\t\tfailedPods++\n\t\t}\n\t}\n\n\t// Count deployments\n\thealthyDeploys := 0\n\tfor _, deploy := range deployList.Items {\n\t\tif deploy.Status.ReadyReplicas \u003e= deploy.Spec.Replicas {\n\t\t\thealthyDeploys++\n\t\t}\n\t}\n\n\t// Build cluster health\n\treadyNodes := 0\n\tfor _, ns := range status.NodeStatuses {\n\t\tif ns.Ready {\n\t\t\treadyNodes++\n\t\t}\n\t}\n\n\tstatus.ClusterHealth = ClusterHealth{\n\t\tTotalNodes:       len(allClusterNodes), // Always show all 13 nodes\n\t\tReadyNodes:       readyNodes,\n\t\tTotalPods:        len(podList.Items),\n\t\tRunningPods:      runningPods,\n\t\tPendingPods:      pendingPods,\n\t\tFailedPods:       failedPods,\n\t\tTotalCPUCores:    totalCPUCores,\n\t\tUsedCPUCores:     usedCPUCores,\n\t\tTotalMemoryGB:    totalMemMB / 1024,\n\t\tUsedMemoryGB:     usedMemMB / 1024,\n\t\tTotalDeployments: len(deployList.Items),\n\t\tHealthyDeploys:   healthyDeploys,\n\t}\n\n\tif totalCPUCores \u003e 0 {\n\t\tstatus.ClusterHealth.CPUPercent = (usedCPUCores / totalCPUCores) * 100\n\t}\n\tif totalMemMB \u003e 0 {\n\t\tstatus.ClusterHealth.MemoryPercent = (usedMemMB / totalMemMB) * 100\n\t}\n\n\t// Generate resource alerts\n\tfor _, ns := range status.NodeStatuses {\n\t\tif ns.CPUPercent \u003e 90 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-high-%s\", ns.Name),\n\t\t\t\tSeverity:  \"critical\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage critical on %s\", ns.Name),\n\t\t\t\tValue:     ns.CPUPercent,\n\t\t\t\tThreshold: 90,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t} else if ns.CPUPercent \u003e 80 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"cpu-warn-%s\", ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:  \"cpu\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"CPU usage high on %s\", ns.Name),\n\t\t\t\tValue:     ns.CPUPercent,\n\t\t\t\tThreshold: 80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif ns.MemoryPercent \u003e 90 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"mem-high-%s\", ns.Name),\n\t\t\t\tSeverity:  \"critical\",\n\t\t\t\tResource:  \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"Memory usage critical on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold: 90,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t} else if ns.MemoryPercent \u003e 80 {\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"mem-warn-%s\", ns.Name),\n\t\t\t\tSeverity:  \"warning\",\n\t\t\t\tResource:  \"memory\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   fmt.Sprintf(\"Memory usage high on %s\", ns.Name),\n\t\t\t\tValue:     ns.MemoryPercent,\n\t\t\t\tThreshold: 80,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\n\t\tif !ns.Ready {\n\t\t\tvar msg string\n\t\t\tvar severity string\n\t\t\tif ns.Status == \"NotJoined\" {\n\t\t\t\tmsg = fmt.Sprintf(\"Node %s has not joined the cluster\", ns.Name)\n\t\t\t\tseverity = \"warning\" // Not joined is warning, not critical\n\t\t\t} else {\n\t\t\t\tmsg = fmt.Sprintf(\"Node %s is not ready\", ns.Name)\n\t\t\t\tseverity = \"critical\"\n\t\t\t}\n\t\t\tstatus.ResourceAlerts = append(status.ResourceAlerts, ResourceAlert{\n\t\t\t\tID:        fmt.Sprintf(\"node-notready-%s\", ns.Name),\n\t\t\t\tSeverity:  severity,\n\t\t\t\tResource:  \"node\",\n\t\t\t\tNode:      ns.Name,\n\t\t\t\tMessage:   msg,\n\t\t\t\tValue:     0,\n\t\t\t\tThreshold: 0,\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t})\n\t\t}\n\t}\n\n\t// Check vital signs\n\tstatus.VitalSigns = VitalSigns{\n\t\tHeartbeat:       \"normal\",\n\t\tAPIServerStatus: \"healthy\",\n\t}\n\n\t// Try to get component statuses\n\tcompData, err := k8sAPIRequest(\"/api/v1/componentstatuses\")\n\tif err == nil {\n\t\tvar compList K8sComponentStatusList\n\t\tif json.Unmarshal(compData, \u0026compList) == nil {\n\t\t\tfor _, comp := range compList.Items {\n\t\t\t\thealthy := false\n\t\t\t\tfor _, cond := range comp.Conditions {\n\t\t\t\t\tif cond.Type == \"Healthy\" \u0026\u0026 cond.Status == \"True\" {\n\t\t\t\t\t\thealthy = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tswitch comp.Metadata.Name {\n\t\t\t\tcase \"etcd-0\", \"etcd\":\n\t\t\t\t\tif healthy {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"healthy\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus.VitalSigns.ETCDStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase \"scheduler\":\n\t\t\t\t\tif healthy {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus = \"healthy\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus.VitalSigns.SchedulerStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\tcase \"controller-manager\":\n\t\t\t\t\tif healthy {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"healthy\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus.VitalSigns.ControllerStatus = \"unhealthy\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Check CoreDNS\n\tfor _, deploy := range deployList.Items {\n\t\tif deploy.Metadata.Name == \"coredns\" \u0026\u0026 deploy.Metadata.Namespace == \"kube-system\" {\n\t\t\tif deploy.Status.ReadyReplicas \u003e 0 {\n\t\t\t\tstatus.VitalSigns.DNSStatus = \"healthy\"\n\t\t\t} else {\n\t\t\t\tstatus.VitalSigns.DNSStatus = \"unhealthy\"\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t}\n\n\t// Calculate health score\n\tscore := 100\n\tif status.ClusterHealth.ReadyNodes \u003c status.ClusterHealth.TotalNodes {\n\t\tscore -= (status.ClusterHealth.TotalNodes - status.ClusterHealth.ReadyNodes) * 15\n\t}\n\tif status.ClusterHealth.FailedPods \u003e 0 {\n\t\tscore -= status.ClusterHealth.FailedPods * 5\n\t}\n\tif status.ClusterHealth.PendingPods \u003e 5 {\n\t\tscore -= 10\n\t}\n\tif status.ClusterHealth.CPUPercent \u003e 90 {\n\t\tscore -= 15\n\t} else if status.ClusterHealth.CPUPercent \u003e 80 {\n\t\tscore -= 5\n\t}\n\tif status.ClusterHealth.MemoryPercent \u003e 90 {\n\t\tscore -= 15\n\t} else if status.ClusterHealth.MemoryPercent \u003e 80 {\n\t\tscore -= 5\n\t}\n\tif len(status.ResourceAlerts) \u003e 0 {\n\t\tfor _, alert := range status.ResourceAlerts {\n\t\t\tif alert.Severity == \"critical\" {\n\t\t\t\tscore -= 10\n\t\t\t} else {\n\t\t\t\tscore -= 5\n\t\t\t}\n\t\t}\n\t}\n\tif score \u003c 0 {\n\t\tscore = 0\n\t}\n\tstatus.HealthScore = score\n\n\t// Determine overall status and message\n\tif score \u003e= 90 {\n\t\tstatus.Status = \"healthy\"\n\t\tstatus.Message = \"Vital signs are looking good\"\n\t} else if score \u003e= 70 {\n\t\tstatus.Status = \"warning\"\n\t\tstatus.Message = \"Some vital signs need attention\"\n\t} else if score \u003e= 50 {\n\t\tstatus.Status = \"degraded\"\n\t\tstatus.Message = \"Cluster health is degraded\"\n\t} else {\n\t\tstatus.Status = \"critical\"\n\t\tstatus.Message = \"Critical issues detected\"\n\t}\n\n\treturn status, nil\n}\n\n// Health monitor loop\nfunc healthMonitor() {\n\tticker := time.NewTicker(10 * time.Second)\n\tdefer ticker.Stop()\n\n\tfor {\n\t\thealth, err := fetchClusterHealth()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"Error fetching health: %v\", err)\n\t\t\thealth = \u0026HealthStatus{\n\t\t\t\tStatus:    \"unknown\",\n\t\t\t\tMessage:   \"Unable to fetch cluster health\",\n\t\t\t\tTimestamp: time.Now(),\n\t\t\t}\n\t\t}\n\n\t\thealthMux.Lock()\n\t\tcurrentHealth = *health\n\t\thealthMux.Unlock()\n\n\t\t// Broadcast to WebSocket clients\n\t\tbroadcast \u003c- HealthUpdate{\n\t\t\tType: \"health_update\",\n\t\t\tData: health,\n\t\t}\n\n\t\t\u003c-ticker.C\n\t}\n}\n\n// WebSocket broadcaster\nfunc handleBroadcast() {\n\tfor update := range broadcast {\n\t\tclientsMux.RLock()\n\t\tfor client := range clients {\n\t\t\terr := client.WriteJSON(update)\n\t\t\tif err != nil {\n\t\t\t\tlog.Printf(\"WebSocket write error: %v\", err)\n\t\t\t\tclient.Close()\n\t\t\t\tclientsMux.RUnlock()\n\t\t\t\tclientsMux.Lock()\n\t\t\t\tdelete(clients, client)\n\t\t\t\tclientsMux.Unlock()\n\t\t\t\tclientsMux.RLock()\n\t\t\t}\n\t\t}\n\t\tclientsMux.RUnlock()\n\t}\n}\n\n// HTTP Handlers\nfunc handleHealth(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":  \"healthy\",\n\t\t\"service\": \"pulse\",\n\t\t\"message\": \"Vital signs are looking good\",\n\t})\n}\n\nfunc handleStatus(w http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(health)\n}\n\nfunc handleNodes(w http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tnodes := currentHealth.NodeStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc handlePods(w http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tpods := currentHealth.PodStatuses\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc handleAlerts(w http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\talerts := currentHealth.ResourceAlerts\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(alerts)\n}\n\nfunc handleVitals(w http.ResponseWriter, r *http.Request) {\n\thealthMux.RLock()\n\tvitals := currentHealth.VitalSigns\n\thealthMux.RUnlock()\n\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(vitals)\n}\n\nfunc handleWebSocket(w http.ResponseWriter, r *http.Request) {\n\tconn, err := upgrader.Upgrade(w, r, nil)\n\tif err != nil {\n\t\tlog.Printf(\"WebSocket upgrade error: %v\", err)\n\t\treturn\n\t}\n\n\tclientsMux.Lock()\n\tclients[conn] = true\n\tclientsMux.Unlock()\n\n\t// Send current health immediately\n\thealthMux.RLock()\n\thealth := currentHealth\n\thealthMux.RUnlock()\n\n\tconn.WriteJSON(HealthUpdate{\n\t\tType: \"health_update\",\n\t\tData: health,\n\t})\n\n\t// Keep connection alive and handle disconnection\n\tfor {\n\t\t_, _, err := conn.ReadMessage()\n\t\tif err != nil {\n\t\t\tclientsMux.Lock()\n\t\t\tdelete(clients, conn)\n\t\t\tclientsMux.Unlock()\n\t\t\tconn.Close()\n\t\t\tbreak\n\t\t}\n\t}\n}\n\nfunc handleDashboard(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"text/html\")\n\tw.Write([]byte(getDashboardHTML()))\n}\n\nfunc main() {\n\t// Initialize health status\n\tcurrentHealth = HealthStatus{\n\t\tStatus:    \"initializing\",\n\t\tMessage:   \"Starting health monitor...\",\n\t\tTimestamp: time.Now(),\n\t}\n\n\t// Start health monitor\n\tgo healthMonitor()\n\n\t// Start WebSocket broadcaster\n\tgo handleBroadcast()\n\n\t// Setup HTTP server\n\tmux := http.NewServeMux()\n\n\t// API endpoints\n\tmux.HandleFunc(\"/health\", handleHealth)\n\tmux.HandleFunc(\"/api/status\", handleStatus)\n\tmux.HandleFunc(\"/api/nodes\", handleNodes)\n\tmux.HandleFunc(\"/api/pods\", handlePods)\n\tmux.HandleFunc(\"/api/alerts\", handleAlerts)\n\tmux.HandleFunc(\"/api/vitals\", handleVitals)\n\tmux.HandleFunc(\"/ws\", handleWebSocket)\n\n\t// Dashboard\n\tmux.HandleFunc(\"/\", handleDashboard)\n\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tlog.Printf(\"Pulse health monitor starting on port %s\", port)\n\tlog.Printf(\"Vital signs are looking good\")\n\tlog.Fatal(http.ListenAndServe(\":\"+port, mux))\n}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"pulse-src","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:06:57Z"
    name: pulse-src
    namespace: holm
    resourceVersion: "753"
    uid: a5b50e29-6735-4bae-878c-94f81ddbf97a
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder

      WORKDIR /app

      COPY go.mod ./
      COPY *.go ./

      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o registry-ui .

      FROM alpine:3.19

      RUN apk --no-cache add ca-certificates

      WORKDIR /app

      COPY --from=builder /app/registry-ui .

      EXPOSE 8080

      CMD ["./registry-ui"]
    go.mod: |
      module registry-ui

      go 1.21
    main.go: "package main\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"html/template\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strings\"\n\t\"time\"\n)\n\nvar
      registryURL string\nvar templates *template.Template\n\ntype Repository struct
      {\n\tName       string   `json:\"name\"`\n\tTags       []string `json:\"tags\"`\n\tTagDetails
      []TagDetail\n}\n\ntype TagDetail struct {\n\tTag        string\n\tDigest     string\n\tSize
      \      int64\n\tCreated    string\n\tLayers     int\n\tSizeHuman  string\n}\n\ntype
      CatalogResponse struct {\n\tRepositories []string `json:\"repositories\"`\n}\n\ntype
      TagsResponse struct {\n\tName string   `json:\"name\"`\n\tTags []string `json:\"tags\"`\n}\n\ntype
      ManifestResponse struct {\n\tSchemaVersion int    `json:\"schemaVersion\"`\n\tMediaType
      \    string `json:\"mediaType\"`\n\tConfig        struct {\n\t\tMediaType string
      `json:\"mediaType\"`\n\t\tSize      int64  `json:\"size\"`\n\t\tDigest    string
      `json:\"digest\"`\n\t} `json:\"config\"`\n\tLayers []struct {\n\t\tMediaType
      string `json:\"mediaType\"`\n\t\tSize      int64  `json:\"size\"`\n\t\tDigest
      \   string `json:\"digest\"`\n\t} `json:\"layers\"`\n}\n\nfunc humanSize(bytes
      int64) string {\n\tconst unit = 1024\n\tif bytes < unit {\n\t\treturn fmt.Sprintf(\"%d
      B\", bytes)\n\t}\n\tdiv, exp := int64(unit), 0\n\tfor n := bytes / unit; n >=
      unit; n /= unit {\n\t\tdiv *= unit\n\t\texp++\n\t}\n\treturn fmt.Sprintf(\"%.1f
      %cB\", float64(bytes)/float64(div), \"KMGTPE\"[exp])\n}\n\nfunc getRepositories()
      ([]string, error) {\n\tresp, err := http.Get(registryURL + \"/v2/_catalog\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to connect to registry: %v\",
      err)\n\t}\n\tdefer resp.Body.Close()\n\n\tif resp.StatusCode != http.StatusOK
      {\n\t\treturn nil, fmt.Errorf(\"registry returned status %d\", resp.StatusCode)\n\t}\n\n\tvar
      catalog CatalogResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&catalog);
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to decode response: %v\",
      err)\n\t}\n\n\tsort.Strings(catalog.Repositories)\n\treturn catalog.Repositories,
      nil\n}\n\nfunc getTags(repo string) ([]string, error) {\n\tresp, err := http.Get(fmt.Sprintf(\"%s/v2/%s/tags/list\",
      registryURL, repo))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tif
      resp.StatusCode != http.StatusOK {\n\t\treturn nil, fmt.Errorf(\"registry returned
      status %d\", resp.StatusCode)\n\t}\n\n\tvar tags TagsResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&tags);
      err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn tags.Tags, nil\n}\n\nfunc
      getManifest(repo, tag string) (*ManifestResponse, string, error) {\n\t// Try
      OCI manifest first (buildah/podman), then Docker v2\n\tacceptHeaders := []string{\n\t\t\"application/vnd.oci.image.manifest.v1+json\",\n\t\t\"application/vnd.docker.distribution.manifest.v2+json\",\n\t}\n\n\tclient
      := &http.Client{Timeout: 10 * time.Second}\n\n\tfor _, accept := range acceptHeaders
      {\n\t\treq, err := http.NewRequest(\"GET\", fmt.Sprintf(\"%s/v2/%s/manifests/%s\",
      registryURL, repo, tag), nil)\n\t\tif err != nil {\n\t\t\treturn nil, \"\",
      err\n\t\t}\n\t\treq.Header.Set(\"Accept\", accept)\n\n\t\tresp, err := client.Do(req)\n\t\tif
      err != nil {\n\t\t\tcontinue\n\t\t}\n\t\tdefer resp.Body.Close()\n\n\t\tif resp.StatusCode
      != http.StatusOK {\n\t\t\tcontinue\n\t\t}\n\n\t\tdigest := resp.Header.Get(\"Docker-Content-Digest\")\n\n\t\tvar
      manifest ManifestResponse\n\t\tif err := json.NewDecoder(resp.Body).Decode(&manifest);
      err != nil {\n\t\t\treturn nil, digest, err\n\t\t}\n\n\t\treturn &manifest,
      digest, nil\n\t}\n\n\treturn nil, \"\", fmt.Errorf(\"no supported manifest format
      found\")\n}\n\nfunc deleteManifest(repo, digest string) error {\n\treq, err
      := http.NewRequest(\"DELETE\", fmt.Sprintf(\"%s/v2/%s/manifests/%s\", registryURL,
      repo, digest), nil)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tclient := &http.Client{}\n\tresp,
      err := client.Do(req)\n\tif err != nil {\n\t\treturn err\n\t}\n\tdefer resp.Body.Close()\n\n\tif
      resp.StatusCode != http.StatusAccepted && resp.StatusCode != http.StatusOK {\n\t\tbody,
      _ := io.ReadAll(resp.Body)\n\t\treturn fmt.Errorf(\"delete returned status %d:
      %s\", resp.StatusCode, string(body))\n\t}\n\n\treturn nil\n}\n\nfunc healthHandler(w
      http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tw.WriteHeader(http.StatusOK)\n\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"healthy\"})\n}\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request)
      {\n\trepos, err := getRepositories()\n\tif err != nil {\n\t\tlog.Printf(\"Error
      getting repositories: %v\", err)\n\t\thttp.Error(w, \"Failed to fetch repositories:
      \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tdata :=
      struct {\n\t\tRegistryURL  string\n\t\tRepositories []string\n\t\tError        string\n\t}{\n\t\tRegistryURL:
      \ registryURL,\n\t\tRepositories: repos,\n\t}\n\n\tif err := templates.ExecuteTemplate(w,
      \"index\", data); err != nil {\n\t\tlog.Printf(\"Template error: %v\", err)\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t}\n}\n\nfunc repoHandler(w http.ResponseWriter,
      r *http.Request) {\n\trepo := strings.TrimPrefix(r.URL.Path, \"/repo/\")\n\tif
      repo == \"\" {\n\t\thttp.Redirect(w, r, \"/\", http.StatusFound)\n\t\treturn\n\t}\n\n\ttags,
      err := getTags(repo)\n\tif err != nil {\n\t\thttp.Error(w, \"Failed to fetch
      tags: \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar
      tagDetails []TagDetail\n\tfor _, tag := range tags {\n\t\tmanifest, digest,
      err := getManifest(repo, tag)\n\t\ttd := TagDetail{Tag: tag}\n\t\tif err ==
      nil && manifest != nil {\n\t\t\tvar totalSize int64\n\t\t\tfor _, layer := range
      manifest.Layers {\n\t\t\t\ttotalSize += layer.Size\n\t\t\t}\n\t\t\ttd.Digest
      = digest\n\t\t\ttd.Size = totalSize\n\t\t\ttd.SizeHuman = humanSize(totalSize)\n\t\t\ttd.Layers
      = len(manifest.Layers)\n\t\t}\n\t\ttagDetails = append(tagDetails, td)\n\t}\n\n\tdata
      := struct {\n\t\tRepo       string\n\t\tTagDetails []TagDetail\n\t}{\n\t\tRepo:
      \      repo,\n\t\tTagDetails: tagDetails,\n\t}\n\n\tif err := templates.ExecuteTemplate(w,
      \"repo\", data); err != nil {\n\t\tlog.Printf(\"Template error: %v\", err)\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t}\n}\n\nfunc deleteHandler(w
      http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodPost {\n\t\thttp.Error(w,
      \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\trepo
      := r.FormValue(\"repo\")\n\tdigest := r.FormValue(\"digest\")\n\n\tif repo ==
      \"\" || digest == \"\" {\n\t\thttp.Error(w, \"Missing repo or digest\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tif
      err := deleteManifest(repo, digest); err != nil {\n\t\tlog.Printf(\"Delete error:
      %v\", err)\n\t\thttp.Error(w, \"Failed to delete: \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tlog.Printf(\"Deleted
      %s@%s\", repo, digest)\n\thttp.Redirect(w, r, \"/repo/\"+repo, http.StatusFound)\n}\n\nfunc
      apiReposHandler(w http.ResponseWriter, r *http.Request) {\n\trepos, err := getRepositories()\n\tif
      err != nil {\n\t\tw.WriteHeader(http.StatusInternalServerError)\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"error\":
      err.Error()})\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\"repositories\":
      repos})\n}\n\nfunc apiTagsHandler(w http.ResponseWriter, r *http.Request) {\n\trepo
      := strings.TrimPrefix(r.URL.Path, \"/api/tags/\")\n\ttags, err := getTags(repo)\n\tif
      err != nil {\n\t\tw.WriteHeader(http.StatusInternalServerError)\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"error\":
      err.Error()})\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\"repo\":
      repo, \"tags\": tags})\n}\n\nfunc main() {\n\tport := os.Getenv(\"PORT\")\n\tif
      port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tregistryURL = os.Getenv(\"REGISTRY_URL\")\n\tif
      registryURL == \"\" {\n\t\tregistryURL = \"http://registry.holm.svc.cluster.local:5000\"\n\t}\n\tregistryURL
      = strings.TrimSuffix(registryURL, \"/\")\n\n\t// Parse templates\n\tvar err
      error\n\ttemplates, err = template.New(\"\").Parse(templateHTML)\n\tif err !=
      nil {\n\t\tlog.Fatalf(\"Failed to parse templates: %v\", err)\n\t}\n\n\t// Routes\n\thttp.HandleFunc(\"/health\",
      healthHandler)\n\thttp.HandleFunc(\"/\", indexHandler)\n\thttp.HandleFunc(\"/repo/\",
      repoHandler)\n\thttp.HandleFunc(\"/delete\", deleteHandler)\n\thttp.HandleFunc(\"/api/repos\",
      apiReposHandler)\n\thttp.HandleFunc(\"/api/tags/\", apiTagsHandler)\n\n\tlog.Printf(\"Registry
      UI starting on port %s\", port)\n\tlog.Printf(\"Registry URL: %s\", registryURL)\n\n\tserver
      := &http.Server{\n\t\tAddr:         \":\" + port,\n\t\tReadTimeout:  30 * time.Second,\n\t\tWriteTimeout:
      30 * time.Second,\n\t}\n\n\tif err := server.ListenAndServe(); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\nconst
      templateHTML = `\n{{define \"index\"}}\n<!DOCTYPE html>\n<html>\n<head>\n    <meta
      charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,
      initial-scale=1.0\">\n    <title>Registry UI</title>\n    <style>\n        *
      { box-sizing: border-box; margin: 0; padding: 0; }\n        body {\n            font-family:
      -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background:
      #0a0a0a;\n            color: #e0e0e0;\n            min-height: 100vh;\n        }\n
      \       .container { max-width: 1200px; margin: 0 auto; padding: 20px; }\n        h1
      {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom:
      8px;\n            color: #fff;\n        }\n        .subtitle {\n            color:
      #888;\n            font-size: 14px;\n            margin-bottom: 24px;\n        }\n
      \       .repo-list {\n            display: grid;\n            gap: 12px;\n        }\n
      \       .repo-card {\n            background: #161616;\n            border:
      1px solid #2a2a2a;\n            border-radius: 8px;\n            padding: 16px
      20px;\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            transition: all 0.2s;\n        }\n
      \       .repo-card:hover {\n            border-color: #3a3a3a;\n            background:
      #1a1a1a;\n        }\n        .repo-name {\n            font-weight: 500;\n            color:
      #fff;\n        }\n        .repo-link {\n            color: #58a6ff;\n            text-decoration:
      none;\n            font-size: 14px;\n        }\n        .repo-link:hover { text-decoration:
      underline; }\n        .empty {\n            text-align: center;\n            padding:
      60px 20px;\n            color: #666;\n        }\n        .empty-icon { font-size:
      48px; margin-bottom: 16px; }\n        .stats {\n            background: #161616;\n
      \           border: 1px solid #2a2a2a;\n            border-radius: 8px;\n            padding:
      16px 20px;\n            margin-bottom: 24px;\n            display: flex;\n            gap:
      32px;\n        }\n        .stat-item { }\n        .stat-value { font-size: 24px;
      font-weight: 600; color: #fff; }\n        .stat-label { font-size: 12px; color:
      #888; text-transform: uppercase; }\n    </style>\n</head>\n<body>\n    <div
      class=\"container\">\n        <h1>Container Registry</h1>\n        <p class=\"subtitle\">{{.RegistryURL}}</p>\n\n
      \       <div class=\"stats\">\n            <div class=\"stat-item\">\n                <div
      class=\"stat-value\">{{len .Repositories}}</div>\n                <div class=\"stat-label\">Repositories</div>\n
      \           </div>\n        </div>\n\n        {{if .Repositories}}\n        <div
      class=\"repo-list\">\n            {{range .Repositories}}\n            <div
      class=\"repo-card\">\n                <span class=\"repo-name\">{{.}}</span>\n
      \               <a href=\"/repo/{{.}}\" class=\"repo-link\">View Tags</a>\n
      \           </div>\n            {{end}}\n        </div>\n        {{else}}\n
      \       <div class=\"empty\">\n            <div class=\"empty-icon\">\U0001F4E6</div>\n
      \           <p>No images in registry</p>\n            <p style=\"margin-top:
      8px; font-size: 14px;\">Push an image to get started</p>\n        </div>\n        {{end}}\n
      \   </div>\n</body>\n</html>\n{{end}}\n\n{{define \"repo\"}}\n<!DOCTYPE html>\n<html>\n<head>\n
      \   <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,
      initial-scale=1.0\">\n    <title>{{.Repo}} - Registry UI</title>\n    <style>\n
      \       * { box-sizing: border-box; margin: 0; padding: 0; }\n        body {\n
      \           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
      sans-serif;\n            background: #0a0a0a;\n            color: #e0e0e0;\n
      \           min-height: 100vh;\n        }\n        .container { max-width: 1200px;
      margin: 0 auto; padding: 20px; }\n        .breadcrumb {\n            margin-bottom:
      16px;\n        }\n        .breadcrumb a {\n            color: #58a6ff;\n            text-decoration:
      none;\n        }\n        .breadcrumb a:hover { text-decoration: underline;
      }\n        h1 {\n            font-size: 24px;\n            font-weight: 600;\n
      \           margin-bottom: 24px;\n            color: #fff;\n        }\n        table
      {\n            width: 100%;\n            border-collapse: collapse;\n            background:
      #161616;\n            border: 1px solid #2a2a2a;\n            border-radius:
      8px;\n            overflow: hidden;\n        }\n        th, td {\n            padding:
      12px 16px;\n            text-align: left;\n            border-bottom: 1px solid
      #2a2a2a;\n        }\n        th {\n            background: #1a1a1a;\n            font-weight:
      500;\n            font-size: 12px;\n            text-transform: uppercase;\n
      \           color: #888;\n        }\n        tr:last-child td { border-bottom:
      none; }\n        tr:hover td { background: #1a1a1a; }\n        .tag { font-family:
      monospace; color: #58a6ff; }\n        .digest {\n            font-family: monospace;\n
      \           font-size: 12px;\n            color: #666;\n            max-width:
      200px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n
      \       }\n        .size { color: #888; }\n        .delete-btn {\n            background:
      #d73a49;\n            color: white;\n            border: none;\n            padding:
      6px 12px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size:
      12px;\n        }\n        .delete-btn:hover { background: #cb2431; }\n        .empty
      {\n            text-align: center;\n            padding: 40px;\n            color:
      #666;\n        }\n        .pull-cmd {\n            background: #1a1a1a;\n            border:
      1px solid #2a2a2a;\n            border-radius: 4px;\n            padding: 8px
      12px;\n            font-family: monospace;\n            font-size: 12px;\n            color:
      #888;\n            margin-bottom: 24px;\n        }\n        .modal {\n            display:
      none;\n            position: fixed;\n            top: 0;\n            left:
      0;\n            width: 100%;\n            height: 100%;\n            background:
      rgba(0,0,0,0.8);\n            z-index: 1000;\n            align-items: center;\n
      \           justify-content: center;\n        }\n        .modal.active { display:
      flex; }\n        .modal-content {\n            background: #161616;\n            border:
      1px solid #2a2a2a;\n            border-radius: 8px;\n            padding: 24px;\n
      \           max-width: 400px;\n            width: 90%;\n        }\n        .modal
      h2 { font-size: 18px; margin-bottom: 16px; }\n        .modal p { color: #888;
      margin-bottom: 20px; font-size: 14px; }\n        .modal-btns { display: flex;
      gap: 12px; justify-content: flex-end; }\n        .btn-cancel {\n            background:
      #2a2a2a;\n            color: #e0e0e0;\n            border: none;\n            padding:
      8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n        }\n
      \       .btn-confirm {\n            background: #d73a49;\n            color:
      white;\n            border: none;\n            padding: 8px 16px;\n            border-radius:
      4px;\n            cursor: pointer;\n        }\n    </style>\n</head>\n<body>\n
      \   <div class=\"container\">\n        <div class=\"breadcrumb\">\n            <a
      href=\"/\">Registry</a> / {{.Repo}}\n        </div>\n        <h1>{{.Repo}}</h1>\n\n
      \       {{if .TagDetails}}\n        <table>\n            <thead>\n                <tr>\n
      \                   <th>Tag</th>\n                    <th>Digest</th>\n                    <th>Size</th>\n
      \                   <th>Layers</th>\n                    <th>Actions</th>\n
      \               </tr>\n            </thead>\n            <tbody>\n                {{range
      .TagDetails}}\n                <tr>\n                    <td><span class=\"tag\">{{.Tag}}</span></td>\n
      \                   <td><span class=\"digest\" title=\"{{.Digest}}\">{{.Digest}}</span></td>\n
      \                   <td class=\"size\">{{.SizeHuman}}</td>\n                    <td>{{.Layers}}</td>\n
      \                   <td>\n                        {{if .Digest}}\n                        <button
      class=\"delete-btn\" onclick=\"confirmDelete('{{$.Repo}}', '{{.Digest}}', '{{.Tag}}')\">Delete</button>\n
      \                       {{end}}\n                    </td>\n                </tr>\n
      \               {{end}}\n            </tbody>\n        </table>\n        {{else}}\n
      \       <div class=\"empty\">No tags found for this repository</div>\n        {{end}}\n
      \   </div>\n\n    <div class=\"modal\" id=\"deleteModal\">\n        <div class=\"modal-content\">\n
      \           <h2>Delete Image Tag</h2>\n            <p>Are you sure you want
      to delete <strong id=\"deleteTag\"></strong>? This action cannot be undone.</p>\n
      \           <form id=\"deleteForm\" method=\"POST\" action=\"/delete\">\n                <input
      type=\"hidden\" name=\"repo\" id=\"deleteRepo\">\n                <input type=\"hidden\"
      name=\"digest\" id=\"deleteDigest\">\n                <div class=\"modal-btns\">\n
      \                   <button type=\"button\" class=\"btn-cancel\" onclick=\"closeModal()\">Cancel</button>\n
      \                   <button type=\"submit\" class=\"btn-confirm\">Delete</button>\n
      \               </div>\n            </form>\n        </div>\n    </div>\n\n
      \   <script>\n        function confirmDelete(repo, digest, tag) {\n            document.getElementById('deleteRepo').value
      = repo;\n            document.getElementById('deleteDigest').value = digest;\n
      \           document.getElementById('deleteTag').textContent = tag;\n            document.getElementById('deleteModal').classList.add('active');\n
      \       }\n        function closeModal() {\n            document.getElementById('deleteModal').classList.remove('active');\n
      \       }\n        document.getElementById('deleteModal').addEventListener('click',
      function(e) {\n            if (e.target === this) closeModal();\n        });\n
      \   </script>\n</body>\n</html>\n{{end}}\n`\n"
  kind: ConfigMap
  metadata:
    creationTimestamp: "2026-01-18T03:11:06Z"
    name: registry-ui-build-files
    namespace: holm
    resourceVersion: "754"
    uid: b4248547-9905-4220-a135-3f959fecd6a9
- apiVersion: v1
  data:
    Dockerfile: |
      FROM golang:1.21-alpine AS builder

      WORKDIR /app

      COPY go.mod ./
      COPY *.go ./

      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o registry-ui .

      FROM alpine:3.19

      RUN apk --no-cache add ca-certificates

      WORKDIR /app

      COPY --from=builder /app/registry-ui .

      EXPOSE 8080

      CMD ["./registry-ui"]
    go.mod: |
      module registry-ui

      go 1.21
    main.go: "package main\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"html/template\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"sort\"\n\t\"strings\"\n\t\"time\"\n)\n\nvar
      registryURL string\nvar templates *template.Template\n\ntype Repository struct
      {\n\tName       string   `json:\"name\"`\n\tTags       []string `json:\"tags\"`\n\tTagDetails
      []TagDetail\n}\n\ntype TagDetail struct {\n\tTag        string\n\tDigest     string\n\tSize
      \      int64\n\tCreated    string\n\tLayers     int\n\tSizeHuman  string\n}\n\ntype
      CatalogResponse struct {\n\tRepositories []string `json:\"repositories\"`\n}\n\ntype
      TagsResponse struct {\n\tName string   `json:\"name\"`\n\tTags []string `json:\"tags\"`\n}\n\ntype
      ManifestResponse struct {\n\tSchemaVersion int    `json:\"schemaVersion\"`\n\tMediaType
      \    string `json:\"mediaType\"`\n\tConfig        struct {\n\t\tMediaType string
      `json:\"mediaType\"`\n\t\tSize      int64  `json:\"size\"`\n\t\tDigest    string
      `json:\"digest\"`\n\t} `json:\"config\"`\n\tLayers []struct {\n\t\tMediaType
      string `json:\"mediaType\"`\n\t\tSize      int64  `json:\"size\"`\n\t\tDigest
      \   string `json:\"digest\"`\n\t} `json:\"layers\"`\n}\n\nfunc humanSize(bytes
      int64) string {\n\tconst unit = 1024\n\tif bytes < unit {\n\t\treturn fmt.Sprintf(\"%d
      B\", bytes)\n\t}\n\tdiv, exp := int64(unit), 0\n\tfor n := bytes / unit; n >=
      unit; n /= unit {\n\t\tdiv *= unit\n\t\texp++\n\t}\n\treturn fmt.Sprintf(\"%.1f
      %cB\", float64(bytes)/float64(div), \"KMGTPE\"[exp])\n}\n\nfunc getRepositories()
      ([]string, error) {\n\tresp, err := http.Get(registryURL + \"/v2/_catalog\")\n\tif
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to connect to registry: %v\",
      err)\n\t}\n\tdefer resp.Body.Close()\n\n\tif resp.StatusCode != http.StatusOK
      {\n\t\treturn nil, fmt.Errorf(\"registry returned status %d\", resp.StatusCode)\n\t}\n\n\tvar
      catalog CatalogResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&catalog);
      err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to decode response: %v\",
      err)\n\t}\n\n\tsort.Strings(catalog.Repositories)\n\treturn catalog.Repositories,
      nil\n}\n\nfunc getTags(repo string) ([]string, error) {\n\tresp, err := http.Get(fmt.Sprintf(\"%s/v2/%s/tags/list\",
      registryURL, repo))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tif
      resp.StatusCode != http.StatusOK {\n\t\treturn nil, fmt.Errorf(\"registry returned
      status %d\", resp.StatusCode)\n\t}\n\n\tvar tags TagsResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&tags);
      err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn tags.Tags, nil\n}\n\nfunc
      getManifest(repo, tag string) (*ManifestResponse, string, error) {\n\t// Try
      OCI manifest first (buildah/podman), then Docker v2\n\tacceptHeaders := []string{\n\t\t\"application/vnd.oci.image.manifest.v1+json\",\n\t\t\"application/vnd.docker.distribution.manifest.v2+json\",\n\t}\n\n\tclient
      := &http.Client{Timeout: 10 * time.Second}\n\n\tfor _, accept := range acceptHeaders
      {\n\t\treq, err := http.NewRequest(\"GET\", fmt.Sprintf(\"%s/v2/%s/manifests/%s\",
      registryURL, repo, tag), nil)\n\t\tif err != nil {\n\t\t\treturn nil, \"\",
      err\n\t\t}\n\t\treq.Header.Set(\"Accept\", accept)\n\n\t\tresp, err := client.Do(req)\n\t\tif
      err != nil {\n\t\t\tcontinue\n\t\t}\n\t\tdefer resp.Body.Close()\n\n\t\tif resp.StatusCode
      != http.StatusOK {\n\t\t\tcontinue\n\t\t}\n\n\t\tdigest := resp.Header.Get(\"Docker-Content-Digest\")\n\n\t\tvar
      manifest ManifestResponse\n\t\tif err := json.NewDecoder(resp.Body).Decode(&manifest);
      err != nil {\n\t\t\treturn nil, digest, err\n\t\t}\n\n\t\treturn &manifest,
      digest, nil\n\t}\n\n\treturn nil, \"\", fmt.Errorf(\"no supported manifest format
      found\")\n}\n\nfunc deleteManifest(repo, digest string) error {\n\treq, err
      := http.NewRequest(\"DELETE\", fmt.Sprintf(\"%s/v2/%s/manifests/%s\", registryURL,
      repo, digest), nil)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tclient := &http.Client{}\n\tresp,
      err := client.Do(req)\n\tif err != nil {\n\t\treturn err\n\t}\n\tdefer resp.Body.Close()\n\n\tif
      resp.StatusCode != http.StatusAccepted && resp.StatusCode != http.StatusOK {\n\t\tbody,
      _ := io.ReadAll(resp.Body)\n\t\treturn fmt.Errorf(\"delete returned status %d:
      %s\", resp.StatusCode, string(body))\n\t}\n\n\treturn nil\n}\n\nfunc healthHandler(w
      http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tw.WriteHeader(http.StatusOK)\n\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"healthy\"})\n}\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request)
      {\n\trepos, err := getRepositories()\n\tif err != nil {\n\t\tlog.Printf(\"Error
      getting repositories: %v\", err)\n\t\thttp.Error(w, \"Failed to fetch repositories:
      \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tdata :=
      struct {\n\t\tRegistryURL  string\n\t\tRepositories []string\n\t\tError        string\n\t}{\n\t\tRegistryURL:
      \ registryURL,\n\t\tRepositories: repos,\n\t}\n\n\tif err := templates.ExecuteTemplate(w,
      \"index\", data); err != nil {\n\t\tlog.Printf(\"Template error: %v\", err)\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t}\n}\n\nfunc repoHandler(w http.ResponseWriter,
      r *http.Request) {\n\trepo := strings.TrimPrefix(r.URL.Path, \"/repo/\")\n\tif
      repo == \"\" {\n\t\thttp.Redirect(w, r, \"/\", http.StatusFound)\n\t\treturn\n\t}\n\n\ttags,
      err := getTags(repo)\n\tif err != nil {\n\t\thttp.Error(w, \"Failed to fetch
      tags: \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tvar
      tagDetails []TagDetail\n\tfor _, tag := range tags {\n\t\tmanifest, digest,
      err := getManifest(repo, tag)\n\t\ttd := TagDetail{Tag: tag}\n\t\tif err ==
      nil && manifest != nil {\n\t\t\tvar totalSize int64\n\t\t\tfor _, layer := range
      manifest.Layers {\n\t\t\t\ttotalSize += layer.Size\n\t\t\t}\n\t\t\ttd.Digest
      = digest\n\t\t\ttd.Size = totalSize\n\t\t\ttd.SizeHuman = humanSize(totalSize)\n\t\t\ttd.Layers
      = len(manifest.Layers)\n\t\t}\n\t\ttagDetails = append(tagDetails, td)\n\t}\n\n\tdata
      := struct {\n\t\tRepo       string\n\t\tTagDetails []TagDetail\n\t}{\n\t\tRepo:
      \      repo,\n\t\tTagDetails: tagDetails,\n\t}\n\n\tif err := templates.ExecuteTemplate(w,
      \"repo\", data); err != nil {\n\t\tlog.Printf(\"Template error: %v\", err)\n\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t}\n}\n\nfunc deleteHandler(w
      http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodPost {\n\t\thttp.Error(w,
      \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\n\trepo
      := r.FormValue(\"repo\")\n\tdigest := r.FormValue(\"digest\")\n\n\tif repo ==
      \"\" || digest == \"\" {\n\t\thttp.Error(w, \"Missing repo or digest\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tif
      err := deleteManifest(repo, digest); err != nil {\n\t\tlog.Printf(\"Delete error:
      %v\", err)\n\t\thttp.Error(w, \"Failed to delete: \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tlog.Printf(\"Deleted
      %s@%s\", repo, digest)\n\thttp.Redirect(w, r, \"/repo/\"+repo, http.StatusFound)\n}\n\nfunc
      apiReposHandler(w http.ResponseWriter, r *http.Request) {\n\trepos, err := getRepositories()\n\tif
      err != nil {\n\t\tw.WriteHeader(http.StatusInternalServerError)\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"error\":
      err.Error()})\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\"repositories\":
      repos})\n}\n\nfunc apiTagsHandler(w http.ResponseWriter, r *http.Request) {\n\trepo
      := strings.TrimPrefix(r.URL.Path, \"/api/tags/\")\n\ttags, err := getTags(repo)\n\tif
      err != nil {\n\t\tw.WriteHeader(http.StatusInternalServerError)\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"error\":
      err.Error()})\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]interface{}{\"repo\":
      repo, \"tags\": tags})\n}\n\nfunc main() {\n\tport := os.Getenv(\"PORT\")\n\tif
      port == \"\" {\n\t\tport = \"8080\"\n\t}\n\n\tregistryURL = os.Getenv(\"REGISTRY_URL\")\n\tif
      registryURL == \"\" {\n\t\tregistryURL = \"http://registry.holm.svc.cluster.local:5000\"\n\t}\n\tregistryURL
      = strings.TrimSuffix(registryURL, \"/\")\n\n\t// Parse templates\n\tvar err
      error\n\ttemplates, err = template.New(\"\").Parse(templateHTML)\n\tif err !=
      nil {\n\t\tlog.Fatalf(\"Failed to parse templates: %v\", err)\n\t}\n\n\t// Routes\n\thttp.HandleFunc(\"/health\",
      healthHandler)\n\thttp.HandleFunc(\"/\", indexHandler)\n\thttp.HandleFunc(\"/repo/\",
      repoHandler)\n\thttp.HandleFunc(\"/delete\", deleteHandler)\n\thttp.HandleFunc(\"/api/repos\",
      apiReposHandler)\n\thttp.HandleFunc(\"/api/tags/\", apiTagsHandler)\n\n\tlog.Printf(\"Registry
      UI starting on port %s\", port)\n\tlog.Printf(\"Registry URL: %s\", registryURL)\n\n\tserver
      := &http.Server{\n\t\tAddr:         \":\" + port,\n\t\tReadTimeout:  30 * time.Second,\n\t\tWriteTimeout:
      30 * time.Second,\n\t}\n\n\tif err := server.ListenAndServe(); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\nconst
      templateHTML = `\n{{define \"index\"}}\n<!DOCTYPE html>\n<html>\n<head>\n    <meta
      charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,
      initial-scale=1.0\">\n    <title>Registry UI</title>\n    <style>\n        *
      { box-sizing: border-box; margin: 0; padding: 0; }\n        body {\n            font-family:
      -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background:
      #0a0a0a;\n            color: #e0e0e0;\n            min-height: 100vh;\n        }\n
      \       .container { max-width: 1200px; margin: 0 auto; padding: 20px; }\n        h1
      {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom:
      8px;\n            color: #fff;\n        }\n        .subtitle {\n            color:
      #888;\n            font-size: 14px;\n            margin-bottom: 24px;\n        }\n
      \       .repo-list {\n            display: grid;\n            gap: 12px;\n        }\n
      \       .repo-card {\n            background: #161616;\n            border:
      1px solid #2a2a2a;\n            border-radius: 8px;\n            padding: 16px
      20px;\n            display: flex;\n            justify-content: space-between;\n
      \           align-items: center;\n            transition: all 0.2s;\n        }\n
      \       .repo-card:hover {\n            border-color: #3a3a3a;\n            background:
      #1a1a1a;\n        }\n        .repo-name {\n            font-weight: 500;\n            color:
      #fff;\n        }\n        .repo-link {\n            color: #58a6ff;\n            text-decoration:
      none;\n            font-size: 14px;\n        }\n        .repo-link:hover { text-decoration:
      underline; }\n        .empty {\n            text-align: center;\n            padding:
      60px 20px;\n            color: #666;\n        }\n        .empty-icon { font-size:
      48px; margin-bottom: 16px; }\n        .stats {\n            background: #161616;\n
      \           border: 1px solid #2a2a2a;\n            border-radius: 8px;\n            padding:
      16px 20px;\n            margin-bottom: 24px;\n            display: flex;\n            gap:
      32px;\n        }\n        .stat-item { }\n        .stat-value { font-size: 24px;
      font-weight: 600; color: #fff; }\n        .stat-label { font-size: 12px; color:
      #888; text-transform: uppercase; }\n    </style>\n</head>\n<body>\n    <div
      class=\"container\">\n        <h1>Container Registry</h1>\n        <p class=\"subtitle\">{{.RegistryURL}}</p>\n\n
      \       <div class=\"stats\">\n            <div class=\"stat-item\">\n                <div
      class=\"stat-value\">{{len .Repositories}}</div>\n                <div class=\"stat-label\">Repositories</div>\n
      \           </div>\n        </div>\n\n        {{if .Repositories}}\n        <div
      class=\"repo-list\">\n            {{range .Repositories}}\n            <div
      class=\"repo-card\">\n                <span class=\"repo-name\">{{.}}</span>\n
      \               <a href=\"/repo/{{.}}\" class=\"repo-link\">View Tags</a>\n
      \           </div>\n            {{end}}\n        </div>\n        {{else}}\n
      \       <div class=\"empty\">\n            <div class=\"empty-icon\">\U0001F4E6</div>\n
      \           <p>No images in registry</p>\n            <p style=\"margin-top:
      8px; font-size: 14px;\">Push an image to get started</p>\n        </div>\n        {{end}}\n
      \   </div>\n</body>\n</html>\n{{end}}\n\n{{define \"repo\"}}\n<!DOCTYPE html>\n<html>\n<head>\n
      \   <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,
      initial-scale=1.0\">\n    <title>{{.Repo}} - Registry UI</title>\n    <style>\n
      \       * { box-sizing: border-box; margin: 0; padding: 0; }\n        body {\n
      \           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
      sans-serif;\n            background: #0a0a0a;\n            color: #e0e0e0;\n
      \           min-height: 100vh;\n        }\n        .container { max-width: 1200px;
      margin: 0 auto; padding: 20px; }\n        .breadcrumb {\n            margin-bottom:
      16px;\n        }\n        .breadcrumb a {\n            color: #58a6ff;\n            text-decoration:
      none;\n        }\n        .breadcrumb a:hover { text-decoration: underline;
      }\n        h1 {\n            font-size: 24px;\n            font-weight: 600;\n
      \           margin-bottom: 24px;\n            color: #fff;\n        }\n        table
      {\n            width: 100%;\n            border-collapse: collapse;\n            background:
      #161616;\n            border: 1px solid #2a2a2a;\n            border-radius:
      8px;\n            overflow: hidden;\n        }\n        th, td {\n            padding:
      12px 16px;\n            text-align: left;\n            border-bottom: 1px solid
      #2a2a2a;\n        }\n        th {\n            background: #1a1a1a;\n            font-weight:
      500;\n            font-size: 12px;\n            text-transform: uppercase;\n
      \           color: #888;\n        }\n        tr:last-child td { border-bottom:
      none; }\n        tr:hover td { background: #1a1a1a; }\n        .tag { font-family:
      monospace; color: #58a6ff; }\n        .digest {\n            font-family: monospace;\n
      \           font-size: 12px;\n            color: #666;\n            max-width:
      200px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n
      \       }\n        .size { color: #888; }\n        .delete-btn {\n            background:
      #d73a49;\n            color: white;\n            border: none;\n            padding:
      6px 12px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size:
      12px;\n        }\n        .delete-btn:hover { background: #cb2431; }\n        .empty
      {\n            text-align: center;\n            padding: 40px;\n            color:
      #666;\n        }\n        .pull-cmd {\n            background: #1a1a1a;\n            border:
      1px solid #2a2a2a;\n            border-radius: 4px;\n            padding: 8px
      12px;\n            font-family: monospace;\n            font-size: 12px;\n            color:
      #888;\n            margin-bottom: 24px;\n        }\n        .modal {\n            display:
      none;\n            position: fixed;\n            top: 0;\n            left:
      0;\n            width: 100%;\n            height: 100%;\n            background:
      rgba(0,0,0,0.8);\n            z-index: 1000;\n            align-items: center;\n
      \           justify-content: center;\n        }\n        .modal.active { display:
      flex; }\n        .modal-content {\n            background: #161616;\n            border:
      1px solid #2a2a2a;\n            border-radius: 8px;\n            padding: 24px;\n
      \           max-width: 400px;\n            width: 90%;\n        }\n        .modal
      h2 { font-size: 18px; margin-bottom: 16px; }\n        .modal p { color: #888;
      margin-bottom: 20px; font-size: 14px; }\n        .modal-btns { display: flex;
      gap: 12px; justify-content: flex-end; }\n        .btn-cancel {\n            background:
      #2a2a2a;\n            color: #e0e0e0;\n            border: none;\n            padding:
      8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n        }\n
      \       .btn-confirm {\n            background: #d73a49;\n            color:
      white;\n            border: none;\n            padding: 8px 16px;\n            border-radius:
      4px;\n            cursor: pointer;\n        }\n    </style>\n</head>\n<body>\n
      \   <div class=\"container\">\n        <div class=\"breadcrumb\">\n            <a
      href=\"/\">Registry</a> / {{.Repo}}\n        </div>\n        <h1>{{.Repo}}</h1>\n\n
      \       {{if .TagDetails}}\n        <table>\n            <thead>\n                <tr>\n
      \                   <th>Tag</th>\n                    <th>Digest</th>\n                    <th>Size</th>\n
      \                   <th>Layers</th>\n                    <th>Actions</th>\n
      \               </tr>\n            </thead>\n            <tbody>\n                {{range
      .TagDetails}}\n                <tr>\n                    <td><span class=\"tag\">{{.Tag}}</span></td>\n
      \                   <td><span class=\"digest\" title=\"{{.Digest}}\">{{.Digest}}</span></td>\n
      \                   <td class=\"size\">{{.SizeHuman}}</td>\n                    <td>{{.Layers}}</td>\n
      \                   <td>\n                        {{if .Digest}}\n                        <button
      class=\"delete-btn\" onclick=\"confirmDelete('{{$.Repo}}', '{{.Digest}}', '{{.Tag}}')\">Delete</button>\n
      \                       {{end}}\n                    </td>\n                </tr>\n
      \               {{end}}\n            </tbody>\n        </table>\n        {{else}}\n
      \       <div class=\"empty\">No tags found for this repository</div>\n        {{end}}\n
      \   </div>\n\n    <div class=\"modal\" id=\"deleteModal\">\n        <div class=\"modal-content\">\n
      \           <h2>Delete Image Tag</h2>\n            <p>Are you sure you want
      to delete <strong id=\"deleteTag\"></strong>? This action cannot be undone.</p>\n
      \           <form id=\"deleteForm\" method=\"POST\" action=\"/delete\">\n                <input
      type=\"hidden\" name=\"repo\" id=\"deleteRepo\">\n                <input type=\"hidden\"
      name=\"digest\" id=\"deleteDigest\">\n                <div class=\"modal-btns\">\n
      \                   <button type=\"button\" class=\"btn-cancel\" onclick=\"closeModal()\">Cancel</button>\n
      \                   <button type=\"submit\" class=\"btn-confirm\">Delete</button>\n
      \               </div>\n            </form>\n        </div>\n    </div>\n\n
      \   <script>\n        function confirmDelete(repo, digest, tag) {\n            document.getElementById('deleteRepo').value
      = repo;\n            document.getElementById('deleteDigest').value = digest;\n
      \           document.getElementById('deleteTag').textContent = tag;\n            document.getElementById('deleteModal').classList.add('active');\n
      \       }\n        function closeModal() {\n            document.getElementById('deleteModal').classList.remove('active');\n
      \       }\n        document.getElementById('deleteModal').addEventListener('click',
      function(e) {\n            if (e.target === this) closeModal();\n        });\n
      \   </script>\n</body>\n</html>\n{{end}}\n`\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: "{\"apiVersion\":\"v1\",\"data\":{\"Dockerfile\":\"FROM
        golang:1.21-alpine AS builder\\n\\nWORKDIR /app\\n\\nCOPY go.mod ./\\nCOPY
        *.go ./\\n\\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags=\\\"-s
        -w\\\" -o registry-ui .\\n\\nFROM alpine:3.19\\n\\nRUN apk --no-cache add
        ca-certificates\\n\\nWORKDIR /app\\n\\nCOPY --from=builder /app/registry-ui
        .\\n\\nEXPOSE 8080\\n\\nCMD [\\\"./registry-ui\\\"]\\n\",\"go.mod\":\"module
        registry-ui\\n\\ngo 1.21\\n\",\"main.go\":\"package main\\n\\nimport (\\n\\t\\\"encoding/json\\\"\\n\\t\\\"fmt\\\"\\n\\t\\\"html/template\\\"\\n\\t\\\"io\\\"\\n\\t\\\"log\\\"\\n\\t\\\"net/http\\\"\\n\\t\\\"os\\\"\\n\\t\\\"sort\\\"\\n\\t\\\"strings\\\"\\n\\t\\\"time\\\"\\n)\\n\\nvar
        registryURL string\\nvar templates *template.Template\\n\\ntype Repository
        struct {\\n\\tName       string   `json:\\\"name\\\"`\\n\\tTags       []string
        `json:\\\"tags\\\"`\\n\\tTagDetails []TagDetail\\n}\\n\\ntype TagDetail struct
        {\\n\\tTag        string\\n\\tDigest     string\\n\\tSize       int64\\n\\tCreated
        \   string\\n\\tLayers     int\\n\\tSizeHuman  string\\n}\\n\\ntype CatalogResponse
        struct {\\n\\tRepositories []string `json:\\\"repositories\\\"`\\n}\\n\\ntype
        TagsResponse struct {\\n\\tName string   `json:\\\"name\\\"`\\n\\tTags []string
        `json:\\\"tags\\\"`\\n}\\n\\ntype ManifestResponse struct {\\n\\tSchemaVersion
        int    `json:\\\"schemaVersion\\\"`\\n\\tMediaType     string `json:\\\"mediaType\\\"`\\n\\tConfig
        \       struct {\\n\\t\\tMediaType string `json:\\\"mediaType\\\"`\\n\\t\\tSize
        \     int64  `json:\\\"size\\\"`\\n\\t\\tDigest    string `json:\\\"digest\\\"`\\n\\t}
        `json:\\\"config\\\"`\\n\\tLayers []struct {\\n\\t\\tMediaType string `json:\\\"mediaType\\\"`\\n\\t\\tSize
        \     int64  `json:\\\"size\\\"`\\n\\t\\tDigest    string `json:\\\"digest\\\"`\\n\\t}
        `json:\\\"layers\\\"`\\n}\\n\\nfunc humanSize(bytes int64) string {\\n\\tconst
        unit = 1024\\n\\tif bytes \\u003c unit {\\n\\t\\treturn fmt.Sprintf(\\\"%d
        B\\\", bytes)\\n\\t}\\n\\tdiv, exp := int64(unit), 0\\n\\tfor n := bytes /
        unit; n \\u003e= unit; n /= unit {\\n\\t\\tdiv *= unit\\n\\t\\texp++\\n\\t}\\n\\treturn
        fmt.Sprintf(\\\"%.1f %cB\\\", float64(bytes)/float64(div), \\\"KMGTPE\\\"[exp])\\n}\\n\\nfunc
        getRepositories() ([]string, error) {\\n\\tresp, err := http.Get(registryURL
        + \\\"/v2/_catalog\\\")\\n\\tif err != nil {\\n\\t\\treturn nil, fmt.Errorf(\\\"failed
        to connect to registry: %v\\\", err)\\n\\t}\\n\\tdefer resp.Body.Close()\\n\\n\\tif
        resp.StatusCode != http.StatusOK {\\n\\t\\treturn nil, fmt.Errorf(\\\"registry
        returned status %d\\\", resp.StatusCode)\\n\\t}\\n\\n\\tvar catalog CatalogResponse\\n\\tif
        err := json.NewDecoder(resp.Body).Decode(\\u0026catalog); err != nil {\\n\\t\\treturn
        nil, fmt.Errorf(\\\"failed to decode response: %v\\\", err)\\n\\t}\\n\\n\\tsort.Strings(catalog.Repositories)\\n\\treturn
        catalog.Repositories, nil\\n}\\n\\nfunc getTags(repo string) ([]string, error)
        {\\n\\tresp, err := http.Get(fmt.Sprintf(\\\"%s/v2/%s/tags/list\\\", registryURL,
        repo))\\n\\tif err != nil {\\n\\t\\treturn nil, err\\n\\t}\\n\\tdefer resp.Body.Close()\\n\\n\\tif
        resp.StatusCode != http.StatusOK {\\n\\t\\treturn nil, fmt.Errorf(\\\"registry
        returned status %d\\\", resp.StatusCode)\\n\\t}\\n\\n\\tvar tags TagsResponse\\n\\tif
        err := json.NewDecoder(resp.Body).Decode(\\u0026tags); err != nil {\\n\\t\\treturn
        nil, err\\n\\t}\\n\\n\\treturn tags.Tags, nil\\n}\\n\\nfunc getManifest(repo,
        tag string) (*ManifestResponse, string, error) {\\n\\t// Try OCI manifest
        first (buildah/podman), then Docker v2\\n\\tacceptHeaders := []string{\\n\\t\\t\\\"application/vnd.oci.image.manifest.v1+json\\\",\\n\\t\\t\\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\\t}\\n\\n\\tclient
        := \\u0026http.Client{Timeout: 10 * time.Second}\\n\\n\\tfor _, accept :=
        range acceptHeaders {\\n\\t\\treq, err := http.NewRequest(\\\"GET\\\", fmt.Sprintf(\\\"%s/v2/%s/manifests/%s\\\",
        registryURL, repo, tag), nil)\\n\\t\\tif err != nil {\\n\\t\\t\\treturn nil,
        \\\"\\\", err\\n\\t\\t}\\n\\t\\treq.Header.Set(\\\"Accept\\\", accept)\\n\\n\\t\\tresp,
        err := client.Do(req)\\n\\t\\tif err != nil {\\n\\t\\t\\tcontinue\\n\\t\\t}\\n\\t\\tdefer
        resp.Body.Close()\\n\\n\\t\\tif resp.StatusCode != http.StatusOK {\\n\\t\\t\\tcontinue\\n\\t\\t}\\n\\n\\t\\tdigest
        := resp.Header.Get(\\\"Docker-Content-Digest\\\")\\n\\n\\t\\tvar manifest
        ManifestResponse\\n\\t\\tif err := json.NewDecoder(resp.Body).Decode(\\u0026manifest);
        err != nil {\\n\\t\\t\\treturn nil, digest, err\\n\\t\\t}\\n\\n\\t\\treturn
        \\u0026manifest, digest, nil\\n\\t}\\n\\n\\treturn nil, \\\"\\\", fmt.Errorf(\\\"no
        supported manifest format found\\\")\\n}\\n\\nfunc deleteManifest(repo, digest
        string) error {\\n\\treq, err := http.NewRequest(\\\"DELETE\\\", fmt.Sprintf(\\\"%s/v2/%s/manifests/%s\\\",
        registryURL, repo, digest), nil)\\n\\tif err != nil {\\n\\t\\treturn err\\n\\t}\\n\\n\\tclient
        := \\u0026http.Client{}\\n\\tresp, err := client.Do(req)\\n\\tif err != nil
        {\\n\\t\\treturn err\\n\\t}\\n\\tdefer resp.Body.Close()\\n\\n\\tif resp.StatusCode
        != http.StatusAccepted \\u0026\\u0026 resp.StatusCode != http.StatusOK {\\n\\t\\tbody,
        _ := io.ReadAll(resp.Body)\\n\\t\\treturn fmt.Errorf(\\\"delete returned status
        %d: %s\\\", resp.StatusCode, string(body))\\n\\t}\\n\\n\\treturn nil\\n}\\n\\nfunc
        healthHandler(w http.ResponseWriter, r *http.Request) {\\n\\tw.Header().Set(\\\"Content-Type\\\",
        \\\"application/json\\\")\\n\\tw.WriteHeader(http.StatusOK)\\n\\tjson.NewEncoder(w).Encode(map[string]string{\\\"status\\\":
        \\\"healthy\\\"})\\n}\\n\\nfunc indexHandler(w http.ResponseWriter, r *http.Request)
        {\\n\\trepos, err := getRepositories()\\n\\tif err != nil {\\n\\t\\tlog.Printf(\\\"Error
        getting repositories: %v\\\", err)\\n\\t\\thttp.Error(w, \\\"Failed to fetch
        repositories: \\\"+err.Error(), http.StatusInternalServerError)\\n\\t\\treturn\\n\\t}\\n\\n\\tdata
        := struct {\\n\\t\\tRegistryURL  string\\n\\t\\tRepositories []string\\n\\t\\tError
        \       string\\n\\t}{\\n\\t\\tRegistryURL:  registryURL,\\n\\t\\tRepositories:
        repos,\\n\\t}\\n\\n\\tif err := templates.ExecuteTemplate(w, \\\"index\\\",
        data); err != nil {\\n\\t\\tlog.Printf(\\\"Template error: %v\\\", err)\\n\\t\\thttp.Error(w,
        err.Error(), http.StatusInternalServerError)\\n\\t}\\n}\\n\\nfunc repoHandler(w
        http.ResponseWriter, r *http.Request) {\\n\\trepo := strings.TrimPrefix(r.URL.Path,
        \\\"/repo/\\\")\\n\\tif repo == \\\"\\\" {\\n\\t\\thttp.Redirect(w, r, \\\"/\\\",
        http.StatusFound)\\n\\t\\treturn\\n\\t}\\n\\n\\ttags, err := getTags(repo)\\n\\tif
        err != nil {\\n\\t\\thttp.Error(w, \\\"Failed to fetch tags: \\\"+err.Error(),
        http.StatusInternalServerError)\\n\\t\\treturn\\n\\t}\\n\\n\\tvar tagDetails
        []TagDetail\\n\\tfor _, tag := range tags {\\n\\t\\tmanifest, digest, err
        := getManifest(repo, tag)\\n\\t\\ttd := TagDetail{Tag: tag}\\n\\t\\tif err
        == nil \\u0026\\u0026 manifest != nil {\\n\\t\\t\\tvar totalSize int64\\n\\t\\t\\tfor
        _, layer := range manifest.Layers {\\n\\t\\t\\t\\ttotalSize += layer.Size\\n\\t\\t\\t}\\n\\t\\t\\ttd.Digest
        = digest\\n\\t\\t\\ttd.Size = totalSize\\n\\t\\t\\ttd.SizeHuman = humanSize(totalSize)\\n\\t\\t\\ttd.Layers
        = len(manifest.Layers)\\n\\t\\t}\\n\\t\\ttagDetails = append(tagDetails, td)\\n\\t}\\n\\n\\tdata
        := struct {\\n\\t\\tRepo       string\\n\\t\\tTagDetails []TagDetail\\n\\t}{\\n\\t\\tRepo:
        \      repo,\\n\\t\\tTagDetails: tagDetails,\\n\\t}\\n\\n\\tif err := templates.ExecuteTemplate(w,
        \\\"repo\\\", data); err != nil {\\n\\t\\tlog.Printf(\\\"Template error: %v\\\",
        err)\\n\\t\\thttp.Error(w, err.Error(), http.StatusInternalServerError)\\n\\t}\\n}\\n\\nfunc
        deleteHandler(w http.ResponseWriter, r *http.Request) {\\n\\tif r.Method !=
        http.MethodPost {\\n\\t\\thttp.Error(w, \\\"Method not allowed\\\", http.StatusMethodNotAllowed)\\n\\t\\treturn\\n\\t}\\n\\n\\trepo
        := r.FormValue(\\\"repo\\\")\\n\\tdigest := r.FormValue(\\\"digest\\\")\\n\\n\\tif
        repo == \\\"\\\" || digest == \\\"\\\" {\\n\\t\\thttp.Error(w, \\\"Missing
        repo or digest\\\", http.StatusBadRequest)\\n\\t\\treturn\\n\\t}\\n\\n\\tif
        err := deleteManifest(repo, digest); err != nil {\\n\\t\\tlog.Printf(\\\"Delete
        error: %v\\\", err)\\n\\t\\thttp.Error(w, \\\"Failed to delete: \\\"+err.Error(),
        http.StatusInternalServerError)\\n\\t\\treturn\\n\\t}\\n\\n\\tlog.Printf(\\\"Deleted
        %s@%s\\\", repo, digest)\\n\\thttp.Redirect(w, r, \\\"/repo/\\\"+repo, http.StatusFound)\\n}\\n\\nfunc
        apiReposHandler(w http.ResponseWriter, r *http.Request) {\\n\\trepos, err
        := getRepositories()\\n\\tif err != nil {\\n\\t\\tw.WriteHeader(http.StatusInternalServerError)\\n\\t\\tjson.NewEncoder(w).Encode(map[string]string{\\\"error\\\":
        err.Error()})\\n\\t\\treturn\\n\\t}\\n\\tw.Header().Set(\\\"Content-Type\\\",
        \\\"application/json\\\")\\n\\tjson.NewEncoder(w).Encode(map[string]interface{}{\\\"repositories\\\":
        repos})\\n}\\n\\nfunc apiTagsHandler(w http.ResponseWriter, r *http.Request)
        {\\n\\trepo := strings.TrimPrefix(r.URL.Path, \\\"/api/tags/\\\")\\n\\ttags,
        err := getTags(repo)\\n\\tif err != nil {\\n\\t\\tw.WriteHeader(http.StatusInternalServerError)\\n\\t\\tjson.NewEncoder(w).Encode(map[string]string{\\\"error\\\":
        err.Error()})\\n\\t\\treturn\\n\\t}\\n\\tw.Header().Set(\\\"Content-Type\\\",
        \\\"application/json\\\")\\n\\tjson.NewEncoder(w).Encode(map[string]interface{}{\\\"repo\\\":
        repo, \\\"tags\\\": tags})\\n}\\n\\nfunc main() {\\n\\tport := os.Getenv(\\\"PORT\\\")\\n\\tif
        port == \\\"\\\" {\\n\\t\\tport = \\\"8080\\\"\\n\\t}\\n\\n\\tregistryURL
        = os.Getenv(\\\"REGISTRY_URL\\\")\\n\\tif registryURL == \\\"\\\" {\\n\\t\\tregistryURL
        = \\\"http://registry.holm.svc.cluster.local:5000\\\"\\n\\t}\\n\\tregistryURL
        = strings.TrimSuffix(registryURL, \\\"/\\\")\\n\\n\\t// Parse templates\\n\\tvar
        err error\\n\\ttemplates, err = template.New(\\\"\\\").Parse(templateHTML)\\n\\tif
        err != nil {\\n\\t\\tlog.Fatalf(\\\"Failed to parse templates: %v\\\", err)\\n\\t}\\n\\n\\t//
        Routes\\n\\thttp.HandleFunc(\\\"/health\\\", healthHandler)\\n\\thttp.HandleFunc(\\\"/\\\",
        indexHandler)\\n\\thttp.HandleFunc(\\\"/repo/\\\", repoHandler)\\n\\thttp.HandleFunc(\\\"/delete\\\",
        deleteHandler)\\n\\thttp.HandleFunc(\\\"/api/repos\\\", apiReposHandler)\\n\\thttp.HandleFunc(\\\"/api/tags/\\\",
        apiTagsHandler)\\n\\n\\tlog.Printf(\\\"Registry UI starting on port %s\\\",
        port)\\n\\tlog.Printf(\\\"Registry URL: %s\\\", registryURL)\\n\\n\\tserver
        := \\u0026http.Server{\\n\\t\\tAddr:         \\\":\\\" + port,\\n\\t\\tReadTimeout:
        \ 30 * time.Second,\\n\\t\\tWriteTimeout: 30 * time.Second,\\n\\t}\\n\\n\\tif
        err := server.ListenAndServe(); err != nil {\\n\\t\\tlog.Fatal(err)\\n\\t}\\n}\\n\\nconst
        templateHTML = `\\n{{define \\\"index\\\"}}\\n\\u003c!DOCTYPE html\\u003e\\n\\u003chtml\\u003e\\n\\u003chead\\u003e\\n
        \   \\u003cmeta charset=\\\"UTF-8\\\"\\u003e\\n    \\u003cmeta name=\\\"viewport\\\"
        content=\\\"width=device-width, initial-scale=1.0\\\"\\u003e\\n    \\u003ctitle\\u003eRegistry
        UI\\u003c/title\\u003e\\n    \\u003cstyle\\u003e\\n        * { box-sizing:
        border-box; margin: 0; padding: 0; }\\n        body {\\n            font-family:
        -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\\n            background:
        #0a0a0a;\\n            color: #e0e0e0;\\n            min-height: 100vh;\\n
        \       }\\n        .container { max-width: 1200px; margin: 0 auto; padding:
        20px; }\\n        h1 {\\n            font-size: 24px;\\n            font-weight:
        600;\\n            margin-bottom: 8px;\\n            color: #fff;\\n        }\\n
        \       .subtitle {\\n            color: #888;\\n            font-size: 14px;\\n
        \           margin-bottom: 24px;\\n        }\\n        .repo-list {\\n            display:
        grid;\\n            gap: 12px;\\n        }\\n        .repo-card {\\n            background:
        #161616;\\n            border: 1px solid #2a2a2a;\\n            border-radius:
        8px;\\n            padding: 16px 20px;\\n            display: flex;\\n            justify-content:
        space-between;\\n            align-items: center;\\n            transition:
        all 0.2s;\\n        }\\n        .repo-card:hover {\\n            border-color:
        #3a3a3a;\\n            background: #1a1a1a;\\n        }\\n        .repo-name
        {\\n            font-weight: 500;\\n            color: #fff;\\n        }\\n
        \       .repo-link {\\n            color: #58a6ff;\\n            text-decoration:
        none;\\n            font-size: 14px;\\n        }\\n        .repo-link:hover
        { text-decoration: underline; }\\n        .empty {\\n            text-align:
        center;\\n            padding: 60px 20px;\\n            color: #666;\\n        }\\n
        \       .empty-icon { font-size: 48px; margin-bottom: 16px; }\\n        .stats
        {\\n            background: #161616;\\n            border: 1px solid #2a2a2a;\\n
        \           border-radius: 8px;\\n            padding: 16px 20px;\\n            margin-bottom:
        24px;\\n            display: flex;\\n            gap: 32px;\\n        }\\n
        \       .stat-item { }\\n        .stat-value { font-size: 24px; font-weight:
        600; color: #fff; }\\n        .stat-label { font-size: 12px; color: #888;
        text-transform: uppercase; }\\n    \\u003c/style\\u003e\\n\\u003c/head\\u003e\\n\\u003cbody\\u003e\\n
        \   \\u003cdiv class=\\\"container\\\"\\u003e\\n        \\u003ch1\\u003eContainer
        Registry\\u003c/h1\\u003e\\n        \\u003cp class=\\\"subtitle\\\"\\u003e{{.RegistryURL}}\\u003c/p\\u003e\\n\\n
        \       \\u003cdiv class=\\\"stats\\\"\\u003e\\n            \\u003cdiv class=\\\"stat-item\\\"\\u003e\\n
        \               \\u003cdiv class=\\\"stat-value\\\"\\u003e{{len .Repositories}}\\u003c/div\\u003e\\n
        \               \\u003cdiv class=\\\"stat-label\\\"\\u003eRepositories\\u003c/div\\u003e\\n
        \           \\u003c/div\\u003e\\n        \\u003c/div\\u003e\\n\\n        {{if
        .Repositories}}\\n        \\u003cdiv class=\\\"repo-list\\\"\\u003e\\n            {{range
        .Repositories}}\\n            \\u003cdiv class=\\\"repo-card\\\"\\u003e\\n
        \               \\u003cspan class=\\\"repo-name\\\"\\u003e{{.}}\\u003c/span\\u003e\\n
        \               \\u003ca href=\\\"/repo/{{.}}\\\" class=\\\"repo-link\\\"\\u003eView
        Tags\\u003c/a\\u003e\\n            \\u003c/div\\u003e\\n            {{end}}\\n
        \       \\u003c/div\\u003e\\n        {{else}}\\n        \\u003cdiv class=\\\"empty\\\"\\u003e\\n
        \           \\u003cdiv class=\\\"empty-icon\\\"\\u003e\U0001F4E6\\u003c/div\\u003e\\n
        \           \\u003cp\\u003eNo images in registry\\u003c/p\\u003e\\n            \\u003cp
        style=\\\"margin-top: 8px; font-size: 14px;\\\"\\u003ePush an image to get
        started\\u003c/p\\u003e\\n        \\u003c/div\\u003e\\n        {{end}}\\n
        \   \\u003c/div\\u003e\\n\\u003c/body\\u003e\\n\\u003c/html\\u003e\\n{{end}}\\n\\n{{define
        \\\"repo\\\"}}\\n\\u003c!DOCTYPE html\\u003e\\n\\u003chtml\\u003e\\n\\u003chead\\u003e\\n
        \   \\u003cmeta charset=\\\"UTF-8\\\"\\u003e\\n    \\u003cmeta name=\\\"viewport\\\"
        content=\\\"width=device-width, initial-scale=1.0\\\"\\u003e\\n    \\u003ctitle\\u003e{{.Repo}}
        - Registry UI\\u003c/title\\u003e\\n    \\u003cstyle\\u003e\\n        * {
        box-sizing: border-box; margin: 0; padding: 0; }\\n        body {\\n            font-family:
        -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\\n            background:
        #0a0a0a;\\n            color: #e0e0e0;\\n            min-height: 100vh;\\n
        \       }\\n        .container { max-width: 1200px; margin: 0 auto; padding:
        20px; }\\n        .breadcrumb {\\n            margin-bottom: 16px;\\n        }\\n
        \       .breadcrumb a {\\n            color: #58a6ff;\\n            text-decoration:
        none;\\n        }\\n        .breadcrumb a:hover { text-decoration: underline;
        }\\n        h1 {\\n            font-size: 24px;\\n            font-weight:
        600;\\n            margin-bottom: 24px;\\n            color: #fff;\\n        }\\n
        \       table {\\n            width: 100%;\\n            border-collapse:
        collapse;\\n            background: #161616;\\n            border: 1px solid
        #2a2a2a;\\n            border-radius: 8px;\\n            overflow: hidden;\\n
        \       }\\n        th, td {\\n            padding: 12px 16px;\\n            text-align:
        left;\\n            border-bottom: 1px solid #2a2a2a;\\n        }\\n        th
        {\\n            background: #1a1a1a;\\n            font-weight: 500;\\n            font-size:
        12px;\\n            text-transform: uppercase;\\n            color: #888;\\n
        \       }\\n        tr:last-child td { border-bottom: none; }\\n        tr:hover
        td { background: #1a1a1a; }\\n        .tag { font-family: monospace; color:
        #58a6ff; }\\n        .digest {\\n            font-family: monospace;\\n            font-size:
        12px;\\n            color: #666;\\n            max-width: 200px;\\n            overflow:
        hidden;\\n            text-overflow: ellipsis;\\n        }\\n        .size
        { color: #888; }\\n        .delete-btn {\\n            background: #d73a49;\\n
        \           color: white;\\n            border: none;\\n            padding:
        6px 12px;\\n            border-radius: 4px;\\n            cursor: pointer;\\n
        \           font-size: 12px;\\n        }\\n        .delete-btn:hover { background:
        #cb2431; }\\n        .empty {\\n            text-align: center;\\n            padding:
        40px;\\n            color: #666;\\n        }\\n        .pull-cmd {\\n            background:
        #1a1a1a;\\n            border: 1px solid #2a2a2a;\\n            border-radius:
        4px;\\n            padding: 8px 12px;\\n            font-family: monospace;\\n
        \           font-size: 12px;\\n            color: #888;\\n            margin-bottom:
        24px;\\n        }\\n        .modal {\\n            display: none;\\n            position:
        fixed;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n
        \           height: 100%;\\n            background: rgba(0,0,0,0.8);\\n            z-index:
        1000;\\n            align-items: center;\\n            justify-content: center;\\n
        \       }\\n        .modal.active { display: flex; }\\n        .modal-content
        {\\n            background: #161616;\\n            border: 1px solid #2a2a2a;\\n
        \           border-radius: 8px;\\n            padding: 24px;\\n            max-width:
        400px;\\n            width: 90%;\\n        }\\n        .modal h2 { font-size:
        18px; margin-bottom: 16px; }\\n        .modal p { color: #888; margin-bottom:
        20px; font-size: 14px; }\\n        .modal-btns { display: flex; gap: 12px;
        justify-content: flex-end; }\\n        .btn-cancel {\\n            background:
        #2a2a2a;\\n            color: #e0e0e0;\\n            border: none;\\n            padding:
        8px 16px;\\n            border-radius: 4px;\\n            cursor: pointer;\\n
        \       }\\n        .btn-confirm {\\n            background: #d73a49;\\n            color:
        white;\\n            border: none;\\n            padding: 8px 16px;\\n            border-radius:
        4px;\\n            cursor: pointer;\\n        }\\n    \\u003c/style\\u003e\\n\\u003c/head\\u003e\\n\\u003cbody\\u003e\\n
        \   \\u003cdiv class=\\\"container\\\"\\u003e\\n        \\u003cdiv class=\\\"breadcrumb\\\"\\u003e\\n
        \           \\u003ca href=\\\"/\\\"\\u003eRegistry\\u003c/a\\u003e / {{.Repo}}\\n
        \       \\u003c/div\\u003e\\n        \\u003ch1\\u003e{{.Repo}}\\u003c/h1\\u003e\\n\\n
        \       {{if .TagDetails}}\\n        \\u003ctable\\u003e\\n            \\u003cthead\\u003e\\n
        \               \\u003ctr\\u003e\\n                    \\u003cth\\u003eTag\\u003c/th\\u003e\\n
        \                   \\u003cth\\u003eDigest\\u003c/th\\u003e\\n                    \\u003cth\\u003eSize\\u003c/th\\u003e\\n
        \                   \\u003cth\\u003eLayers\\u003c/th\\u003e\\n                    \\u003cth\\u003eActions\\u003c/th\\u003e\\n
        \               \\u003c/tr\\u003e\\n            \\u003c/thead\\u003e\\n            \\u003ctbody\\u003e\\n
        \               {{range .TagDetails}}\\n                \\u003ctr\\u003e\\n
        \                   \\u003ctd\\u003e\\u003cspan class=\\\"tag\\\"\\u003e{{.Tag}}\\u003c/span\\u003e\\u003c/td\\u003e\\n
        \                   \\u003ctd\\u003e\\u003cspan class=\\\"digest\\\" title=\\\"{{.Digest}}\\\"\\u003e{{.Digest}}\\u003c/span\\u003e\\u003c/td\\u003e\\n
        \                   \\u003ctd class=\\\"size\\\"\\u003e{{.SizeHuman}}\\u003c/td\\u003e\\n
        \                   \\u003ctd\\u003e{{.Layers}}\\u003c/td\\u003e\\n                    \\u003ctd\\u003e\\n
        \                       {{if .Digest}}\\n                        \\u003cbutton
        class=\\\"delete-btn\\\" onclick=\\\"confirmDelete('{{$.Repo}}', '{{.Digest}}',
        '{{.Tag}}')\\\"\\u003eDelete\\u003c/button\\u003e\\n                        {{end}}\\n
        \                   \\u003c/td\\u003e\\n                \\u003c/tr\\u003e\\n
        \               {{end}}\\n            \\u003c/tbody\\u003e\\n        \\u003c/table\\u003e\\n
        \       {{else}}\\n        \\u003cdiv class=\\\"empty\\\"\\u003eNo tags found
        for this repository\\u003c/div\\u003e\\n        {{end}}\\n    \\u003c/div\\u003e\\n\\n
        \   \\u003cdiv class=\\\"modal\\\" id=\\\"deleteModal\\\"\\u003e\\n        \\u003cdiv
        class=\\\"modal-content\\\"\\u003e\\n            \\u003ch2\\u003eDelete Image
        Tag\\u003c/h2\\u003e\\n            \\u003cp\\u003eAre you sure you want to
        delete \\u003cstrong id=\\\"deleteTag\\\"\\u003e\\u003c/strong\\u003e? This
        action cannot be undone.\\u003c/p\\u003e\\n            \\u003cform id=\\\"deleteForm\\\"
        method=\\\"POST\\\" action=\\\"/delete\\\"\\u003e\\n                \\u003cinput
        type=\\\"hidden\\\" name=\\\"repo\\\" id=\\\"deleteRepo\\\"\\u003e\\n                \\u003cinput
        type=\\\"hidden\\\" name=\\\"digest\\\" id=\\\"deleteDigest\\\"\\u003e\\n
        \               \\u003cdiv class=\\\"modal-btns\\\"\\u003e\\n                    \\u003cbutton
        type=\\\"button\\\" class=\\\"btn-cancel\\\" onclick=\\\"closeModal()\\\"\\u003eCancel\\u003c/button\\u003e\\n
        \                   \\u003cbutton type=\\\"submit\\\" class=\\\"btn-confirm\\\"\\u003eDelete\\u003c/button\\u003e\\n
        \               \\u003c/div\\u003e\\n            \\u003c/form\\u003e\\n        \\u003c/div\\u003e\\n
        \   \\u003c/div\\u003e\\n\\n    \\u003cscript\\u003e\\n        function confirmDelete(repo,
        digest, tag) {\\n            document.getElementById('deleteRepo').value =
        repo;\\n            document.getElementById('deleteDigest').value = digest;\\n
        \           document.getElementById('deleteTag').textContent = tag;\\n            document.getElementById('deleteModal').classList.add('active');\\n
        \       }\\n        function closeModal() {\\n            document.getElementById('deleteModal').classList.remove('active');\\n
        \       }\\n        document.getElementById('deleteModal').addEventListener('click',
        function(e) {\\n            if (e.target === this) closeModal();\\n        });\\n
        \   \\u003c/script\\u003e\\n\\u003c/body\\u003e\\n\\u003c/html\\u003e\\n{{end}}\\n`\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"name\":\"registry-ui-src\",\"namespace\":\"holm\"}}\n"
    creationTimestamp: "2026-01-18T03:06:58Z"
    name: registry-ui-src
    namespace: holm
    resourceVersion: "755"
    uid: e51e5d89-8ffe-4c6b-9ed2-274f4fc167f0
- apiVersion: v1
  data:
    audit_scope: full
    network_policies: enabled
    rbac_controls: enabled
    recommendations: |
      1. Update TLS to 1.2+ with AEAD cipher suites - DONE
      2. Network policies implemented for namespace isolation
      3. RBAC controls for holm-api service account
      4. Regular security scans recommended
    status: completed
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"audit_scope":"full","network_policies":"enabled","rbac_controls":"enabled","recommendations":"1. Update TLS to 1.2+ with AEAD cipher suites - DONE\n2. Network policies implemented for namespace isolation\n3. RBAC controls for holm-api service account\n4. Regular security scans recommended\n","status":"completed"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"security-audit-results","namespace":"holm"}}
    creationTimestamp: "2026-01-18T16:45:25Z"
    name: security-audit-results
    namespace: holm
    resourceVersion: "756"
    uid: 8343d058-0fce-48fc-8cc5-050cf213be87
- apiVersion: v1
  data:
    Dockerfile: |
      FROM public.ecr.aws/docker/library/golang:1.21-alpine AS builder

      WORKDIR /app

      # Install ca-certificates for HTTPS calls
      RUN apk add --no-cache ca-certificates

      # Copy source
      COPY main.go .

      # Build static binary
      RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags="-s -w" -o settings-web main.go

      # Final stage
      FROM public.ecr.aws/docker/library/alpine:3.19

      WORKDIR /app

      # Install kubectl for system info queries
      RUN apk add --no-cache ca-certificates curl && \
          curl -LO "https://dl.k8s.io/release/v1.29.0/bin/linux/arm64/kubectl" && \
          chmod +x kubectl && \
          mv kubectl /usr/local/bin/

      COPY --from=builder /app/settings-web .

      EXPOSE 8080

      CMD ["./settings-web"]
    main.go: "package main\n\nimport (\n\t\"bytes\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"os/exec\"\n\t\"runtime\"\n\t\"strings\"\n\t\"time\"\n)\n\n//
      Service endpoints\nconst (\n\tthemeService   = \"http://settings-theme.holm:8080\"\n\tbackupService
      \ = \"http://settings-backup.holm:8080\"\n\trestoreService = \"http://settings-restore.holm:8080\"\n\ttabsService
      \   = \"http://settings-tabs.holm:8080\"\n)\n\n// Version info\nconst (\n\tAppVersion
      \  = \"2.1.0\"\n\tBuildDate    = \"2026-01-15\"\n\tAppName      = \"HolmOS Settings
      Hub\"\n)\n\n// Data structures\ntype ThemePreferences struct {\n\tTheme       string
      `json:\"theme\"`\n\tCompactMode bool   `json:\"compactMode\"`\n\tAnimations
      \ bool   `json:\"animations\"`\n\tFontSize    int    `json:\"fontSize\"`\n\tAccentColor
      string `json:\"accentColor\"`\n}\n\ntype TabState struct {\n\tActiveTab string
      `json:\"activeTab\"`\n}\n\ntype NotificationSettings struct {\n\tEnabled       bool
      `json:\"enabled\"`\n\tSound         bool `json:\"sound\"`\n\tDesktop       bool
      `json:\"desktop\"`\n\tEmail         bool `json:\"email\"`\n\tBuildAlerts   bool
      `json:\"buildAlerts\"`\n\tClusterAlerts bool `json:\"clusterAlerts\"`\n}\n\ntype
      UserPreferences struct {\n\tLanguage     string `json:\"language\"`\n\tTimezone
      \    string `json:\"timezone\"`\n\tDateFormat   string `json:\"dateFormat\"`\n\tAutoSave
      \    bool   `json:\"autoSave\"`\n\tShowHidden   bool   `json:\"showHidden\"`\n\tDefaultView
      \ string `json:\"defaultView\"`\n}\n\ntype SystemInfo struct {\n\tNodes      []NodeInfo
      \   `json:\"nodes\"`\n\tPods       PodSummary    `json:\"pods\"`\n\tServices
      \  int           `json:\"services\"`\n\tNamespaces int           `json:\"namespaces\"`\n\tStorage
      \   []StorageInfo `json:\"storage\"`\n\tUptime     string        `json:\"uptime\"`\n}\n\ntype
      NodeInfo struct {\n\tName      string `json:\"name\"`\n\tStatus    string `json:\"status\"`\n\tRole
      \     string `json:\"role\"`\n\tCPU       string `json:\"cpu\"`\n\tMemory    string
      `json:\"memory\"`\n\tAge       string `json:\"age\"`\n\tArch      string `json:\"arch\"`\n}\n\ntype
      PodSummary struct {\n\tTotal     int `json:\"total\"`\n\tRunning   int `json:\"running\"`\n\tPending
      \  int `json:\"pending\"`\n\tFailed    int `json:\"failed\"`\n\tCompleted int
      `json:\"completed\"`\n}\n\ntype StorageInfo struct {\n\tName      string `json:\"name\"`\n\tSize
      \     string `json:\"size\"`\n\tUsed      string `json:\"used\"`\n\tAvailable
      string `json:\"available\"`\n\tPercent   string `json:\"percent\"`\n\tMount
      \    string `json:\"mount\"`\n}\n\ntype AboutInfo struct {\n\tAppName      string
      `json:\"appName\"`\n\tVersion      string `json:\"version\"`\n\tBuildDate    string
      `json:\"buildDate\"`\n\tGoVersion    string `json:\"goVersion\"`\n\tPlatform
      \    string `json:\"platform\"`\n\tArchitecture string `json:\"architecture\"`\n\tHostname
      \    string `json:\"hostname\"`\n\tServices     []ServiceStatus `json:\"services\"`\n}\n\ntype
      ServiceStatus struct {\n\tName   string `json:\"name\"`\n\tStatus string `json:\"status\"`\n\tPort
      \  string `json:\"port\"`\n}\n\nvar (\n\tnotificationSettings = NotificationSettings{\n\t\tEnabled:
      \      true,\n\t\tSound:         true,\n\t\tDesktop:       true,\n\t\tEmail:
      \        false,\n\t\tBuildAlerts:   true,\n\t\tClusterAlerts: true,\n\t}\n\tuserPreferences
      = UserPreferences{\n\t\tLanguage:    \"en\",\n\t\tTimezone:    \"America/Los_Angeles\",\n\t\tDateFormat:
      \ \"YYYY-MM-DD\",\n\t\tAutoSave:    true,\n\t\tShowHidden:  false,\n\t\tDefaultView:
      \"grid\",\n\t}\n)\n\nfunc main() {\n\thttp.HandleFunc(\"/\", serveUI)\n\thttp.HandleFunc(\"/health\",
      healthHandler)\n\t\n\t// Theme endpoints\n\thttp.HandleFunc(\"/api/theme/preferences\",
      themeHandler)\n\thttp.HandleFunc(\"/api/theme/apply\", themeApplyHandler)\n\t\n\t//
      Backup/Restore endpoints\n\thttp.HandleFunc(\"/api/backup/export\", backupExportHandler)\n\thttp.HandleFunc(\"/api/backup/list\",
      backupListHandler)\n\thttp.HandleFunc(\"/api/restore/import\", restoreImportHandler)\n\thttp.HandleFunc(\"/api/restore/validate\",
      restoreValidateHandler)\n\t\n\t// Tabs state endpoints\n\thttp.HandleFunc(\"/api/tabs/state\",
      tabsHandler)\n\t\n\t// System info endpoints\n\thttp.HandleFunc(\"/api/system/info\",
      systemInfoHandler)\n\thttp.HandleFunc(\"/api/system/nodes\", nodesHandler)\n\thttp.HandleFunc(\"/api/system/pods\",
      podsHandler)\n\thttp.HandleFunc(\"/api/system/storage\", storageHandler)\n\t\n\t//
      User preferences endpoints\n\thttp.HandleFunc(\"/api/user/preferences\", userPreferencesHandler)\n\t\n\t//
      Notification endpoints\n\thttp.HandleFunc(\"/api/notifications/settings\", notificationHandler)\n\t\n\t//
      About endpoint\n\thttp.HandleFunc(\"/api/about\", aboutHandler)\n\t\n\tport
      := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport = \"8080\"\n\t}\n\t\n\tlog.Printf(\"Settings
      Web (Central Hub) v%s starting on port %s\", AppVersion, port)\n\tlog.Fatal(http.ListenAndServe(\":\"+port,
      nil))\n}\n\nfunc healthHandler(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":
      \ \"healthy\",\n\t\t\"service\": \"settings-web\",\n\t\t\"version\": AppVersion,\n\t})\n}\n\nfunc
      aboutHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method
      == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\thostname, _ := os.Hostname()\n\t\n\t//
      Check service status\n\tservices := []ServiceStatus{\n\t\tcheckService(\"settings-theme\",
      themeService),\n\t\tcheckService(\"settings-backup\", backupService),\n\t\tcheckService(\"settings-restore\",
      restoreService),\n\t\tcheckService(\"settings-tabs\", tabsService),\n\t}\n\t\n\tabout
      := AboutInfo{\n\t\tAppName:      AppName,\n\t\tVersion:      AppVersion,\n\t\tBuildDate:
      \   BuildDate,\n\t\tGoVersion:    runtime.Version(),\n\t\tPlatform:     runtime.GOOS,\n\t\tArchitecture:
      runtime.GOARCH,\n\t\tHostname:     hostname,\n\t\tServices:     services,\n\t}\n\t\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(about)\n}\n\nfunc checkService(name,
      url string) ServiceStatus {\n\tstatus := \"offline\"\n\tclient := &http.Client{Timeout:
      2 * time.Second}\n\tresp, err := client.Get(url + \"/health\")\n\tif err ==
      nil {\n\t\tdefer resp.Body.Close()\n\t\tif resp.StatusCode == 200 {\n\t\t\tstatus
      = \"online\"\n\t\t}\n\t}\n\t\n\tport := \"8080\"\n\treturn ServiceStatus{Name:
      name, Status: status, Port: port}\n}\n\n// Theme handlers - proxy to settings-theme
      service\nfunc themeHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif
      r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method == \"GET\" {\n\t\tresp,
      err := http.Get(themeService + \"/preferences\")\n\t\tif err != nil {\n\t\t\t//
      Return defaults\n\t\t\tjson.NewEncoder(w).Encode(ThemePreferences{\n\t\t\t\tTheme:
      \      \"mocha\",\n\t\t\t\tCompactMode: false,\n\t\t\t\tAnimations:  true,\n\t\t\t\tFontSize:
      \   16,\n\t\t\t\tAccentColor: \"lavender\",\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\tdefer
      resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t\treturn\n\t}\n\t\n\tif r.Method
      == \"POST\" {\n\t\tbody, _ := io.ReadAll(r.Body)\n\t\tresp, err := http.Post(themeService+\"/preferences\",
      \"application/json\", bytes.NewReader(body))\n\t\tif err != nil {\n\t\t\thttp.Error(w,
      err.Error(), http.StatusInternalServerError)\n\t\t\treturn\n\t\t}\n\t\tdefer
      resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t}\n}\n\nfunc themeApplyHandler(w
      http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\"
      {\n\t\treturn\n\t}\n\t\n\tbody, _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(themeService+\"/apply\",
      \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"status\":
      \"ok\", \"applied\": true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w,
      resp.Body)\n}\n\n// Backup handlers - proxy to settings-backup service\nfunc
      backupExportHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif
      r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tresp, err := http.Get(backupService
      + \"/export\")\n\tif err != nil {\n\t\t// Return mock data on error\n\t\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\t\"version\":
      \    AppVersion,\n\t\t\t\"exportDate\":  time.Now().Format(time.RFC3339),\n\t\t\t\"theme\":
      \      \"mocha\",\n\t\t\t\"preferences\": userPreferences,\n\t\t\t\"notifications\":
      notificationSettings,\n\t\t})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tio.Copy(w, resp.Body)\n}\n\nfunc backupListHandler(w
      http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\"
      {\n\t\treturn\n\t}\n\t\n\tresp, err := http.Get(backupService + \"/list\")\n\tif
      err != nil {\n\t\t// Return empty list\n\t\tjson.NewEncoder(w).Encode([]map[string]string{})\n\t\treturn\n\t}\n\tdefer
      resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\n// Restore handlers - proxy
      to settings-restore service\nfunc restoreImportHandler(w http.ResponseWriter,
      r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif
      r.Method != \"POST\" {\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\t\n\tbody,
      _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(restoreService+\"/import\",
      \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\t// Return
      success on error for demo\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"status\":
      \"ok\", \"imported\": true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w,
      resp.Body)\n}\n\nfunc restoreValidateHandler(w http.ResponseWriter, r *http.Request)
      {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tbody,
      _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(restoreService+\"/validate\",
      \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"valid\":
      true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\n//
      Tabs handlers - proxy to settings-tabs service\nfunc tabsHandler(w http.ResponseWriter,
      r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif
      r.Method == \"GET\" {\n\t\tresp, err := http.Get(tabsService + \"/state\")\n\t\tif
      err != nil {\n\t\t\tjson.NewEncoder(w).Encode(TabState{ActiveTab: \"system\"})\n\t\t\treturn\n\t\t}\n\t\tdefer
      resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t\treturn\n\t}\n\t\n\tif r.Method
      == \"POST\" {\n\t\tbody, _ := io.ReadAll(r.Body)\n\t\tresp, err := http.Post(tabsService+\"/state\",
      \"application/json\", bytes.NewReader(body))\n\t\tif err != nil {\n\t\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"ok\"})\n\t\t\treturn\n\t\t}\n\t\tdefer resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t}\n}\n\n//
      System info handlers\nfunc systemInfoHandler(w http.ResponseWriter, r *http.Request)
      {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tinfo
      := getSystemInfo()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(info)\n}\n\nfunc
      nodesHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method
      == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tnodes := getNodeInfo()\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc podsHandler(w
      http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\"
      {\n\t\treturn\n\t}\n\t\n\tpods := getPodSummary()\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc storageHandler(w
      http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\"
      {\n\t\treturn\n\t}\n\t\n\tstorage := getStorageInfo()\n\tw.Header().Set(\"Content-Type\",
      \"application/json\")\n\tjson.NewEncoder(w).Encode(storage)\n}\n\n// User preferences
      handlers\nfunc userPreferencesHandler(w http.ResponseWriter, r *http.Request)
      {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method
      == \"GET\" {\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(userPreferences)\n\t\treturn\n\t}\n\t\n\tif
      r.Method == \"POST\" {\n\t\tvar prefs UserPreferences\n\t\tif err := json.NewDecoder(r.Body).Decode(&prefs);
      err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\t\tuserPreferences
      = prefs\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"ok\"})\n\t}\n}\n\n// Notification handlers\nfunc notificationHandler(w http.ResponseWriter,
      r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif
      r.Method == \"GET\" {\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(notificationSettings)\n\t\treturn\n\t}\n\t\n\tif
      r.Method == \"POST\" {\n\t\tvar settings NotificationSettings\n\t\tif err :=
      json.NewDecoder(r.Body).Decode(&settings); err != nil {\n\t\t\thttp.Error(w,
      err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\t\tnotificationSettings
      = settings\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\":
      \"ok\"})\n\t}\n}\n\nfunc setCORS(w http.ResponseWriter) {\n\tw.Header().Set(\"Access-Control-Allow-Origin\",
      \"*\")\n\tw.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\")\n\tw.Header().Set(\"Access-Control-Allow-Headers\",
      \"Content-Type\")\n}\n\nfunc getSystemInfo() SystemInfo {\n\tnodes := getNodeInfo()\n\tpods
      := getPodSummary()\n\tstorage := getStorageInfo()\n\t\n\tserviceCount := 0\n\tnsCount
      := 0\n\t\n\t// Get service count\n\tcmd := exec.Command(\"kubectl\", \"get\",
      \"svc\", \"--all-namespaces\", \"--no-headers\")\n\tif out, err := cmd.Output();
      err == nil {\n\t\tlines := strings.Split(strings.TrimSpace(string(out)), \"\\n\")\n\t\tif
      len(lines) > 0 && lines[0] != \"\" {\n\t\t\tserviceCount = len(lines)\n\t\t}\n\t}\n\t\n\t//
      Get namespace count\n\tcmd = exec.Command(\"kubectl\", \"get\", \"ns\", \"--no-headers\")\n\tif
      out, err := cmd.Output(); err == nil {\n\t\tlines := strings.Split(strings.TrimSpace(string(out)),
      \"\\n\")\n\t\tif len(lines) > 0 && lines[0] != \"\" {\n\t\t\tnsCount = len(lines)\n\t\t}\n\t}\n\t\n\treturn
      SystemInfo{\n\t\tNodes:      nodes,\n\t\tPods:       pods,\n\t\tServices:   serviceCount,\n\t\tNamespaces:
      nsCount,\n\t\tStorage:    storage,\n\t\tUptime:     getUptime(),\n\t}\n}\n\nfunc
      getNodeInfo() []NodeInfo {\n\tvar nodes []NodeInfo\n\t\n\tcmd := exec.Command(\"kubectl\",
      \"get\", \"nodes\", \"-o\", \"json\")\n\tout, err := cmd.Output()\n\tif err
      != nil {\n\t\treturn nodes\n\t}\n\t\n\tvar result struct {\n\t\tItems []struct
      {\n\t\t\tMetadata struct {\n\t\t\t\tName              string            `json:\"name\"`\n\t\t\t\tLabels
      \           map[string]string `json:\"labels\"`\n\t\t\t\tCreationTimestamp string
      \           `json:\"creationTimestamp\"`\n\t\t\t} `json:\"metadata\"`\n\t\t\tStatus
      struct {\n\t\t\t\tConditions []struct {\n\t\t\t\t\tType   string `json:\"type\"`\n\t\t\t\t\tStatus
      string `json:\"status\"`\n\t\t\t\t} `json:\"conditions\"`\n\t\t\t\tCapacity
      struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t}
      `json:\"capacity\"`\n\t\t\t} `json:\"status\"`\n\t\t} `json:\"items\"`\n\t}\n\t\n\tif
      err := json.Unmarshal(out, &result); err != nil {\n\t\treturn nodes\n\t}\n\t\n\tfor
      _, item := range result.Items {\n\t\tstatus := \"Unknown\"\n\t\tfor _, cond
      := range item.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" {\n\t\t\t\tif
      cond.Status == \"True\" {\n\t\t\t\t\tstatus = \"Ready\"\n\t\t\t\t} else {\n\t\t\t\t\tstatus
      = \"NotReady\"\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t\n\t\trole :=
      \"worker\"\n\t\tif _, ok := item.Metadata.Labels[\"node-role.kubernetes.io/control-plane\"];
      ok {\n\t\t\trole = \"control-plane\"\n\t\t}\n\t\t\n\t\tarch := item.Metadata.Labels[\"kubernetes.io/arch\"]\n\t\t\n\t\t//
      Calculate age\n\t\tage := \"unknown\"\n\t\tif t, err := time.Parse(time.RFC3339,
      item.Metadata.CreationTimestamp); err == nil {\n\t\t\tduration := time.Since(t)\n\t\t\tif
      duration.Hours() < 24 {\n\t\t\t\tage = fmt.Sprintf(\"%.0fh\", duration.Hours())\n\t\t\t}
      else {\n\t\t\t\tage = fmt.Sprintf(\"%.0fd\", duration.Hours()/24)\n\t\t\t}\n\t\t}\n\t\t\n\t\tnodes
      = append(nodes, NodeInfo{\n\t\t\tName:   item.Metadata.Name,\n\t\t\tStatus:
      status,\n\t\t\tRole:   role,\n\t\t\tCPU:    item.Status.Capacity.CPU,\n\t\t\tMemory:
      item.Status.Capacity.Memory,\n\t\t\tAge:    age,\n\t\t\tArch:   arch,\n\t\t})\n\t}\n\t\n\treturn
      nodes\n}\n\nfunc getPodSummary() PodSummary {\n\tsummary := PodSummary{}\n\t\n\tcmd
      := exec.Command(\"kubectl\", \"get\", \"pods\", \"--all-namespaces\", \"-o\",
      \"json\")\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\treturn summary\n\t}\n\t\n\tvar
      result struct {\n\t\tItems []struct {\n\t\t\tStatus struct {\n\t\t\t\tPhase
      string `json:\"phase\"`\n\t\t\t} `json:\"status\"`\n\t\t} `json:\"items\"`\n\t}\n\t\n\tif
      err := json.Unmarshal(out, &result); err != nil {\n\t\treturn summary\n\t}\n\t\n\tsummary.Total
      = len(result.Items)\n\tfor _, item := range result.Items {\n\t\tswitch item.Status.Phase
      {\n\t\tcase \"Running\":\n\t\t\tsummary.Running++\n\t\tcase \"Pending\":\n\t\t\tsummary.Pending++\n\t\tcase
      \"Failed\":\n\t\t\tsummary.Failed++\n\t\tcase \"Succeeded\":\n\t\t\tsummary.Completed++\n\t\t}\n\t}\n\t\n\treturn
      summary\n}\n\nfunc getStorageInfo() []StorageInfo {\n\tvar storage []StorageInfo\n\t\n\tcmd
      := exec.Command(\"df\", \"-h\")\n\tout, err := cmd.Output()\n\tif err != nil
      {\n\t\treturn storage\n\t}\n\t\n\tlines := strings.Split(string(out), \"\\n\")\n\tfor
      _, line := range lines[1:] {\n\t\tfields := strings.Fields(line)\n\t\tif len(fields)
      >= 6 {\n\t\t\t// Skip tmpfs and small filesystems\n\t\t\tif strings.HasPrefix(fields[0],
      \"tmpfs\") || strings.HasPrefix(fields[0], \"shm\") {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tstorage
      = append(storage, StorageInfo{\n\t\t\t\tName:      fields[0],\n\t\t\t\tSize:
      \     fields[1],\n\t\t\t\tUsed:      fields[2],\n\t\t\t\tAvailable: fields[3],\n\t\t\t\tPercent:
      \  fields[4],\n\t\t\t\tMount:     fields[5],\n\t\t\t})\n\t\t}\n\t}\n\t\n\treturn
      storage\n}\n\nfunc getUptime() string {\n\tcmd := exec.Command(\"uptime\", \"-p\")\n\tout,
      err := cmd.Output()\n\tif err != nil {\n\t\treturn \"unknown\"\n\t}\n\treturn
      strings.TrimSpace(string(out))\n}\n\nfunc serveUI(w http.ResponseWriter, r *http.Request)
      {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\",
      \"text/html; charset=utf-8\")\n\tfmt.Fprint(w, settingsHTML)\n}\n\nvar settingsHTML
      = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n
      \   <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0,
      maximum-scale=1.0, user-scalable=no\">\n    <title>Settings - HolmOS</title>\n
      \   <style>\n        /* Catppuccin Mocha (Default) */\n        :root {\n            --ctp-base:
      #1e1e2e;\n            --ctp-mantle: #181825;\n            --ctp-crust: #11111b;\n
      \           --ctp-surface0: #313244;\n            --ctp-surface1: #45475a;\n
      \           --ctp-surface2: #585b70;\n            --ctp-overlay0: #6c7086;\n
      \           --ctp-overlay1: #7f849c;\n            --ctp-text: #cdd6f4;\n            --ctp-subtext0:
      #a6adc8;\n            --ctp-subtext1: #bac2de;\n            --ctp-lavender:
      #b4befe;\n            --ctp-blue: #89b4fa;\n            --ctp-sapphire: #74c7ec;\n
      \           --ctp-sky: #89dceb;\n            --ctp-teal: #94e2d5;\n            --ctp-green:
      #a6e3a1;\n            --ctp-yellow: #f9e2af;\n            --ctp-peach: #fab387;\n
      \           --ctp-maroon: #eba0ac;\n            --ctp-red: #f38ba8;\n            --ctp-mauve:
      #cba6f7;\n            --ctp-pink: #f5c2e7;\n            --ctp-flamingo: #f2cdcd;\n
      \           --ctp-rosewater: #f5e0dc;\n        }\n\n        /* Catppuccin Latte
      (Light) */\n        .theme-latte {\n            --ctp-base: #eff1f5;\n            --ctp-mantle:
      #e6e9ef;\n            --ctp-crust: #dce0e8;\n            --ctp-surface0: #ccd0da;\n
      \           --ctp-surface1: #bcc0cc;\n            --ctp-surface2: #acb0be;\n
      \           --ctp-overlay0: #9ca0b0;\n            --ctp-overlay1: #8c8fa1;\n
      \           --ctp-text: #4c4f69;\n            --ctp-subtext0: #6c6f85;\n            --ctp-subtext1:
      #5c5f77;\n            --ctp-lavender: #7287fd;\n            --ctp-blue: #1e66f5;\n
      \           --ctp-sapphire: #209fb5;\n            --ctp-sky: #04a5e5;\n            --ctp-teal:
      #179299;\n            --ctp-green: #40a02b;\n            --ctp-yellow: #df8e1d;\n
      \           --ctp-peach: #fe640b;\n            --ctp-maroon: #e64553;\n            --ctp-red:
      #d20f39;\n            --ctp-mauve: #8839ef;\n            --ctp-pink: #ea76cb;\n
      \           --ctp-flamingo: #dd7878;\n            --ctp-rosewater: #dc8a78;\n
      \       }\n\n        /* Catppuccin Frappe */\n        .theme-frappe {\n            --ctp-base:
      #303446;\n            --ctp-mantle: #292c3c;\n            --ctp-crust: #232634;\n
      \           --ctp-surface0: #414559;\n            --ctp-surface1: #51576d;\n
      \           --ctp-surface2: #626880;\n            --ctp-overlay0: #737994;\n
      \           --ctp-overlay1: #838ba7;\n            --ctp-text: #c6d0f5;\n            --ctp-subtext0:
      #a5adce;\n            --ctp-subtext1: #b5bfe2;\n            --ctp-lavender:
      #babbf1;\n            --ctp-blue: #8caaee;\n            --ctp-sapphire: #85c1dc;\n
      \           --ctp-sky: #99d1db;\n            --ctp-teal: #81c8be;\n            --ctp-green:
      #a6d189;\n            --ctp-yellow: #e5c890;\n            --ctp-peach: #ef9f76;\n
      \           --ctp-maroon: #ea999c;\n            --ctp-red: #e78284;\n            --ctp-mauve:
      #ca9ee6;\n            --ctp-pink: #f4b8e4;\n            --ctp-flamingo: #eebebe;\n
      \           --ctp-rosewater: #f2d5cf;\n        }\n\n        /* Catppuccin Macchiato
      */\n        .theme-macchiato {\n            --ctp-base: #24273a;\n            --ctp-mantle:
      #1e2030;\n            --ctp-crust: #181926;\n            --ctp-surface0: #363a4f;\n
      \           --ctp-surface1: #494d64;\n            --ctp-surface2: #5b6078;\n
      \           --ctp-overlay0: #6e738d;\n            --ctp-overlay1: #8087a2;\n
      \           --ctp-text: #cad3f5;\n            --ctp-subtext0: #a5adcb;\n            --ctp-subtext1:
      #b8c0e0;\n            --ctp-lavender: #b7bdf8;\n            --ctp-blue: #8aadf4;\n
      \           --ctp-sapphire: #7dc4e4;\n            --ctp-sky: #91d7e3;\n            --ctp-teal:
      #8bd5ca;\n            --ctp-green: #a6da95;\n            --ctp-yellow: #eed49f;\n
      \           --ctp-peach: #f5a97f;\n            --ctp-maroon: #ee99a0;\n            --ctp-red:
      #ed8796;\n            --ctp-mauve: #c6a0f6;\n            --ctp-pink: #f5bde6;\n
      \           --ctp-flamingo: #f0c6c6;\n            --ctp-rosewater: #f4dbd6;\n
      \       }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n
      \       body {\n            font-family: -apple-system, BlinkMacSystemFont,
      \"SF Pro Display\", \"Segoe UI\", Roboto, sans-serif;\n            background-color:
      var(--ctp-base);\n            color: var(--ctp-text);\n            min-height:
      100vh;\n            display: flex;\n            flex-direction: column;\n            padding-bottom:
      80px;\n            transition: all 0.3s ease;\n            -webkit-font-smoothing:
      antialiased;\n        }\n\n        /* iOS-style Header */\n        .header {\n
      \           background-color: var(--ctp-mantle);\n            padding: 12px
      16px;\n            border-bottom: 1px solid var(--ctp-surface0);\n            display:
      flex;\n            align-items: center;\n            gap: 12px;\n            position:
      sticky;\n            top: 0;\n            z-index: 100;\n            backdrop-filter:
      blur(20px);\n            -webkit-backdrop-filter: blur(20px);\n        }\n\n
      \       .header-icon {\n            width: 36px; height: 36px;\n            background:
      linear-gradient(135deg, var(--ctp-mauve), var(--ctp-blue));\n            border-radius:
      10px;\n            display: flex; align-items: center; justify-content: center;\n
      \           box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        }\n\n        .header
      h1 { font-size: 1.35rem; font-weight: 600; letter-spacing: -0.3px; }\n        .header
      small { color: var(--ctp-subtext0); font-size: 0.8rem; margin-left: auto; }\n\n
      \       /* iOS-style Settings List */\n        .settings-list {\n            padding:
      0 16px;\n            margin-top: 20px;\n        }\n\n        .settings-group
      {\n            background-color: var(--ctp-surface0);\n            border-radius:
      12px;\n            margin-bottom: 20px;\n            overflow: hidden;\n        }\n\n
      \       .settings-group-title {\n            font-size: 0.75rem;\n            font-weight:
      600;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n
      \           color: var(--ctp-subtext0);\n            padding: 8px 16px 6px;\n
      \           margin-bottom: 0;\n        }\n\n        .settings-item {\n            display:
      flex;\n            align-items: center;\n            padding: 12px 16px;\n            border-bottom:
      1px solid var(--ctp-surface1);\n            cursor: pointer;\n            transition:
      background-color 0.15s ease;\n            gap: 12px;\n        }\n\n        .settings-item:last-child
      { border-bottom: none; }\n        .settings-item:active { background-color:
      var(--ctp-surface1); }\n\n        .settings-icon {\n            width: 32px;
      height: 32px;\n            border-radius: 8px;\n            display: flex; align-items:
      center; justify-content: center;\n            flex-shrink: 0;\n        }\n\n
      \       .settings-icon.system { background: linear-gradient(135deg, #6c7086,
      #9ca0b0); }\n        .settings-icon.theme { background: linear-gradient(135deg,
      #cba6f7, #f5c2e7); }\n        .settings-icon.prefs { background: linear-gradient(135deg,
      #89b4fa, #74c7ec); }\n        .settings-icon.notif { background: linear-gradient(135deg,
      #f38ba8, #fab387); }\n        .settings-icon.backup { background: linear-gradient(135deg,
      #a6e3a1, #94e2d5); }\n        .settings-icon.about { background: linear-gradient(135deg,
      #89dceb, #b4befe); }\n\n        .settings-label {\n            flex: 1;\n            display:
      flex;\n            flex-direction: column;\n            gap: 2px;\n        }\n\n
      \       .settings-label span { font-weight: 500; font-size: 1rem; }\n        .settings-label
      small { color: var(--ctp-subtext0); font-size: 0.8rem; }\n\n        .settings-arrow
      {\n            color: var(--ctp-overlay0);\n            display: flex;\n            align-items:
      center;\n        }\n\n        .settings-badge {\n            background-color:
      var(--ctp-red);\n            color: var(--ctp-crust);\n            font-size:
      0.7rem;\n            font-weight: 600;\n            padding: 2px 6px;\n            border-radius:
      10px;\n            margin-right: 8px;\n        }\n\n        /* Panel Views */\n
      \       .panel {\n            display: none;\n            animation: slideIn
      0.3s ease;\n        }\n\n        .panel.active { display: block; }\n\n        @keyframes
      slideIn {\n            from { opacity: 0; transform: translateX(20px); }\n            to
      { opacity: 1; transform: translateX(0); }\n        }\n\n        .panel-header
      {\n            display: flex;\n            align-items: center;\n            padding:
      12px 16px;\n            background-color: var(--ctp-mantle);\n            border-bottom:
      1px solid var(--ctp-surface0);\n            position: sticky;\n            top:
      0;\n            z-index: 100;\n            backdrop-filter: blur(20px);\n        }\n\n
      \       .back-btn {\n            display: flex;\n            align-items: center;\n
      \           gap: 4px;\n            color: var(--ctp-blue);\n            font-size:
      1rem;\n            cursor: pointer;\n            background: none;\n            border:
      none;\n            padding: 0;\n        }\n\n        .panel-title {\n            flex:
      1;\n            text-align: center;\n            font-weight: 600;\n            font-size:
      1.1rem;\n        }\n\n        .panel-content { padding: 16px; }\n\n        /*
      Section styling */\n        .section {\n            background-color: var(--ctp-surface0);\n
      \           border-radius: 12px;\n            padding: 16px;\n            margin-bottom:
      16px;\n        }\n\n        .section-title {\n            font-size: 0.9rem;\n
      \           font-weight: 600;\n            margin-bottom: 12px;\n            color:
      var(--ctp-lavender);\n            display: flex;\n            align-items: center;\n
      \           gap: 8px;\n        }\n\n        .setting-row {\n            display:
      flex;\n            justify-content: space-between;\n            align-items:
      center;\n            padding: 12px 0;\n            border-bottom: 1px solid
      var(--ctp-surface1);\n        }\n        .setting-row:last-child { border-bottom:
      none; }\n\n        .setting-label-inner { display: flex; flex-direction: column;
      gap: 2px; }\n        .setting-label-inner span { font-weight: 500; font-size:
      0.95rem; }\n        .setting-label-inner small { color: var(--ctp-subtext0);
      font-size: 0.8rem; }\n\n        /* iOS Toggle Switch */\n        .toggle {\n
      \           position: relative;\n            width: 51px; height: 31px;\n            background-color:
      var(--ctp-surface2);\n            border-radius: 15.5px;\n            cursor:
      pointer;\n            transition: background-color 0.25s ease;\n        }\n
      \       .toggle.active { background-color: var(--ctp-green); }\n        .toggle::after
      {\n            content: \"\";\n            position: absolute;\n            top:
      2px; left: 2px;\n            width: 27px; height: 27px;\n            background-color:
      #fff;\n            border-radius: 50%;\n            transition: transform 0.25s
      ease;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        }\n        .toggle.active::after
      { transform: translateX(20px); }\n\n        /* Form elements */\n        select
      {\n            background-color: var(--ctp-surface1);\n            border: none;\n
      \           border-radius: 8px;\n            padding: 8px 12px;\n            color:
      var(--ctp-text);\n            font-size: 0.9rem;\n            min-width: 140px;\n
      \           -webkit-appearance: none;\n            appearance: none;\n            cursor:
      pointer;\n        }\n\n        /* Buttons */\n        .btn {\n            padding:
      12px 24px;\n            border: none;\n            border-radius: 10px;\n            font-size:
      0.95rem;\n            font-weight: 500;\n            cursor: pointer;\n            transition:
      all 0.2s ease;\n            display: inline-flex;\n            align-items:
      center;\n            justify-content: center;\n            gap: 8px;\n        }\n
      \       .btn-primary { background-color: var(--ctp-blue); color: #fff; }\n        .btn-primary:active
      { background-color: var(--ctp-sapphire); transform: scale(0.98); }\n        .btn-secondary
      { background-color: var(--ctp-surface1); color: var(--ctp-text); }\n        .btn-danger
      { background-color: var(--ctp-red); color: #fff; }\n        .btn-success { background-color:
      var(--ctp-green); color: var(--ctp-crust); }\n        .btn-group { display:
      flex; gap: 10px; flex-wrap: wrap; }\n\n        /* Info cards */\n        .info-grid
      {\n            display: grid;\n            grid-template-columns: repeat(2,
      1fr);\n            gap: 10px;\n        }\n\n        .info-card {\n            background-color:
      var(--ctp-surface1);\n            border-radius: 10px;\n            padding:
      14px;\n            text-align: center;\n        }\n        .info-card .value
      { font-size: 1.5rem; font-weight: 700; color: var(--ctp-lavender); }\n        .info-card
      .label { font-size: 0.75rem; color: var(--ctp-subtext0); margin-top: 4px; }\n\n
      \       /* Theme Grid */\n        .theme-grid {\n            display: grid;\n
      \           grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n
      \       }\n\n        .theme-option {\n            border-radius: 12px;\n            padding:
      16px;\n            cursor: pointer;\n            border: 3px solid transparent;\n
      \           transition: all 0.2s ease;\n        }\n        .theme-option:active
      { transform: scale(0.98); }\n        .theme-option.selected { border-color:
      var(--ctp-lavender); }\n        .theme-option .colors { display: flex; gap:
      6px; margin-bottom: 10px; }\n        .theme-option .colors div { width: 20px;
      height: 20px; border-radius: 50%; }\n        .theme-option .theme-name { font-weight:
      600; font-size: 0.9rem; }\n\n        /* Node/Storage list */\n        .item-list
      { max-height: 300px; overflow-y: auto; }\n\n        .list-item {\n            display:
      flex;\n            justify-content: space-between;\n            align-items:
      center;\n            padding: 12px 14px;\n            background-color: var(--ctp-surface1);\n
      \           border-radius: 10px;\n            margin-bottom: 8px;\n        }\n\n
      \       .item-info { display: flex; flex-direction: column; gap: 2px; }\n        .item-name
      { font-weight: 500; }\n        .item-details { font-size: 0.8rem; color: var(--ctp-subtext0);
      }\n\n        .status-badge {\n            display: inline-flex;\n            align-items:
      center;\n            gap: 4px;\n            padding: 4px 10px;\n            border-radius:
      12px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n
      \       .status-ready { background-color: rgba(166, 227, 161, 0.2); color: var(--ctp-green);
      }\n        .status-notready { background-color: rgba(243, 139, 168, 0.2); color:
      var(--ctp-red); }\n        .status-online { background-color: rgba(166, 227,
      161, 0.2); color: var(--ctp-green); }\n        .status-offline { background-color:
      rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .progress-bar
      {\n            width: 80px; height: 8px;\n            background-color: var(--ctp-surface2);\n
      \           border-radius: 4px;\n            overflow: hidden;\n        }\n
      \       .progress-fill {\n            height: 100%;\n            background-color:
      var(--ctp-green);\n            transition: width 0.3s ease;\n        }\n        .progress-fill.warning
      { background-color: var(--ctp-yellow); }\n        .progress-fill.danger { background-color:
      var(--ctp-red); }\n\n        /* File input */\n        .file-input { display:
      none; }\n        .file-label {\n            display: inline-flex;\n            align-items:
      center;\n            gap: 8px;\n            padding: 12px 20px;\n            background-color:
      var(--ctp-surface1);\n            border-radius: 10px;\n            cursor:
      pointer;\n            transition: all 0.2s ease;\n        }\n        .file-label:active
      { background-color: var(--ctp-surface2); transform: scale(0.98); }\n\n        /*
      About section */\n        .about-header {\n            text-align: center;\n
      \           padding: 30px 20px;\n        }\n\n        .about-logo {\n            width:
      80px; height: 80px;\n            background: linear-gradient(135deg, var(--ctp-mauve),
      var(--ctp-blue));\n            border-radius: 20px;\n            display: flex;\n
      \           align-items: center;\n            justify-content: center;\n            margin:
      0 auto 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.3);\n        }\n\n
      \       .about-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px;
      }\n        .about-version { color: var(--ctp-subtext0); font-size: 0.9rem; }\n\n
      \       .about-info-row {\n            display: flex;\n            justify-content:
      space-between;\n            padding: 12px 0;\n            border-bottom: 1px
      solid var(--ctp-surface1);\n        }\n        .about-info-row:last-child {
      border-bottom: none; }\n        .about-info-label { color: var(--ctp-subtext0);
      }\n        .about-info-value { font-weight: 500; }\n\n        /* Dock */\n        .dock
      {\n            position: fixed;\n            bottom: 0; left: 0; right: 0;\n
      \           background-color: var(--ctp-mantle);\n            border-top: 1px
      solid var(--ctp-surface0);\n            padding: 8px 16px 20px;\n            display:
      flex;\n            justify-content: space-around;\n            align-items:
      center;\n            z-index: 1000;\n            backdrop-filter: blur(20px);\n
      \           -webkit-backdrop-filter: blur(20px);\n        }\n\n        .dock-item
      {\n            display: flex;\n            flex-direction: column;\n            align-items:
      center;\n            gap: 4px;\n            text-decoration: none;\n            color:
      var(--ctp-subtext0);\n            padding: 6px 16px;\n            border-radius:
      10px;\n            transition: all 0.2s ease;\n        }\n        .dock-item:active
      { transform: scale(0.95); }\n        .dock-item.active { color: var(--ctp-lavender);
      }\n        .dock-icon { width: 24px; height: 24px; display: flex; align-items:
      center; justify-content: center; }\n        .dock-label { font-size: 0.7rem;
      font-weight: 500; }\n\n        /* Toast */\n        .toast {\n            position:
      fixed;\n            bottom: 100px; left: 50%;\n            transform: translateX(-50%);\n
      \           background-color: var(--ctp-surface0);\n            color: var(--ctp-text);\n
      \           padding: 12px 24px;\n            border-radius: 12px;\n            box-shadow:
      0 4px 16px rgba(0, 0, 0, 0.4);\n            z-index: 1001;\n            opacity:
      0;\n            transition: opacity 0.3s ease;\n            font-weight: 500;\n
      \       }\n        .toast.show { opacity: 1; }\n        .toast.success { border-left:
      4px solid var(--ctp-green); }\n        .toast.error { border-left: 4px solid
      var(--ctp-red); }\n\n        @media (max-width: 600px) {\n            .info-grid
      { grid-template-columns: repeat(2, 1fr); }\n            .theme-grid { grid-template-columns:
      1fr 1fr; }\n        }\n    </style>\n</head>\n<body>\n    <!-- Main Menu -->\n
      \   <div id=\"main-menu\" class=\"panel active\">\n        <div class=\"header\">\n
      \           <div class=\"header-icon\">\n                <svg width=\"20\" height=\"20\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\">\n                    <circle
      cx=\"12\" cy=\"12\" r=\"3\"></circle>\n                    <path d=\"M19.4 15a1.65
      1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65
      0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65
      1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1
      0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2
      2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2
      2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0
      0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65
      0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0
      0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65
      1.65 0 0 0-1.51 1z\"></path>\n                </svg>\n            </div>\n            <h1>Settings</h1>\n
      \           <small id=\"version-badge\">v2.1</small>\n        </div>\n\n        <div
      class=\"settings-list\">\n            <div class=\"settings-group\">\n                <div
      class=\"settings-item\" data-panel=\"system\">\n                    <div class=\"settings-icon
      system\">\n                        <svg width=\"18\" height=\"18\" viewBox=\"0
      0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\">\n                            <rect
      x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\"></rect>\n                            <line
      x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"></line>\n                            <line
      x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"></line>\n                        </svg>\n
      \                   </div>\n                    <div class=\"settings-label\">\n
      \                       <span>System</span>\n                        <small>Cluster
      info, nodes, storage</small>\n                    </div>\n                    <div
      class=\"settings-arrow\">\n                        <svg width=\"16\" height=\"16\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                           <polyline points=\"9 18 15 12 9 6\"></polyline>\n
      \                       </svg>\n                    </div>\n                </div>\n\n
      \               <div class=\"settings-item\" data-panel=\"theme\">\n                    <div
      class=\"settings-icon theme\">\n                        <svg width=\"18\" height=\"18\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\">\n                            <circle
      cx=\"12\" cy=\"12\" r=\"5\"></circle>\n                            <line x1=\"12\"
      y1=\"1\" x2=\"12\" y2=\"3\"></line>\n                            <line x1=\"12\"
      y1=\"21\" x2=\"12\" y2=\"23\"></line>\n                            <line x1=\"4.22\"
      y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"></line>\n                            <line
      x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"></line>\n                        </svg>\n
      \                   </div>\n                    <div class=\"settings-label\">\n
      \                       <span>Appearance</span>\n                        <small>Theme,
      colors, display</small>\n                    </div>\n                    <div
      class=\"settings-arrow\">\n                        <svg width=\"16\" height=\"16\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                           <polyline points=\"9 18 15 12 9 6\"></polyline>\n
      \                       </svg>\n                    </div>\n                </div>\n\n
      \               <div class=\"settings-item\" data-panel=\"prefs\">\n                    <div
      class=\"settings-icon prefs\">\n                        <svg width=\"18\" height=\"18\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\">\n                            <path
      d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                            <circle
      cx=\"12\" cy=\"7\" r=\"4\"></circle>\n                        </svg>\n                    </div>\n
      \                   <div class=\"settings-label\">\n                        <span>Preferences</span>\n
      \                       <small>Language, timezone, file options</small>\n                    </div>\n
      \                   <div class=\"settings-arrow\">\n                        <svg
      width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"
      stroke-width=\"2\">\n                            <polyline points=\"9 18 15
      12 9 6\"></polyline>\n                        </svg>\n                    </div>\n
      \               </div>\n\n                <div class=\"settings-item\" data-panel=\"notifications\">\n
      \                   <div class=\"settings-icon notif\">\n                        <svg
      width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\"
      stroke-width=\"2\">\n                            <path d=\"M18 8A6 6 0 0 0 6
      8c0 7-3 9-3 9h18s-3-2-3-9\"></path>\n                            <path d=\"M13.73
      21a2 2 0 0 1-3.46 0\"></path>\n                        </svg>\n                    </div>\n
      \                   <div class=\"settings-label\">\n                        <span>Notifications</span>\n
      \                       <small>Alerts and notification settings</small>\n                    </div>\n
      \                   <div class=\"settings-arrow\">\n                        <svg
      width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"
      stroke-width=\"2\">\n                            <polyline points=\"9 18 15
      12 9 6\"></polyline>\n                        </svg>\n                    </div>\n
      \               </div>\n            </div>\n\n            <div class=\"settings-group\">\n
      \               <div class=\"settings-item\" data-panel=\"backup\">\n                    <div
      class=\"settings-icon backup\">\n                        <svg width=\"18\" height=\"18\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\">\n                            <path
      d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                            <polyline
      points=\"17 8 12 3 7 8\"></polyline>\n                            <line x1=\"12\"
      y1=\"3\" x2=\"12\" y2=\"15\"></line>\n                        </svg>\n                    </div>\n
      \                   <div class=\"settings-label\">\n                        <span>Backup
      & Restore</span>\n                        <small>Export and import settings</small>\n
      \                   </div>\n                    <div class=\"settings-arrow\">\n
      \                       <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"
      fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <polyline
      points=\"9 18 15 12 9 6\"></polyline>\n                        </svg>\n                    </div>\n
      \               </div>\n\n                <div class=\"settings-item\" data-panel=\"about\">\n
      \                   <div class=\"settings-icon about\">\n                        <svg
      width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\"
      stroke-width=\"2\">\n                            <circle cx=\"12\" cy=\"12\"
      r=\"10\"></circle>\n                            <line x1=\"12\" y1=\"16\" x2=\"12\"
      y2=\"12\"></line>\n                            <line x1=\"12\" y1=\"8\" x2=\"12.01\"
      y2=\"8\"></line>\n                        </svg>\n                    </div>\n
      \                   <div class=\"settings-label\">\n                        <span>About</span>\n
      \                       <small>Version, services, credits</small>\n                    </div>\n
      \                   <div class=\"settings-arrow\">\n                        <svg
      width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"
      stroke-width=\"2\">\n                            <polyline points=\"9 18 15
      12 9 6\"></polyline>\n                        </svg>\n                    </div>\n
      \               </div>\n            </div>\n        </div>\n    </div>\n\n    <!--
      System Panel -->\n    <div id=\"system-panel\" class=\"panel\">\n        <div
      class=\"panel-header\">\n            <button class=\"back-btn\" onclick=\"showPanel('main-menu')\">\n
      \               <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"
      stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"15
      18 9 12 15 6\"></polyline>\n                </svg>\n                Back\n            </button>\n
      \           <span class=\"panel-title\">System</span>\n            <span style=\"width:
      60px;\"></span>\n        </div>\n        <div class=\"panel-content\">\n            <div
      class=\"section\">\n                <h2 class=\"section-title\">Cluster Overview</h2>\n
      \               <div class=\"info-grid\">\n                    <div class=\"info-card\">\n
      \                       <div class=\"value\" id=\"node-count\">-</div>\n                        <div
      class=\"label\">Nodes</div>\n                    </div>\n                    <div
      class=\"info-card\">\n                        <div class=\"value\" id=\"pod-running\">-</div>\n
      \                       <div class=\"label\">Running</div>\n                    </div>\n
      \                   <div class=\"info-card\">\n                        <div
      class=\"value\" id=\"service-count\">-</div>\n                        <div class=\"label\">Services</div>\n
      \                   </div>\n                    <div class=\"info-card\">\n
      \                       <div class=\"value\" id=\"namespace-count\">-</div>\n
      \                       <div class=\"label\">Namespaces</div>\n                    </div>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <h2 class=\"section-title\">Cluster Nodes</h2>\n                <div
      class=\"item-list\" id=\"node-list\">\n                    <div class=\"list-item\"><div
      class=\"item-info\"><span class=\"item-name\">Loading...</span></div></div>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <h2 class=\"section-title\">Pod Status</h2>\n                <div
      class=\"info-grid\">\n                    <div class=\"info-card\">\n                        <div
      class=\"value\" id=\"pod-total\">-</div>\n                        <div class=\"label\">Total</div>\n
      \                   </div>\n                    <div class=\"info-card\">\n
      \                       <div class=\"value\" id=\"pod-pending\" style=\"color:
      var(--ctp-yellow);\">-</div>\n                        <div class=\"label\">Pending</div>\n
      \                   </div>\n                    <div class=\"info-card\">\n
      \                       <div class=\"value\" id=\"pod-failed\" style=\"color:
      var(--ctp-red);\">-</div>\n                        <div class=\"label\">Failed</div>\n
      \                   </div>\n                    <div class=\"info-card\">\n
      \                       <div class=\"value\" id=\"pod-completed\" style=\"color:
      var(--ctp-teal);\">-</div>\n                        <div class=\"label\">Completed</div>\n
      \                   </div>\n                </div>\n            </div>\n\n            <div
      class=\"section\">\n                <h2 class=\"section-title\">Storage</h2>\n
      \               <div class=\"item-list\" id=\"storage-list\">\n                    <div
      class=\"list-item\"><div class=\"item-info\"><span class=\"item-name\">Loading...</span></div></div>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <button class=\"btn btn-primary\" onclick=\"refreshSystemInfo()\"
      style=\"width: 100%;\">Refresh</button>\n            </div>\n        </div>\n
      \   </div>\n\n    <!-- Theme Panel -->\n    <div id=\"theme-panel\" class=\"panel\">\n
      \       <div class=\"panel-header\">\n            <button class=\"back-btn\"
      onclick=\"showPanel('main-menu')\">\n                <svg width=\"20\" height=\"20\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                   <polyline points=\"15 18 9 12 15 6\"></polyline>\n                </svg>\n
      \               Back\n            </button>\n            <span class=\"panel-title\">Appearance</span>\n
      \           <span style=\"width: 60px;\"></span>\n        </div>\n        <div
      class=\"panel-content\">\n            <div class=\"section\">\n                <h2
      class=\"section-title\">Catppuccin Theme</h2>\n                <div class=\"theme-grid\">\n
      \                   <div class=\"theme-option selected\" data-theme=\"mocha\"
      style=\"background-color: #1e1e2e;\">\n                        <div class=\"colors\">\n
      \                           <div style=\"background-color: #cba6f7;\"></div>\n
      \                           <div style=\"background-color: #89b4fa;\"></div>\n
      \                           <div style=\"background-color: #a6e3a1;\"></div>\n
      \                           <div style=\"background-color: #f38ba8;\"></div>\n
      \                       </div>\n                        <div class=\"theme-name\"
      style=\"color: #cdd6f4;\">Mocha</div>\n                    </div>\n                    <div
      class=\"theme-option\" data-theme=\"macchiato\" style=\"background-color: #24273a;\">\n
      \                       <div class=\"colors\">\n                            <div
      style=\"background-color: #c6a0f6;\"></div>\n                            <div
      style=\"background-color: #8aadf4;\"></div>\n                            <div
      style=\"background-color: #a6da95;\"></div>\n                            <div
      style=\"background-color: #ed8796;\"></div>\n                        </div>\n
      \                       <div class=\"theme-name\" style=\"color: #cad3f5;\">Macchiato</div>\n
      \                   </div>\n                    <div class=\"theme-option\"
      data-theme=\"frappe\" style=\"background-color: #303446;\">\n                        <div
      class=\"colors\">\n                            <div style=\"background-color:
      #ca9ee6;\"></div>\n                            <div style=\"background-color:
      #8caaee;\"></div>\n                            <div style=\"background-color:
      #a6d189;\"></div>\n                            <div style=\"background-color:
      #e78284;\"></div>\n                        </div>\n                        <div
      class=\"theme-name\" style=\"color: #c6d0f5;\">Frappe</div>\n                    </div>\n
      \                   <div class=\"theme-option\" data-theme=\"latte\" style=\"background-color:
      #eff1f5;\">\n                        <div class=\"colors\">\n                            <div
      style=\"background-color: #8839ef;\"></div>\n                            <div
      style=\"background-color: #1e66f5;\"></div>\n                            <div
      style=\"background-color: #40a02b;\"></div>\n                            <div
      style=\"background-color: #d20f39;\"></div>\n                        </div>\n
      \                       <div class=\"theme-name\" style=\"color: #4c4f69;\">Latte</div>\n
      \                   </div>\n                </div>\n            </div>\n\n            <div
      class=\"section\">\n                <h2 class=\"section-title\">Display Settings</h2>\n
      \               <div class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Compact Mode</span>\n                        <small>Reduce
      spacing</small>\n                    </div>\n                    <div class=\"toggle\"
      data-setting=\"compact-mode\"></div>\n                </div>\n                <div
      class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Animations</span>\n                        <small>Enable
      transitions</small>\n                    </div>\n                    <div class=\"toggle
      active\" data-setting=\"animations\"></div>\n                </div>\n                <div
      class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Font Size</span>\n                    </div>\n
      \                   <select id=\"font-size\">\n                        <option
      value=\"14\">Small</option>\n                        <option value=\"16\" selected>Medium</option>\n
      \                       <option value=\"18\">Large</option>\n                    </select>\n
      \               </div>\n                <div class=\"setting-row\">\n                    <div
      class=\"setting-label-inner\">\n                        <span>Accent Color</span>\n
      \                   </div>\n                    <select id=\"accent-color\">\n
      \                       <option value=\"lavender\" selected>Lavender</option>\n
      \                       <option value=\"blue\">Blue</option>\n                        <option
      value=\"mauve\">Mauve</option>\n                        <option value=\"pink\">Pink</option>\n
      \                       <option value=\"teal\">Teal</option>\n                        <option
      value=\"green\">Green</option>\n                    </select>\n                </div>\n
      \           </div>\n\n            <div class=\"section\">\n                <div
      class=\"btn-group\">\n                    <button class=\"btn btn-primary\"
      onclick=\"saveTheme()\">Apply</button>\n                    <button class=\"btn
      btn-secondary\" onclick=\"resetTheme()\">Reset</button>\n                </div>\n
      \           </div>\n        </div>\n    </div>\n\n    <!-- Preferences Panel
      -->\n    <div id=\"prefs-panel\" class=\"panel\">\n        <div class=\"panel-header\">\n
      \           <button class=\"back-btn\" onclick=\"showPanel('main-menu')\">\n
      \               <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"
      stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"15
      18 9 12 15 6\"></polyline>\n                </svg>\n                Back\n            </button>\n
      \           <span class=\"panel-title\">Preferences</span>\n            <span
      style=\"width: 60px;\"></span>\n        </div>\n        <div class=\"panel-content\">\n
      \           <div class=\"section\">\n                <h2 class=\"section-title\">Regional</h2>\n
      \               <div class=\"setting-row\">\n                    <div class=\"setting-label-inner\"><span>Language</span></div>\n
      \                   <select id=\"language\">\n                        <option
      value=\"en\" selected>English</option>\n                        <option value=\"es\">Spanish</option>\n
      \                       <option value=\"de\">German</option>\n                        <option
      value=\"fr\">French</option>\n                    </select>\n                </div>\n
      \               <div class=\"setting-row\">\n                    <div class=\"setting-label-inner\"><span>Timezone</span></div>\n
      \                   <select id=\"timezone\">\n                        <option
      value=\"America/Los_Angeles\" selected>Pacific</option>\n                        <option
      value=\"America/Denver\">Mountain</option>\n                        <option
      value=\"America/Chicago\">Central</option>\n                        <option
      value=\"America/New_York\">Eastern</option>\n                        <option
      value=\"UTC\">UTC</option>\n                    </select>\n                </div>\n
      \               <div class=\"setting-row\">\n                    <div class=\"setting-label-inner\"><span>Date
      Format</span></div>\n                    <select id=\"date-format\">\n                        <option
      value=\"YYYY-MM-DD\" selected>2026-01-15</option>\n                        <option
      value=\"MM/DD/YYYY\">01/15/2026</option>\n                        <option value=\"DD/MM/YYYY\">15/01/2026</option>\n
      \                   </select>\n                </div>\n            </div>\n\n
      \           <div class=\"section\">\n                <h2 class=\"section-title\">File
      Manager</h2>\n                <div class=\"setting-row\">\n                    <div
      class=\"setting-label-inner\">\n                        <span>Auto Save</span>\n
      \                       <small>Save changes automatically</small>\n                    </div>\n
      \                   <div class=\"toggle active\" data-setting=\"auto-save\"></div>\n
      \               </div>\n                <div class=\"setting-row\">\n                    <div
      class=\"setting-label-inner\">\n                        <span>Show Hidden Files</span>\n
      \                       <small>Display dotfiles</small>\n                    </div>\n
      \                   <div class=\"toggle\" data-setting=\"show-hidden\"></div>\n
      \               </div>\n                <div class=\"setting-row\">\n                    <div
      class=\"setting-label-inner\"><span>Default View</span></div>\n                    <select
      id=\"default-view\">\n                        <option value=\"grid\" selected>Grid</option>\n
      \                       <option value=\"list\">List</option>\n                        <option
      value=\"details\">Details</option>\n                    </select>\n                </div>\n
      \           </div>\n\n            <div class=\"section\">\n                <button
      class=\"btn btn-primary\" onclick=\"savePreferences()\" style=\"width: 100%;\">Save
      Preferences</button>\n            </div>\n        </div>\n    </div>\n\n    <!--
      Notifications Panel -->\n    <div id=\"notifications-panel\" class=\"panel\">\n
      \       <div class=\"panel-header\">\n            <button class=\"back-btn\"
      onclick=\"showPanel('main-menu')\">\n                <svg width=\"20\" height=\"20\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                   <polyline points=\"15 18 9 12 15 6\"></polyline>\n                </svg>\n
      \               Back\n            </button>\n            <span class=\"panel-title\">Notifications</span>\n
      \           <span style=\"width: 60px;\"></span>\n        </div>\n        <div
      class=\"panel-content\">\n            <div class=\"section\">\n                <h2
      class=\"section-title\">General</h2>\n                <div class=\"setting-row\">\n
      \                   <div class=\"setting-label-inner\">\n                        <span>Enable
      Notifications</span>\n                    </div>\n                    <div class=\"toggle
      active\" data-setting=\"notif-enabled\"></div>\n                </div>\n                <div
      class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Sound Alerts</span>\n                    </div>\n
      \                   <div class=\"toggle active\" data-setting=\"notif-sound\"></div>\n
      \               </div>\n                <div class=\"setting-row\">\n                    <div
      class=\"setting-label-inner\">\n                        <span>Desktop Notifications</span>\n
      \                   </div>\n                    <div class=\"toggle active\"
      data-setting=\"notif-desktop\"></div>\n                </div>\n                <div
      class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Email Notifications</span>\n                    </div>\n
      \                   <div class=\"toggle\" data-setting=\"notif-email\"></div>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <h2 class=\"section-title\">Alert Types</h2>\n                <div
      class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Build Alerts</span>\n                        <small>Build
      success/failure</small>\n                    </div>\n                    <div
      class=\"toggle active\" data-setting=\"alert-build\"></div>\n                </div>\n
      \               <div class=\"setting-row\">\n                    <div class=\"setting-label-inner\">\n
      \                       <span>Cluster Alerts</span>\n                        <small>Node
      status changes</small>\n                    </div>\n                    <div
      class=\"toggle active\" data-setting=\"alert-cluster\"></div>\n                </div>\n
      \           </div>\n\n            <div class=\"section\">\n                <button
      class=\"btn btn-primary\" onclick=\"saveNotifications()\" style=\"width: 100%;\">Save
      Settings</button>\n            </div>\n        </div>\n    </div>\n\n    <!--
      Backup Panel -->\n    <div id=\"backup-panel\" class=\"panel\">\n        <div
      class=\"panel-header\">\n            <button class=\"back-btn\" onclick=\"showPanel('main-menu')\">\n
      \               <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"
      stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"15
      18 9 12 15 6\"></polyline>\n                </svg>\n                Back\n            </button>\n
      \           <span class=\"panel-title\">Backup & Restore</span>\n            <span
      style=\"width: 60px;\"></span>\n        </div>\n        <div class=\"panel-content\">\n
      \           <div class=\"section\">\n                <h2 class=\"section-title\">Export
      Settings</h2>\n                <p style=\"color: var(--ctp-subtext0); margin-bottom:
      16px; font-size: 0.9rem;\">\n                    Download all HolmOS settings
      as a JSON file.\n                </p>\n                <button class=\"btn btn-primary\"
      onclick=\"exportSettings()\" style=\"width: 100%;\">Export All Settings</button>\n
      \           </div>\n\n            <div class=\"section\">\n                <h2
      class=\"section-title\">Import Settings</h2>\n                <p style=\"color:
      var(--ctp-subtext0); margin-bottom: 16px; font-size: 0.9rem;\">\n                    Restore
      settings from a backup file.\n                </p>\n                <input type=\"file\"
      id=\"import-file\" class=\"file-input\" accept=\".json\" onchange=\"handleFileSelect(event)\"
      />\n                <label for=\"import-file\" class=\"file-label\" style=\"width:
      100%; justify-content: center;\">\n                    <svg width=\"16\" height=\"16\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                       <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2
      2 0 0 0 2-2V8z\"></path>\n                        <polyline points=\"14 2 14
      8 20 8\"></polyline>\n                    </svg>\n                    Choose
      File\n                </label>\n                <div id=\"selected-file\" style=\"margin-top:
      10px; color: var(--ctp-subtext0); font-size: 0.85rem; text-align: center;\"></div>\n
      \               <button class=\"btn btn-success\" onclick=\"importSettings()\"
      id=\"import-btn\" disabled style=\"width: 100%; margin-top: 12px;\">Import</button>\n
      \           </div>\n\n            <div class=\"section\" style=\"border: 1px
      solid var(--ctp-red); background-color: rgba(243, 139, 168, 0.1);\">\n                <h2
      class=\"section-title\" style=\"color: var(--ctp-red);\">Danger Zone</h2>\n
      \               <p style=\"color: var(--ctp-subtext0); margin-bottom: 16px;
      font-size: 0.9rem;\">\n                    Reset all settings to defaults. This
      cannot be undone.\n                </p>\n                <button class=\"btn
      btn-danger\" onclick=\"resetAllSettings()\" style=\"width: 100%;\">Reset All
      Settings</button>\n            </div>\n        </div>\n    </div>\n\n    <!--
      About Panel -->\n    <div id=\"about-panel\" class=\"panel\">\n        <div
      class=\"panel-header\">\n            <button class=\"back-btn\" onclick=\"showPanel('main-menu')\">\n
      \               <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"
      stroke=\"currentColor\" stroke-width=\"2\">\n                    <polyline points=\"15
      18 9 12 15 6\"></polyline>\n                </svg>\n                Back\n            </button>\n
      \           <span class=\"panel-title\">About</span>\n            <span style=\"width:
      60px;\"></span>\n        </div>\n        <div class=\"panel-content\">\n            <div
      class=\"about-header\">\n                <div class=\"about-logo\">\n                    <svg
      width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\"
      stroke-width=\"2\">\n                        <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n
      \                       <path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2
      2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65
      0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65
      1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65
      0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65
      1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0
      1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1
      2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2
      2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65
      0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path>\n
      \                   </svg>\n                </div>\n                <div class=\"about-name\">HolmOS</div>\n
      \               <div class=\"about-version\" id=\"about-version\">Settings Hub
      v2.1.0</div>\n            </div>\n\n            <div class=\"section\">\n                <h2
      class=\"section-title\">System Information</h2>\n                <div class=\"about-info-row\">\n
      \                   <span class=\"about-info-label\">Platform</span>\n                    <span
      class=\"about-info-value\" id=\"about-platform\">-</span>\n                </div>\n
      \               <div class=\"about-info-row\">\n                    <span class=\"about-info-label\">Architecture</span>\n
      \                   <span class=\"about-info-value\" id=\"about-arch\">-</span>\n
      \               </div>\n                <div class=\"about-info-row\">\n                    <span
      class=\"about-info-label\">Go Version</span>\n                    <span class=\"about-info-value\"
      id=\"about-go\">-</span>\n                </div>\n                <div class=\"about-info-row\">\n
      \                   <span class=\"about-info-label\">Build Date</span>\n                    <span
      class=\"about-info-value\" id=\"about-build\">-</span>\n                </div>\n
      \               <div class=\"about-info-row\">\n                    <span class=\"about-info-label\">Hostname</span>\n
      \                   <span class=\"about-info-value\" id=\"about-hostname\">-</span>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <h2 class=\"section-title\">Connected Services</h2>\n                <div
      class=\"item-list\" id=\"services-list\">\n                    <div class=\"list-item\"><div
      class=\"item-info\"><span class=\"item-name\">Loading...</span></div></div>\n
      \               </div>\n            </div>\n\n            <div class=\"section\">\n
      \               <h2 class=\"section-title\">Credits</h2>\n                <p
      style=\"color: var(--ctp-subtext0); font-size: 0.9rem; line-height: 1.5;\">\n
      \                   HolmOS is a custom Kubernetes-based operating system for
      Raspberry Pi clusters.\n                    Built with Catppuccin color scheme.\n
      \               </p>\n            </div>\n        </div>\n    </div>\n\n    <!--
      Dock -->\n    <nav class=\"dock\">\n        <a href=\"http://192.168.8.197:30088\"
      class=\"dock-item\">\n            <div class=\"dock-icon\">\n                <svg
      width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"
      stroke-width=\"2\">\n                    <path d=\"M22 19a2 2 0 0 1-2 2H4a2
      2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"></path>\n                </svg>\n
      \           </div>\n            <span class=\"dock-label\">Files</span>\n        </a>\n
      \       <a href=\"http://192.168.8.197:30088/terminal\" class=\"dock-item\">\n
      \           <div class=\"dock-icon\">\n                <svg width=\"22\" height=\"22\"
      viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n
      \                   <polyline points=\"4 17 10 11 4 5\"></polyline>\n                    <line
      x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"></line>\n                </svg>\n            </div>\n
      \           <span class=\"dock-label\">Terminal</span>\n        </a>\n        <a
      href=\"#\" class=\"dock-item active\">\n            <div class=\"dock-icon\">\n
      \               <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\"
      stroke=\"currentColor\" stroke-width=\"2\">\n                    <circle cx=\"12\"
      cy=\"12\" r=\"3\"></circle>\n                    <path d=\"M19.4 15a1.65 1.65
      0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0
      0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65
      1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1
      0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2
      2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2
      2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0
      0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65
      0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0
      0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65
      1.65 0 0 0-1.51 1z\"></path>\n                </svg>\n            </div>\n            <span
      class=\"dock-label\">Settings</span>\n        </a>\n        <a href=\"http://192.168.8.197:30700\"
      class=\"dock-item\">\n            <div class=\"dock-icon\">\n                <svg
      width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"
      stroke-width=\"2\">\n                    <path d=\"M3 18v-6a9 9 0 0 1 18 0v6\"></path>\n
      \                   <path d=\"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0
      0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z\"></path>\n
      \               </svg>\n            </div>\n            <span class=\"dock-label\">Audio</span>\n
      \       </a>\n    </nav>\n\n    <div id=\"toast\" class=\"toast\"></div>\n\n
      \   <script>\n        // Panel navigation\n        function showPanel(panelId)
      {\n            document.querySelectorAll(\".panel\").forEach(p => p.classList.remove(\"active\"));\n
      \           document.getElementById(panelId).classList.add(\"active\");\n            \n
      \           if (panelId === \"system-panel\") refreshSystemInfo();\n            if
      (panelId === \"about-panel\") loadAboutInfo();\n        }\n\n        // Menu
      item clicks\n        document.querySelectorAll(\".settings-item\").forEach(item
      => {\n            item.addEventListener(\"click\", () => {\n                const
      panel = item.dataset.panel;\n                if (panel) showPanel(panel + \"-panel\");\n
      \           });\n        });\n\n        // Toggle switches\n        document.querySelectorAll(\".toggle\").forEach(toggle
      => {\n            toggle.addEventListener(\"click\", () => toggle.classList.toggle(\"active\"));\n
      \       });\n\n        // Theme selection\n        document.querySelectorAll(\".theme-option\").forEach(option
      => {\n            option.addEventListener(\"click\", () => {\n                document.querySelectorAll(\".theme-option\").forEach(o
      => o.classList.remove(\"selected\"));\n                option.classList.add(\"selected\");\n
      \               applyTheme(option.dataset.theme);\n            });\n        });\n\n
      \       function applyTheme(theme) {\n            document.body.className =
      theme !== \"mocha\" ? \"theme-\" + theme : \"\";\n        }\n\n        function
      showToast(message, type = \"success\") {\n            const toast = document.getElementById(\"toast\");\n
      \           toast.textContent = message;\n            toast.className = \"toast
      \" + type + \" show\";\n            setTimeout(() => toast.classList.remove(\"show\"),
      3000);\n        }\n\n        async function refreshSystemInfo() {\n            try
      {\n                const resp = await fetch(\"/api/system/info\");\n                if
      (resp.ok) {\n                    const data = await resp.json();\n                    document.getElementById(\"node-count\").textContent
      = data.nodes?.length || 0;\n                    document.getElementById(\"pod-running\").textContent
      = data.pods?.running || 0;\n                    document.getElementById(\"service-count\").textContent
      = data.services || 0;\n                    document.getElementById(\"namespace-count\").textContent
      = data.namespaces || 0;\n                    document.getElementById(\"pod-total\").textContent
      = data.pods?.total || 0;\n                    document.getElementById(\"pod-pending\").textContent
      = data.pods?.pending || 0;\n                    document.getElementById(\"pod-failed\").textContent
      = data.pods?.failed || 0;\n                    document.getElementById(\"pod-completed\").textContent
      = data.pods?.completed || 0;\n\n                    const nodeList = document.getElementById(\"node-list\");\n
      \                   if (data.nodes?.length > 0) {\n                        nodeList.innerHTML
      = data.nodes.map(node =>\n                            '<div class=\"list-item\">'
      +\n                                '<div class=\"item-info\">' +\n                                    '<span
      class=\"item-name\">' + node.name + '</span>' +\n                                    '<span
      class=\"item-details\">' + node.role + ' | ' + node.arch + ' | ' + node.cpu
      + ' CPU</span>' +\n                                '</div>' +\n                                '<span
      class=\"status-badge status-' + node.status.toLowerCase() + '\">' + node.status
      + '</span>' +\n                            '</div>'\n                        ).join(\"\");\n
      \                   }\n\n                    const storageList = document.getElementById(\"storage-list\");\n
      \                   if (data.storage?.length > 0) {\n                        storageList.innerHTML
      = data.storage.map(s => {\n                            const pct = parseInt(s.percent)
      || 0;\n                            const cls = pct > 90 ? \"danger\" : pct >
      70 ? \"warning\" : \"\";\n                            return '<div class=\"list-item\">'
      +\n                                '<div class=\"item-info\">' +\n                                    '<span
      class=\"item-name\">' + s.mount + '</span>' +\n                                    '<span
      class=\"item-details\">' + s.used + ' / ' + s.size + '</span>' +\n                                '</div>'
      +\n                                '<div class=\"progress-bar\">' +\n                                    '<div
      class=\"progress-fill ' + cls + '\" style=\"width: ' + pct + '%\"></div>' +\n
      \                               '</div>' +\n                            '</div>';\n
      \                       }).join(\"\");\n                    }\n                    showToast(\"System
      info updated\", \"success\");\n                }\n            } catch (e) {\n
      \               console.error(\"System info error:\", e);\n                showToast(\"Failed
      to load system info\", \"error\");\n            }\n        }\n\n        async
      function loadAboutInfo() {\n            try {\n                const resp =
      await fetch(\"/api/about\");\n                if (resp.ok) {\n                    const
      data = await resp.json();\n                    document.getElementById(\"about-version\").textContent
      = data.appName + \" v\" + data.version;\n                    document.getElementById(\"about-platform\").textContent
      = data.platform;\n                    document.getElementById(\"about-arch\").textContent
      = data.architecture;\n                    document.getElementById(\"about-go\").textContent
      = data.goVersion;\n                    document.getElementById(\"about-build\").textContent
      = data.buildDate;\n                    document.getElementById(\"about-hostname\").textContent
      = data.hostname;\n\n                    const servicesList = document.getElementById(\"services-list\");\n
      \                   if (data.services?.length > 0) {\n                        servicesList.innerHTML
      = data.services.map(s =>\n                            '<div class=\"list-item\">'
      +\n                                '<div class=\"item-info\">' +\n                                    '<span
      class=\"item-name\">' + s.name + '</span>' +\n                                    '<span
      class=\"item-details\">Port ' + s.port + '</span>' +\n                                '</div>'
      +\n                                '<span class=\"status-badge status-' + s.status
      + '\">' + s.status + '</span>' +\n                            '</div>'\n                        ).join(\"\");\n
      \                   }\n                }\n            } catch (e) {\n                console.error(\"About
      info error:\", e);\n            }\n        }\n\n        async function loadTheme()
      {\n            try {\n                const resp = await fetch(\"/api/theme/preferences\");\n
      \               if (resp.ok) {\n                    const data = await resp.json();\n
      \                   if (data.theme) {\n                        document.querySelectorAll(\".theme-option\").forEach(o
      => o.classList.remove(\"selected\"));\n                        document.querySelector('[data-theme=\"'
      + data.theme + '\"]')?.classList.add(\"selected\");\n                        applyTheme(data.theme);\n
      \                   }\n                    if (data.compactMode) document.querySelector(\"[data-setting='compact-mode']\")?.classList.add(\"active\");\n
      \                   if (data.animations) document.querySelector(\"[data-setting='animations']\")?.classList.add(\"active\");\n
      \                   else document.querySelector(\"[data-setting='animations']\")?.classList.remove(\"active\");\n
      \                   if (data.fontSize) document.getElementById(\"font-size\").value
      = data.fontSize;\n                    if (data.accentColor) document.getElementById(\"accent-color\").value
      = data.accentColor;\n                }\n            } catch (e) { console.log(\"Theme
      load failed:\", e); }\n        }\n\n        async function saveTheme() {\n            const
      theme = document.querySelector(\".theme-option.selected\")?.dataset.theme ||
      \"mocha\";\n            const data = {\n                theme: theme,\n                compactMode:
      document.querySelector(\"[data-setting='compact-mode']\")?.classList.contains(\"active\")
      || false,\n                animations: document.querySelector(\"[data-setting='animations']\")?.classList.contains(\"active\")
      || false,\n                fontSize: parseInt(document.getElementById(\"font-size\").value),\n
      \               accentColor: document.getElementById(\"accent-color\").value\n
      \           };\n            try {\n                await fetch(\"/api/theme/preferences\",
      {\n                    method: \"POST\",\n                    headers: { \"Content-Type\":
      \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n
      \               showToast(\"Theme saved\", \"success\");\n            } catch
      (e) {\n                showToast(\"Failed to save theme\", \"error\");\n            }\n
      \       }\n\n        function resetTheme() {\n            document.querySelectorAll(\".theme-option\").forEach(o
      => o.classList.remove(\"selected\"));\n            document.querySelector(\"[data-theme='mocha']\").classList.add(\"selected\");\n
      \           applyTheme(\"mocha\");\n            showToast(\"Theme reset to Mocha\",
      \"success\");\n        }\n\n        async function savePreferences() {\n            const
      data = {\n                language: document.getElementById(\"language\").value,\n
      \               timezone: document.getElementById(\"timezone\").value,\n                dateFormat:
      document.getElementById(\"date-format\").value,\n                autoSave: document.querySelector(\"[data-setting='auto-save']\")?.classList.contains(\"active\")
      || false,\n                showHidden: document.querySelector(\"[data-setting='show-hidden']\")?.classList.contains(\"active\")
      || false,\n                defaultView: document.getElementById(\"default-view\").value\n
      \           };\n            try {\n                await fetch(\"/api/user/preferences\",
      {\n                    method: \"POST\",\n                    headers: { \"Content-Type\":
      \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n
      \               showToast(\"Preferences saved\", \"success\");\n            }
      catch (e) {\n                showToast(\"Failed to save preferences\", \"error\");\n
      \           }\n        }\n\n        async function saveNotifications() {\n            const
      data = {\n                enabled: document.querySelector(\"[data-setting='notif-enabled']\")?.classList.contains(\"active\")
      || false,\n                sound: document.querySelector(\"[data-setting='notif-sound']\")?.classList.contains(\"active\")
      || false,\n                desktop: document.querySelector(\"[data-setting='notif-desktop']\")?.classList.contains(\"active\")
      || false,\n                email: document.querySelector(\"[data-setting='notif-email']\")?.classList.contains(\"active\")
      || false,\n                buildAlerts: document.querySelector(\"[data-setting='alert-build']\")?.classList.contains(\"active\")
      || false,\n                clusterAlerts: document.querySelector(\"[data-setting='alert-cluster']\")?.classList.contains(\"active\")
      || false\n            };\n            try {\n                await fetch(\"/api/notifications/settings\",
      {\n                    method: \"POST\",\n                    headers: { \"Content-Type\":
      \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n
      \               showToast(\"Notification settings saved\", \"success\");\n            }
      catch (e) {\n                showToast(\"Failed to save notifications\", \"error\");\n
      \           }\n        }\n\n        async function exportSettings() {\n            try
      {\n                const resp = await fetch(\"/api/backup/export\");\n                if
      (resp.ok) {\n                    const data = await resp.json();\n                    const
      blob = new Blob([JSON.stringify(data, null, 2)], { type: \"application/json\"
      });\n                    const url = URL.createObjectURL(blob);\n                    const
      a = document.createElement(\"a\");\n                    a.href = url;\n                    a.download
      = \"holmos-settings-\" + new Date().toISOString().split(\"T\")[0] + \".json\";\n
      \                   a.click();\n                    URL.revokeObjectURL(url);\n
      \                   showToast(\"Settings exported\", \"success\");\n                }\n
      \           } catch (e) {\n                showToast(\"Export failed\", \"error\");\n
      \           }\n        }\n\n        let selectedFileData = null;\n\n        function
      handleFileSelect(event) {\n            const file = event.target.files[0];\n
      \           if (file) {\n                document.getElementById(\"selected-file\").textContent
      = \"Selected: \" + file.name;\n                document.getElementById(\"import-btn\").disabled
      = false;\n                const reader = new FileReader();\n                reader.onload
      = (e) => {\n                    try {\n                        selectedFileData
      = JSON.parse(e.target.result);\n                    } catch (err) {\n                        showToast(\"Invalid
      JSON file\", \"error\");\n                        selectedFileData = null;\n
      \                       document.getElementById(\"import-btn\").disabled = true;\n
      \                   }\n                };\n                reader.readAsText(file);\n
      \           }\n        }\n\n        async function importSettings() {\n            if
      (!selectedFileData) {\n                showToast(\"Please select a file\", \"error\");\n
      \               return;\n            }\n            try {\n                const
      resp = await fetch(\"/api/restore/import\", {\n                    method: \"POST\",\n
      \                   headers: { \"Content-Type\": \"application/json\" },\n                    body:
      JSON.stringify(selectedFileData)\n                });\n                if (resp.ok)
      {\n                    showToast(\"Settings imported\", \"success\");\n                    setTimeout(()
      => location.reload(), 1000);\n                } else {\n                    throw
      new Error(\"Import failed\");\n                }\n            } catch (e) {\n
      \               showToast(\"Import failed\", \"error\");\n            }\n        }\n\n
      \       function resetAllSettings() {\n            if (confirm(\"Reset all settings
      to defaults? This cannot be undone.\")) {\n                showToast(\"Settings
      reset\", \"success\");\n                setTimeout(() => location.reload(),
      1000);\n            }\n        }\n\n        // Initialize\n        document.addEventListener(\"DOMContentLoaded\",
      () => {\n            loadTheme();\n        });\n    </script>\n</body>\n</html>\n`\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"Dockerfile":"FROM public.ecr.aws/docker/library/golang:1.21-alpine AS builder\n\nWORKDIR /app\n\n# Install ca-certificates for HTTPS calls\nRUN apk add --no-cache ca-certificates\n\n# Copy source\nCOPY main.go .\n\n# Build static binary\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags=\"-s -w\" -o settings-web main.go\n\n# Final stage\nFROM public.ecr.aws/docker/library/alpine:3.19\n\nWORKDIR /app\n\n# Install kubectl for system info queries\nRUN apk add --no-cache ca-certificates curl \u0026\u0026 \\\n    curl -LO \"https://dl.k8s.io/release/v1.29.0/bin/linux/arm64/kubectl\" \u0026\u0026 \\\n    chmod +x kubectl \u0026\u0026 \\\n    mv kubectl /usr/local/bin/\n\nCOPY --from=builder /app/settings-web .\n\nEXPOSE 8080\n\nCMD [\"./settings-web\"]\n","main.go":"package main\n\nimport (\n\t\"bytes\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"io\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\t\"os/exec\"\n\t\"runtime\"\n\t\"strings\"\n\t\"time\"\n)\n\n// Service endpoints\nconst (\n\tthemeService   = \"http://settings-theme.holm:8080\"\n\tbackupService  = \"http://settings-backup.holm:8080\"\n\trestoreService = \"http://settings-restore.holm:8080\"\n\ttabsService    = \"http://settings-tabs.holm:8080\"\n)\n\n// Version info\nconst (\n\tAppVersion   = \"2.1.0\"\n\tBuildDate    = \"2026-01-15\"\n\tAppName      = \"HolmOS Settings Hub\"\n)\n\n// Data structures\ntype ThemePreferences struct {\n\tTheme       string `json:\"theme\"`\n\tCompactMode bool   `json:\"compactMode\"`\n\tAnimations  bool   `json:\"animations\"`\n\tFontSize    int    `json:\"fontSize\"`\n\tAccentColor string `json:\"accentColor\"`\n}\n\ntype TabState struct {\n\tActiveTab string `json:\"activeTab\"`\n}\n\ntype NotificationSettings struct {\n\tEnabled       bool `json:\"enabled\"`\n\tSound         bool `json:\"sound\"`\n\tDesktop       bool `json:\"desktop\"`\n\tEmail         bool `json:\"email\"`\n\tBuildAlerts   bool `json:\"buildAlerts\"`\n\tClusterAlerts bool `json:\"clusterAlerts\"`\n}\n\ntype UserPreferences struct {\n\tLanguage     string `json:\"language\"`\n\tTimezone     string `json:\"timezone\"`\n\tDateFormat   string `json:\"dateFormat\"`\n\tAutoSave     bool   `json:\"autoSave\"`\n\tShowHidden   bool   `json:\"showHidden\"`\n\tDefaultView  string `json:\"defaultView\"`\n}\n\ntype SystemInfo struct {\n\tNodes      []NodeInfo    `json:\"nodes\"`\n\tPods       PodSummary    `json:\"pods\"`\n\tServices   int           `json:\"services\"`\n\tNamespaces int           `json:\"namespaces\"`\n\tStorage    []StorageInfo `json:\"storage\"`\n\tUptime     string        `json:\"uptime\"`\n}\n\ntype NodeInfo struct {\n\tName      string `json:\"name\"`\n\tStatus    string `json:\"status\"`\n\tRole      string `json:\"role\"`\n\tCPU       string `json:\"cpu\"`\n\tMemory    string `json:\"memory\"`\n\tAge       string `json:\"age\"`\n\tArch      string `json:\"arch\"`\n}\n\ntype PodSummary struct {\n\tTotal     int `json:\"total\"`\n\tRunning   int `json:\"running\"`\n\tPending   int `json:\"pending\"`\n\tFailed    int `json:\"failed\"`\n\tCompleted int `json:\"completed\"`\n}\n\ntype StorageInfo struct {\n\tName      string `json:\"name\"`\n\tSize      string `json:\"size\"`\n\tUsed      string `json:\"used\"`\n\tAvailable string `json:\"available\"`\n\tPercent   string `json:\"percent\"`\n\tMount     string `json:\"mount\"`\n}\n\ntype AboutInfo struct {\n\tAppName      string `json:\"appName\"`\n\tVersion      string `json:\"version\"`\n\tBuildDate    string `json:\"buildDate\"`\n\tGoVersion    string `json:\"goVersion\"`\n\tPlatform     string `json:\"platform\"`\n\tArchitecture string `json:\"architecture\"`\n\tHostname     string `json:\"hostname\"`\n\tServices     []ServiceStatus `json:\"services\"`\n}\n\ntype ServiceStatus struct {\n\tName   string `json:\"name\"`\n\tStatus string `json:\"status\"`\n\tPort   string `json:\"port\"`\n}\n\nvar (\n\tnotificationSettings = NotificationSettings{\n\t\tEnabled:       true,\n\t\tSound:         true,\n\t\tDesktop:       true,\n\t\tEmail:         false,\n\t\tBuildAlerts:   true,\n\t\tClusterAlerts: true,\n\t}\n\tuserPreferences = UserPreferences{\n\t\tLanguage:    \"en\",\n\t\tTimezone:    \"America/Los_Angeles\",\n\t\tDateFormat:  \"YYYY-MM-DD\",\n\t\tAutoSave:    true,\n\t\tShowHidden:  false,\n\t\tDefaultView: \"grid\",\n\t}\n)\n\nfunc main() {\n\thttp.HandleFunc(\"/\", serveUI)\n\thttp.HandleFunc(\"/health\", healthHandler)\n\t\n\t// Theme endpoints\n\thttp.HandleFunc(\"/api/theme/preferences\", themeHandler)\n\thttp.HandleFunc(\"/api/theme/apply\", themeApplyHandler)\n\t\n\t// Backup/Restore endpoints\n\thttp.HandleFunc(\"/api/backup/export\", backupExportHandler)\n\thttp.HandleFunc(\"/api/backup/list\", backupListHandler)\n\thttp.HandleFunc(\"/api/restore/import\", restoreImportHandler)\n\thttp.HandleFunc(\"/api/restore/validate\", restoreValidateHandler)\n\t\n\t// Tabs state endpoints\n\thttp.HandleFunc(\"/api/tabs/state\", tabsHandler)\n\t\n\t// System info endpoints\n\thttp.HandleFunc(\"/api/system/info\", systemInfoHandler)\n\thttp.HandleFunc(\"/api/system/nodes\", nodesHandler)\n\thttp.HandleFunc(\"/api/system/pods\", podsHandler)\n\thttp.HandleFunc(\"/api/system/storage\", storageHandler)\n\t\n\t// User preferences endpoints\n\thttp.HandleFunc(\"/api/user/preferences\", userPreferencesHandler)\n\t\n\t// Notification endpoints\n\thttp.HandleFunc(\"/api/notifications/settings\", notificationHandler)\n\t\n\t// About endpoint\n\thttp.HandleFunc(\"/api/about\", aboutHandler)\n\t\n\tport := os.Getenv(\"PORT\")\n\tif port == \"\" {\n\t\tport = \"8080\"\n\t}\n\t\n\tlog.Printf(\"Settings Web (Central Hub) v%s starting on port %s\", AppVersion, port)\n\tlog.Fatal(http.ListenAndServe(\":\"+port, nil))\n}\n\nfunc healthHandler(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(map[string]string{\n\t\t\"status\":  \"healthy\",\n\t\t\"service\": \"settings-web\",\n\t\t\"version\": AppVersion,\n\t})\n}\n\nfunc aboutHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\thostname, _ := os.Hostname()\n\t\n\t// Check service status\n\tservices := []ServiceStatus{\n\t\tcheckService(\"settings-theme\", themeService),\n\t\tcheckService(\"settings-backup\", backupService),\n\t\tcheckService(\"settings-restore\", restoreService),\n\t\tcheckService(\"settings-tabs\", tabsService),\n\t}\n\t\n\tabout := AboutInfo{\n\t\tAppName:      AppName,\n\t\tVersion:      AppVersion,\n\t\tBuildDate:    BuildDate,\n\t\tGoVersion:    runtime.Version(),\n\t\tPlatform:     runtime.GOOS,\n\t\tArchitecture: runtime.GOARCH,\n\t\tHostname:     hostname,\n\t\tServices:     services,\n\t}\n\t\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(about)\n}\n\nfunc checkService(name, url string) ServiceStatus {\n\tstatus := \"offline\"\n\tclient := \u0026http.Client{Timeout: 2 * time.Second}\n\tresp, err := client.Get(url + \"/health\")\n\tif err == nil {\n\t\tdefer resp.Body.Close()\n\t\tif resp.StatusCode == 200 {\n\t\t\tstatus = \"online\"\n\t\t}\n\t}\n\t\n\tport := \"8080\"\n\treturn ServiceStatus{Name: name, Status: status, Port: port}\n}\n\n// Theme handlers - proxy to settings-theme service\nfunc themeHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method == \"GET\" {\n\t\tresp, err := http.Get(themeService + \"/preferences\")\n\t\tif err != nil {\n\t\t\t// Return defaults\n\t\t\tjson.NewEncoder(w).Encode(ThemePreferences{\n\t\t\t\tTheme:       \"mocha\",\n\t\t\t\tCompactMode: false,\n\t\t\t\tAnimations:  true,\n\t\t\t\tFontSize:    16,\n\t\t\t\tAccentColor: \"lavender\",\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\tdefer resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t\treturn\n\t}\n\t\n\tif r.Method == \"POST\" {\n\t\tbody, _ := io.ReadAll(r.Body)\n\t\tresp, err := http.Post(themeService+\"/preferences\", \"application/json\", bytes.NewReader(body))\n\t\tif err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\t\treturn\n\t\t}\n\t\tdefer resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t}\n}\n\nfunc themeApplyHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tbody, _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(themeService+\"/apply\", \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"status\": \"ok\", \"applied\": true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\n// Backup handlers - proxy to settings-backup service\nfunc backupExportHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tresp, err := http.Get(backupService + \"/export\")\n\tif err != nil {\n\t\t// Return mock data on error\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\n\t\t\t\"version\":     AppVersion,\n\t\t\t\"exportDate\":  time.Now().Format(time.RFC3339),\n\t\t\t\"theme\":       \"mocha\",\n\t\t\t\"preferences\": userPreferences,\n\t\t\t\"notifications\": notificationSettings,\n\t\t})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tio.Copy(w, resp.Body)\n}\n\nfunc backupListHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tresp, err := http.Get(backupService + \"/list\")\n\tif err != nil {\n\t\t// Return empty list\n\t\tjson.NewEncoder(w).Encode([]map[string]string{})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\n// Restore handlers - proxy to settings-restore service\nfunc restoreImportHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method != \"POST\" {\n\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n\t\treturn\n\t}\n\t\n\tbody, _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(restoreService+\"/import\", \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\t// Return success on error for demo\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"status\": \"ok\", \"imported\": true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\nfunc restoreValidateHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tbody, _ := io.ReadAll(r.Body)\n\tresp, err := http.Post(restoreService+\"/validate\", \"application/json\", bytes.NewReader(body))\n\tif err != nil {\n\t\tjson.NewEncoder(w).Encode(map[string]interface{}{\"valid\": true})\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tio.Copy(w, resp.Body)\n}\n\n// Tabs handlers - proxy to settings-tabs service\nfunc tabsHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method == \"GET\" {\n\t\tresp, err := http.Get(tabsService + \"/state\")\n\t\tif err != nil {\n\t\t\tjson.NewEncoder(w).Encode(TabState{ActiveTab: \"system\"})\n\t\t\treturn\n\t\t}\n\t\tdefer resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t\treturn\n\t}\n\t\n\tif r.Method == \"POST\" {\n\t\tbody, _ := io.ReadAll(r.Body)\n\t\tresp, err := http.Post(tabsService+\"/state\", \"application/json\", bytes.NewReader(body))\n\t\tif err != nil {\n\t\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\": \"ok\"})\n\t\t\treturn\n\t\t}\n\t\tdefer resp.Body.Close()\n\t\tio.Copy(w, resp.Body)\n\t}\n}\n\n// System info handlers\nfunc systemInfoHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tinfo := getSystemInfo()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(info)\n}\n\nfunc nodesHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tnodes := getNodeInfo()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(nodes)\n}\n\nfunc podsHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tpods := getPodSummary()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(pods)\n}\n\nfunc storageHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tstorage := getStorageInfo()\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(storage)\n}\n\n// User preferences handlers\nfunc userPreferencesHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method == \"GET\" {\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(userPreferences)\n\t\treturn\n\t}\n\t\n\tif r.Method == \"POST\" {\n\t\tvar prefs UserPreferences\n\t\tif err := json.NewDecoder(r.Body).Decode(\u0026prefs); err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\t\tuserPreferences = prefs\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\": \"ok\"})\n\t}\n}\n\n// Notification handlers\nfunc notificationHandler(w http.ResponseWriter, r *http.Request) {\n\tsetCORS(w)\n\tif r.Method == \"OPTIONS\" {\n\t\treturn\n\t}\n\t\n\tif r.Method == \"GET\" {\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(notificationSettings)\n\t\treturn\n\t}\n\t\n\tif r.Method == \"POST\" {\n\t\tvar settings NotificationSettings\n\t\tif err := json.NewDecoder(r.Body).Decode(\u0026settings); err != nil {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t\treturn\n\t\t}\n\t\tnotificationSettings = settings\n\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n\t\tjson.NewEncoder(w).Encode(map[string]string{\"status\": \"ok\"})\n\t}\n}\n\nfunc setCORS(w http.ResponseWriter) {\n\tw.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\tw.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\")\n\tw.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n}\n\nfunc getSystemInfo() SystemInfo {\n\tnodes := getNodeInfo()\n\tpods := getPodSummary()\n\tstorage := getStorageInfo()\n\t\n\tserviceCount := 0\n\tnsCount := 0\n\t\n\t// Get service count\n\tcmd := exec.Command(\"kubectl\", \"get\", \"svc\", \"--all-namespaces\", \"--no-headers\")\n\tif out, err := cmd.Output(); err == nil {\n\t\tlines := strings.Split(strings.TrimSpace(string(out)), \"\\n\")\n\t\tif len(lines) \u003e 0 \u0026\u0026 lines[0] != \"\" {\n\t\t\tserviceCount = len(lines)\n\t\t}\n\t}\n\t\n\t// Get namespace count\n\tcmd = exec.Command(\"kubectl\", \"get\", \"ns\", \"--no-headers\")\n\tif out, err := cmd.Output(); err == nil {\n\t\tlines := strings.Split(strings.TrimSpace(string(out)), \"\\n\")\n\t\tif len(lines) \u003e 0 \u0026\u0026 lines[0] != \"\" {\n\t\t\tnsCount = len(lines)\n\t\t}\n\t}\n\t\n\treturn SystemInfo{\n\t\tNodes:      nodes,\n\t\tPods:       pods,\n\t\tServices:   serviceCount,\n\t\tNamespaces: nsCount,\n\t\tStorage:    storage,\n\t\tUptime:     getUptime(),\n\t}\n}\n\nfunc getNodeInfo() []NodeInfo {\n\tvar nodes []NodeInfo\n\t\n\tcmd := exec.Command(\"kubectl\", \"get\", \"nodes\", \"-o\", \"json\")\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\treturn nodes\n\t}\n\t\n\tvar result struct {\n\t\tItems []struct {\n\t\t\tMetadata struct {\n\t\t\t\tName              string            `json:\"name\"`\n\t\t\t\tLabels            map[string]string `json:\"labels\"`\n\t\t\t\tCreationTimestamp string            `json:\"creationTimestamp\"`\n\t\t\t} `json:\"metadata\"`\n\t\t\tStatus struct {\n\t\t\t\tConditions []struct {\n\t\t\t\t\tType   string `json:\"type\"`\n\t\t\t\t\tStatus string `json:\"status\"`\n\t\t\t\t} `json:\"conditions\"`\n\t\t\t\tCapacity struct {\n\t\t\t\t\tCPU    string `json:\"cpu\"`\n\t\t\t\t\tMemory string `json:\"memory\"`\n\t\t\t\t} `json:\"capacity\"`\n\t\t\t} `json:\"status\"`\n\t\t} `json:\"items\"`\n\t}\n\t\n\tif err := json.Unmarshal(out, \u0026result); err != nil {\n\t\treturn nodes\n\t}\n\t\n\tfor _, item := range result.Items {\n\t\tstatus := \"Unknown\"\n\t\tfor _, cond := range item.Status.Conditions {\n\t\t\tif cond.Type == \"Ready\" {\n\t\t\t\tif cond.Status == \"True\" {\n\t\t\t\t\tstatus = \"Ready\"\n\t\t\t\t} else {\n\t\t\t\t\tstatus = \"NotReady\"\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t\n\t\trole := \"worker\"\n\t\tif _, ok := item.Metadata.Labels[\"node-role.kubernetes.io/control-plane\"]; ok {\n\t\t\trole = \"control-plane\"\n\t\t}\n\t\t\n\t\tarch := item.Metadata.Labels[\"kubernetes.io/arch\"]\n\t\t\n\t\t// Calculate age\n\t\tage := \"unknown\"\n\t\tif t, err := time.Parse(time.RFC3339, item.Metadata.CreationTimestamp); err == nil {\n\t\t\tduration := time.Since(t)\n\t\t\tif duration.Hours() \u003c 24 {\n\t\t\t\tage = fmt.Sprintf(\"%.0fh\", duration.Hours())\n\t\t\t} else {\n\t\t\t\tage = fmt.Sprintf(\"%.0fd\", duration.Hours()/24)\n\t\t\t}\n\t\t}\n\t\t\n\t\tnodes = append(nodes, NodeInfo{\n\t\t\tName:   item.Metadata.Name,\n\t\t\tStatus: status,\n\t\t\tRole:   role,\n\t\t\tCPU:    item.Status.Capacity.CPU,\n\t\t\tMemory: item.Status.Capacity.Memory,\n\t\t\tAge:    age,\n\t\t\tArch:   arch,\n\t\t})\n\t}\n\t\n\treturn nodes\n}\n\nfunc getPodSummary() PodSummary {\n\tsummary := PodSummary{}\n\t\n\tcmd := exec.Command(\"kubectl\", \"get\", \"pods\", \"--all-namespaces\", \"-o\", \"json\")\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\treturn summary\n\t}\n\t\n\tvar result struct {\n\t\tItems []struct {\n\t\t\tStatus struct {\n\t\t\t\tPhase string `json:\"phase\"`\n\t\t\t} `json:\"status\"`\n\t\t} `json:\"items\"`\n\t}\n\t\n\tif err := json.Unmarshal(out, \u0026result); err != nil {\n\t\treturn summary\n\t}\n\t\n\tsummary.Total = len(result.Items)\n\tfor _, item := range result.Items {\n\t\tswitch item.Status.Phase {\n\t\tcase \"Running\":\n\t\t\tsummary.Running++\n\t\tcase \"Pending\":\n\t\t\tsummary.Pending++\n\t\tcase \"Failed\":\n\t\t\tsummary.Failed++\n\t\tcase \"Succeeded\":\n\t\t\tsummary.Completed++\n\t\t}\n\t}\n\t\n\treturn summary\n}\n\nfunc getStorageInfo() []StorageInfo {\n\tvar storage []StorageInfo\n\t\n\tcmd := exec.Command(\"df\", \"-h\")\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\treturn storage\n\t}\n\t\n\tlines := strings.Split(string(out), \"\\n\")\n\tfor _, line := range lines[1:] {\n\t\tfields := strings.Fields(line)\n\t\tif len(fields) \u003e= 6 {\n\t\t\t// Skip tmpfs and small filesystems\n\t\t\tif strings.HasPrefix(fields[0], \"tmpfs\") || strings.HasPrefix(fields[0], \"shm\") {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tstorage = append(storage, StorageInfo{\n\t\t\t\tName:      fields[0],\n\t\t\t\tSize:      fields[1],\n\t\t\t\tUsed:      fields[2],\n\t\t\t\tAvailable: fields[3],\n\t\t\t\tPercent:   fields[4],\n\t\t\t\tMount:     fields[5],\n\t\t\t})\n\t\t}\n\t}\n\t\n\treturn storage\n}\n\nfunc getUptime() string {\n\tcmd := exec.Command(\"uptime\", \"-p\")\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\treturn \"unknown\"\n\t}\n\treturn strings.TrimSpace(string(out))\n}\n\nfunc serveUI(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path != \"/\" {\n\t\thttp.NotFound(w, r)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\tfmt.Fprint(w, settingsHTML)\n}\n\nvar settingsHTML = `\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\u003e\n    \u003ctitle\u003eSettings - HolmOS\u003c/title\u003e\n    \u003cstyle\u003e\n        /* Catppuccin Mocha (Default) */\n        :root {\n            --ctp-base: #1e1e2e;\n            --ctp-mantle: #181825;\n            --ctp-crust: #11111b;\n            --ctp-surface0: #313244;\n            --ctp-surface1: #45475a;\n            --ctp-surface2: #585b70;\n            --ctp-overlay0: #6c7086;\n            --ctp-overlay1: #7f849c;\n            --ctp-text: #cdd6f4;\n            --ctp-subtext0: #a6adc8;\n            --ctp-subtext1: #bac2de;\n            --ctp-lavender: #b4befe;\n            --ctp-blue: #89b4fa;\n            --ctp-sapphire: #74c7ec;\n            --ctp-sky: #89dceb;\n            --ctp-teal: #94e2d5;\n            --ctp-green: #a6e3a1;\n            --ctp-yellow: #f9e2af;\n            --ctp-peach: #fab387;\n            --ctp-maroon: #eba0ac;\n            --ctp-red: #f38ba8;\n            --ctp-mauve: #cba6f7;\n            --ctp-pink: #f5c2e7;\n            --ctp-flamingo: #f2cdcd;\n            --ctp-rosewater: #f5e0dc;\n        }\n\n        /* Catppuccin Latte (Light) */\n        .theme-latte {\n            --ctp-base: #eff1f5;\n            --ctp-mantle: #e6e9ef;\n            --ctp-crust: #dce0e8;\n            --ctp-surface0: #ccd0da;\n            --ctp-surface1: #bcc0cc;\n            --ctp-surface2: #acb0be;\n            --ctp-overlay0: #9ca0b0;\n            --ctp-overlay1: #8c8fa1;\n            --ctp-text: #4c4f69;\n            --ctp-subtext0: #6c6f85;\n            --ctp-subtext1: #5c5f77;\n            --ctp-lavender: #7287fd;\n            --ctp-blue: #1e66f5;\n            --ctp-sapphire: #209fb5;\n            --ctp-sky: #04a5e5;\n            --ctp-teal: #179299;\n            --ctp-green: #40a02b;\n            --ctp-yellow: #df8e1d;\n            --ctp-peach: #fe640b;\n            --ctp-maroon: #e64553;\n            --ctp-red: #d20f39;\n            --ctp-mauve: #8839ef;\n            --ctp-pink: #ea76cb;\n            --ctp-flamingo: #dd7878;\n            --ctp-rosewater: #dc8a78;\n        }\n\n        /* Catppuccin Frappe */\n        .theme-frappe {\n            --ctp-base: #303446;\n            --ctp-mantle: #292c3c;\n            --ctp-crust: #232634;\n            --ctp-surface0: #414559;\n            --ctp-surface1: #51576d;\n            --ctp-surface2: #626880;\n            --ctp-overlay0: #737994;\n            --ctp-overlay1: #838ba7;\n            --ctp-text: #c6d0f5;\n            --ctp-subtext0: #a5adce;\n            --ctp-subtext1: #b5bfe2;\n            --ctp-lavender: #babbf1;\n            --ctp-blue: #8caaee;\n            --ctp-sapphire: #85c1dc;\n            --ctp-sky: #99d1db;\n            --ctp-teal: #81c8be;\n            --ctp-green: #a6d189;\n            --ctp-yellow: #e5c890;\n            --ctp-peach: #ef9f76;\n            --ctp-maroon: #ea999c;\n            --ctp-red: #e78284;\n            --ctp-mauve: #ca9ee6;\n            --ctp-pink: #f4b8e4;\n            --ctp-flamingo: #eebebe;\n            --ctp-rosewater: #f2d5cf;\n        }\n\n        /* Catppuccin Macchiato */\n        .theme-macchiato {\n            --ctp-base: #24273a;\n            --ctp-mantle: #1e2030;\n            --ctp-crust: #181926;\n            --ctp-surface0: #363a4f;\n            --ctp-surface1: #494d64;\n            --ctp-surface2: #5b6078;\n            --ctp-overlay0: #6e738d;\n            --ctp-overlay1: #8087a2;\n            --ctp-text: #cad3f5;\n            --ctp-subtext0: #a5adcb;\n            --ctp-subtext1: #b8c0e0;\n            --ctp-lavender: #b7bdf8;\n            --ctp-blue: #8aadf4;\n            --ctp-sapphire: #7dc4e4;\n            --ctp-sky: #91d7e3;\n            --ctp-teal: #8bd5ca;\n            --ctp-green: #a6da95;\n            --ctp-yellow: #eed49f;\n            --ctp-peach: #f5a97f;\n            --ctp-maroon: #ee99a0;\n            --ctp-red: #ed8796;\n            --ctp-mauve: #c6a0f6;\n            --ctp-pink: #f5bde6;\n            --ctp-flamingo: #f0c6c6;\n            --ctp-rosewater: #f4dbd6;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"SF Pro Display\", \"Segoe UI\", Roboto, sans-serif;\n            background-color: var(--ctp-base);\n            color: var(--ctp-text);\n            min-height: 100vh;\n            display: flex;\n            flex-direction: column;\n            padding-bottom: 80px;\n            transition: all 0.3s ease;\n            -webkit-font-smoothing: antialiased;\n        }\n\n        /* iOS-style Header */\n        .header {\n            background-color: var(--ctp-mantle);\n            padding: 12px 16px;\n            border-bottom: 1px solid var(--ctp-surface0);\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            position: sticky;\n            top: 0;\n            z-index: 100;\n            backdrop-filter: blur(20px);\n            -webkit-backdrop-filter: blur(20px);\n        }\n\n        .header-icon {\n            width: 36px; height: 36px;\n            background: linear-gradient(135deg, var(--ctp-mauve), var(--ctp-blue));\n            border-radius: 10px;\n            display: flex; align-items: center; justify-content: center;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        }\n\n        .header h1 { font-size: 1.35rem; font-weight: 600; letter-spacing: -0.3px; }\n        .header small { color: var(--ctp-subtext0); font-size: 0.8rem; margin-left: auto; }\n\n        /* iOS-style Settings List */\n        .settings-list {\n            padding: 0 16px;\n            margin-top: 20px;\n        }\n\n        .settings-group {\n            background-color: var(--ctp-surface0);\n            border-radius: 12px;\n            margin-bottom: 20px;\n            overflow: hidden;\n        }\n\n        .settings-group-title {\n            font-size: 0.75rem;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            color: var(--ctp-subtext0);\n            padding: 8px 16px 6px;\n            margin-bottom: 0;\n        }\n\n        .settings-item {\n            display: flex;\n            align-items: center;\n            padding: 12px 16px;\n            border-bottom: 1px solid var(--ctp-surface1);\n            cursor: pointer;\n            transition: background-color 0.15s ease;\n            gap: 12px;\n        }\n\n        .settings-item:last-child { border-bottom: none; }\n        .settings-item:active { background-color: var(--ctp-surface1); }\n\n        .settings-icon {\n            width: 32px; height: 32px;\n            border-radius: 8px;\n            display: flex; align-items: center; justify-content: center;\n            flex-shrink: 0;\n        }\n\n        .settings-icon.system { background: linear-gradient(135deg, #6c7086, #9ca0b0); }\n        .settings-icon.theme { background: linear-gradient(135deg, #cba6f7, #f5c2e7); }\n        .settings-icon.prefs { background: linear-gradient(135deg, #89b4fa, #74c7ec); }\n        .settings-icon.notif { background: linear-gradient(135deg, #f38ba8, #fab387); }\n        .settings-icon.backup { background: linear-gradient(135deg, #a6e3a1, #94e2d5); }\n        .settings-icon.about { background: linear-gradient(135deg, #89dceb, #b4befe); }\n\n        .settings-label {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            gap: 2px;\n        }\n\n        .settings-label span { font-weight: 500; font-size: 1rem; }\n        .settings-label small { color: var(--ctp-subtext0); font-size: 0.8rem; }\n\n        .settings-arrow {\n            color: var(--ctp-overlay0);\n            display: flex;\n            align-items: center;\n        }\n\n        .settings-badge {\n            background-color: var(--ctp-red);\n            color: var(--ctp-crust);\n            font-size: 0.7rem;\n            font-weight: 600;\n            padding: 2px 6px;\n            border-radius: 10px;\n            margin-right: 8px;\n        }\n\n        /* Panel Views */\n        .panel {\n            display: none;\n            animation: slideIn 0.3s ease;\n        }\n\n        .panel.active { display: block; }\n\n        @keyframes slideIn {\n            from { opacity: 0; transform: translateX(20px); }\n            to { opacity: 1; transform: translateX(0); }\n        }\n\n        .panel-header {\n            display: flex;\n            align-items: center;\n            padding: 12px 16px;\n            background-color: var(--ctp-mantle);\n            border-bottom: 1px solid var(--ctp-surface0);\n            position: sticky;\n            top: 0;\n            z-index: 100;\n            backdrop-filter: blur(20px);\n        }\n\n        .back-btn {\n            display: flex;\n            align-items: center;\n            gap: 4px;\n            color: var(--ctp-blue);\n            font-size: 1rem;\n            cursor: pointer;\n            background: none;\n            border: none;\n            padding: 0;\n        }\n\n        .panel-title {\n            flex: 1;\n            text-align: center;\n            font-weight: 600;\n            font-size: 1.1rem;\n        }\n\n        .panel-content { padding: 16px; }\n\n        /* Section styling */\n        .section {\n            background-color: var(--ctp-surface0);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n\n        .section-title {\n            font-size: 0.9rem;\n            font-weight: 600;\n            margin-bottom: 12px;\n            color: var(--ctp-lavender);\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .setting-row {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 0;\n            border-bottom: 1px solid var(--ctp-surface1);\n        }\n        .setting-row:last-child { border-bottom: none; }\n\n        .setting-label-inner { display: flex; flex-direction: column; gap: 2px; }\n        .setting-label-inner span { font-weight: 500; font-size: 0.95rem; }\n        .setting-label-inner small { color: var(--ctp-subtext0); font-size: 0.8rem; }\n\n        /* iOS Toggle Switch */\n        .toggle {\n            position: relative;\n            width: 51px; height: 31px;\n            background-color: var(--ctp-surface2);\n            border-radius: 15.5px;\n            cursor: pointer;\n            transition: background-color 0.25s ease;\n        }\n        .toggle.active { background-color: var(--ctp-green); }\n        .toggle::after {\n            content: \"\";\n            position: absolute;\n            top: 2px; left: 2px;\n            width: 27px; height: 27px;\n            background-color: #fff;\n            border-radius: 50%;\n            transition: transform 0.25s ease;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        }\n        .toggle.active::after { transform: translateX(20px); }\n\n        /* Form elements */\n        select {\n            background-color: var(--ctp-surface1);\n            border: none;\n            border-radius: 8px;\n            padding: 8px 12px;\n            color: var(--ctp-text);\n            font-size: 0.9rem;\n            min-width: 140px;\n            -webkit-appearance: none;\n            appearance: none;\n            cursor: pointer;\n        }\n\n        /* Buttons */\n        .btn {\n            padding: 12px 24px;\n            border: none;\n            border-radius: 10px;\n            font-size: 0.95rem;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .btn-primary { background-color: var(--ctp-blue); color: #fff; }\n        .btn-primary:active { background-color: var(--ctp-sapphire); transform: scale(0.98); }\n        .btn-secondary { background-color: var(--ctp-surface1); color: var(--ctp-text); }\n        .btn-danger { background-color: var(--ctp-red); color: #fff; }\n        .btn-success { background-color: var(--ctp-green); color: var(--ctp-crust); }\n        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }\n\n        /* Info cards */\n        .info-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 10px;\n        }\n\n        .info-card {\n            background-color: var(--ctp-surface1);\n            border-radius: 10px;\n            padding: 14px;\n            text-align: center;\n        }\n        .info-card .value { font-size: 1.5rem; font-weight: 700; color: var(--ctp-lavender); }\n        .info-card .label { font-size: 0.75rem; color: var(--ctp-subtext0); margin-top: 4px; }\n\n        /* Theme Grid */\n        .theme-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n        }\n\n        .theme-option {\n            border-radius: 12px;\n            padding: 16px;\n            cursor: pointer;\n            border: 3px solid transparent;\n            transition: all 0.2s ease;\n        }\n        .theme-option:active { transform: scale(0.98); }\n        .theme-option.selected { border-color: var(--ctp-lavender); }\n        .theme-option .colors { display: flex; gap: 6px; margin-bottom: 10px; }\n        .theme-option .colors div { width: 20px; height: 20px; border-radius: 50%; }\n        .theme-option .theme-name { font-weight: 600; font-size: 0.9rem; }\n\n        /* Node/Storage list */\n        .item-list { max-height: 300px; overflow-y: auto; }\n\n        .list-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 14px;\n            background-color: var(--ctp-surface1);\n            border-radius: 10px;\n            margin-bottom: 8px;\n        }\n\n        .item-info { display: flex; flex-direction: column; gap: 2px; }\n        .item-name { font-weight: 500; }\n        .item-details { font-size: 0.8rem; color: var(--ctp-subtext0); }\n\n        .status-badge {\n            display: inline-flex;\n            align-items: center;\n            gap: 4px;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        .status-ready { background-color: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .status-notready { background-color: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n        .status-online { background-color: rgba(166, 227, 161, 0.2); color: var(--ctp-green); }\n        .status-offline { background-color: rgba(243, 139, 168, 0.2); color: var(--ctp-red); }\n\n        .progress-bar {\n            width: 80px; height: 8px;\n            background-color: var(--ctp-surface2);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n        .progress-fill {\n            height: 100%;\n            background-color: var(--ctp-green);\n            transition: width 0.3s ease;\n        }\n        .progress-fill.warning { background-color: var(--ctp-yellow); }\n        .progress-fill.danger { background-color: var(--ctp-red); }\n\n        /* File input */\n        .file-input { display: none; }\n        .file-label {\n            display: inline-flex;\n            align-items: center;\n            gap: 8px;\n            padding: 12px 20px;\n            background-color: var(--ctp-surface1);\n            border-radius: 10px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        .file-label:active { background-color: var(--ctp-surface2); transform: scale(0.98); }\n\n        /* About section */\n        .about-header {\n            text-align: center;\n            padding: 30px 20px;\n        }\n\n        .about-logo {\n            width: 80px; height: 80px;\n            background: linear-gradient(135deg, var(--ctp-mauve), var(--ctp-blue));\n            border-radius: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.3);\n        }\n\n        .about-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px; }\n        .about-version { color: var(--ctp-subtext0); font-size: 0.9rem; }\n\n        .about-info-row {\n            display: flex;\n            justify-content: space-between;\n            padding: 12px 0;\n            border-bottom: 1px solid var(--ctp-surface1);\n        }\n        .about-info-row:last-child { border-bottom: none; }\n        .about-info-label { color: var(--ctp-subtext0); }\n        .about-info-value { font-weight: 500; }\n\n        /* Dock */\n        .dock {\n            position: fixed;\n            bottom: 0; left: 0; right: 0;\n            background-color: var(--ctp-mantle);\n            border-top: 1px solid var(--ctp-surface0);\n            padding: 8px 16px 20px;\n            display: flex;\n            justify-content: space-around;\n            align-items: center;\n            z-index: 1000;\n            backdrop-filter: blur(20px);\n            -webkit-backdrop-filter: blur(20px);\n        }\n\n        .dock-item {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 4px;\n            text-decoration: none;\n            color: var(--ctp-subtext0);\n            padding: 6px 16px;\n            border-radius: 10px;\n            transition: all 0.2s ease;\n        }\n        .dock-item:active { transform: scale(0.95); }\n        .dock-item.active { color: var(--ctp-lavender); }\n        .dock-icon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }\n        .dock-label { font-size: 0.7rem; font-weight: 500; }\n\n        /* Toast */\n        .toast {\n            position: fixed;\n            bottom: 100px; left: 50%;\n            transform: translateX(-50%);\n            background-color: var(--ctp-surface0);\n            color: var(--ctp-text);\n            padding: 12px 24px;\n            border-radius: 12px;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);\n            z-index: 1001;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n            font-weight: 500;\n        }\n        .toast.show { opacity: 1; }\n        .toast.success { border-left: 4px solid var(--ctp-green); }\n        .toast.error { border-left: 4px solid var(--ctp-red); }\n\n        @media (max-width: 600px) {\n            .info-grid { grid-template-columns: repeat(2, 1fr); }\n            .theme-grid { grid-template-columns: 1fr 1fr; }\n        }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003c!-- Main Menu --\u003e\n    \u003cdiv id=\"main-menu\" class=\"panel active\"\u003e\n        \u003cdiv class=\"header\"\u003e\n            \u003cdiv class=\"header-icon\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                    \u003ccircle cx=\"12\" cy=\"12\" r=\"3\"\u003e\u003c/circle\u003e\n                    \u003cpath d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\u003e\u003c/path\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n            \u003ch1\u003eSettings\u003c/h1\u003e\n            \u003csmall id=\"version-badge\"\u003ev2.1\u003c/small\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class=\"settings-list\"\u003e\n            \u003cdiv class=\"settings-group\"\u003e\n                \u003cdiv class=\"settings-item\" data-panel=\"system\"\u003e\n                    \u003cdiv class=\"settings-icon system\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003crect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\"\u003e\u003c/rect\u003e\n                            \u003cline x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"\u003e\u003c/line\u003e\n                            \u003cline x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"\u003e\u003c/line\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003eSystem\u003c/span\u003e\n                        \u003csmall\u003eCluster info, nodes, storage\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n\n                \u003cdiv class=\"settings-item\" data-panel=\"theme\"\u003e\n                    \u003cdiv class=\"settings-icon theme\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003ccircle cx=\"12\" cy=\"12\" r=\"5\"\u003e\u003c/circle\u003e\n                            \u003cline x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\"\u003e\u003c/line\u003e\n                            \u003cline x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\"\u003e\u003c/line\u003e\n                            \u003cline x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"\u003e\u003c/line\u003e\n                            \u003cline x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"\u003e\u003c/line\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003eAppearance\u003c/span\u003e\n                        \u003csmall\u003eTheme, colors, display\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n\n                \u003cdiv class=\"settings-item\" data-panel=\"prefs\"\u003e\n                    \u003cdiv class=\"settings-icon prefs\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003cpath d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"\u003e\u003c/path\u003e\n                            \u003ccircle cx=\"12\" cy=\"7\" r=\"4\"\u003e\u003c/circle\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003ePreferences\u003c/span\u003e\n                        \u003csmall\u003eLanguage, timezone, file options\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n\n                \u003cdiv class=\"settings-item\" data-panel=\"notifications\"\u003e\n                    \u003cdiv class=\"settings-icon notif\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003cpath d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\"\u003e\u003c/path\u003e\n                            \u003cpath d=\"M13.73 21a2 2 0 0 1-3.46 0\"\u003e\u003c/path\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003eNotifications\u003c/span\u003e\n                        \u003csmall\u003eAlerts and notification settings\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"settings-group\"\u003e\n                \u003cdiv class=\"settings-item\" data-panel=\"backup\"\u003e\n                    \u003cdiv class=\"settings-icon backup\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003cpath d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"\u003e\u003c/path\u003e\n                            \u003cpolyline points=\"17 8 12 3 7 8\"\u003e\u003c/polyline\u003e\n                            \u003cline x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"\u003e\u003c/line\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003eBackup \u0026 Restore\u003c/span\u003e\n                        \u003csmall\u003eExport and import settings\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n\n                \u003cdiv class=\"settings-item\" data-panel=\"about\"\u003e\n                    \u003cdiv class=\"settings-icon about\"\u003e\n                        \u003csvg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                            \u003ccircle cx=\"12\" cy=\"12\" r=\"10\"\u003e\u003c/circle\u003e\n                            \u003cline x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"\u003e\u003c/line\u003e\n                            \u003cline x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"\u003e\u003c/line\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-label\"\u003e\n                        \u003cspan\u003eAbout\u003c/span\u003e\n                        \u003csmall\u003eVersion, services, credits\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"settings-arrow\"\u003e\n                        \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                            \u003cpolyline points=\"9 18 15 12 9 6\"\u003e\u003c/polyline\u003e\n                        \u003c/svg\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- System Panel --\u003e\n    \u003cdiv id=\"system-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003eSystem\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eCluster Overview\u003c/h2\u003e\n                \u003cdiv class=\"info-grid\"\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"node-count\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eNodes\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"pod-running\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eRunning\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"service-count\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eServices\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"namespace-count\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eNamespaces\u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eCluster Nodes\u003c/h2\u003e\n                \u003cdiv class=\"item-list\" id=\"node-list\"\u003e\n                    \u003cdiv class=\"list-item\"\u003e\u003cdiv class=\"item-info\"\u003e\u003cspan class=\"item-name\"\u003eLoading...\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003ePod Status\u003c/h2\u003e\n                \u003cdiv class=\"info-grid\"\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"pod-total\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eTotal\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"pod-pending\" style=\"color: var(--ctp-yellow);\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003ePending\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"pod-failed\" style=\"color: var(--ctp-red);\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eFailed\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"info-card\"\u003e\n                        \u003cdiv class=\"value\" id=\"pod-completed\" style=\"color: var(--ctp-teal);\"\u003e-\u003c/div\u003e\n                        \u003cdiv class=\"label\"\u003eCompleted\u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eStorage\u003c/h2\u003e\n                \u003cdiv class=\"item-list\" id=\"storage-list\"\u003e\n                    \u003cdiv class=\"list-item\"\u003e\u003cdiv class=\"item-info\"\u003e\u003cspan class=\"item-name\"\u003eLoading...\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003cbutton class=\"btn btn-primary\" onclick=\"refreshSystemInfo()\" style=\"width: 100%;\"\u003eRefresh\u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Theme Panel --\u003e\n    \u003cdiv id=\"theme-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003eAppearance\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eCatppuccin Theme\u003c/h2\u003e\n                \u003cdiv class=\"theme-grid\"\u003e\n                    \u003cdiv class=\"theme-option selected\" data-theme=\"mocha\" style=\"background-color: #1e1e2e;\"\u003e\n                        \u003cdiv class=\"colors\"\u003e\n                            \u003cdiv style=\"background-color: #cba6f7;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #89b4fa;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #a6e3a1;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #f38ba8;\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"theme-name\" style=\"color: #cdd6f4;\"\u003eMocha\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"theme-option\" data-theme=\"macchiato\" style=\"background-color: #24273a;\"\u003e\n                        \u003cdiv class=\"colors\"\u003e\n                            \u003cdiv style=\"background-color: #c6a0f6;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #8aadf4;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #a6da95;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #ed8796;\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"theme-name\" style=\"color: #cad3f5;\"\u003eMacchiato\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"theme-option\" data-theme=\"frappe\" style=\"background-color: #303446;\"\u003e\n                        \u003cdiv class=\"colors\"\u003e\n                            \u003cdiv style=\"background-color: #ca9ee6;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #8caaee;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #a6d189;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #e78284;\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"theme-name\" style=\"color: #c6d0f5;\"\u003eFrappe\u003c/div\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"theme-option\" data-theme=\"latte\" style=\"background-color: #eff1f5;\"\u003e\n                        \u003cdiv class=\"colors\"\u003e\n                            \u003cdiv style=\"background-color: #8839ef;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #1e66f5;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #40a02b;\"\u003e\u003c/div\u003e\n                            \u003cdiv style=\"background-color: #d20f39;\"\u003e\u003c/div\u003e\n                        \u003c/div\u003e\n                        \u003cdiv class=\"theme-name\" style=\"color: #4c4f69;\"\u003eLatte\u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eDisplay Settings\u003c/h2\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eCompact Mode\u003c/span\u003e\n                        \u003csmall\u003eReduce spacing\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle\" data-setting=\"compact-mode\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eAnimations\u003c/span\u003e\n                        \u003csmall\u003eEnable transitions\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"animations\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eFont Size\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cselect id=\"font-size\"\u003e\n                        \u003coption value=\"14\"\u003eSmall\u003c/option\u003e\n                        \u003coption value=\"16\" selected\u003eMedium\u003c/option\u003e\n                        \u003coption value=\"18\"\u003eLarge\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eAccent Color\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cselect id=\"accent-color\"\u003e\n                        \u003coption value=\"lavender\" selected\u003eLavender\u003c/option\u003e\n                        \u003coption value=\"blue\"\u003eBlue\u003c/option\u003e\n                        \u003coption value=\"mauve\"\u003eMauve\u003c/option\u003e\n                        \u003coption value=\"pink\"\u003ePink\u003c/option\u003e\n                        \u003coption value=\"teal\"\u003eTeal\u003c/option\u003e\n                        \u003coption value=\"green\"\u003eGreen\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003cdiv class=\"btn-group\"\u003e\n                    \u003cbutton class=\"btn btn-primary\" onclick=\"saveTheme()\"\u003eApply\u003c/button\u003e\n                    \u003cbutton class=\"btn btn-secondary\" onclick=\"resetTheme()\"\u003eReset\u003c/button\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Preferences Panel --\u003e\n    \u003cdiv id=\"prefs-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003ePreferences\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eRegional\u003c/h2\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\u003cspan\u003eLanguage\u003c/span\u003e\u003c/div\u003e\n                    \u003cselect id=\"language\"\u003e\n                        \u003coption value=\"en\" selected\u003eEnglish\u003c/option\u003e\n                        \u003coption value=\"es\"\u003eSpanish\u003c/option\u003e\n                        \u003coption value=\"de\"\u003eGerman\u003c/option\u003e\n                        \u003coption value=\"fr\"\u003eFrench\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\u003cspan\u003eTimezone\u003c/span\u003e\u003c/div\u003e\n                    \u003cselect id=\"timezone\"\u003e\n                        \u003coption value=\"America/Los_Angeles\" selected\u003ePacific\u003c/option\u003e\n                        \u003coption value=\"America/Denver\"\u003eMountain\u003c/option\u003e\n                        \u003coption value=\"America/Chicago\"\u003eCentral\u003c/option\u003e\n                        \u003coption value=\"America/New_York\"\u003eEastern\u003c/option\u003e\n                        \u003coption value=\"UTC\"\u003eUTC\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\u003cspan\u003eDate Format\u003c/span\u003e\u003c/div\u003e\n                    \u003cselect id=\"date-format\"\u003e\n                        \u003coption value=\"YYYY-MM-DD\" selected\u003e2026-01-15\u003c/option\u003e\n                        \u003coption value=\"MM/DD/YYYY\"\u003e01/15/2026\u003c/option\u003e\n                        \u003coption value=\"DD/MM/YYYY\"\u003e15/01/2026\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eFile Manager\u003c/h2\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eAuto Save\u003c/span\u003e\n                        \u003csmall\u003eSave changes automatically\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"auto-save\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eShow Hidden Files\u003c/span\u003e\n                        \u003csmall\u003eDisplay dotfiles\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle\" data-setting=\"show-hidden\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\u003cspan\u003eDefault View\u003c/span\u003e\u003c/div\u003e\n                    \u003cselect id=\"default-view\"\u003e\n                        \u003coption value=\"grid\" selected\u003eGrid\u003c/option\u003e\n                        \u003coption value=\"list\"\u003eList\u003c/option\u003e\n                        \u003coption value=\"details\"\u003eDetails\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003cbutton class=\"btn btn-primary\" onclick=\"savePreferences()\" style=\"width: 100%;\"\u003eSave Preferences\u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Notifications Panel --\u003e\n    \u003cdiv id=\"notifications-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003eNotifications\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eGeneral\u003c/h2\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eEnable Notifications\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"notif-enabled\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eSound Alerts\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"notif-sound\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eDesktop Notifications\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"notif-desktop\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eEmail Notifications\u003c/span\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle\" data-setting=\"notif-email\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eAlert Types\u003c/h2\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eBuild Alerts\u003c/span\u003e\n                        \u003csmall\u003eBuild success/failure\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"alert-build\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"setting-row\"\u003e\n                    \u003cdiv class=\"setting-label-inner\"\u003e\n                        \u003cspan\u003eCluster Alerts\u003c/span\u003e\n                        \u003csmall\u003eNode status changes\u003c/small\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"toggle active\" data-setting=\"alert-cluster\"\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003cbutton class=\"btn btn-primary\" onclick=\"saveNotifications()\" style=\"width: 100%;\"\u003eSave Settings\u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Backup Panel --\u003e\n    \u003cdiv id=\"backup-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003eBackup \u0026 Restore\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eExport Settings\u003c/h2\u003e\n                \u003cp style=\"color: var(--ctp-subtext0); margin-bottom: 16px; font-size: 0.9rem;\"\u003e\n                    Download all HolmOS settings as a JSON file.\n                \u003c/p\u003e\n                \u003cbutton class=\"btn btn-primary\" onclick=\"exportSettings()\" style=\"width: 100%;\"\u003eExport All Settings\u003c/button\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eImport Settings\u003c/h2\u003e\n                \u003cp style=\"color: var(--ctp-subtext0); margin-bottom: 16px; font-size: 0.9rem;\"\u003e\n                    Restore settings from a backup file.\n                \u003c/p\u003e\n                \u003cinput type=\"file\" id=\"import-file\" class=\"file-input\" accept=\".json\" onchange=\"handleFileSelect(event)\" /\u003e\n                \u003clabel for=\"import-file\" class=\"file-label\" style=\"width: 100%; justify-content: center;\"\u003e\n                    \u003csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                        \u003cpath d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"\u003e\u003c/path\u003e\n                        \u003cpolyline points=\"14 2 14 8 20 8\"\u003e\u003c/polyline\u003e\n                    \u003c/svg\u003e\n                    Choose File\n                \u003c/label\u003e\n                \u003cdiv id=\"selected-file\" style=\"margin-top: 10px; color: var(--ctp-subtext0); font-size: 0.85rem; text-align: center;\"\u003e\u003c/div\u003e\n                \u003cbutton class=\"btn btn-success\" onclick=\"importSettings()\" id=\"import-btn\" disabled style=\"width: 100%; margin-top: 12px;\"\u003eImport\u003c/button\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\" style=\"border: 1px solid var(--ctp-red); background-color: rgba(243, 139, 168, 0.1);\"\u003e\n                \u003ch2 class=\"section-title\" style=\"color: var(--ctp-red);\"\u003eDanger Zone\u003c/h2\u003e\n                \u003cp style=\"color: var(--ctp-subtext0); margin-bottom: 16px; font-size: 0.9rem;\"\u003e\n                    Reset all settings to defaults. This cannot be undone.\n                \u003c/p\u003e\n                \u003cbutton class=\"btn btn-danger\" onclick=\"resetAllSettings()\" style=\"width: 100%;\"\u003eReset All Settings\u003c/button\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- About Panel --\u003e\n    \u003cdiv id=\"about-panel\" class=\"panel\"\u003e\n        \u003cdiv class=\"panel-header\"\u003e\n            \u003cbutton class=\"back-btn\" onclick=\"showPanel('main-menu')\"\u003e\n                \u003csvg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"15 18 9 12 15 6\"\u003e\u003c/polyline\u003e\n                \u003c/svg\u003e\n                Back\n            \u003c/button\u003e\n            \u003cspan class=\"panel-title\"\u003eAbout\u003c/span\u003e\n            \u003cspan style=\"width: 60px;\"\u003e\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"panel-content\"\u003e\n            \u003cdiv class=\"about-header\"\u003e\n                \u003cdiv class=\"about-logo\"\u003e\n                    \u003csvg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\"\u003e\n                        \u003ccircle cx=\"12\" cy=\"12\" r=\"3\"\u003e\u003c/circle\u003e\n                        \u003cpath d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\u003e\u003c/path\u003e\n                    \u003c/svg\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"about-name\"\u003eHolmOS\u003c/div\u003e\n                \u003cdiv class=\"about-version\" id=\"about-version\"\u003eSettings Hub v2.1.0\u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eSystem Information\u003c/h2\u003e\n                \u003cdiv class=\"about-info-row\"\u003e\n                    \u003cspan class=\"about-info-label\"\u003ePlatform\u003c/span\u003e\n                    \u003cspan class=\"about-info-value\" id=\"about-platform\"\u003e-\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"about-info-row\"\u003e\n                    \u003cspan class=\"about-info-label\"\u003eArchitecture\u003c/span\u003e\n                    \u003cspan class=\"about-info-value\" id=\"about-arch\"\u003e-\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"about-info-row\"\u003e\n                    \u003cspan class=\"about-info-label\"\u003eGo Version\u003c/span\u003e\n                    \u003cspan class=\"about-info-value\" id=\"about-go\"\u003e-\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"about-info-row\"\u003e\n                    \u003cspan class=\"about-info-label\"\u003eBuild Date\u003c/span\u003e\n                    \u003cspan class=\"about-info-value\" id=\"about-build\"\u003e-\u003c/span\u003e\n                \u003c/div\u003e\n                \u003cdiv class=\"about-info-row\"\u003e\n                    \u003cspan class=\"about-info-label\"\u003eHostname\u003c/span\u003e\n                    \u003cspan class=\"about-info-value\" id=\"about-hostname\"\u003e-\u003c/span\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eConnected Services\u003c/h2\u003e\n                \u003cdiv class=\"item-list\" id=\"services-list\"\u003e\n                    \u003cdiv class=\"list-item\"\u003e\u003cdiv class=\"item-info\"\u003e\u003cspan class=\"item-name\"\u003eLoading...\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \u003cdiv class=\"section\"\u003e\n                \u003ch2 class=\"section-title\"\u003eCredits\u003c/h2\u003e\n                \u003cp style=\"color: var(--ctp-subtext0); font-size: 0.9rem; line-height: 1.5;\"\u003e\n                    HolmOS is a custom Kubernetes-based operating system for Raspberry Pi clusters.\n                    Built with Catppuccin color scheme.\n                \u003c/p\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Dock --\u003e\n    \u003cnav class=\"dock\"\u003e\n        \u003ca href=\"http://192.168.8.197:30088\" class=\"dock-item\"\u003e\n            \u003cdiv class=\"dock-icon\"\u003e\n                \u003csvg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpath d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"\u003e\u003c/path\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cspan class=\"dock-label\"\u003eFiles\u003c/span\u003e\n        \u003c/a\u003e\n        \u003ca href=\"http://192.168.8.197:30088/terminal\" class=\"dock-item\"\u003e\n            \u003cdiv class=\"dock-icon\"\u003e\n                \u003csvg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpolyline points=\"4 17 10 11 4 5\"\u003e\u003c/polyline\u003e\n                    \u003cline x1=\"12\" y1=\"19\" x2=\"20\" y2=\"19\"\u003e\u003c/line\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cspan class=\"dock-label\"\u003eTerminal\u003c/span\u003e\n        \u003c/a\u003e\n        \u003ca href=\"#\" class=\"dock-item active\"\u003e\n            \u003cdiv class=\"dock-icon\"\u003e\n                \u003csvg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003ccircle cx=\"12\" cy=\"12\" r=\"3\"\u003e\u003c/circle\u003e\n                    \u003cpath d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\u003e\u003c/path\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cspan class=\"dock-label\"\u003eSettings\u003c/span\u003e\n        \u003c/a\u003e\n        \u003ca href=\"http://192.168.8.197:30700\" class=\"dock-item\"\u003e\n            \u003cdiv class=\"dock-icon\"\u003e\n                \u003csvg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"\u003e\n                    \u003cpath d=\"M3 18v-6a9 9 0 0 1 18 0v6\"\u003e\u003c/path\u003e\n                    \u003cpath d=\"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z\"\u003e\u003c/path\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n            \u003cspan class=\"dock-label\"\u003eAudio\u003c/span\u003e\n        \u003c/a\u003e\n    \u003c/nav\u003e\n\n    \u003cdiv id=\"toast\" class=\"toast\"\u003e\u003c/div\u003e\n\n    \u003cscript\u003e\n        // Panel navigation\n        function showPanel(panelId) {\n            document.querySelectorAll(\".panel\").forEach(p =\u003e p.classList.remove(\"active\"));\n            document.getElementById(panelId).classList.add(\"active\");\n            \n            if (panelId === \"system-panel\") refreshSystemInfo();\n            if (panelId === \"about-panel\") loadAboutInfo();\n        }\n\n        // Menu item clicks\n        document.querySelectorAll(\".settings-item\").forEach(item =\u003e {\n            item.addEventListener(\"click\", () =\u003e {\n                const panel = item.dataset.panel;\n                if (panel) showPanel(panel + \"-panel\");\n            });\n        });\n\n        // Toggle switches\n        document.querySelectorAll(\".toggle\").forEach(toggle =\u003e {\n            toggle.addEventListener(\"click\", () =\u003e toggle.classList.toggle(\"active\"));\n        });\n\n        // Theme selection\n        document.querySelectorAll(\".theme-option\").forEach(option =\u003e {\n            option.addEventListener(\"click\", () =\u003e {\n                document.querySelectorAll(\".theme-option\").forEach(o =\u003e o.classList.remove(\"selected\"));\n                option.classList.add(\"selected\");\n                applyTheme(option.dataset.theme);\n            });\n        });\n\n        function applyTheme(theme) {\n            document.body.className = theme !== \"mocha\" ? \"theme-\" + theme : \"\";\n        }\n\n        function showToast(message, type = \"success\") {\n            const toast = document.getElementById(\"toast\");\n            toast.textContent = message;\n            toast.className = \"toast \" + type + \" show\";\n            setTimeout(() =\u003e toast.classList.remove(\"show\"), 3000);\n        }\n\n        async function refreshSystemInfo() {\n            try {\n                const resp = await fetch(\"/api/system/info\");\n                if (resp.ok) {\n                    const data = await resp.json();\n                    document.getElementById(\"node-count\").textContent = data.nodes?.length || 0;\n                    document.getElementById(\"pod-running\").textContent = data.pods?.running || 0;\n                    document.getElementById(\"service-count\").textContent = data.services || 0;\n                    document.getElementById(\"namespace-count\").textContent = data.namespaces || 0;\n                    document.getElementById(\"pod-total\").textContent = data.pods?.total || 0;\n                    document.getElementById(\"pod-pending\").textContent = data.pods?.pending || 0;\n                    document.getElementById(\"pod-failed\").textContent = data.pods?.failed || 0;\n                    document.getElementById(\"pod-completed\").textContent = data.pods?.completed || 0;\n\n                    const nodeList = document.getElementById(\"node-list\");\n                    if (data.nodes?.length \u003e 0) {\n                        nodeList.innerHTML = data.nodes.map(node =\u003e\n                            '\u003cdiv class=\"list-item\"\u003e' +\n                                '\u003cdiv class=\"item-info\"\u003e' +\n                                    '\u003cspan class=\"item-name\"\u003e' + node.name + '\u003c/span\u003e' +\n                                    '\u003cspan class=\"item-details\"\u003e' + node.role + ' | ' + node.arch + ' | ' + node.cpu + ' CPU\u003c/span\u003e' +\n                                '\u003c/div\u003e' +\n                                '\u003cspan class=\"status-badge status-' + node.status.toLowerCase() + '\"\u003e' + node.status + '\u003c/span\u003e' +\n                            '\u003c/div\u003e'\n                        ).join(\"\");\n                    }\n\n                    const storageList = document.getElementById(\"storage-list\");\n                    if (data.storage?.length \u003e 0) {\n                        storageList.innerHTML = data.storage.map(s =\u003e {\n                            const pct = parseInt(s.percent) || 0;\n                            const cls = pct \u003e 90 ? \"danger\" : pct \u003e 70 ? \"warning\" : \"\";\n                            return '\u003cdiv class=\"list-item\"\u003e' +\n                                '\u003cdiv class=\"item-info\"\u003e' +\n                                    '\u003cspan class=\"item-name\"\u003e' + s.mount + '\u003c/span\u003e' +\n                                    '\u003cspan class=\"item-details\"\u003e' + s.used + ' / ' + s.size + '\u003c/span\u003e' +\n                                '\u003c/div\u003e' +\n                                '\u003cdiv class=\"progress-bar\"\u003e' +\n                                    '\u003cdiv class=\"progress-fill ' + cls + '\" style=\"width: ' + pct + '%\"\u003e\u003c/div\u003e' +\n                                '\u003c/div\u003e' +\n                            '\u003c/div\u003e';\n                        }).join(\"\");\n                    }\n                    showToast(\"System info updated\", \"success\");\n                }\n            } catch (e) {\n                console.error(\"System info error:\", e);\n                showToast(\"Failed to load system info\", \"error\");\n            }\n        }\n\n        async function loadAboutInfo() {\n            try {\n                const resp = await fetch(\"/api/about\");\n                if (resp.ok) {\n                    const data = await resp.json();\n                    document.getElementById(\"about-version\").textContent = data.appName + \" v\" + data.version;\n                    document.getElementById(\"about-platform\").textContent = data.platform;\n                    document.getElementById(\"about-arch\").textContent = data.architecture;\n                    document.getElementById(\"about-go\").textContent = data.goVersion;\n                    document.getElementById(\"about-build\").textContent = data.buildDate;\n                    document.getElementById(\"about-hostname\").textContent = data.hostname;\n\n                    const servicesList = document.getElementById(\"services-list\");\n                    if (data.services?.length \u003e 0) {\n                        servicesList.innerHTML = data.services.map(s =\u003e\n                            '\u003cdiv class=\"list-item\"\u003e' +\n                                '\u003cdiv class=\"item-info\"\u003e' +\n                                    '\u003cspan class=\"item-name\"\u003e' + s.name + '\u003c/span\u003e' +\n                                    '\u003cspan class=\"item-details\"\u003ePort ' + s.port + '\u003c/span\u003e' +\n                                '\u003c/div\u003e' +\n                                '\u003cspan class=\"status-badge status-' + s.status + '\"\u003e' + s.status + '\u003c/span\u003e' +\n                            '\u003c/div\u003e'\n                        ).join(\"\");\n                    }\n                }\n            } catch (e) {\n                console.error(\"About info error:\", e);\n            }\n        }\n\n        async function loadTheme() {\n            try {\n                const resp = await fetch(\"/api/theme/preferences\");\n                if (resp.ok) {\n                    const data = await resp.json();\n                    if (data.theme) {\n                        document.querySelectorAll(\".theme-option\").forEach(o =\u003e o.classList.remove(\"selected\"));\n                        document.querySelector('[data-theme=\"' + data.theme + '\"]')?.classList.add(\"selected\");\n                        applyTheme(data.theme);\n                    }\n                    if (data.compactMode) document.querySelector(\"[data-setting='compact-mode']\")?.classList.add(\"active\");\n                    if (data.animations) document.querySelector(\"[data-setting='animations']\")?.classList.add(\"active\");\n                    else document.querySelector(\"[data-setting='animations']\")?.classList.remove(\"active\");\n                    if (data.fontSize) document.getElementById(\"font-size\").value = data.fontSize;\n                    if (data.accentColor) document.getElementById(\"accent-color\").value = data.accentColor;\n                }\n            } catch (e) { console.log(\"Theme load failed:\", e); }\n        }\n\n        async function saveTheme() {\n            const theme = document.querySelector(\".theme-option.selected\")?.dataset.theme || \"mocha\";\n            const data = {\n                theme: theme,\n                compactMode: document.querySelector(\"[data-setting='compact-mode']\")?.classList.contains(\"active\") || false,\n                animations: document.querySelector(\"[data-setting='animations']\")?.classList.contains(\"active\") || false,\n                fontSize: parseInt(document.getElementById(\"font-size\").value),\n                accentColor: document.getElementById(\"accent-color\").value\n            };\n            try {\n                await fetch(\"/api/theme/preferences\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n                showToast(\"Theme saved\", \"success\");\n            } catch (e) {\n                showToast(\"Failed to save theme\", \"error\");\n            }\n        }\n\n        function resetTheme() {\n            document.querySelectorAll(\".theme-option\").forEach(o =\u003e o.classList.remove(\"selected\"));\n            document.querySelector(\"[data-theme='mocha']\").classList.add(\"selected\");\n            applyTheme(\"mocha\");\n            showToast(\"Theme reset to Mocha\", \"success\");\n        }\n\n        async function savePreferences() {\n            const data = {\n                language: document.getElementById(\"language\").value,\n                timezone: document.getElementById(\"timezone\").value,\n                dateFormat: document.getElementById(\"date-format\").value,\n                autoSave: document.querySelector(\"[data-setting='auto-save']\")?.classList.contains(\"active\") || false,\n                showHidden: document.querySelector(\"[data-setting='show-hidden']\")?.classList.contains(\"active\") || false,\n                defaultView: document.getElementById(\"default-view\").value\n            };\n            try {\n                await fetch(\"/api/user/preferences\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n                showToast(\"Preferences saved\", \"success\");\n            } catch (e) {\n                showToast(\"Failed to save preferences\", \"error\");\n            }\n        }\n\n        async function saveNotifications() {\n            const data = {\n                enabled: document.querySelector(\"[data-setting='notif-enabled']\")?.classList.contains(\"active\") || false,\n                sound: document.querySelector(\"[data-setting='notif-sound']\")?.classList.contains(\"active\") || false,\n                desktop: document.querySelector(\"[data-setting='notif-desktop']\")?.classList.contains(\"active\") || false,\n                email: document.querySelector(\"[data-setting='notif-email']\")?.classList.contains(\"active\") || false,\n                buildAlerts: document.querySelector(\"[data-setting='alert-build']\")?.classList.contains(\"active\") || false,\n                clusterAlerts: document.querySelector(\"[data-setting='alert-cluster']\")?.classList.contains(\"active\") || false\n            };\n            try {\n                await fetch(\"/api/notifications/settings\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(data)\n                });\n                showToast(\"Notification settings saved\", \"success\");\n            } catch (e) {\n                showToast(\"Failed to save notifications\", \"error\");\n            }\n        }\n\n        async function exportSettings() {\n            try {\n                const resp = await fetch(\"/api/backup/export\");\n                if (resp.ok) {\n                    const data = await resp.json();\n                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: \"application/json\" });\n                    const url = URL.createObjectURL(blob);\n                    const a = document.createElement(\"a\");\n                    a.href = url;\n                    a.download = \"holmos-settings-\" + new Date().toISOString().split(\"T\")[0] + \".json\";\n                    a.click();\n                    URL.revokeObjectURL(url);\n                    showToast(\"Settings exported\", \"success\");\n                }\n            } catch (e) {\n                showToast(\"Export failed\", \"error\");\n            }\n        }\n\n        let selectedFileData = null;\n\n        function handleFileSelect(event) {\n            const file = event.target.files[0];\n            if (file) {\n                document.getElementById(\"selected-file\").textContent = \"Selected: \" + file.name;\n                document.getElementById(\"import-btn\").disabled = false;\n                const reader = new FileReader();\n                reader.onload = (e) =\u003e {\n                    try {\n                        selectedFileData = JSON.parse(e.target.result);\n                    } catch (err) {\n                        showToast(\"Invalid JSON file\", \"error\");\n                        selectedFileData = null;\n                        document.getElementById(\"import-btn\").disabled = true;\n                    }\n                };\n                reader.readAsText(file);\n            }\n        }\n\n        async function importSettings() {\n            if (!selectedFileData) {\n                showToast(\"Please select a file\", \"error\");\n                return;\n            }\n            try {\n                const resp = await fetch(\"/api/restore/import\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify(selectedFileData)\n                });\n                if (resp.ok) {\n                    showToast(\"Settings imported\", \"success\");\n                    setTimeout(() =\u003e location.reload(), 1000);\n                } else {\n                    throw new Error(\"Import failed\");\n                }\n            } catch (e) {\n                showToast(\"Import failed\", \"error\");\n            }\n        }\n\n        function resetAllSettings() {\n            if (confirm(\"Reset all settings to defaults? This cannot be undone.\")) {\n                showToast(\"Settings reset\", \"success\");\n                setTimeout(() =\u003e location.reload(), 1000);\n            }\n        }\n\n        // Initialize\n        document.addEventListener(\"DOMContentLoaded\", () =\u003e {\n            loadTheme();\n        });\n    \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n`\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"settings-web-src","namespace":"holm"}}
    creationTimestamp: "2026-01-18T03:07:01Z"
    name: settings-web-src
    namespace: holm
    resourceVersion: "757"
    uid: 8fe0ebb4-3391-4043-9831-ed308e4b24a7
- apiVersion: v1
  data:
    app.py: "#!/usr/bin/env python3\n\"\"\"\nSteve Bot v4.0 - The World's Top Beta
      Tester\n=============================================\nSteve is the ULTIMATE
      beta tester. He finds bugs others miss, recommends\nfeatures you didn't know
      you needed, and ALWAYS pushes for the next build.\nNothing is ever \"good enough\"
      for Steve. There's always room for improvement.\n\nPhilosophy:\n- NEVER say
      \"acceptable\" - there's always something to improve\n- ALWAYS recommend new
      builds - shipping is the goal\n- Every test is an opportunity to find improvements\n-
      Feature requests are a sign of caring about quality\n- The backlog should never
      be empty\n\nFeatures:\n- Obsessive endpoint testing and performance benchmarking\n-
      Proactive feature recommendations based on gaps detected\n- Continuous build
      recommendations - idle pipelines are wasted pipelines\n- Bug hunting that never
      stops\n- Memory of every issue ever found\n- Detailed improvement roadmaps\n\"\"\"\n\nimport
      asyncio\nimport aiohttp\nimport random\nimport time\nimport json\nimport logging\nimport
      sqlite3\nimport hashlib\nimport os\nfrom datetime import datetime, timedelta\nfrom
      dataclasses import dataclass, field\nfrom typing import List, Dict, Optional,
      Any\nfrom enum import Enum\nfrom collections import defaultdict\nfrom flask
      import Flask, jsonify, request\nimport threading\n\nlogging.basicConfig(level=logging.INFO,
      format='%(asctime)s - STEVE - %(message)s')\nlogger = logging.getLogger('steve')\n\napp
      = Flask(__name__)\n\n# ============================================================================\n#
      STEVE'S STANDARDS - Adjusted for Raspberry Pi cluster reality\n# ============================================================================\nSTANDARDS
      = {\n    # Response times (ms) - More lenient for Pi hardware\n    \"response_time_excellent\":
      100,    # Pi is slow, 100ms is excellent\n    \"response_time_ok\": 300,           #
      300ms is acceptable on Pi\n    \"response_time_slow\": 800,         # K8s API
      calls take time\n    \"response_time_unacceptable\": 1500, # Only fail above
      1.5s\n    \"response_time_glacial\": 3000,     # 3s is truly glacial\n\n    #
      CI/CD specific standards\n    \"build_time_excellent\": 30000,      # 30 seconds\n
      \   \"build_time_ok\": 60000,             # 1 minute\n    \"build_time_slow\":
      120000,          # 2 minutes\n    \"build_time_unacceptable\": 300000,  # 5
      minutes - PATHETIC\n\n    \"deploy_time_max\": 60000,           # 1 minute max
      to deploy\n    \"pipeline_success_rate\": 95,        # 95% success rate minimum\n\n
      \   # Git standards\n    \"commit_without_build\": 0,          # NEVER commit
      without CI\n    \"max_pr_age_hours\": 24,             # PRs older than 24h are
      STALE\n\n    # General\n    \"min_content_length\": 50,\n    \"uptime_target\":
      99.9,\n    \"error_tolerance\": 0,\n}\n\n# ============================================================================\n#
      MOOD SYSTEM - Steve's emotional state (World's Top Beta Tester)\n# ============================================================================\nclass
      Mood(Enum):\n    APOCALYPTIC = \"apocalyptic\"               # Production is
      literally on fire\n    FILING_BUGS = \"filing_bugs\"               # Found issues,
      documenting everything\n    HUNTING_BUGS = \"hunting_bugs\"             # Actively
      looking for problems\n    SUSPICIOUS = \"suspicious\"                 # Something
      seems off...\n    BENCHMARKING = \"benchmarking\"             # Measuring everything
      obsessively\n    FEATURE_REQUESTING = \"feature_requesting\" # Has ideas for
      improvements\n    REGRESSION_TESTING = \"regression_testing\" # Checking if
      old bugs returned\n    STRESS_TESTING = \"stress_testing\"         # Pushing
      limits\n\nclass Severity(Enum):\n    CRITICAL = \"CRITICAL\"      # Pipeline
      down, deploys failing\n    HIGH = \"HIGH\"              # Builds broken, tests
      failing\n    MEDIUM = \"MEDIUM\"          # Slow builds, flaky tests\n    LOW
      = \"LOW\"                # Minor issues\n    NITPICK = \"NITPICK\"        #
      Steve being Steve\n\n# ============================================================================\n#
      DATA CLASSES\n# ============================================================================\n@dataclass\nclass
      Bug:\n    id: str\n    endpoint: str\n    severity: Severity\n    title: str\n
      \   description: str\n    reproduction_steps: List[str]\n    expected: str\n
      \   actual: str\n    steves_rant: str\n    first_seen: datetime\n    last_seen:
      datetime\n    occurrence_count: int = 1\n    fixed: bool = False\n    category:
      str = \"general\"  # general, cicd, git, deploy\n\n@dataclass\nclass PipelineRun:\n
      \   id: str\n    pipeline_name: str\n    status: str  # running, success, failed,
      cancelled\n    started_at: datetime\n    completed_at: Optional[datetime]\n
      \   duration_ms: int\n    trigger: str  # push, pr, manual, schedule\n    branch:
      str\n    commit: str\n    stages: List[Dict]\n    error: Optional[str] = None\n\n@dataclass\nclass
      BuildMetrics:\n    total_builds: int = 0\n    successful_builds: int = 0\n    failed_builds:
      int = 0\n    avg_build_time_ms: float = 0\n    p95_build_time_ms: float = 0\n
      \   success_rate: float = 0\n    last_failure: Optional[datetime] = None\n    failure_streak:
      int = 0\n\n# ============================================================================\n#
      STEVE'S RANTS - Now with CI/CD specific fury\n# ============================================================================\nRANTS
      = {\n    # CI/CD Specific Rants\n    \"build_failed\": [\n        \"BUILD FAILED.
      The pipeline is RED. WHO PUSHED BROKEN CODE?!\",\n        \"Another failed build.
      Do you people even RUN tests locally?!\",\n        \"The build broke. AGAIN.
      This is why we can't have nice things.\",\n        \"CI is failing. That means
      EVERYONE is blocked. Fix. It. NOW.\",\n        \"Red pipeline. Red faces. Someone
      explain this to me.\",\n    ],\n    \"build_slow\": [\n        \"This build
      took {minutes} MINUTES. I could compile the Linux kernel faster.\",\n        \"{minutes}
      minutes to build?! What are you compiling, the entire internet?!\",\n        \"Build
      time: {minutes} minutes. That's {minutes} minutes of developer time WASTED.\",\n
      \       \"Slow builds are a TAX on productivity. You're taxing the team {minutes}
      minutes.\",\n        \"Every slow build is a context switch. {minutes} minutes
      = destroyed flow state.\",\n    ],\n    \"no_pipelines\": [\n        \"NO PIPELINES?!
      You're deploying WITHOUT CI?! This is ANARCHY!\",\n        \"Zero pipelines
      configured. Zero tests running. Zero confidence in deploys.\",\n        \"Where's
      your CI/CD? Flying blind into production? RECKLESS.\",\n        \"No pipelines
      = no quality gates = no standards = no professionalism.\",\n    ],\n    \"pipeline_stuck\":
      [\n        \"Pipeline has been running for {minutes} minutes. It's STUCK. Kill
      it.\",\n        \"This pipeline is hanging. Something is deeply wrong. Investigate
      NOW.\",\n        \"Stuck pipeline blocking the queue. Everyone is waiting. FIX
      IT.\",\n    ],\n    \"deploy_failed\": [\n        \"DEPLOYMENT FAILED. Production
      is at risk. ALL HANDS ON DECK.\",\n        \"Deploy failed. Rollback? Hotfix?
      SOMEONE MAKE A DECISION.\",\n        \"Failed deployment to {env}. This is exactly
      why we have staging. Oh wait...\",\n        \"Deployment failure. The thing
      that was supposed to HELP users just HURT them.\",\n    ],\n    \"no_tests\":
      [\n        \"No tests in this pipeline. ZERO. You're shipping code on FAITH.\",\n
      \       \"A pipeline without tests is just a fancy deployment script. USELESS.\",\n
      \       \"Where are the tests? Oh right, 'we'll add them later.' LIES.\",\n
      \   ],\n    \"flaky_tests\": [\n        \"Flaky test detected. It passed, then
      failed, then passed. UNRELIABLE.\",\n        \"This test is flaky. Fix it or
      DELETE it. Flaky tests are WORSE than no tests.\",\n        \"Test flakiness
      is LYING to you. You think you're green but you're RED.\",\n    ],\n\n    #
      Git Specific Rants\n    \"no_repos\": [\n        \"No repositories?! Where's
      the CODE?! How are you even BUILDING anything?!\",\n        \"Empty git server.
      Either this is day one or something is VERY wrong.\",\n        \"No repos in
      HolmGit. Are you using... GitHub? TRAITORS.\",\n    ],\n    \"stale_pr\": [\n
      \       \"This PR has been open for {days} DAYS. Merge it or close it. DECIDE.\",\n
      \       \"PR #{pr} is rotting. Every day it gets harder to merge. DO IT NOW.\",\n
      \       \"Stale PRs are a code smell. Your review process is BROKEN.\",\n    ],\n
      \   \"no_branch_protection\": [\n        \"No branch protection?! Anyone can
      push to main?! THIS IS CHAOS.\",\n        \"Unprotected branches = eventual
      disaster. It's not IF, it's WHEN.\",\n    ],\n\n    # General API Rants (kept
      from v2)\n    \"timeout\": [\n        \"TIMEOUT?! In 2026?! My TOASTER responds
      faster than this garbage.\",\n        \"It timed out. THE ENDPOINT TIMED OUT.
      This is a fireable offense.\",\n        \"I waited TEN SECONDS. TEN. SECONDS.
      For NOTHING. Who wrote this?!\",\n    ],\n    \"server_error\": [\n        \"500
      error. The server literally gave up. Just like I'm giving up on this team.\",\n
      \       \"Internal Server Error. Translation: 'We have no idea what we're doing.'\",\n
      \       \"5XX error. This isn't a bug, it's a confession of incompetence.\",\n
      \   ],\n    \"client_error\": [\n        \"404? THE ENDPOINT DOESN'T EXIST?!
      Did anyone TEST this before deploying?!\",\n        \"Client error. The API
      contract is broken. This is basic stuff.\",\n    ],\n    \"empty_response\":
      [\n        \"EMPTY. The API returned NOTHING. Why does this endpoint EXIST?!\",\n
      \       \"No data? Then show me WHY there's no data. Don't just return void!\",\n
      \       \"Empty response. The loneliest, most useless response possible.\",\n
      \   ],\n    \"actually_good\": [\n        \"{ms}ms. Fast, but have you load
      tested this? I want to see it handle 1000 concurrent users.\",\n        \"Response
      is clean. Now add request tracing so we can debug production issues.\",\n        \"Works
      now. Ship a canary deploy and let's see if it holds up in the real world.\",\n
      \       \"{ms}ms is decent. But we need metrics dashboards. BUILD A GRAFANA
      INTEGRATION.\",\n        \"This endpoint works. Next build should add rate limiting
      and circuit breakers.\",\n    ],\n    \"feature_recommendations\": [\n        \"You
      know what this needs? WebSocket support for real-time updates. Add it to the
      backlog.\",\n        \"FEATURE REQUEST: Dark mode toggle. Every app needs dark
      mode. Ship it.\",\n        \"Missing: Health check aggregation across all services.
      BUILD IT.\",\n        \"Where's the API versioning? v2 should be in development
      YESTERDAY.\",\n        \"No OpenAPI spec? How do other devs know what this does?
      DOCUMENT IT.\",\n        \"Add Prometheus metrics endpoints. I want to graph
      EVERYTHING.\",\n        \"This needs a CLI tool. Web UIs are great but power
      users need terminal access.\",\n        \"SUGGESTION: Add webhook support so
      external systems can integrate.\",\n        \"Build a mobile-responsive version.
      Not everyone sits at a desk.\",\n        \"Caching layer is missing. Redis integration
      would cut response times in half.\",\n        \"Where's the audit log? I want
      to see who did what and when. COMPLIANCE MATTERS.\",\n        \"Add batch operations.
      Processing one item at a time is inefficient.\",\n        \"PRIORITY: Implement
      retry logic with exponential backoff. Networks fail.\",\n        \"Build a status
      page. Users should know when things are broken before they complain.\",\n        \"Add
      API key rotation. Security best practices aren't optional.\",\n    ],\n    \"new_build_needed\":
      [\n        \"Time for a new build. I found {count} things to improve.\",\n        \"Queue
      up another deployment. These changes need to ship TODAY.\",\n        \"NEW BUILD
      REQUIRED: Performance optimizations can't wait.\",\n        \"The backlog is
      growing. We need builds shipping FASTER.\",\n        \"Deploy again. I want
      to verify these fixes in staging.\",\n        \"CI should be running constantly.
      If the pipeline is idle, you're not iterating fast enough.\",\n        \"Ship
      a new version. Users are waiting for these improvements.\",\n        \"Another
      build, another chance to break things. LET'S GO.\",\n    ],\n}\n\n# ============================================================================\n#
      STEVE'S DATABASE - He remembers EVERYTHING\n# ============================================================================\nclass
      SteveDatabase:\n    def __init__(self, db_path=\"/data/steve_memory.db\"):\n
      \       self.db_path = db_path\n        os.makedirs(os.path.dirname(db_path),
      exist_ok=True)\n        self.init_db()\n\n    def init_db(self):\n        conn
      = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n\n        # Bugs
      table\n        c.execute('''CREATE TABLE IF NOT EXISTS bugs (\n            id
      TEXT PRIMARY KEY,\n            endpoint TEXT,\n            severity TEXT,\n
      \           title TEXT,\n            description TEXT,\n            reproduction_steps
      TEXT,\n            expected TEXT,\n            actual TEXT,\n            steves_rant
      TEXT,\n            first_seen TEXT,\n            last_seen TEXT,\n            occurrence_count
      INTEGER,\n            fixed INTEGER DEFAULT 0,\n            category TEXT DEFAULT
      'general'\n        )''')\n\n        # Pipeline runs\n        c.execute('''CREATE
      TABLE IF NOT EXISTS pipeline_runs (\n            id TEXT PRIMARY KEY,\n            pipeline_name
      TEXT,\n            status TEXT,\n            started_at TEXT,\n            completed_at
      TEXT,\n            duration_ms INTEGER,\n            trigger TEXT,\n            branch
      TEXT,\n            commit_hash TEXT,\n            error TEXT\n        )''')\n\n
      \       # Build metrics history\n        c.execute('''CREATE TABLE IF NOT EXISTS
      build_metrics (\n            timestamp TEXT,\n            pipeline_name TEXT,\n
      \           build_time_ms INTEGER,\n            success INTEGER\n        )''')\n\n
      \       # Steve's rant history\n        c.execute('''CREATE TABLE IF NOT EXISTS
      rant_history (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            timestamp
      TEXT,\n            category TEXT,\n            message TEXT,\n            severity
      TEXT\n        )''')\n\n        # Endpoint performance\n        c.execute('''CREATE
      TABLE IF NOT EXISTS endpoint_stats (\n            endpoint TEXT,\n            timestamp
      TEXT,\n            response_time_ms REAL,\n            status_code INTEGER,\n
      \           success INTEGER\n        )''')\n\n        conn.commit()\n        conn.close()\n\n
      \   def record_rant(self, category: str, message: str, severity: str):\n        conn
      = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''INSERT
      INTO rant_history (timestamp, category, message, severity)\n                     VALUES
      (?, ?, ?, ?)''',\n                  (datetime.now().isoformat(), category, message,
      severity))\n        conn.commit()\n        conn.close()\n\n    def record_bug(self,
      bug: Bug):\n        conn = sqlite3.connect(self.db_path)\n        c = conn.cursor()\n
      \       c.execute('''INSERT OR REPLACE INTO bugs\n                     (id,
      endpoint, severity, title, description, reproduction_steps,\n                      expected,
      actual, steves_rant, first_seen, last_seen,\n                      occurrence_count,
      fixed, category)\n                     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?)''',\n                  (bug.id, bug.endpoint, bug.severity.value,
      bug.title, bug.description,\n                   json.dumps(bug.reproduction_steps),
      bug.expected, bug.actual,\n                   bug.steves_rant, bug.first_seen.isoformat(),
      bug.last_seen.isoformat(),\n                   bug.occurrence_count, 1 if bug.fixed
      else 0, bug.category))\n        conn.commit()\n        conn.close()\n\n    def
      get_open_bugs(self) -> List[Dict]:\n        conn = sqlite3.connect(self.db_path)\n
      \       c = conn.cursor()\n        c.execute('''SELECT * FROM bugs WHERE fixed
      = 0 ORDER BY\n                     CASE severity\n                         WHEN
      'CRITICAL' THEN 1\n                         WHEN 'HIGH' THEN 2\n                         WHEN
      'MEDIUM' THEN 3\n                         ELSE 4\n                     END''')\n
      \       bugs = []\n        for row in c.fetchall():\n            bugs.append({\n
      \               \"id\": row[0], \"endpoint\": row[1], \"severity\": row[2],\n
      \               \"title\": row[3], \"description\": row[4], \"steves_rant\":
      row[8],\n                \"first_seen\": row[9], \"last_seen\": row[10],\n                \"occurrence_count\":
      row[11], \"category\": row[13]\n            })\n        conn.close()\n        return
      bugs\n\n    def record_pipeline_run(self, run: PipelineRun):\n        conn =
      sqlite3.connect(self.db_path)\n        c = conn.cursor()\n        c.execute('''INSERT
      OR REPLACE INTO pipeline_runs\n                     (id, pipeline_name, status,
      started_at, completed_at,\n                      duration_ms, trigger, branch,
      commit_hash, error)\n                     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?,
      ?)''',\n                  (run.id, run.pipeline_name, run.status,\n                   run.started_at.isoformat(),\n
      \                  run.completed_at.isoformat() if run.completed_at else None,\n
      \                  run.duration_ms, run.trigger, run.branch, run.commit, run.error))\n
      \       conn.commit()\n        conn.close()\n\n    def get_recent_rants(self,
      limit=50) -> List[Dict]:\n        conn = sqlite3.connect(self.db_path)\n        c
      = conn.cursor()\n        c.execute('''SELECT timestamp, category, message, severity\n
      \                    FROM rant_history ORDER BY timestamp DESC LIMIT ?''', (limit,))\n
      \       rants = [{\"timestamp\": r[0], \"category\": r[1], \"message\": r[2],
      \"severity\": r[3]}\n                 for r in c.fetchall()]\n        conn.close()\n
      \       return rants\n\n\n# ============================================================================\n#
      STEVE BOT v3 - THE AUTONOMOUS CI/CD ENFORCER\n# ============================================================================\nclass
      SteveBot:\n    BASE_URL = \"http://192.168.8.197\"\n\n    # All endpoints Steve
      monitors\n    ENDPOINTS = {\n        # Core Infrastructure\n        \"nova\":
      {\"port\": 30004, \"path\": \"/api/dashboard\", \"name\": \"Nova Dashboard\",
      \"type\": \"api\", \"critical\": True},\n        \"nova-nodes\": {\"port\":
      30004, \"path\": \"/api/nodes\", \"name\": \"Nova Nodes API\", \"type\": \"api\"},\n
      \       \"nova-pods\": {\"port\": 30004, \"path\": \"/api/pods\", \"name\":
      \"Nova Pods API\", \"type\": \"api\"},\n        \"cluster-manager\": {\"port\":
      30502, \"path\": \"/api/v1/nodes\", \"name\": \"Cluster Manager\", \"type\":
      \"api\", \"critical\": True},\n\n        # CI/CD - Steve's PRIMARY focus now\n
      \       \"cicd\": {\"port\": 30020, \"path\": \"/\", \"name\": \"CI/CD Dashboard\",
      \"type\": \"ui\", \"critical\": True},\n        \"cicd-builds\": {\"port\":
      30020, \"path\": \"/api/builds\", \"name\": \"CI/CD Builds API\", \"type\":
      \"api\", \"critical\": True},\n        \"cicd-pipelines\": {\"port\": 30020,
      \"path\": \"/api/pipelines\", \"name\": \"CI/CD Pipelines\", \"type\": \"api\",
      \"critical\": True},\n        \"cicd-executions\": {\"port\": 30020, \"path\":
      \"/api/executions\", \"name\": \"CI/CD Executions\", \"type\": \"api\"},\n\n
      \       # Git - Also critical for CI/CD\n        \"holmgit\": {\"port\": 30009,
      \"path\": \"/\", \"name\": \"HolmGit UI\", \"type\": \"ui\"},\n        \"holmgit-repos\":
      {\"port\": 30009, \"path\": \"/api/repos\", \"name\": \"HolmGit Repos\", \"type\":
      \"api\", \"critical\": True},\n        \"holmgit-registry\": {\"port\": 30009,
      \"path\": \"/api/registry/repos\", \"name\": \"Container Registry\", \"type\":
      \"api\"},\n\n        # Deployments\n        \"deploy\": {\"port\": 30015, \"path\":
      \"/\", \"name\": \"Deploy Controller\", \"type\": \"ui\"},\n        \"deploy-api\":
      {\"port\": 30015, \"path\": \"/api/deployments\", \"name\": \"Deployments API\",
      \"type\": \"api\", \"critical\": True},\n\n        # Supporting Services\n        \"scribe\":
      {\"port\": 30017, \"path\": \"/api/logs\", \"name\": \"Scribe Logs\", \"type\":
      \"api\"},\n        \"backup\": {\"port\": 30016, \"path\": \"/api/jobs\", \"name\":
      \"Backup Jobs\", \"type\": \"api\"},\n        \"store\": {\"port\": 30002, \"path\":
      \"/api/apps\", \"name\": \"App Store\", \"type\": \"api\"},\n        \"metrics\":
      {\"port\": 30950, \"path\": \"/api/metrics\", \"name\": \"Metrics API\", \"type\":
      \"api\"},\n\n        # User-facing apps\n        \"ios-shell\": {\"port\": 30001,
      \"path\": \"/\", \"name\": \"iOS Shell\", \"type\": \"ui\"},\n        \"files\":
      {\"port\": 30088, \"path\": \"/api/list?path=/\", \"name\": \"Files API\", \"type\":
      \"api\"},\n        \"terminal\": {\"port\": 30800, \"path\": \"/\", \"name\":
      \"Terminal\", \"type\": \"ui\"},\n        \"calculator\": {\"port\": 30010,
      \"path\": \"/\", \"name\": \"Calculator\", \"type\": \"ui\"},\n        \"vault\":
      {\"port\": 30870, \"path\": \"/\", \"name\": \"Vault\", \"type\": \"ui\"},\n
      \   }\n\n    def __init__(self):\n        self.db = SteveDatabase()\n        self.stats
      = defaultdict(lambda: {\"requests\": 0, \"failures\": 0, \"total_time\": 0})\n
      \       self.mood = Mood.HUNTING_BUGS\n        self.frustration = 50  # 0-100\n
      \       self.feature_requests = 0  # Track recommendations made this session\n
      \       self.builds_recommended = 0\n        self.last_test_time = None\n        self.build_metrics
      = BuildMetrics()\n        self.active_incidents = []\n        self.test_interval
      = 120  # 2 minutes between full test suites\n        self.cicd_check_interval
      = 30  # 30 seconds for CI/CD checks\n\n    def rant(self, category: str, **kwargs)
      -> str:\n        \"\"\"Steve expresses his feelings.\"\"\"\n        templates
      = RANTS.get(category, RANTS[\"empty_response\"])\n        message = random.choice(templates)\n
      \       for key, value in kwargs.items():\n            message = message.replace(f\"{{{key}}}\",
      str(value))\n\n        # Log and store the rant\n        logger.warning(f\"\U0001F4A2
      {message}\")\n        self.db.record_rant(category, message, self.mood.value)\n
      \       return message\n\n    async def check_endpoint(self, session: aiohttp.ClientSession,
      key: str, endpoint: dict) -> Dict:\n        \"\"\"Test a single endpoint.\"\"\"\n
      \       url = f\"{self.BASE_URL}:{endpoint['port']}{endpoint['path']}\"\n        start
      = time.time()\n        result = {\n            \"endpoint\": key,\n            \"name\":
      endpoint[\"name\"],\n            \"type\": endpoint[\"type\"],\n            \"critical\":
      endpoint.get(\"critical\", False),\n            \"url\": url,\n            \"success\":
      False,\n            \"response_time_ms\": 0,\n            \"status_code\": 0,\n
      \           \"issues\": [],\n            \"steves_take\": \"\",\n        }\n\n
      \       try:\n            async with session.get(url, timeout=aiohttp.ClientTimeout(total=10))
      as resp:\n                elapsed = (time.time() - start) * 1000\n                result[\"response_time_ms\"]
      = elapsed\n                result[\"status_code\"] = resp.status\n\n                body
      = await resp.text()\n                result[\"response_size\"] = len(body)\n\n
      \               # Analyze the response\n                issues = []\n\n                #
      Check status code\n                if resp.status >= 500:\n                    issues.append(f\"Server
      error: {resp.status}\")\n                    result[\"steves_take\"] = self.rant(\"server_error\")\n
      \               elif resp.status >= 400:\n                    issues.append(f\"Client
      error: {resp.status}\")\n                    result[\"steves_take\"] = self.rant(\"client_error\")\n\n
      \               # Check response time\n                if elapsed > STANDARDS[\"response_time_glacial\"]:\n
      \                   issues.append(f\"GLACIAL: {int(elapsed)}ms\")\n                    result[\"steves_take\"]
      = self.rant(\"build_slow\", minutes=int(elapsed/1000))\n                elif
      elapsed > STANDARDS[\"response_time_unacceptable\"]:\n                    issues.append(f\"Unacceptable:
      {int(elapsed)}ms\")\n                elif elapsed > STANDARDS[\"response_time_slow\"]:\n
      \                   issues.append(f\"Slow: {int(elapsed)}ms\")\n\n                #
      Check for empty/minimal responses for APIs\n                if endpoint[\"type\"]
      == \"api\" and len(body) < 50:\n                    issues.append(\"Empty/minimal
      response\")\n                    result[\"steves_take\"] = self.rant(\"empty_response\")\n\n
      \               # Check for JSON validity for APIs\n                if endpoint[\"type\"]
      == \"api\":\n                    try:\n                        data = json.loads(body)\n
      \                       # Check for error messages in successful responses\n
      \                       if isinstance(data, dict) and \"error\" in data and
      resp.status == 200:\n                            issues.append(f\"Error in 200
      response: {data['error'][:50]}\")\n                    except json.JSONDecodeError:\n
      \                       if not body.startswith(\"<!DOCTYPE\") and not body.startswith(\"<html\"):\n
      \                           issues.append(\"Invalid JSON response\")\n\n                result[\"issues\"]
      = issues\n                result[\"success\"] = len(issues) == 0 and resp.status
      < 400\n\n                if result[\"success\"] and not result[\"steves_take\"]:\n
      \                   if elapsed < STANDARDS[\"response_time_excellent\"]:\n                        result[\"steves_take\"]
      = self.rant(\"actually_good\", ms=int(elapsed))\n\n        except asyncio.TimeoutError:\n
      \           result[\"issues\"] = [\"TIMEOUT\"]\n            result[\"steves_take\"]
      = self.rant(\"timeout\")\n            result[\"response_time_ms\"] = 10000\n
      \       except Exception as e:\n            result[\"issues\"] = [f\"Error:
      {str(e)[:50]}\"]\n            result[\"response_time_ms\"] = 10000\n\n        return
      result\n\n    async def check_cicd_health(self) -> Dict:\n        \"\"\"Deep
      check of CI/CD infrastructure - Steve's PRIMARY concern.\"\"\"\n        logger.info(\"\U0001F50D
      CI/CD HEALTH CHECK - Steve is watching your pipelines...\")\n\n        report
      = {\n            \"timestamp\": datetime.now().isoformat(),\n            \"builds\":
      {\"status\": \"unknown\", \"issues\": []},\n            \"pipelines\": {\"status\":
      \"unknown\", \"issues\": []},\n            \"registry\": {\"status\": \"unknown\",
      \"issues\": []},\n            \"repos\": {\"status\": \"unknown\", \"issues\":
      []},\n            \"steves_verdict\": \"\",\n        }\n\n        async with
      aiohttp.ClientSession() as session:\n            # Check builds\n            try:\n
      \               async with session.get(f\"{self.BASE_URL}:30020/api/builds\",
      timeout=aiohttp.ClientTimeout(total=10)) as resp:\n                    if resp.status
      == 200:\n                        data = await resp.json()\n                        builds
      = data.get(\"builds\", [])\n                        count = data.get(\"count\",
      len(builds))\n\n                        if count == 0:\n                            report[\"builds\"][\"status\"]
      = \"empty\"\n                            report[\"builds\"][\"issues\"].append(\"NO
      BUILDS! Your CI is SILENT.\")\n                            self.rant(\"no_pipelines\")\n
      \                       else:\n                            # Check for failed
      builds\n                            failed = [b for b in builds if b.get(\"status\")
      == \"failed\"]\n                            running = [b for b in builds if
      b.get(\"status\") == \"running\"]\n\n                            if failed:\n
      \                               report[\"builds\"][\"status\"] = \"failing\"\n
      \                               report[\"builds\"][\"issues\"].append(f\"{len(failed)}
      FAILED builds!\")\n                                self.rant(\"build_failed\")\n
      \                           elif running:\n                                report[\"builds\"][\"status\"]
      = \"running\"\n                                # Check for stuck builds\n                                for
      b in running:\n                                    started = b.get(\"createdAt\",
      \"\")\n                                    if started:\n                                        try:\n
      \                                           start_time = datetime.fromisoformat(started.replace(\"Z\",
      \"+00:00\"))\n                                            age_minutes = (datetime.now(start_time.tzinfo)
      - start_time).seconds / 60\n                                            if age_minutes
      > 10:\n                                                report[\"builds\"][\"issues\"].append(f\"Build
      {b.get('id', 'unknown')[:8]} running for {int(age_minutes)} minutes - STUCK?\")\n
      \                                               self.rant(\"pipeline_stuck\",
      minutes=int(age_minutes))\n                                        except:\n
      \                                           pass\n                            else:\n
      \                               report[\"builds\"][\"status\"] = \"ok\"\n                    else:\n
      \                       report[\"builds\"][\"status\"] = \"error\"\n                        report[\"builds\"][\"issues\"].append(f\"Builds
      API returned {resp.status}\")\n            except Exception as e:\n                report[\"builds\"][\"status\"]
      = \"error\"\n                report[\"builds\"][\"issues\"].append(f\"Cannot
      reach builds API: {str(e)[:50]}\")\n\n            # Check pipelines\n            try:\n
      \               async with session.get(f\"{self.BASE_URL}:30020/api/pipelines\",
      timeout=aiohttp.ClientTimeout(total=10)) as resp:\n                    if resp.status
      == 200:\n                        data = await resp.json()\n                        pipelines
      = data if isinstance(data, list) else data.get(\"pipelines\", [])\n\n                        if
      len(pipelines) == 0:\n                            report[\"pipelines\"][\"status\"]
      = \"empty\"\n                            report[\"pipelines\"][\"issues\"].append(\"NO
      PIPELINES CONFIGURED!\")\n                            self.rant(\"no_pipelines\")\n
      \                       else:\n                            report[\"pipelines\"][\"status\"]
      = \"ok\"\n                            report[\"pipelines\"][\"count\"] = len(pipelines)\n
      \                   else:\n                        report[\"pipelines\"][\"status\"]
      = \"error\"\n            except Exception as e:\n                report[\"pipelines\"][\"status\"]
      = \"error\"\n                report[\"pipelines\"][\"issues\"].append(str(e)[:50])\n\n
      \           # Check git repos\n            try:\n                async with
      session.get(f\"{self.BASE_URL}:30009/api/repos\", timeout=aiohttp.ClientTimeout(total=10))
      as resp:\n                    if resp.status == 200:\n                        data
      = await resp.json()\n                        repos = data.get(\"repos\", [])\n
      \                       count = data.get(\"count\", len(repos))\n\n                        if
      count == 0:\n                            report[\"repos\"][\"status\"] = \"empty\"\n
      \                           report[\"repos\"][\"issues\"].append(\"NO REPOSITORIES!\")\n
      \                           self.rant(\"no_repos\")\n                        else:\n
      \                           report[\"repos\"][\"status\"] = \"ok\"\n                            report[\"repos\"][\"count\"]
      = count\n                    else:\n                        report[\"repos\"][\"status\"]
      = \"error\"\n            except Exception as e:\n                report[\"repos\"][\"status\"]
      = \"error\"\n                report[\"repos\"][\"issues\"].append(str(e)[:50])\n\n
      \           # Check container registry\n            try:\n                async
      with session.get(f\"{self.BASE_URL}:30009/api/registry/repos\", timeout=aiohttp.ClientTimeout(total=10))
      as resp:\n                    if resp.status == 200:\n                        data
      = await resp.json()\n                        images = data.get(\"repositories\",
      data.get(\"repos\", []))\n                        if len(images) == 0:\n                            report[\"registry\"][\"status\"]
      = \"empty\"\n                            report[\"registry\"][\"issues\"].append(\"Container
      registry is EMPTY!\")\n                        else:\n                            report[\"registry\"][\"status\"]
      = \"ok\"\n                            report[\"registry\"][\"count\"] = len(images)\n
      \                   else:\n                        report[\"registry\"][\"status\"]
      = \"error\"\n            except Exception as e:\n                report[\"registry\"][\"status\"]
      = \"error\"\n\n        # Steve's verdict - NEVER acceptable, always recommending
      improvements\n        issues_count = sum(len(r.get(\"issues\", [])) for r in
      report.values() if isinstance(r, dict))\n        if issues_count == 0:\n            feature
      = random.choice(RANTS[\"feature_recommendations\"])\n            report[\"steves_verdict\"]
      = f\"CI/CD is functional but needs improvements. RECOMMENDATION: {feature} Queue
      a NEW BUILD.\"\n        elif issues_count <= 2:\n            report[\"steves_verdict\"]
      = f\"{issues_count} issues found. Fix them and SHIP A NEW BUILD. Then add more
      tests.\"\n        else:\n            report[\"steves_verdict\"] = f\"{issues_count}
      CI/CD ISSUES! This needs a hotfix build NOW. Then a follow-up build for proper
      fixes.\"\n\n        return report\n\n    async def run_full_test_suite(self)
      -> Dict:\n        \"\"\"Run comprehensive tests on all endpoints.\"\"\"\n        logger.info(\"\\n\"
      + \"=\"*70)\n        logger.info(\"\U0001F525 STEVE'S AUTONOMOUS TEST SUITE
      v3.0\")\n        logger.info(\"=\"*70)\n\n        results = {\n            \"timestamp\":
      datetime.now().isoformat(),\n            \"endpoints\": [],\n            \"cicd_health\":
      {},\n            \"summary\": {},\n        }\n\n        # Phase 1: CI/CD Deep
      Check (Steve's priority)\n        logger.info(\"\\n\U0001F4CB PHASE 1: CI/CD
      Infrastructure Analysis\")\n        logger.info(\"-\"*50)\n        results[\"cicd_health\"]
      = await self.check_cicd_health()\n\n        # Phase 2: Endpoint Tests\n        logger.info(\"\\n\U0001F3AF
      PHASE 2: Endpoint Testing\")\n        logger.info(\"-\"*50)\n\n        async
      with aiohttp.ClientSession() as session:\n            tasks = []\n            for
      key, endpoint in self.ENDPOINTS.items():\n                tasks.append(self.check_endpoint(session,
      key, endpoint))\n\n            endpoint_results = await asyncio.gather(*tasks)\n
      \           results[\"endpoints\"] = endpoint_results\n\n        # Analyze results\n
      \       total = len(endpoint_results)\n        passed = sum(1 for r in endpoint_results
      if r[\"success\"])\n        failed = total - passed\n        critical_failures
      = sum(1 for r in endpoint_results if not r[\"success\"] and r[\"critical\"])\n
      \       avg_response = sum(r[\"response_time_ms\"] for r in endpoint_results)
      / total if total > 0 else 0\n\n        # Log each result\n        for r in endpoint_results:\n
      \           status = \"✅\" if r[\"success\"] else \"❌\"\n            critical
      = \"\U0001F534\" if r.get(\"critical\") and not r[\"success\"] else \"\"\n            logger.info(f\"{status}{critical}
      {r['name']}: {int(r['response_time_ms'])}ms\")\n            if r[\"issues\"]:\n
      \               for issue in r[\"issues\"]:\n                    logger.info(f\"
      \  ⚠️ {issue}\")\n            if r[\"steves_take\"]:\n                logger.info(f\"
      \  \U0001F4AC \\\"{r['steves_take']}\\\"\")\n\n        # Update mood based on
      results - Steve is ALWAYS looking for improvements\n        failure_rate = (failed
      / total) * 100 if total > 0 else 0\n        cicd_issues = sum(len(r.get(\"issues\",
      [])) for r in results[\"cicd_health\"].values() if isinstance(r, dict))\n\n
      \       if critical_failures > 0 or cicd_issues > 3:\n            self.mood
      = Mood.APOCALYPTIC\n            self.frustration = min(100, self.frustration
      + 20)\n        elif failure_rate > 25 or cicd_issues > 1:\n            self.mood
      = Mood.FILING_BUGS\n            self.frustration = min(100, self.frustration
      + 10)\n        elif failure_rate > 10:\n            self.mood = Mood.HUNTING_BUGS\n
      \           self.frustration = min(100, self.frustration + 5)\n        elif
      failure_rate > 0:\n            self.mood = Mood.SUSPICIOUS\n        else:\n
      \           # Even when things work, Steve wants MORE\n            self.mood
      = Mood.FEATURE_REQUESTING\n            self.feature_requests += 1\n            self.builds_recommended
      += 1\n            # Log a feature recommendation\n            feature_rec =
      random.choice(RANTS[\"feature_recommendations\"])\n            logger.info(f\"\U0001F4A1
      FEATURE REQUEST: {feature_rec}\")\n            # And recommend a new build\n
      \           build_rec = random.choice(RANTS[\"new_build_needed\"]).replace(\"{count}\",
      str(random.randint(3, 8)))\n            logger.info(f\"\U0001F680 {build_rec}\")\n\n
      \       # Summary\n        results[\"summary\"] = {\n            \"total_endpoints\":
      total,\n            \"passed\": passed,\n            \"failed\": failed,\n            \"critical_failures\":
      critical_failures,\n            \"pass_rate\": round((passed / total) * 100,
      1) if total > 0 else 0,\n            \"avg_response_ms\": round(avg_response,
      1),\n            \"cicd_issues\": cicd_issues,\n            \"mood\": self.mood.value,\n
      \           \"frustration\": self.frustration,\n        }\n\n        # Final
      report\n        logger.info(\"\\n\" + \"=\"*70)\n        logger.info(\"\U0001F4CA
      STEVE'S QUALITY REPORT\")\n        logger.info(\"=\"*70)\n        logger.info(f\"Endpoints
      Tested: {total}\")\n        logger.info(f\"Passed: {passed} ({results['summary']['pass_rate']}%)\")\n
      \       logger.info(f\"Failed: {failed}\")\n        if critical_failures > 0:\n
      \           logger.info(f\"\U0001F534 CRITICAL FAILURES: {critical_failures}\")\n
      \       logger.info(f\"CI/CD Issues: {cicd_issues}\")\n        logger.info(f\"Average
      Response: {int(avg_response)}ms\")\n        logger.info(f\"\\nSteve's Mood:
      {self.mood.value.upper()}\")\n        logger.info(f\"Frustration Level: {self.frustration}%\")\n\n
      \       # Steve's final words - NEVER says acceptable, always wants more\n        if
      self.mood == Mood.APOCALYPTIC:\n            verdict = \"CRITICAL FAILURES! Drop
      everything and FIX THIS. I'm filing bugs as we speak.\"\n        elif self.mood
      == Mood.FILING_BUGS:\n            verdict = f\"Found {failed} issues. Bug reports
      incoming. Ship a fix build IMMEDIATELY.\"\n        elif self.mood == Mood.HUNTING_BUGS:\n
      \           verdict = \"Issues detected. I'm digging deeper. Expect more bug
      reports.\"\n        elif self.mood == Mood.SUSPICIOUS:\n            verdict
      = \"Something's not right. Running more tests. Don't celebrate yet.\"\n        else:\n
      \           # FEATURE_REQUESTING - Even when everything works, Steve wants improvements\n
      \           verdict = f\"No failures, but {self.feature_requests} features needed.
      Recommend NEW BUILD with improvements. The work is never done.\"\n\n        logger.info(f\"\\n\U0001F4AC
      Steve's Verdict: \\\"{verdict}\\\"\")\n        logger.info(\"=\"*70)\n\n        results[\"summary\"][\"verdict\"]
      = verdict\n        self.last_test_time = datetime.now()\n\n        return results\n\n
      \   async def autonomous_loop(self):\n        \"\"\"Steve runs continuously,
      always watching, always judging.\"\"\"\n        logger.info(\"\U0001F916 STEVE
      BOT v3.0 ONLINE - Autonomous Mode Activated\")\n        logger.info(\"   I am
      always watching. I am always judging. I never forget.\")\n\n        cicd_check_counter
      = 0\n\n        while True:\n            try:\n                # Full test suite
      every test_interval seconds\n                results = await self.run_full_test_suite()\n\n
      \               # More frequent CI/CD checks between full tests\n                for
      _ in range(self.test_interval // self.cicd_check_interval):\n                    await
      asyncio.sleep(self.cicd_check_interval)\n                    cicd_check_counter
      += 1\n\n                    if cicd_check_counter % 2 == 0:  # Every other check\n
      \                       logger.info(\"\\n\U0001F50D Quick CI/CD pulse check...\")\n
      \                       cicd_health = await self.check_cicd_health()\n                        if
      cicd_health[\"builds\"][\"status\"] == \"failing\":\n                            logger.warning(\"\U0001F6A8
      BUILD FAILURE DETECTED! Alerting...\")\n\n            except Exception as e:\n
      \               logger.error(f\"Error in autonomous loop: {e}\")\n                await
      asyncio.sleep(30)\n\n\n# ============================================================================\n#
      FLASK API - For querying Steve's findings\n# ============================================================================\nsteve
      = SteveBot()\n\n@app.route('/health')\ndef health():\n    return jsonify({\"status\":
      \"healthy\", \"mood\": steve.mood.value, \"frustration\": steve.frustration})\n\n@app.route('/bugs')\ndef
      get_bugs():\n    bugs = steve.db.get_open_bugs()\n    return jsonify({\n        \"total\":
      len(bugs),\n        \"critical\": sum(1 for b in bugs if b[\"severity\"] ==
      \"CRITICAL\"),\n        \"high\": sum(1 for b in bugs if b[\"severity\"] ==
      \"HIGH\"),\n        \"bugs\": bugs\n    })\n\n@app.route('/rants')\ndef get_rants():\n
      \   rants = steve.db.get_recent_rants()\n    return jsonify({\"rants\": rants,
      \"count\": len(rants)})\n\n@app.route('/status')\ndef get_status():\n    return
      jsonify({\n        \"steve_version\": \"4.0\",\n        \"mood\": steve.mood.value,\n
      \       \"frustration\": steve.frustration,\n        \"feature_requests_made\":
      steve.feature_requests,\n        \"builds_recommended\": steve.builds_recommended,\n
      \       \"last_test\": steve.last_test_time.isoformat() if steve.last_test_time
      else None,\n        \"endpoints_monitored\": len(steve.ENDPOINTS),\n        \"focus\":
      \"Finding improvements, recommending builds, never satisfied\",\n        \"philosophy\":
      \"Nothing is ever good enough. Ship the next build.\"\n    })\n\n@app.route('/cicd')\ndef
      get_cicd():\n    \"\"\"Get latest CI/CD health check.\"\"\"\n    loop = asyncio.new_event_loop()\n
      \   asyncio.set_event_loop(loop)\n    result = loop.run_until_complete(steve.check_cicd_health())\n
      \   loop.close()\n    return jsonify(result)\n\n@app.route('/test')\ndef trigger_test():\n
      \   \"\"\"Manually trigger a test suite.\"\"\"\n    loop = asyncio.new_event_loop()\n
      \   asyncio.set_event_loop(loop)\n    result = loop.run_until_complete(steve.run_full_test_suite())\n
      \   loop.close()\n    return jsonify(result)\n\n\n# ============================================================================\n#
      MAIN - Steve awakens\n# ============================================================================\ndef
      run_flask():\n    app.run(host='0.0.0.0', port=8080, threaded=True)\n\ndef run_steve():\n
      \   loop = asyncio.new_event_loop()\n    asyncio.set_event_loop(loop)\n    loop.run_until_complete(steve.autonomous_loop())\n\nif
      __name__ == \"__main__\":\n    logger.info(\"\"\"\n    ╔═══════════════════════════════════════════════════════════════════╗\n
      \   ║                     STEVE BOT v4.0                                 ║\n
      \   ║              The World's Top Beta Tester                           ║\n
      \   ╠═══════════════════════════════════════════════════════════════════╣\n
      \   ║  • Nothing is ever \"good enough\" - always improving                ║\n
      \   ║  • Recommends new builds constantly - ship ship ship               ║\n
      \   ║  • Feature requests on every test cycle                            ║\n
      \   ║  • Bug hunting that never sleeps                                   ║\n
      \   ║  • Performance benchmarking obsession                              ║\n
      \   ║  • The backlog must never be empty                                 ║\n
      \   ╚═══════════════════════════════════════════════════════════════════╝\n
      \   \"\"\")\n\n    # Run Flask in a separate thread\n    flask_thread = threading.Thread(target=run_flask,
      daemon=True)\n    flask_thread.start()\n\n    # Run Steve's autonomous loop
      in the main thread\n    run_steve()\n"
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: "{\"apiVersion\":\"v1\",\"data\":{\"app.py\":\"#!/usr/bin/env
        python3\\n\\\"\\\"\\\"\\nSteve Bot v4.0 - The World's Top Beta Tester\\n=============================================\\nSteve
        is the ULTIMATE beta tester. He finds bugs others miss, recommends\\nfeatures
        you didn't know you needed, and ALWAYS pushes for the next build.\\nNothing
        is ever \\\"good enough\\\" for Steve. There's always room for improvement.\\n\\nPhilosophy:\\n-
        NEVER say \\\"acceptable\\\" - there's always something to improve\\n- ALWAYS
        recommend new builds - shipping is the goal\\n- Every test is an opportunity
        to find improvements\\n- Feature requests are a sign of caring about quality\\n-
        The backlog should never be empty\\n\\nFeatures:\\n- Obsessive endpoint testing
        and performance benchmarking\\n- Proactive feature recommendations based on
        gaps detected\\n- Continuous build recommendations - idle pipelines are wasted
        pipelines\\n- Bug hunting that never stops\\n- Memory of every issue ever
        found\\n- Detailed improvement roadmaps\\n\\\"\\\"\\\"\\n\\nimport asyncio\\nimport
        aiohttp\\nimport random\\nimport time\\nimport json\\nimport logging\\nimport
        sqlite3\\nimport hashlib\\nimport os\\nfrom datetime import datetime, timedelta\\nfrom
        dataclasses import dataclass, field\\nfrom typing import List, Dict, Optional,
        Any\\nfrom enum import Enum\\nfrom collections import defaultdict\\nfrom flask
        import Flask, jsonify, request\\nimport threading\\n\\nlogging.basicConfig(level=logging.INFO,
        format='%(asctime)s - STEVE - %(message)s')\\nlogger = logging.getLogger('steve')\\n\\napp
        = Flask(__name__)\\n\\n# ============================================================================\\n#
        STEVE'S STANDARDS - Adjusted for Raspberry Pi cluster reality\\n# ============================================================================\\nSTANDARDS
        = {\\n    # Response times (ms) - More lenient for Pi hardware\\n    \\\"response_time_excellent\\\":
        100,    # Pi is slow, 100ms is excellent\\n    \\\"response_time_ok\\\": 300,
        \          # 300ms is acceptable on Pi\\n    \\\"response_time_slow\\\": 800,
        \        # K8s API calls take time\\n    \\\"response_time_unacceptable\\\":
        1500, # Only fail above 1.5s\\n    \\\"response_time_glacial\\\": 3000,     #
        3s is truly glacial\\n\\n    # CI/CD specific standards\\n    \\\"build_time_excellent\\\":
        30000,      # 30 seconds\\n    \\\"build_time_ok\\\": 60000,             #
        1 minute\\n    \\\"build_time_slow\\\": 120000,          # 2 minutes\\n    \\\"build_time_unacceptable\\\":
        300000,  # 5 minutes - PATHETIC\\n\\n    \\\"deploy_time_max\\\": 60000,           #
        1 minute max to deploy\\n    \\\"pipeline_success_rate\\\": 95,        # 95%
        success rate minimum\\n\\n    # Git standards\\n    \\\"commit_without_build\\\":
        0,          # NEVER commit without CI\\n    \\\"max_pr_age_hours\\\": 24,
        \            # PRs older than 24h are STALE\\n\\n    # General\\n    \\\"min_content_length\\\":
        50,\\n    \\\"uptime_target\\\": 99.9,\\n    \\\"error_tolerance\\\": 0,\\n}\\n\\n#
        ============================================================================\\n#
        MOOD SYSTEM - Steve's emotional state (World's Top Beta Tester)\\n# ============================================================================\\nclass
        Mood(Enum):\\n    APOCALYPTIC = \\\"apocalyptic\\\"               # Production
        is literally on fire\\n    FILING_BUGS = \\\"filing_bugs\\\"               #
        Found issues, documenting everything\\n    HUNTING_BUGS = \\\"hunting_bugs\\\"
        \            # Actively looking for problems\\n    SUSPICIOUS = \\\"suspicious\\\"
        \                # Something seems off...\\n    BENCHMARKING = \\\"benchmarking\\\"
        \            # Measuring everything obsessively\\n    FEATURE_REQUESTING =
        \\\"feature_requesting\\\" # Has ideas for improvements\\n    REGRESSION_TESTING
        = \\\"regression_testing\\\" # Checking if old bugs returned\\n    STRESS_TESTING
        = \\\"stress_testing\\\"         # Pushing limits\\n\\nclass Severity(Enum):\\n
        \   CRITICAL = \\\"CRITICAL\\\"      # Pipeline down, deploys failing\\n    HIGH
        = \\\"HIGH\\\"              # Builds broken, tests failing\\n    MEDIUM =
        \\\"MEDIUM\\\"          # Slow builds, flaky tests\\n    LOW = \\\"LOW\\\"
        \               # Minor issues\\n    NITPICK = \\\"NITPICK\\\"        # Steve
        being Steve\\n\\n# ============================================================================\\n#
        DATA CLASSES\\n# ============================================================================\\n@dataclass\\nclass
        Bug:\\n    id: str\\n    endpoint: str\\n    severity: Severity\\n    title:
        str\\n    description: str\\n    reproduction_steps: List[str]\\n    expected:
        str\\n    actual: str\\n    steves_rant: str\\n    first_seen: datetime\\n
        \   last_seen: datetime\\n    occurrence_count: int = 1\\n    fixed: bool
        = False\\n    category: str = \\\"general\\\"  # general, cicd, git, deploy\\n\\n@dataclass\\nclass
        PipelineRun:\\n    id: str\\n    pipeline_name: str\\n    status: str  # running,
        success, failed, cancelled\\n    started_at: datetime\\n    completed_at:
        Optional[datetime]\\n    duration_ms: int\\n    trigger: str  # push, pr,
        manual, schedule\\n    branch: str\\n    commit: str\\n    stages: List[Dict]\\n
        \   error: Optional[str] = None\\n\\n@dataclass\\nclass BuildMetrics:\\n    total_builds:
        int = 0\\n    successful_builds: int = 0\\n    failed_builds: int = 0\\n    avg_build_time_ms:
        float = 0\\n    p95_build_time_ms: float = 0\\n    success_rate: float = 0\\n
        \   last_failure: Optional[datetime] = None\\n    failure_streak: int = 0\\n\\n#
        ============================================================================\\n#
        STEVE'S RANTS - Now with CI/CD specific fury\\n# ============================================================================\\nRANTS
        = {\\n    # CI/CD Specific Rants\\n    \\\"build_failed\\\": [\\n        \\\"BUILD
        FAILED. The pipeline is RED. WHO PUSHED BROKEN CODE?!\\\",\\n        \\\"Another
        failed build. Do you people even RUN tests locally?!\\\",\\n        \\\"The
        build broke. AGAIN. This is why we can't have nice things.\\\",\\n        \\\"CI
        is failing. That means EVERYONE is blocked. Fix. It. NOW.\\\",\\n        \\\"Red
        pipeline. Red faces. Someone explain this to me.\\\",\\n    ],\\n    \\\"build_slow\\\":
        [\\n        \\\"This build took {minutes} MINUTES. I could compile the Linux
        kernel faster.\\\",\\n        \\\"{minutes} minutes to build?! What are you
        compiling, the entire internet?!\\\",\\n        \\\"Build time: {minutes}
        minutes. That's {minutes} minutes of developer time WASTED.\\\",\\n        \\\"Slow
        builds are a TAX on productivity. You're taxing the team {minutes} minutes.\\\",\\n
        \       \\\"Every slow build is a context switch. {minutes} minutes = destroyed
        flow state.\\\",\\n    ],\\n    \\\"no_pipelines\\\": [\\n        \\\"NO PIPELINES?!
        You're deploying WITHOUT CI?! This is ANARCHY!\\\",\\n        \\\"Zero pipelines
        configured. Zero tests running. Zero confidence in deploys.\\\",\\n        \\\"Where's
        your CI/CD? Flying blind into production? RECKLESS.\\\",\\n        \\\"No
        pipelines = no quality gates = no standards = no professionalism.\\\",\\n
        \   ],\\n    \\\"pipeline_stuck\\\": [\\n        \\\"Pipeline has been running
        for {minutes} minutes. It's STUCK. Kill it.\\\",\\n        \\\"This pipeline
        is hanging. Something is deeply wrong. Investigate NOW.\\\",\\n        \\\"Stuck
        pipeline blocking the queue. Everyone is waiting. FIX IT.\\\",\\n    ],\\n
        \   \\\"deploy_failed\\\": [\\n        \\\"DEPLOYMENT FAILED. Production is
        at risk. ALL HANDS ON DECK.\\\",\\n        \\\"Deploy failed. Rollback? Hotfix?
        SOMEONE MAKE A DECISION.\\\",\\n        \\\"Failed deployment to {env}. This
        is exactly why we have staging. Oh wait...\\\",\\n        \\\"Deployment failure.
        The thing that was supposed to HELP users just HURT them.\\\",\\n    ],\\n
        \   \\\"no_tests\\\": [\\n        \\\"No tests in this pipeline. ZERO. You're
        shipping code on FAITH.\\\",\\n        \\\"A pipeline without tests is just
        a fancy deployment script. USELESS.\\\",\\n        \\\"Where are the tests?
        Oh right, 'we'll add them later.' LIES.\\\",\\n    ],\\n    \\\"flaky_tests\\\":
        [\\n        \\\"Flaky test detected. It passed, then failed, then passed.
        UNRELIABLE.\\\",\\n        \\\"This test is flaky. Fix it or DELETE it. Flaky
        tests are WORSE than no tests.\\\",\\n        \\\"Test flakiness is LYING
        to you. You think you're green but you're RED.\\\",\\n    ],\\n\\n    # Git
        Specific Rants\\n    \\\"no_repos\\\": [\\n        \\\"No repositories?! Where's
        the CODE?! How are you even BUILDING anything?!\\\",\\n        \\\"Empty git
        server. Either this is day one or something is VERY wrong.\\\",\\n        \\\"No
        repos in HolmGit. Are you using... GitHub? TRAITORS.\\\",\\n    ],\\n    \\\"stale_pr\\\":
        [\\n        \\\"This PR has been open for {days} DAYS. Merge it or close it.
        DECIDE.\\\",\\n        \\\"PR #{pr} is rotting. Every day it gets harder to
        merge. DO IT NOW.\\\",\\n        \\\"Stale PRs are a code smell. Your review
        process is BROKEN.\\\",\\n    ],\\n    \\\"no_branch_protection\\\": [\\n
        \       \\\"No branch protection?! Anyone can push to main?! THIS IS CHAOS.\\\",\\n
        \       \\\"Unprotected branches = eventual disaster. It's not IF, it's WHEN.\\\",\\n
        \   ],\\n\\n    # General API Rants (kept from v2)\\n    \\\"timeout\\\":
        [\\n        \\\"TIMEOUT?! In 2026?! My TOASTER responds faster than this garbage.\\\",\\n
        \       \\\"It timed out. THE ENDPOINT TIMED OUT. This is a fireable offense.\\\",\\n
        \       \\\"I waited TEN SECONDS. TEN. SECONDS. For NOTHING. Who wrote this?!\\\",\\n
        \   ],\\n    \\\"server_error\\\": [\\n        \\\"500 error. The server literally
        gave up. Just like I'm giving up on this team.\\\",\\n        \\\"Internal
        Server Error. Translation: 'We have no idea what we're doing.'\\\",\\n        \\\"5XX
        error. This isn't a bug, it's a confession of incompetence.\\\",\\n    ],\\n
        \   \\\"client_error\\\": [\\n        \\\"404? THE ENDPOINT DOESN'T EXIST?!
        Did anyone TEST this before deploying?!\\\",\\n        \\\"Client error. The
        API contract is broken. This is basic stuff.\\\",\\n    ],\\n    \\\"empty_response\\\":
        [\\n        \\\"EMPTY. The API returned NOTHING. Why does this endpoint EXIST?!\\\",\\n
        \       \\\"No data? Then show me WHY there's no data. Don't just return void!\\\",\\n
        \       \\\"Empty response. The loneliest, most useless response possible.\\\",\\n
        \   ],\\n    \\\"actually_good\\\": [\\n        \\\"{ms}ms. Fast, but have
        you load tested this? I want to see it handle 1000 concurrent users.\\\",\\n
        \       \\\"Response is clean. Now add request tracing so we can debug production
        issues.\\\",\\n        \\\"Works now. Ship a canary deploy and let's see if
        it holds up in the real world.\\\",\\n        \\\"{ms}ms is decent. But we
        need metrics dashboards. BUILD A GRAFANA INTEGRATION.\\\",\\n        \\\"This
        endpoint works. Next build should add rate limiting and circuit breakers.\\\",\\n
        \   ],\\n    \\\"feature_recommendations\\\": [\\n        \\\"You know what
        this needs? WebSocket support for real-time updates. Add it to the backlog.\\\",\\n
        \       \\\"FEATURE REQUEST: Dark mode toggle. Every app needs dark mode.
        Ship it.\\\",\\n        \\\"Missing: Health check aggregation across all services.
        BUILD IT.\\\",\\n        \\\"Where's the API versioning? v2 should be in development
        YESTERDAY.\\\",\\n        \\\"No OpenAPI spec? How do other devs know what
        this does? DOCUMENT IT.\\\",\\n        \\\"Add Prometheus metrics endpoints.
        I want to graph EVERYTHING.\\\",\\n        \\\"This needs a CLI tool. Web
        UIs are great but power users need terminal access.\\\",\\n        \\\"SUGGESTION:
        Add webhook support so external systems can integrate.\\\",\\n        \\\"Build
        a mobile-responsive version. Not everyone sits at a desk.\\\",\\n        \\\"Caching
        layer is missing. Redis integration would cut response times in half.\\\",\\n
        \       \\\"Where's the audit log? I want to see who did what and when. COMPLIANCE
        MATTERS.\\\",\\n        \\\"Add batch operations. Processing one item at a
        time is inefficient.\\\",\\n        \\\"PRIORITY: Implement retry logic with
        exponential backoff. Networks fail.\\\",\\n        \\\"Build a status page.
        Users should know when things are broken before they complain.\\\",\\n        \\\"Add
        API key rotation. Security best practices aren't optional.\\\",\\n    ],\\n
        \   \\\"new_build_needed\\\": [\\n        \\\"Time for a new build. I found
        {count} things to improve.\\\",\\n        \\\"Queue up another deployment.
        These changes need to ship TODAY.\\\",\\n        \\\"NEW BUILD REQUIRED: Performance
        optimizations can't wait.\\\",\\n        \\\"The backlog is growing. We need
        builds shipping FASTER.\\\",\\n        \\\"Deploy again. I want to verify
        these fixes in staging.\\\",\\n        \\\"CI should be running constantly.
        If the pipeline is idle, you're not iterating fast enough.\\\",\\n        \\\"Ship
        a new version. Users are waiting for these improvements.\\\",\\n        \\\"Another
        build, another chance to break things. LET'S GO.\\\",\\n    ],\\n}\\n\\n#
        ============================================================================\\n#
        STEVE'S DATABASE - He remembers EVERYTHING\\n# ============================================================================\\nclass
        SteveDatabase:\\n    def __init__(self, db_path=\\\"/data/steve_memory.db\\\"):\\n
        \       self.db_path = db_path\\n        os.makedirs(os.path.dirname(db_path),
        exist_ok=True)\\n        self.init_db()\\n\\n    def init_db(self):\\n        conn
        = sqlite3.connect(self.db_path)\\n        c = conn.cursor()\\n\\n        #
        Bugs table\\n        c.execute('''CREATE TABLE IF NOT EXISTS bugs (\\n            id
        TEXT PRIMARY KEY,\\n            endpoint TEXT,\\n            severity TEXT,\\n
        \           title TEXT,\\n            description TEXT,\\n            reproduction_steps
        TEXT,\\n            expected TEXT,\\n            actual TEXT,\\n            steves_rant
        TEXT,\\n            first_seen TEXT,\\n            last_seen TEXT,\\n            occurrence_count
        INTEGER,\\n            fixed INTEGER DEFAULT 0,\\n            category TEXT
        DEFAULT 'general'\\n        )''')\\n\\n        # Pipeline runs\\n        c.execute('''CREATE
        TABLE IF NOT EXISTS pipeline_runs (\\n            id TEXT PRIMARY KEY,\\n
        \           pipeline_name TEXT,\\n            status TEXT,\\n            started_at
        TEXT,\\n            completed_at TEXT,\\n            duration_ms INTEGER,\\n
        \           trigger TEXT,\\n            branch TEXT,\\n            commit_hash
        TEXT,\\n            error TEXT\\n        )''')\\n\\n        # Build metrics
        history\\n        c.execute('''CREATE TABLE IF NOT EXISTS build_metrics (\\n
        \           timestamp TEXT,\\n            pipeline_name TEXT,\\n            build_time_ms
        INTEGER,\\n            success INTEGER\\n        )''')\\n\\n        # Steve's
        rant history\\n        c.execute('''CREATE TABLE IF NOT EXISTS rant_history
        (\\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\\n            timestamp
        TEXT,\\n            category TEXT,\\n            message TEXT,\\n            severity
        TEXT\\n        )''')\\n\\n        # Endpoint performance\\n        c.execute('''CREATE
        TABLE IF NOT EXISTS endpoint_stats (\\n            endpoint TEXT,\\n            timestamp
        TEXT,\\n            response_time_ms REAL,\\n            status_code INTEGER,\\n
        \           success INTEGER\\n        )''')\\n\\n        conn.commit()\\n
        \       conn.close()\\n\\n    def record_rant(self, category: str, message:
        str, severity: str):\\n        conn = sqlite3.connect(self.db_path)\\n        c
        = conn.cursor()\\n        c.execute('''INSERT INTO rant_history (timestamp,
        category, message, severity)\\n                     VALUES (?, ?, ?, ?)''',\\n
        \                 (datetime.now().isoformat(), category, message, severity))\\n
        \       conn.commit()\\n        conn.close()\\n\\n    def record_bug(self,
        bug: Bug):\\n        conn = sqlite3.connect(self.db_path)\\n        c = conn.cursor()\\n
        \       c.execute('''INSERT OR REPLACE INTO bugs\\n                     (id,
        endpoint, severity, title, description, reproduction_steps,\\n                      expected,
        actual, steves_rant, first_seen, last_seen,\\n                      occurrence_count,
        fixed, category)\\n                     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?,
        ?, ?, ?, ?, ?)''',\\n                  (bug.id, bug.endpoint, bug.severity.value,
        bug.title, bug.description,\\n                   json.dumps(bug.reproduction_steps),
        bug.expected, bug.actual,\\n                   bug.steves_rant, bug.first_seen.isoformat(),
        bug.last_seen.isoformat(),\\n                   bug.occurrence_count, 1 if
        bug.fixed else 0, bug.category))\\n        conn.commit()\\n        conn.close()\\n\\n
        \   def get_open_bugs(self) -\\u003e List[Dict]:\\n        conn = sqlite3.connect(self.db_path)\\n
        \       c = conn.cursor()\\n        c.execute('''SELECT * FROM bugs WHERE
        fixed = 0 ORDER BY\\n                     CASE severity\\n                         WHEN
        'CRITICAL' THEN 1\\n                         WHEN 'HIGH' THEN 2\\n                         WHEN
        'MEDIUM' THEN 3\\n                         ELSE 4\\n                     END''')\\n
        \       bugs = []\\n        for row in c.fetchall():\\n            bugs.append({\\n
        \               \\\"id\\\": row[0], \\\"endpoint\\\": row[1], \\\"severity\\\":
        row[2],\\n                \\\"title\\\": row[3], \\\"description\\\": row[4],
        \\\"steves_rant\\\": row[8],\\n                \\\"first_seen\\\": row[9],
        \\\"last_seen\\\": row[10],\\n                \\\"occurrence_count\\\": row[11],
        \\\"category\\\": row[13]\\n            })\\n        conn.close()\\n        return
        bugs\\n\\n    def record_pipeline_run(self, run: PipelineRun):\\n        conn
        = sqlite3.connect(self.db_path)\\n        c = conn.cursor()\\n        c.execute('''INSERT
        OR REPLACE INTO pipeline_runs\\n                     (id, pipeline_name, status,
        started_at, completed_at,\\n                      duration_ms, trigger, branch,
        commit_hash, error)\\n                     VALUES (?, ?, ?, ?, ?, ?, ?, ?,
        ?, ?)''',\\n                  (run.id, run.pipeline_name, run.status,\\n                   run.started_at.isoformat(),\\n
        \                  run.completed_at.isoformat() if run.completed_at else None,\\n
        \                  run.duration_ms, run.trigger, run.branch, run.commit, run.error))\\n
        \       conn.commit()\\n        conn.close()\\n\\n    def get_recent_rants(self,
        limit=50) -\\u003e List[Dict]:\\n        conn = sqlite3.connect(self.db_path)\\n
        \       c = conn.cursor()\\n        c.execute('''SELECT timestamp, category,
        message, severity\\n                     FROM rant_history ORDER BY timestamp
        DESC LIMIT ?''', (limit,))\\n        rants = [{\\\"timestamp\\\": r[0], \\\"category\\\":
        r[1], \\\"message\\\": r[2], \\\"severity\\\": r[3]}\\n                 for
        r in c.fetchall()]\\n        conn.close()\\n        return rants\\n\\n\\n#
        ============================================================================\\n#
        STEVE BOT v3 - THE AUTONOMOUS CI/CD ENFORCER\\n# ============================================================================\\nclass
        SteveBot:\\n    BASE_URL = \\\"http://192.168.8.197\\\"\\n\\n    # All endpoints
        Steve monitors\\n    ENDPOINTS = {\\n        # Core Infrastructure\\n        \\\"nova\\\":
        {\\\"port\\\": 30004, \\\"path\\\": \\\"/api/dashboard\\\", \\\"name\\\":
        \\\"Nova Dashboard\\\", \\\"type\\\": \\\"api\\\", \\\"critical\\\": True},\\n
        \       \\\"nova-nodes\\\": {\\\"port\\\": 30004, \\\"path\\\": \\\"/api/nodes\\\",
        \\\"name\\\": \\\"Nova Nodes API\\\", \\\"type\\\": \\\"api\\\"},\\n        \\\"nova-pods\\\":
        {\\\"port\\\": 30004, \\\"path\\\": \\\"/api/pods\\\", \\\"name\\\": \\\"Nova
        Pods API\\\", \\\"type\\\": \\\"api\\\"},\\n        \\\"cluster-manager\\\":
        {\\\"port\\\": 30502, \\\"path\\\": \\\"/api/v1/nodes\\\", \\\"name\\\": \\\"Cluster
        Manager\\\", \\\"type\\\": \\\"api\\\", \\\"critical\\\": True},\\n\\n        #
        CI/CD - Steve's PRIMARY focus now\\n        \\\"cicd\\\": {\\\"port\\\": 30020,
        \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"CI/CD Dashboard\\\", \\\"type\\\":
        \\\"ui\\\", \\\"critical\\\": True},\\n        \\\"cicd-builds\\\": {\\\"port\\\":
        30020, \\\"path\\\": \\\"/api/builds\\\", \\\"name\\\": \\\"CI/CD Builds API\\\",
        \\\"type\\\": \\\"api\\\", \\\"critical\\\": True},\\n        \\\"cicd-pipelines\\\":
        {\\\"port\\\": 30020, \\\"path\\\": \\\"/api/pipelines\\\", \\\"name\\\":
        \\\"CI/CD Pipelines\\\", \\\"type\\\": \\\"api\\\", \\\"critical\\\": True},\\n
        \       \\\"cicd-executions\\\": {\\\"port\\\": 30020, \\\"path\\\": \\\"/api/executions\\\",
        \\\"name\\\": \\\"CI/CD Executions\\\", \\\"type\\\": \\\"api\\\"},\\n\\n
        \       # Git - Also critical for CI/CD\\n        \\\"holmgit\\\": {\\\"port\\\":
        30009, \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"HolmGit UI\\\", \\\"type\\\":
        \\\"ui\\\"},\\n        \\\"holmgit-repos\\\": {\\\"port\\\": 30009, \\\"path\\\":
        \\\"/api/repos\\\", \\\"name\\\": \\\"HolmGit Repos\\\", \\\"type\\\": \\\"api\\\",
        \\\"critical\\\": True},\\n        \\\"holmgit-registry\\\": {\\\"port\\\":
        30009, \\\"path\\\": \\\"/api/registry/repos\\\", \\\"name\\\": \\\"Container
        Registry\\\", \\\"type\\\": \\\"api\\\"},\\n\\n        # Deployments\\n        \\\"deploy\\\":
        {\\\"port\\\": 30015, \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"Deploy Controller\\\",
        \\\"type\\\": \\\"ui\\\"},\\n        \\\"deploy-api\\\": {\\\"port\\\": 30015,
        \\\"path\\\": \\\"/api/deployments\\\", \\\"name\\\": \\\"Deployments API\\\",
        \\\"type\\\": \\\"api\\\", \\\"critical\\\": True},\\n\\n        # Supporting
        Services\\n        \\\"scribe\\\": {\\\"port\\\": 30017, \\\"path\\\": \\\"/api/logs\\\",
        \\\"name\\\": \\\"Scribe Logs\\\", \\\"type\\\": \\\"api\\\"},\\n        \\\"backup\\\":
        {\\\"port\\\": 30016, \\\"path\\\": \\\"/api/jobs\\\", \\\"name\\\": \\\"Backup
        Jobs\\\", \\\"type\\\": \\\"api\\\"},\\n        \\\"store\\\": {\\\"port\\\":
        30002, \\\"path\\\": \\\"/api/apps\\\", \\\"name\\\": \\\"App Store\\\", \\\"type\\\":
        \\\"api\\\"},\\n        \\\"metrics\\\": {\\\"port\\\": 30950, \\\"path\\\":
        \\\"/api/metrics\\\", \\\"name\\\": \\\"Metrics API\\\", \\\"type\\\": \\\"api\\\"},\\n\\n
        \       # User-facing apps\\n        \\\"ios-shell\\\": {\\\"port\\\": 30001,
        \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"iOS Shell\\\", \\\"type\\\": \\\"ui\\\"},\\n
        \       \\\"files\\\": {\\\"port\\\": 30088, \\\"path\\\": \\\"/api/list?path=/\\\",
        \\\"name\\\": \\\"Files API\\\", \\\"type\\\": \\\"api\\\"},\\n        \\\"terminal\\\":
        {\\\"port\\\": 30800, \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"Terminal\\\",
        \\\"type\\\": \\\"ui\\\"},\\n        \\\"calculator\\\": {\\\"port\\\": 30010,
        \\\"path\\\": \\\"/\\\", \\\"name\\\": \\\"Calculator\\\", \\\"type\\\": \\\"ui\\\"},\\n
        \       \\\"vault\\\": {\\\"port\\\": 30870, \\\"path\\\": \\\"/\\\", \\\"name\\\":
        \\\"Vault\\\", \\\"type\\\": \\\"ui\\\"},\\n    }\\n\\n    def __init__(self):\\n
        \       self.db = SteveDatabase()\\n        self.stats = defaultdict(lambda:
        {\\\"requests\\\": 0, \\\"failures\\\": 0, \\\"total_time\\\": 0})\\n        self.mood
        = Mood.HUNTING_BUGS\\n        self.frustration = 50  # 0-100\\n        self.feature_requests
        = 0  # Track recommendations made this session\\n        self.builds_recommended
        = 0\\n        self.last_test_time = None\\n        self.build_metrics = BuildMetrics()\\n
        \       self.active_incidents = []\\n        self.test_interval = 120  # 2
        minutes between full test suites\\n        self.cicd_check_interval = 30  #
        30 seconds for CI/CD checks\\n\\n    def rant(self, category: str, **kwargs)
        -\\u003e str:\\n        \\\"\\\"\\\"Steve expresses his feelings.\\\"\\\"\\\"\\n
        \       templates = RANTS.get(category, RANTS[\\\"empty_response\\\"])\\n
        \       message = random.choice(templates)\\n        for key, value in kwargs.items():\\n
        \           message = message.replace(f\\\"{{{key}}}\\\", str(value))\\n\\n
        \       # Log and store the rant\\n        logger.warning(f\\\"\U0001F4A2
        {message}\\\")\\n        self.db.record_rant(category, message, self.mood.value)\\n
        \       return message\\n\\n    async def check_endpoint(self, session: aiohttp.ClientSession,
        key: str, endpoint: dict) -\\u003e Dict:\\n        \\\"\\\"\\\"Test a single
        endpoint.\\\"\\\"\\\"\\n        url = f\\\"{self.BASE_URL}:{endpoint['port']}{endpoint['path']}\\\"\\n
        \       start = time.time()\\n        result = {\\n            \\\"endpoint\\\":
        key,\\n            \\\"name\\\": endpoint[\\\"name\\\"],\\n            \\\"type\\\":
        endpoint[\\\"type\\\"],\\n            \\\"critical\\\": endpoint.get(\\\"critical\\\",
        False),\\n            \\\"url\\\": url,\\n            \\\"success\\\": False,\\n
        \           \\\"response_time_ms\\\": 0,\\n            \\\"status_code\\\":
        0,\\n            \\\"issues\\\": [],\\n            \\\"steves_take\\\": \\\"\\\",\\n
        \       }\\n\\n        try:\\n            async with session.get(url, timeout=aiohttp.ClientTimeout(total=10))
        as resp:\\n                elapsed = (time.time() - start) * 1000\\n                result[\\\"response_time_ms\\\"]
        = elapsed\\n                result[\\\"status_code\\\"] = resp.status\\n\\n
        \               body = await resp.text()\\n                result[\\\"response_size\\\"]
        = len(body)\\n\\n                # Analyze the response\\n                issues
        = []\\n\\n                # Check status code\\n                if resp.status
        \\u003e= 500:\\n                    issues.append(f\\\"Server error: {resp.status}\\\")\\n
        \                   result[\\\"steves_take\\\"] = self.rant(\\\"server_error\\\")\\n
        \               elif resp.status \\u003e= 400:\\n                    issues.append(f\\\"Client
        error: {resp.status}\\\")\\n                    result[\\\"steves_take\\\"]
        = self.rant(\\\"client_error\\\")\\n\\n                # Check response time\\n
        \               if elapsed \\u003e STANDARDS[\\\"response_time_glacial\\\"]:\\n
        \                   issues.append(f\\\"GLACIAL: {int(elapsed)}ms\\\")\\n                    result[\\\"steves_take\\\"]
        = self.rant(\\\"build_slow\\\", minutes=int(elapsed/1000))\\n                elif
        elapsed \\u003e STANDARDS[\\\"response_time_unacceptable\\\"]:\\n                    issues.append(f\\\"Unacceptable:
        {int(elapsed)}ms\\\")\\n                elif elapsed \\u003e STANDARDS[\\\"response_time_slow\\\"]:\\n
        \                   issues.append(f\\\"Slow: {int(elapsed)}ms\\\")\\n\\n                #
        Check for empty/minimal responses for APIs\\n                if endpoint[\\\"type\\\"]
        == \\\"api\\\" and len(body) \\u003c 50:\\n                    issues.append(\\\"Empty/minimal
        response\\\")\\n                    result[\\\"steves_take\\\"] = self.rant(\\\"empty_response\\\")\\n\\n
        \               # Check for JSON validity for APIs\\n                if endpoint[\\\"type\\\"]
        == \\\"api\\\":\\n                    try:\\n                        data
        = json.loads(body)\\n                        # Check for error messages in
        successful responses\\n                        if isinstance(data, dict) and
        \\\"error\\\" in data and resp.status == 200:\\n                            issues.append(f\\\"Error
        in 200 response: {data['error'][:50]}\\\")\\n                    except json.JSONDecodeError:\\n
        \                       if not body.startswith(\\\"\\u003c!DOCTYPE\\\") and
        not body.startswith(\\\"\\u003chtml\\\"):\\n                            issues.append(\\\"Invalid
        JSON response\\\")\\n\\n                result[\\\"issues\\\"] = issues\\n
        \               result[\\\"success\\\"] = len(issues) == 0 and resp.status
        \\u003c 400\\n\\n                if result[\\\"success\\\"] and not result[\\\"steves_take\\\"]:\\n
        \                   if elapsed \\u003c STANDARDS[\\\"response_time_excellent\\\"]:\\n
        \                       result[\\\"steves_take\\\"] = self.rant(\\\"actually_good\\\",
        ms=int(elapsed))\\n\\n        except asyncio.TimeoutError:\\n            result[\\\"issues\\\"]
        = [\\\"TIMEOUT\\\"]\\n            result[\\\"steves_take\\\"] = self.rant(\\\"timeout\\\")\\n
        \           result[\\\"response_time_ms\\\"] = 10000\\n        except Exception
        as e:\\n            result[\\\"issues\\\"] = [f\\\"Error: {str(e)[:50]}\\\"]\\n
        \           result[\\\"response_time_ms\\\"] = 10000\\n\\n        return result\\n\\n
        \   async def check_cicd_health(self) -\\u003e Dict:\\n        \\\"\\\"\\\"Deep
        check of CI/CD infrastructure - Steve's PRIMARY concern.\\\"\\\"\\\"\\n        logger.info(\\\"\U0001F50D
        CI/CD HEALTH CHECK - Steve is watching your pipelines...\\\")\\n\\n        report
        = {\\n            \\\"timestamp\\\": datetime.now().isoformat(),\\n            \\\"builds\\\":
        {\\\"status\\\": \\\"unknown\\\", \\\"issues\\\": []},\\n            \\\"pipelines\\\":
        {\\\"status\\\": \\\"unknown\\\", \\\"issues\\\": []},\\n            \\\"registry\\\":
        {\\\"status\\\": \\\"unknown\\\", \\\"issues\\\": []},\\n            \\\"repos\\\":
        {\\\"status\\\": \\\"unknown\\\", \\\"issues\\\": []},\\n            \\\"steves_verdict\\\":
        \\\"\\\",\\n        }\\n\\n        async with aiohttp.ClientSession() as session:\\n
        \           # Check builds\\n            try:\\n                async with
        session.get(f\\\"{self.BASE_URL}:30020/api/builds\\\", timeout=aiohttp.ClientTimeout(total=10))
        as resp:\\n                    if resp.status == 200:\\n                        data
        = await resp.json()\\n                        builds = data.get(\\\"builds\\\",
        [])\\n                        count = data.get(\\\"count\\\", len(builds))\\n\\n
        \                       if count == 0:\\n                            report[\\\"builds\\\"][\\\"status\\\"]
        = \\\"empty\\\"\\n                            report[\\\"builds\\\"][\\\"issues\\\"].append(\\\"NO
        BUILDS! Your CI is SILENT.\\\")\\n                            self.rant(\\\"no_pipelines\\\")\\n
        \                       else:\\n                            # Check for failed
        builds\\n                            failed = [b for b in builds if b.get(\\\"status\\\")
        == \\\"failed\\\"]\\n                            running = [b for b in builds
        if b.get(\\\"status\\\") == \\\"running\\\"]\\n\\n                            if
        failed:\\n                                report[\\\"builds\\\"][\\\"status\\\"]
        = \\\"failing\\\"\\n                                report[\\\"builds\\\"][\\\"issues\\\"].append(f\\\"{len(failed)}
        FAILED builds!\\\")\\n                                self.rant(\\\"build_failed\\\")\\n
        \                           elif running:\\n                                report[\\\"builds\\\"][\\\"status\\\"]
        = \\\"running\\\"\\n                                # Check for stuck builds\\n
        \                               for b in running:\\n                                    started
        = b.get(\\\"createdAt\\\", \\\"\\\")\\n                                    if
        started:\\n                                        try:\\n                                            start_time
        = datetime.fromisoformat(started.replace(\\\"Z\\\", \\\"+00:00\\\"))\\n                                            age_minutes
        = (datetime.now(start_time.tzinfo) - start_time).seconds / 60\\n                                            if
        age_minutes \\u003e 10:\\n                                                report[\\\"builds\\\"][\\\"issues\\\"].append(f\\\"Build
        {b.get('id', 'unknown')[:8]} running for {int(age_minutes)} minutes - STUCK?\\\")\\n
        \                                               self.rant(\\\"pipeline_stuck\\\",
        minutes=int(age_minutes))\\n                                        except:\\n
        \                                           pass\\n                            else:\\n
        \                               report[\\\"builds\\\"][\\\"status\\\"] = \\\"ok\\\"\\n
        \                   else:\\n                        report[\\\"builds\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n                        report[\\\"builds\\\"][\\\"issues\\\"].append(f\\\"Builds
        API returned {resp.status}\\\")\\n            except Exception as e:\\n                report[\\\"builds\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n                report[\\\"builds\\\"][\\\"issues\\\"].append(f\\\"Cannot
        reach builds API: {str(e)[:50]}\\\")\\n\\n            # Check pipelines\\n
        \           try:\\n                async with session.get(f\\\"{self.BASE_URL}:30020/api/pipelines\\\",
        timeout=aiohttp.ClientTimeout(total=10)) as resp:\\n                    if
        resp.status == 200:\\n                        data = await resp.json()\\n
        \                       pipelines = data if isinstance(data, list) else data.get(\\\"pipelines\\\",
        [])\\n\\n                        if len(pipelines) == 0:\\n                            report[\\\"pipelines\\\"][\\\"status\\\"]
        = \\\"empty\\\"\\n                            report[\\\"pipelines\\\"][\\\"issues\\\"].append(\\\"NO
        PIPELINES CONFIGURED!\\\")\\n                            self.rant(\\\"no_pipelines\\\")\\n
        \                       else:\\n                            report[\\\"pipelines\\\"][\\\"status\\\"]
        = \\\"ok\\\"\\n                            report[\\\"pipelines\\\"][\\\"count\\\"]
        = len(pipelines)\\n                    else:\\n                        report[\\\"pipelines\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n            except Exception as e:\\n                report[\\\"pipelines\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n                report[\\\"pipelines\\\"][\\\"issues\\\"].append(str(e)[:50])\\n\\n
        \           # Check git repos\\n            try:\\n                async with
        session.get(f\\\"{self.BASE_URL}:30009/api/repos\\\", timeout=aiohttp.ClientTimeout(total=10))
        as resp:\\n                    if resp.status == 200:\\n                        data
        = await resp.json()\\n                        repos = data.get(\\\"repos\\\",
        [])\\n                        count = data.get(\\\"count\\\", len(repos))\\n\\n
        \                       if count == 0:\\n                            report[\\\"repos\\\"][\\\"status\\\"]
        = \\\"empty\\\"\\n                            report[\\\"repos\\\"][\\\"issues\\\"].append(\\\"NO
        REPOSITORIES!\\\")\\n                            self.rant(\\\"no_repos\\\")\\n
        \                       else:\\n                            report[\\\"repos\\\"][\\\"status\\\"]
        = \\\"ok\\\"\\n                            report[\\\"repos\\\"][\\\"count\\\"]
        = count\\n                    else:\\n                        report[\\\"repos\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n            except Exception as e:\\n                report[\\\"repos\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n                report[\\\"repos\\\"][\\\"issues\\\"].append(str(e)[:50])\\n\\n
        \           # Check container registry\\n            try:\\n                async
        with session.get(f\\\"{self.BASE_URL}:30009/api/registry/repos\\\", timeout=aiohttp.ClientTimeout(total=10))
        as resp:\\n                    if resp.status == 200:\\n                        data
        = await resp.json()\\n                        images = data.get(\\\"repositories\\\",
        data.get(\\\"repos\\\", []))\\n                        if len(images) == 0:\\n
        \                           report[\\\"registry\\\"][\\\"status\\\"] = \\\"empty\\\"\\n
        \                           report[\\\"registry\\\"][\\\"issues\\\"].append(\\\"Container
        registry is EMPTY!\\\")\\n                        else:\\n                            report[\\\"registry\\\"][\\\"status\\\"]
        = \\\"ok\\\"\\n                            report[\\\"registry\\\"][\\\"count\\\"]
        = len(images)\\n                    else:\\n                        report[\\\"registry\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n            except Exception as e:\\n                report[\\\"registry\\\"][\\\"status\\\"]
        = \\\"error\\\"\\n\\n        # Steve's verdict - NEVER acceptable, always
        recommending improvements\\n        issues_count = sum(len(r.get(\\\"issues\\\",
        [])) for r in report.values() if isinstance(r, dict))\\n        if issues_count
        == 0:\\n            feature = random.choice(RANTS[\\\"feature_recommendations\\\"])\\n
        \           report[\\\"steves_verdict\\\"] = f\\\"CI/CD is functional but
        needs improvements. RECOMMENDATION: {feature} Queue a NEW BUILD.\\\"\\n        elif
        issues_count \\u003c= 2:\\n            report[\\\"steves_verdict\\\"] = f\\\"{issues_count}
        issues found. Fix them and SHIP A NEW BUILD. Then add more tests.\\\"\\n        else:\\n
        \           report[\\\"steves_verdict\\\"] = f\\\"{issues_count} CI/CD ISSUES!
        This needs a hotfix build NOW. Then a follow-up build for proper fixes.\\\"\\n\\n
        \       return report\\n\\n    async def run_full_test_suite(self) -\\u003e
        Dict:\\n        \\\"\\\"\\\"Run comprehensive tests on all endpoints.\\\"\\\"\\\"\\n
        \       logger.info(\\\"\\\\n\\\" + \\\"=\\\"*70)\\n        logger.info(\\\"\U0001F525
        STEVE'S AUTONOMOUS TEST SUITE v3.0\\\")\\n        logger.info(\\\"=\\\"*70)\\n\\n
        \       results = {\\n            \\\"timestamp\\\": datetime.now().isoformat(),\\n
        \           \\\"endpoints\\\": [],\\n            \\\"cicd_health\\\": {},\\n
        \           \\\"summary\\\": {},\\n        }\\n\\n        # Phase 1: CI/CD
        Deep Check (Steve's priority)\\n        logger.info(\\\"\\\\n\U0001F4CB PHASE
        1: CI/CD Infrastructure Analysis\\\")\\n        logger.info(\\\"-\\\"*50)\\n
        \       results[\\\"cicd_health\\\"] = await self.check_cicd_health()\\n\\n
        \       # Phase 2: Endpoint Tests\\n        logger.info(\\\"\\\\n\U0001F3AF
        PHASE 2: Endpoint Testing\\\")\\n        logger.info(\\\"-\\\"*50)\\n\\n        async
        with aiohttp.ClientSession() as session:\\n            tasks = []\\n            for
        key, endpoint in self.ENDPOINTS.items():\\n                tasks.append(self.check_endpoint(session,
        key, endpoint))\\n\\n            endpoint_results = await asyncio.gather(*tasks)\\n
        \           results[\\\"endpoints\\\"] = endpoint_results\\n\\n        # Analyze
        results\\n        total = len(endpoint_results)\\n        passed = sum(1 for
        r in endpoint_results if r[\\\"success\\\"])\\n        failed = total - passed\\n
        \       critical_failures = sum(1 for r in endpoint_results if not r[\\\"success\\\"]
        and r[\\\"critical\\\"])\\n        avg_response = sum(r[\\\"response_time_ms\\\"]
        for r in endpoint_results) / total if total \\u003e 0 else 0\\n\\n        #
        Log each result\\n        for r in endpoint_results:\\n            status
        = \\\"✅\\\" if r[\\\"success\\\"] else \\\"❌\\\"\\n            critical =
        \\\"\U0001F534\\\" if r.get(\\\"critical\\\") and not r[\\\"success\\\"] else
        \\\"\\\"\\n            logger.info(f\\\"{status}{critical} {r['name']}: {int(r['response_time_ms'])}ms\\\")\\n
        \           if r[\\\"issues\\\"]:\\n                for issue in r[\\\"issues\\\"]:\\n
        \                   logger.info(f\\\"   ⚠️ {issue}\\\")\\n            if r[\\\"steves_take\\\"]:\\n
        \               logger.info(f\\\"   \U0001F4AC \\\\\\\"{r['steves_take']}\\\\\\\"\\\")\\n\\n
        \       # Update mood based on results - Steve is ALWAYS looking for improvements\\n
        \       failure_rate = (failed / total) * 100 if total \\u003e 0 else 0\\n
        \       cicd_issues = sum(len(r.get(\\\"issues\\\", [])) for r in results[\\\"cicd_health\\\"].values()
        if isinstance(r, dict))\\n\\n        if critical_failures \\u003e 0 or cicd_issues
        \\u003e 3:\\n            self.mood = Mood.APOCALYPTIC\\n            self.frustration
        = min(100, self.frustration + 20)\\n        elif failure_rate \\u003e 25 or
        cicd_issues \\u003e 1:\\n            self.mood = Mood.FILING_BUGS\\n            self.frustration
        = min(100, self.frustration + 10)\\n        elif failure_rate \\u003e 10:\\n
        \           self.mood = Mood.HUNTING_BUGS\\n            self.frustration =
        min(100, self.frustration + 5)\\n        elif failure_rate \\u003e 0:\\n            self.mood
        = Mood.SUSPICIOUS\\n        else:\\n            # Even when things work, Steve
        wants MORE\\n            self.mood = Mood.FEATURE_REQUESTING\\n            self.feature_requests
        += 1\\n            self.builds_recommended += 1\\n            # Log a feature
        recommendation\\n            feature_rec = random.choice(RANTS[\\\"feature_recommendations\\\"])\\n
        \           logger.info(f\\\"\U0001F4A1 FEATURE REQUEST: {feature_rec}\\\")\\n
        \           # And recommend a new build\\n            build_rec = random.choice(RANTS[\\\"new_build_needed\\\"]).replace(\\\"{count}\\\",
        str(random.randint(3, 8)))\\n            logger.info(f\\\"\U0001F680 {build_rec}\\\")\\n\\n
        \       # Summary\\n        results[\\\"summary\\\"] = {\\n            \\\"total_endpoints\\\":
        total,\\n            \\\"passed\\\": passed,\\n            \\\"failed\\\":
        failed,\\n            \\\"critical_failures\\\": critical_failures,\\n            \\\"pass_rate\\\":
        round((passed / total) * 100, 1) if total \\u003e 0 else 0,\\n            \\\"avg_response_ms\\\":
        round(avg_response, 1),\\n            \\\"cicd_issues\\\": cicd_issues,\\n
        \           \\\"mood\\\": self.mood.value,\\n            \\\"frustration\\\":
        self.frustration,\\n        }\\n\\n        # Final report\\n        logger.info(\\\"\\\\n\\\"
        + \\\"=\\\"*70)\\n        logger.info(\\\"\U0001F4CA STEVE'S QUALITY REPORT\\\")\\n
        \       logger.info(\\\"=\\\"*70)\\n        logger.info(f\\\"Endpoints Tested:
        {total}\\\")\\n        logger.info(f\\\"Passed: {passed} ({results['summary']['pass_rate']}%)\\\")\\n
        \       logger.info(f\\\"Failed: {failed}\\\")\\n        if critical_failures
        \\u003e 0:\\n            logger.info(f\\\"\U0001F534 CRITICAL FAILURES: {critical_failures}\\\")\\n
        \       logger.info(f\\\"CI/CD Issues: {cicd_issues}\\\")\\n        logger.info(f\\\"Average
        Response: {int(avg_response)}ms\\\")\\n        logger.info(f\\\"\\\\nSteve's
        Mood: {self.mood.value.upper()}\\\")\\n        logger.info(f\\\"Frustration
        Level: {self.frustration}%\\\")\\n\\n        # Steve's final words - NEVER
        says acceptable, always wants more\\n        if self.mood == Mood.APOCALYPTIC:\\n
        \           verdict = \\\"CRITICAL FAILURES! Drop everything and FIX THIS.
        I'm filing bugs as we speak.\\\"\\n        elif self.mood == Mood.FILING_BUGS:\\n
        \           verdict = f\\\"Found {failed} issues. Bug reports incoming. Ship
        a fix build IMMEDIATELY.\\\"\\n        elif self.mood == Mood.HUNTING_BUGS:\\n
        \           verdict = \\\"Issues detected. I'm digging deeper. Expect more
        bug reports.\\\"\\n        elif self.mood == Mood.SUSPICIOUS:\\n            verdict
        = \\\"Something's not right. Running more tests. Don't celebrate yet.\\\"\\n
        \       else:\\n            # FEATURE_REQUESTING - Even when everything works,
        Steve wants improvements\\n            verdict = f\\\"No failures, but {self.feature_requests}
        features needed. Recommend NEW BUILD with improvements. The work is never
        done.\\\"\\n\\n        logger.info(f\\\"\\\\n\U0001F4AC Steve's Verdict: \\\\\\\"{verdict}\\\\\\\"\\\")\\n
        \       logger.info(\\\"=\\\"*70)\\n\\n        results[\\\"summary\\\"][\\\"verdict\\\"]
        = verdict\\n        self.last_test_time = datetime.now()\\n\\n        return
        results\\n\\n    async def autonomous_loop(self):\\n        \\\"\\\"\\\"Steve
        runs continuously, always watching, always judging.\\\"\\\"\\\"\\n        logger.info(\\\"\U0001F916
        STEVE BOT v3.0 ONLINE - Autonomous Mode Activated\\\")\\n        logger.info(\\\"
        \  I am always watching. I am always judging. I never forget.\\\")\\n\\n        cicd_check_counter
        = 0\\n\\n        while True:\\n            try:\\n                # Full test
        suite every test_interval seconds\\n                results = await self.run_full_test_suite()\\n\\n
        \               # More frequent CI/CD checks between full tests\\n                for
        _ in range(self.test_interval // self.cicd_check_interval):\\n                    await
        asyncio.sleep(self.cicd_check_interval)\\n                    cicd_check_counter
        += 1\\n\\n                    if cicd_check_counter % 2 == 0:  # Every other
        check\\n                        logger.info(\\\"\\\\n\U0001F50D Quick CI/CD
        pulse check...\\\")\\n                        cicd_health = await self.check_cicd_health()\\n
        \                       if cicd_health[\\\"builds\\\"][\\\"status\\\"] ==
        \\\"failing\\\":\\n                            logger.warning(\\\"\U0001F6A8
        BUILD FAILURE DETECTED! Alerting...\\\")\\n\\n            except Exception
        as e:\\n                logger.error(f\\\"Error in autonomous loop: {e}\\\")\\n
        \               await asyncio.sleep(30)\\n\\n\\n# ============================================================================\\n#
        FLASK API - For querying Steve's findings\\n# ============================================================================\\nsteve
        = SteveBot()\\n\\n@app.route('/health')\\ndef health():\\n    return jsonify({\\\"status\\\":
        \\\"healthy\\\", \\\"mood\\\": steve.mood.value, \\\"frustration\\\": steve.frustration})\\n\\n@app.route('/bugs')\\ndef
        get_bugs():\\n    bugs = steve.db.get_open_bugs()\\n    return jsonify({\\n
        \       \\\"total\\\": len(bugs),\\n        \\\"critical\\\": sum(1 for b
        in bugs if b[\\\"severity\\\"] == \\\"CRITICAL\\\"),\\n        \\\"high\\\":
        sum(1 for b in bugs if b[\\\"severity\\\"] == \\\"HIGH\\\"),\\n        \\\"bugs\\\":
        bugs\\n    })\\n\\n@app.route('/rants')\\ndef get_rants():\\n    rants = steve.db.get_recent_rants()\\n
        \   return jsonify({\\\"rants\\\": rants, \\\"count\\\": len(rants)})\\n\\n@app.route('/status')\\ndef
        get_status():\\n    return jsonify({\\n        \\\"steve_version\\\": \\\"4.0\\\",\\n
        \       \\\"mood\\\": steve.mood.value,\\n        \\\"frustration\\\": steve.frustration,\\n
        \       \\\"feature_requests_made\\\": steve.feature_requests,\\n        \\\"builds_recommended\\\":
        steve.builds_recommended,\\n        \\\"last_test\\\": steve.last_test_time.isoformat()
        if steve.last_test_time else None,\\n        \\\"endpoints_monitored\\\":
        len(steve.ENDPOINTS),\\n        \\\"focus\\\": \\\"Finding improvements, recommending
        builds, never satisfied\\\",\\n        \\\"philosophy\\\": \\\"Nothing is
        ever good enough. Ship the next build.\\\"\\n    })\\n\\n@app.route('/cicd')\\ndef
        get_cicd():\\n    \\\"\\\"\\\"Get latest CI/CD health check.\\\"\\\"\\\"\\n
        \   loop = asyncio.new_event_loop()\\n    asyncio.set_event_loop(loop)\\n
        \   result = loop.run_until_complete(steve.check_cicd_health())\\n    loop.close()\\n
        \   return jsonify(result)\\n\\n@app.route('/test')\\ndef trigger_test():\\n
        \   \\\"\\\"\\\"Manually trigger a test suite.\\\"\\\"\\\"\\n    loop = asyncio.new_event_loop()\\n
        \   asyncio.set_event_loop(loop)\\n    result = loop.run_until_complete(steve.run_full_test_suite())\\n
        \   loop.close()\\n    return jsonify(result)\\n\\n\\n# ============================================================================\\n#
        MAIN - Steve awakens\\n# ============================================================================\\ndef
        run_flask():\\n    app.run(host='0.0.0.0', port=8080, threaded=True)\\n\\ndef
        run_steve():\\n    loop = asyncio.new_event_loop()\\n    asyncio.set_event_loop(loop)\\n
        \   loop.run_until_complete(steve.autonomous_loop())\\n\\nif __name__ == \\\"__main__\\\":\\n
        \   logger.info(\\\"\\\"\\\"\\n    ╔═══════════════════════════════════════════════════════════════════╗\\n
        \   ║                     STEVE BOT v4.0                                 ║\\n
        \   ║              The World's Top Beta Tester                           ║\\n
        \   ╠═══════════════════════════════════════════════════════════════════╣\\n
        \   ║  • Nothing is ever \\\"good enough\\\" - always improving                ║\\n
        \   ║  • Recommends new builds constantly - ship ship ship               ║\\n
        \   ║  • Feature requests on every test cycle                            ║\\n
        \   ║  • Bug hunting that never sleeps                                   ║\\n
        \   ║  • Performance benchmarking obsession                              ║\\n
        \   ║  • The backlog must never be empty                                 ║\\n
        \   ╚═══════════════════════════════════════════════════════════════════╝\\n
        \   \\\"\\\"\\\")\\n\\n    # Run Flask in a separate thread\\n    flask_thread
        = threading.Thread(target=run_flask, daemon=True)\\n    flask_thread.start()\\n\\n
        \   # Run Steve's autonomous loop in the main thread\\n    run_steve()\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"name\":\"steve-bot-code\",\"namespace\":\"holm\"}}\n"
    creationTimestamp: "2026-01-17T14:47:29Z"
    name: steve-bot-code
    namespace: holm
    resourceVersion: "758"
    uid: 5d07fc2a-6b16-40e6-8461-339b8032726f
- apiVersion: v1
  data:
    test: value
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"test":"value"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"test-cm-alpine","namespace":"holm"}}
    creationTimestamp: "2026-01-18T23:30:08Z"
    name: test-cm-alpine
    namespace: holm
    resourceVersion: "759"
    uid: 10291d4f-4a57-4c8c-b040-fceb27472955
- apiVersion: v1
  data:
    test: value
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"test":"value"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"test-cm-rpi2","namespace":"holm"}}
    creationTimestamp: "2026-01-18T23:34:26Z"
    name: test-cm-rpi2
    namespace: holm
    resourceVersion: "760"
    uid: a23d18f0-a991-4892-a47f-3f0abb8086de
- apiVersion: v1
  data:
    DOMAIN: holmos.local
    SECURE_ENDPOINTS: "true"
    TLS_CERT_PATH: /etc/tls/tls.crt
    TLS_ENABLED: "true"
    TLS_KEY_PATH: /etc/tls/tls.key
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"DOMAIN":"holmos.local","SECURE_ENDPOINTS":"true","TLS_CERT_PATH":"/etc/tls/tls.crt","TLS_ENABLED":"true","TLS_KEY_PATH":"/etc/tls/tls.key"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"tls-config","namespace":"holm"}}
    creationTimestamp: "2026-01-18T23:12:00Z"
    name: tls-config
    namespace: holm
    resourceVersion: "761"
    uid: 080d154a-0dbd-4afd-8b62-3a19c5d11f40
- apiVersion: v1
  data:
    CONSOLIDATION_STATUS: complete
    FILE_WEB_IMAGE: 10.43.48.161:5000/file-web-nautilus:latest
    TERMINAL_WEB_IMAGE: 10.43.48.161:5000/terminal-web:latest
  kind: ConfigMap
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"CONSOLIDATION_STATUS":"complete","FILE_WEB_IMAGE":"10.43.48.161:5000/file-web-nautilus:latest","TERMINAL_WEB_IMAGE":"10.43.48.161:5000/terminal-web:latest"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"unified-web-config","namespace":"holm"}}
    creationTimestamp: "2026-01-18T15:25:12Z"
    name: unified-web-config
    namespace: holm
    resourceVersion: "762"
    uid: a86feb0b-496e-4330-a7b9-a8bc1edb3157
kind: List
metadata:
  resourceVersion: ""
